
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>UseOptiX7GeometryInstancedGASComp &#8212; Opticks 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Opticks 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">UseOptiX7GeometryInstancedGASComp</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#standalone-building">Standalone Building</a></li>
<li><a class="reference internal" href="#links">Links</a></li>
<li><a class="reference internal" href="#top-level">Top Level</a></li>
<li><a class="reference internal" href="#interface-to-optix-7">Interface to OptiX 7</a></li>
<li><a class="reference internal" href="#utilities">Utilities</a></li>
<li><a class="reference internal" href="#diff-useoptix7geometryinstancedgascomp-with-useoptix7geometryinstancedgascompdyn">diff ../UseOptiX7GeometryInstancedGASComp with UseOptiX7GeometryInstancedGASCompDyn</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/examples/UseOptiX7GeometryInstancedGASCompDyn/README.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="useoptix7geometryinstancedgascomp">
<h1><a class="toc-backref" href="#id1">UseOptiX7GeometryInstancedGASComp</a><a class="headerlink" href="#useoptix7geometryinstancedgascomp" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table Of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#useoptix7geometryinstancedgascomp" id="id1">UseOptiX7GeometryInstancedGASComp</a><ul>
<li><a class="reference internal" href="#overview" id="id2">Overview</a></li>
<li><a class="reference internal" href="#standalone-building" id="id3">Standalone Building</a></li>
<li><a class="reference internal" href="#links" id="id4">Links</a></li>
<li><a class="reference internal" href="#top-level" id="id5">Top Level</a></li>
<li><a class="reference internal" href="#interface-to-optix-7" id="id6">Interface to OptiX 7</a></li>
<li><a class="reference internal" href="#utilities" id="id7">Utilities</a></li>
<li><a class="reference internal" href="#diff-useoptix7geometryinstancedgascomp-with-useoptix7geometryinstancedgascompdyn" id="id8">diff ../UseOptiX7GeometryInstancedGASComp with UseOptiX7GeometryInstancedGASCompDyn</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id2">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This example is used as a playground for learning/investigating OptiX 7 techniques needed by Opticks.
Hopefully also some of the OptiX 7 interface classes will subsequenly become part of Opticks.</p>
</div>
<div class="section" id="standalone-building">
<h2><a class="toc-backref" href="#id3">Standalone Building</a><a class="headerlink" href="#standalone-building" title="Permalink to this headline">¶</a></h2>
<p>Does not require Opticks, just depends on NVIDIA OptiX 7.0:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">OPTIX_PREFIX</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">OptiX_700</span>    <span class="c1"># (might need to put this in .bashrc/.bash_profile)</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">bitbucket</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">simoncblyth</span><span class="o">/</span><span class="n">opticks</span>
<span class="n">cd</span> <span class="n">opticks</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">UseOptiX7GeometryInstancedGASComp</span>
<span class="o">./</span><span class="n">go</span><span class="o">.</span><span class="n">sh</span> <span class="c1"># gets glm, builds, runs -&gt; ppm image file</span>
</pre></div>
</div>
</div>
<div class="section" id="links">
<h2><a class="toc-backref" href="#id4">Links</a><a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="../README.html"><span class="doc">Examples of Opticks Usage, especially the CMake machinery</span></a></li>
<li><a class="reference external" href="https://simoncblyth.bitbucket.io/env/presentation/lz_opticks_optix7.html">https://simoncblyth.bitbucket.io/env/presentation/lz_opticks_optix7.html</a></li>
<li><a class="reference external" href="https://www.nvidia.com/en-us/gtc/on-demand/?search=OptiX">https://www.nvidia.com/en-us/gtc/on-demand/?search=OptiX</a></li>
<li><a class="reference external" href="https://developer.download.nvidia.com/video/gputechconf/gtc/2020/presentations/s21888-rtx-accelerated-raytracing-with-optix-7.pdf">https://developer.download.nvidia.com/video/gputechconf/gtc/2020/presentations/s21888-rtx-accelerated-raytracing-with-optix-7.pdf</a></li>
</ul>
</div>
<div class="section" id="top-level">
<h2><a class="toc-backref" href="#id5">Top Level</a><a class="headerlink" href="#top-level" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>UseOptiX7GeometryInstancedGASComp.cc</dt>
<dd>main implemented with Geo and Engine</dd>
<dt>Geo</dt>
<dd>High level holder of GAS and IAS</dd>
<dt>Binding</dt>
<dd>Types needed both on CPU and GPU</dd>
<dt>Engine</dt>
<dd>Holder of OptixDeviceContext context and PIP pipeline</dd>
</dl>
</div>
<div class="section" id="interface-to-optix-7">
<h2><a class="toc-backref" href="#id6">Interface to OptiX 7</a><a class="headerlink" href="#interface-to-optix-7" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>UseOptiX7GeometryInstancedGASComp.cu</dt>
<dd><p class="first">OptiX Programs</p>
<ul class="last simple">
<li>RG : RayGen</li>
<li>MS : Miss</li>
<li>IS : Intersection</li>
<li>CH : ClosestHit</li>
</ul>
</dd>
<dt>PIP</dt>
<dd>Pipeline and SBT (Shader Binding Table) construction</dd>
<dt>AS</dt>
<dd>Acceleration Structure, base struct for GAS and IAS</dd>
<dt>GAS</dt>
<dd>Geometry Acceleration Structure</dd>
<dt>IAS</dt>
<dd>Instance Acceleration Structure</dd>
<dt>GAS_Builder</dt>
<dd>Builds GAS from bbox</dd>
<dt>IAS_Builder</dt>
<dd>Builds IAS from transforms and GAS indices</dd>
</dl>
</div>
<div class="section" id="utilities">
<h2><a class="toc-backref" href="#id7">Utilities</a><a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>SPPM</dt>
<dd>Writing PPM image files</dd>
<dt>sutil_Exception</dt>
<dd>OPTIX_CHECK CUDA_CHECK macros</dd>
<dt>sutil_vec_math</dt>
<dd>simple vec math</dd>
<dt>sutil_Preprocessor</dt>
<dd>Defines used by sutil_vec_math.h</dd>
</dl>
</div>
<div class="section" id="diff-useoptix7geometryinstancedgascomp-with-useoptix7geometryinstancedgascompdyn">
<h2><a class="toc-backref" href="#id8">diff ../UseOptiX7GeometryInstancedGASComp with UseOptiX7GeometryInstancedGASCompDyn</a><a class="headerlink" href="#diff-useoptix7geometryinstancedgascomp-with-useoptix7geometryinstancedgascompdyn" title="Permalink to this headline">¶</a></h2>
<p>Changing SBT record data from from static single radius float to dynamic values array.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[blyth@localhost UseOptiX7GeometryInstancedGASCompDyn]$ ./diff.sh
21c21
&lt; UseOptiX7GeometryInstancedGASCompDyn
---
&gt; UseOptiX7GeometryInstancedGASComp
113c113
&lt;     const char* name = &quot;UseOptiX7GeometryInstancedGASCompDyn&quot; ;
---
&gt;     const char* name = &quot;UseOptiX7GeometryInstancedGASComp&quot; ;
diff ../UseOptiX7GeometryInstancedGASComp/AS.h AS.h
diff ../UseOptiX7GeometryInstancedGASComp/Binding.h Binding.h
32c32
&lt;     float radius;
---
&gt;     float* values ;
diff ../UseOptiX7GeometryInstancedGASComp/Engine.cc Engine.cc
diff ../UseOptiX7GeometryInstancedGASComp/Engine.h Engine.h
diff ../UseOptiX7GeometryInstancedGASComp/GAS_Builder.cc GAS_Builder.cc
diff ../UseOptiX7GeometryInstancedGASComp/GAS_Builder.h GAS_Builder.h
diff ../UseOptiX7GeometryInstancedGASComp/GAS.cc GAS.cc
diff ../UseOptiX7GeometryInstancedGASComp/GAS.h GAS.h
diff ../UseOptiX7GeometryInstancedGASComp/Geo.cc Geo.cc
diff ../UseOptiX7GeometryInstancedGASComp/Geo.h Geo.h
diff ../UseOptiX7GeometryInstancedGASComp/IAS_Builder.cc IAS_Builder.cc
diff ../UseOptiX7GeometryInstancedGASComp/IAS_Builder.h IAS_Builder.h
diff ../UseOptiX7GeometryInstancedGASComp/IAS.cc IAS.cc
diff ../UseOptiX7GeometryInstancedGASComp/IAS.h IAS.h
diff ../UseOptiX7GeometryInstancedGASComp/PIP.cc PIP.cc
261a262,263
&gt;     // allocate CPU side records
&gt;
269a272,273
&gt;
&gt;     unsigned num_values = 1 ;
274c278,301
&lt;         (hg_sbt_ptr + i)-&gt;data.radius = gas.extent ;
---
&gt;
&gt;         // -------- dynamic SBT values ---------------------------
&gt;         float* values = new float[num_values];
&gt;         for(unsigned i=0 ; i &lt; num_values ; i++) values[i] = 0.f ;
&gt;         values[0] = gas.extent ;
&gt;
&gt;         float* d_values = nullptr ;
&gt;         CUDA_CHECK( cudaMalloc(
&gt;                     reinterpret_cast&lt;void**&gt;( &amp;d_values ),
&gt;                     num_values*sizeof(float)
&gt;                     ) );
&gt;
&gt;         CUDA_CHECK( cudaMemcpy(
&gt;                     reinterpret_cast&lt;void*&gt;( d_values ),
&gt;                     values,
&gt;                     sizeof(float)*num_values,
&gt;                     cudaMemcpyHostToDevice
&gt;                     ) );
&gt;
&gt;         delete [] values ;
&gt;         // --------------------------------------------------------
&gt;
&gt;         (hg_sbt_ptr + i)-&gt;data.values = d_values ;
&gt;         // sets device pointer into CPU struct about to be copied to device
277a305
&gt;     // copy CPU side records to GPU
285a314
&gt;
diff ../UseOptiX7GeometryInstancedGASComp/PIP.h PIP.h
diff ../UseOptiX7GeometryInstancedGASComp/SPPM.h SPPM.h
diff ../UseOptiX7GeometryInstancedGASComp/sutil_Exception.h sutil_Exception.h
diff ../UseOptiX7GeometryInstancedGASComp/sutil_Preprocessor.h sutil_Preprocessor.h
diff ../UseOptiX7GeometryInstancedGASComp/sutil_vec_math.h sutil_vec_math.h
[blyth@localhost UseOptiX7GeometryInstancedGASCompDyn]$
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Opticks 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
  </body>
</html>