
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Overview of Opticks Integration Tests &#8212; Opticks 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="tviz- : Visualization Examples" href="tviz.html" />
    <link rel="prev" title="tests- : Opticks Integration Tests" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tviz.html" title="tviz- : Visualization Examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="tests- : Opticks Integration Tests"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Opticks 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">tests- : Opticks Integration Tests</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Overview of Opticks Integration Tests</a><ul>
<li><a class="reference internal" href="#test-geometry-configuration">Test Geometry Configuration</a><ul>
<li><a class="reference internal" href="#test-geometry-shapes">Test Geometry Shapes</a></li>
<li><a class="reference internal" href="#boundary-specification">Boundary Specification</a></li>
<li><a class="reference internal" href="#materials">Materials</a></li>
<li><a class="reference internal" href="#surfaces">Surfaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#torch-configuration">Torch Configuration</a></li>
<li><a class="reference internal" href="#updating-opticks-bash-functions">Updating Opticks Bash Functions</a></li>
<li><a class="reference internal" href="#analysis-only-exercises">Analysis Only Exercises</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">tests- : Opticks Integration Tests</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tviz.html"
                        title="next chapter">tviz- : Visualization Examples</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tests/overview.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="overview-of-opticks-integration-tests">
<h1>Overview of Opticks Integration Tests<a class="headerlink" href="#overview-of-opticks-integration-tests" title="Permalink to this headline">¶</a></h1>
<p>Sourcing <strong>opticks.bash</strong> results in sourcing of the integration test
precursor bash functions.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#### opticks top level tests ########</span>

tviz-<span class="o">(){</span>       . <span class="k">$(</span>opticks-home<span class="k">)</span>/tests/tviz.bash     <span class="o">&amp;&amp;</span> tviz-env <span class="nv">$*</span> <span class="p">;</span> <span class="o">}</span>
tpmt-<span class="o">(){</span>       . <span class="k">$(</span>opticks-home<span class="k">)</span>/tests/tpmt.bash     <span class="o">&amp;&amp;</span> tpmt-env <span class="nv">$*</span> <span class="p">;</span> <span class="o">}</span>
trainbow-<span class="o">(){</span>   . <span class="k">$(</span>opticks-home<span class="k">)</span>/tests/trainbow.bash <span class="o">&amp;&amp;</span> trainbow-env <span class="nv">$*</span> <span class="p">;</span> <span class="o">}</span>
tnewton-<span class="o">(){</span>    . <span class="k">$(</span>opticks-home<span class="k">)</span>/tests/tnewton.bash  <span class="o">&amp;&amp;</span> tnewton-env <span class="nv">$*</span> <span class="p">;</span> <span class="o">}</span>
tprism-<span class="o">(){</span>     . <span class="k">$(</span>opticks-home<span class="k">)</span>/tests/tprism.bash   <span class="o">&amp;&amp;</span> tprism-env <span class="nv">$*</span> <span class="p">;</span> <span class="o">}</span>
tbox-<span class="o">(){</span>       . <span class="k">$(</span>opticks-home<span class="k">)</span>/tests/tbox.bash     <span class="o">&amp;&amp;</span> tbox-env <span class="nv">$*</span> <span class="p">;</span> <span class="o">}</span>
treflect-<span class="o">(){</span>   . <span class="k">$(</span>opticks-home<span class="k">)</span>/tests/treflect.bash <span class="o">&amp;&amp;</span> treflect-env <span class="nv">$*</span> <span class="p">;</span> <span class="o">}</span>
twhite-<span class="o">(){</span>     . <span class="k">$(</span>opticks-home<span class="k">)</span>/tests/twhite.bash   <span class="o">&amp;&amp;</span> twhite-env <span class="nv">$*</span> <span class="p">;</span> <span class="o">}</span>
tlens-<span class="o">(){</span>      . <span class="k">$(</span>opticks-home<span class="k">)</span>/tests/tlens.bash    <span class="o">&amp;&amp;</span> tlens-env <span class="nv">$*</span> <span class="p">;</span> <span class="o">}</span>
tg4gun-<span class="o">(){</span>     . <span class="k">$(</span>opticks-home<span class="k">)</span>/tests/tg4gun.bash   <span class="o">&amp;&amp;</span> tg4gun-env <span class="nv">$*</span> <span class="p">;</span> <span class="o">}</span>
</pre></div>
</div>
<p>Running a precursor function such as <cite>tpmt-</cite> defines other functions
all beginning <cite>tpmt-</cite> such as <cite>tpmt-vi</cite> and <cite>tpmt-usage</cite>.
For more about bash function usage see <a class="reference internal" href="../ana/tools.html"><span class="doc">Tools : bash, python, numpy, ipython, matplotlib</span></a>.</p>
<p>All the tests have a function such as <cite>tpmt–</cite> or <cite>treflect–</cite>
which invokes <strong>op.sh</strong> <a class="reference internal" href="../bin/op.html"><span class="doc">op.sh : Opticks Launching Script</span></a> with arguments specific to the test
which define the geometry, light source (or G4gun parameters) and
where to save event files.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>join<span class="o">(){</span> <span class="nb">local</span> <span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="p">;</span> shift<span class="p">;</span> <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$*</span><span class="s2">&quot;</span><span class="p">;</span> <span class="o">}</span>
op.sh <span class="se">\</span>
    --cat PmtInBox --tag <span class="m">10</span> --save <span class="se">\</span>
    --test --testconfig <span class="s2">&quot;</span><span class="k">$(</span>join _ <span class="si">${</span><span class="nv">test_config</span><span class="p">[@]</span><span class="si">}</span><span class="k">)</span><span class="s2">&quot;</span> <span class="se">\</span>
    --torch --torchconfig <span class="s2">&quot;</span><span class="k">$(</span>join _ <span class="si">${</span><span class="nv">torch_config</span><span class="p">[@]</span><span class="si">}</span><span class="k">)</span><span class="s2">&quot;</span> <span class="se">\</span>
    --timemax <span class="m">10</span> <span class="se">\</span>
    --animtimemax <span class="m">10</span> <span class="se">\</span>
    --eye <span class="m">0</span>.0,-0.5,0.0 <span class="se">\</span>
    --geocenter <span class="se">\</span>
    <span class="nv">$*</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>–cat</strong> : category of the event, for test geometries this
overrides the detector name</li>
<li><strong>–tag</strong> : numerical identifier of a simulation setup within a category,
for example S-polarized and P-polarized setups use different tags.
Also the convention is adopted of giving a Geant4 equivalent setup
a negative tag of the same magnitude.</li>
<li><strong>–save</strong> : saves event files, by default into folders within /tmp/$USER/opticks/evt/</li>
<li><strong>–test</strong> : swiches on use of a test geometry, rather than a full detector geometry</li>
<li><strong>–testconfig</strong> : configures the test geometry, described below</li>
<li><strong>–torch</strong> : swiches on use of artificial light source instead of <strong>–cerenkov</strong> or <strong>–scintillation</strong></li>
<li><strong>–torchconfig</strong> : configures the light source, described below</li>
<li><strong>–timemax</strong> : maximum time in nanoseconds for the simulation, used to set the time compression domain</li>
</ul>
<p>The below <strong>join</strong> functions simply concatenate the <strong>torch_config</strong> and <strong>test_config</strong>
arrays into strings delimited by <strong>_</strong> to simplify passing the config as commandline
options to the Opticks executables.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>--torch --torchconfig <span class="s2">&quot;</span><span class="k">$(</span>join _ <span class="si">${</span><span class="nv">torch_config</span><span class="p">[@]</span><span class="si">}</span><span class="k">)</span><span class="s2">&quot;</span> <span class="se">\</span>
--test --testconfig <span class="s2">&quot;</span><span class="k">$(</span>join _ <span class="si">${</span><span class="nv">test_config</span><span class="p">[@]</span><span class="si">}</span><span class="k">)</span><span class="s2">&quot;</span> <span class="se">\</span>
</pre></div>
</div>
<div class="section" id="test-geometry-configuration">
<h2>Test Geometry Configuration<a class="headerlink" href="#test-geometry-configuration" title="Permalink to this headline">¶</a></h2>
<p>The code that interprets the configuration is <a class="reference external" href="http://bitbucket.org/simoncblyth/opticks/src/tip/ggeo/GGeoTestConfig.cc">oktip:ggeo/GGeoTestConfig.cc</a>.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">local</span> <span class="nv">material</span><span class="o">=</span>GlassSchottF2
<span class="nb">local</span> <span class="nv">test_config</span><span class="o">=(</span>
            <span class="nv">mode</span><span class="o">=</span>BoxInBox
            <span class="nv">analytic</span><span class="o">=</span><span class="m">1</span>

            <span class="nv">shape</span><span class="o">=</span>box   <span class="nv">parameters</span><span class="o">=</span>-1,1,0,700           <span class="nv">boundary</span><span class="o">=</span>Rock//perfectAbsorbSurface/Vacuum
            <span class="nv">shape</span><span class="o">=</span>lens  <span class="nv">parameters</span><span class="o">=</span><span class="m">641</span>.2,641.2,-600,600 <span class="nv">boundary</span><span class="o">=</span>Vacuum///<span class="nv">$material</span>
          <span class="o">)</span>
</pre></div>
</div>
<p>Multiple <strong>shape</strong>, <strong>parameters</strong> and <strong>boundary</strong> are supported, there must be
an equal number of each. Available modes are: <strong>BoxInBox</strong> and <strong>PmtInBox</strong>.</p>
<div class="section" id="test-geometry-shapes">
<h3>Test Geometry Shapes<a class="headerlink" href="#test-geometry-shapes" title="Permalink to this headline">¶</a></h3>
<p>To see the supported shapes and discover the meaning of the parameters
start from <a class="reference external" href="http://bitbucket.org/simoncblyth/opticks/src/tip/ggeo/GMaker.cc">oktip:ggeo/GMaker.cc</a>.</p>
</div>
<div class="section" id="boundary-specification">
<h3>Boundary Specification<a class="headerlink" href="#boundary-specification" title="Permalink to this headline">¶</a></h3>
<p>Boundaries are composed of four parts:</p>
<ul class="simple">
<li>outer material</li>
<li>outer surface, relevant to incoming photons</li>
<li>inner surface, relevant to outgoing photons</li>
<li>inner material</li>
</ul>
<p>They are specified by a string with <strong>/</strong> delimiters,
surfaces are optional, materials are required.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>Rock//perfectAbsorbSurface/Vacuum
</pre></div>
</div>
<p>See <a class="reference internal" href="../ana/boundary.html"><span class="doc">boundary.py : inner/outer materials and surfaces</span></a> for more.</p>
</div>
<div class="section" id="materials">
<h3>Materials<a class="headerlink" href="#materials" title="Permalink to this headline">¶</a></h3>
<p>To dump materials names and properties, use <cite>op –mat</cite> eg:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>op --mat --ggeo warn  <span class="c1"># titles and property names</span>
op --mat <span class="m">0</span>            <span class="c1"># table of properties of material with index 0</span>
op --mat GdDopedLS    <span class="c1"># table of properties of material identified by name</span>
op --mat              <span class="c1"># tables of all material properties</span>
</pre></div>
</div>
</div>
<div class="section" id="surfaces">
<h3>Surfaces<a class="headerlink" href="#surfaces" title="Permalink to this headline">¶</a></h3>
<p>Similary for dumping surfaces use <cite>op –surf</cite>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>op --surf --ggeo warn
</pre></div>
</div>
<p>Note that surfaces have not yet been debugged, you are advised
to only use the <strong>perfect</strong> surfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">perfectDetectSurface</span>
<span class="n">perfectAbsorbSurface</span>
<span class="n">perfectSpecularSurface</span>
<span class="n">perfectDiffuseSurface</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="torch-configuration">
<h2>Torch Configuration<a class="headerlink" href="#torch-configuration" title="Permalink to this headline">¶</a></h2>
<p>Relevant sources:</p>
<ul class="simple">
<li><a class="reference external" href="http://bitbucket.org/simoncblyth/opticks/src/tip/opticksnpy/TorchStepNPY.cpp">oktip:opticksnpy/TorchStepNPY.cpp</a> parses the config</li>
<li><a class="reference external" href="http://bitbucket.org/simoncblyth/opticks/src/tip/opticksnpy/TorchStepNPY.hpp">oktip:opticksnpy/TorchStepNPY.hpp</a> header used from both C++ and CUDA</li>
<li><a class="reference external" href="http://bitbucket.org/simoncblyth/opticks/src/tip/optixrap/cu/torchstep.h">oktip:optixrap/cu/torchstep.h</a></li>
<li><a class="reference internal" href="../optixrap/cu/torchstep.html"><span class="doc">torchstep.h : Torch modes</span></a></li>
</ul>
<p>Example torch config used by <a class="reference internal" href="treflect.html"><span class="doc">treflect- : Fresnel reflection vs incident angle check</span></a></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">local</span> <span class="nv">pol</span><span class="o">=</span>s
<span class="nb">local</span> <span class="nv">photons</span><span class="o">=</span><span class="m">1000000</span>
<span class="nb">local</span> <span class="nv">torch_config</span><span class="o">=(</span>
             <span class="nv">type</span><span class="o">=</span>refltest
             <span class="nv">photons</span><span class="o">=</span><span class="nv">$photons</span>
             <span class="nv">mode</span><span class="o">=</span><span class="si">${</span><span class="nv">pol</span><span class="si">}</span>pol,flatTheta
             <span class="nv">polarization</span><span class="o">=</span><span class="m">0</span>,0,-1
             <span class="nv">frame</span><span class="o">=</span>-1
             <span class="nv">transform</span><span class="o">=</span><span class="m">1</span>.000,0.000,0.000,0.000,0.000,1.000,0.000,0.000,0.000,0.000,1.000,0.000,0.000,0.000,0.000,1.000
             <span class="nv">source</span><span class="o">=</span><span class="m">0</span>,0,-200
             <span class="nv">radius</span><span class="o">=</span><span class="m">100</span>
             <span class="nv">distance</span><span class="o">=</span><span class="m">25</span>
             <span class="nv">zenithazimuth</span><span class="o">=</span><span class="m">0</span>.5,1,0,1
             <span class="nv">material</span><span class="o">=</span>Vacuum
             <span class="nv">wavelength</span><span class="o">=</span><span class="m">550</span>
           <span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="updating-opticks-bash-functions">
<h2>Updating Opticks Bash Functions<a class="headerlink" href="#updating-opticks-bash-functions" title="Permalink to this headline">¶</a></h2>
<p>If you have not yet cloned Opticks to your machine, do so with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span>
<span class="n">hg</span> <span class="n">clone</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">bitbucket</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">simoncblyth</span><span class="o">/</span><span class="n">opticks</span>
</pre></div>
</div>
<p>If you have already done the above, make sure to update to the latest version with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">opticks</span>
<span class="n">hg</span> <span class="n">pull</span>
<span class="n">hg</span> <span class="n">update</span>
</pre></div>
</div>
<p>Then update your bash enviroment by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opticks</span><span class="o">-</span>
</pre></div>
</div>
</div>
<div class="section" id="analysis-only-exercises">
<h2>Analysis Only Exercises<a class="headerlink" href="#analysis-only-exercises" title="Permalink to this headline">¶</a></h2>
<p>Sections labelled <strong>ANALYSIS EXERCISE</strong> can be done without a full Opticks installation.
You will however need to copy some files to your machine, using  <strong>opticks-</strong> bash functions.</p>
<p>First update you Opticks bash functions as described above
and then run the below function to copy files to your machine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opticks</span><span class="o">-</span><span class="n">analysis</span><span class="o">-</span><span class="n">only</span><span class="o">-</span><span class="n">setup</span>
</pre></div>
</div>
<p>To see what the function does use the <strong>t</strong> alias that
you should have in your <cite>~/.bash_profile</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[simonblyth@optix ~]$ t opticks-analysis-only-setup  # alias t=&quot;typeset -f&quot;
opticks-analysis-only-setup ()
{
    opticksdata-;
    opticksdata-get;
    opticks-geo-get;
    opticks-evt-get rainbow
}
</pre></div>
</div>
<p>This will <strong>scp</strong> files from the workstation installation, you will
be prompted for your workstation password several times.</p>
<p>Note this only copies <strong>rainbow</strong> files, to do other exercises you will
need to run for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opticks</span><span class="o">-</span><span class="n">evt</span><span class="o">-</span><span class="n">get</span> <span class="n">reflect</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tviz.html" title="tviz- : Visualization Examples"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="tests- : Opticks Integration Tests"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Opticks 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >tests- : Opticks Integration Tests</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.2.
    </div>
  </body>
</html>