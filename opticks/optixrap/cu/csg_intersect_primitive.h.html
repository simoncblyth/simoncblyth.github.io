
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>csg_intersect_primitive.h : Intersections with ~10 different primitives &#8212; Opticks 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Opticks 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">csg_intersect_primitive.h :  Intersections with ~10 different primitives</a><ul>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-convexpolyhedron">csg_intersect_primitive.h : csg_bounds_convexpolyhedron</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-convexpolyhedron">csg_intersect_primitive.h : csg_intersect_convexpolyhedron</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-cone">csg_intersect_primitive.h : csg_bounds_cone</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-cone">csg_intersect_primitive.h : csg_intersect_cone</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-hyperboloid">csg_intersect_primitive.h : csg_bounds_hyperboloid</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-hyperboloid">csg_intersect_primitive.h : csg_intersect_hyperboloid</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-sphere">csg_intersect_primitive.h : csg_bounds_sphere</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-sphere">csg_intersect_primitive.h : csg_intersect_sphere</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-zsphere">csg_intersect_primitive.h : csg_bounds_zsphere</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-zsphere">csg_intersect_primitive.h : csg_intersect_zsphere</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-box">csg_intersect_primitive.h : csg_bounds_box</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-box3">csg_intersect_primitive.h : csg_bounds_box3</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-box">csg_intersect_primitive.h : _csg_intersect_box</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-box3">csg_intersect_primitive.h : csg_intersect_box3</a></li>
<li><a class="reference internal" href="#id1">csg_intersect_primitive.h : csg_intersect_box</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-plane">csg_intersect_primitive.h : csg_bounds_plane</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-plane">csg_intersect_primitive.h : csg_intersect_plane</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-slab">csg_intersect_primitive.h : csg_bounds_slab</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-slab">csg_intersect_primitive.h : csg_intersect_slab</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-cylinder">csg_intersect_primitive.h : csg_bounds_cylinder</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-disc">csg_intersect_primitive.h : csg_bounds_disc</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-disc">csg_intersect_primitive.h : csg_intersect_disc</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-cylinder">csg_intersect_primitive.h : csg_intersect_cylinder</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/optixrap/cu/csg_intersect_primitive.h.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="csg-intersect-primitive-h-intersections-with-10-different-primitives">
<h1><a class="toc-backref" href="#id2">csg_intersect_primitive.h :  Intersections with ~10 different primitives</a><a class="headerlink" href="#csg-intersect-primitive-h-intersections-with-10-different-primitives" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference external" href="https://bitbucket.org/simoncblyth/opticks/src/master/optixrap/cu/csg_intersect_primitive.h">https://bitbucket.org/simoncblyth/opticks/src/master/optixrap/cu/csg_intersect_primitive.h</a></li>
<li><em>csg_intersect_primitive.h</em> is included into top level program <em>intersect_analytic.cu</em></li>
<li><em>csg_intersect_part.h</em> is primary user of these intersect and bounds functions</li>
</ul>
<a class="reference internal image-reference" href="../../_images/tboolean_parade_sep2017.png"><img alt="//env/presentation/tboolean_parade_sep2017.png" src="../../_images/tboolean_parade_sep2017.png" style="width: 1024px;" /></a>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#csg-intersect-primitive-h-intersections-with-10-different-primitives" id="id2">csg_intersect_primitive.h :  Intersections with ~10 different primitives</a><ul>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-convexpolyhedron" id="id3">csg_intersect_primitive.h : csg_bounds_convexpolyhedron</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-convexpolyhedron" id="id4">csg_intersect_primitive.h : csg_intersect_convexpolyhedron</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-cone" id="id5">csg_intersect_primitive.h : csg_bounds_cone</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-cone" id="id6">csg_intersect_primitive.h : csg_intersect_cone</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-hyperboloid" id="id7">csg_intersect_primitive.h : csg_bounds_hyperboloid</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-hyperboloid" id="id8">csg_intersect_primitive.h : csg_intersect_hyperboloid</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-sphere" id="id9">csg_intersect_primitive.h : csg_bounds_sphere</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-sphere" id="id10">csg_intersect_primitive.h : csg_intersect_sphere</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-zsphere" id="id11">csg_intersect_primitive.h : csg_bounds_zsphere</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-zsphere" id="id12">csg_intersect_primitive.h : csg_intersect_zsphere</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-box" id="id13">csg_intersect_primitive.h : csg_bounds_box</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-box3" id="id14">csg_intersect_primitive.h : csg_bounds_box3</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-box" id="id15">csg_intersect_primitive.h : _csg_intersect_box</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-box3" id="id16">csg_intersect_primitive.h : csg_intersect_box3</a></li>
<li><a class="reference internal" href="#id1" id="id17">csg_intersect_primitive.h : csg_intersect_box</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-plane" id="id18">csg_intersect_primitive.h : csg_bounds_plane</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-plane" id="id19">csg_intersect_primitive.h : csg_intersect_plane</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-slab" id="id20">csg_intersect_primitive.h : csg_bounds_slab</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-slab" id="id21">csg_intersect_primitive.h : csg_intersect_slab</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-cylinder" id="id22">csg_intersect_primitive.h : csg_bounds_cylinder</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-bounds-disc" id="id23">csg_intersect_primitive.h : csg_bounds_disc</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-disc" id="id24">csg_intersect_primitive.h : csg_intersect_disc</a></li>
<li><a class="reference internal" href="#csg-intersect-primitive-h-csg-intersect-cylinder" id="id25">csg_intersect_primitive.h : csg_intersect_cylinder</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-bounds-convexpolyhedron">
<h2><a class="toc-backref" href="#id3">csg_intersect_primitive.h : csg_bounds_convexpolyhedron</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-bounds-convexpolyhedron" title="Permalink to this headline">¶</a></h2>
<p>Bounds of convex polyhedron defined by a set of planes.</p>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-intersect-convexpolyhedron">
<h2><a class="toc-backref" href="#id4">csg_intersect_primitive.h : csg_intersect_convexpolyhedron</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-intersect-convexpolyhedron" title="Permalink to this headline">¶</a></h2>
<p>Intersect with convex polyhedron defined by a set of planes.</p>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-bounds-cone">
<h2><a class="toc-backref" href="#id5">csg_intersect_primitive.h : csg_bounds_cone</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-bounds-cone" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-intersect-cone">
<h2><a class="toc-backref" href="#id6">csg_intersect_primitive.h : csg_intersect_cone</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-intersect-cone" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-bounds-hyperboloid">
<h2><a class="toc-backref" href="#id7">csg_intersect_primitive.h : csg_bounds_hyperboloid</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-bounds-hyperboloid" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-intersect-hyperboloid">
<h2><a class="toc-backref" href="#id8">csg_intersect_primitive.h : csg_intersect_hyperboloid</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-intersect-hyperboloid" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-bounds-sphere">
<h2><a class="toc-backref" href="#id9">csg_intersect_primitive.h : csg_bounds_sphere</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-bounds-sphere" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-intersect-sphere">
<h2><a class="toc-backref" href="#id10">csg_intersect_primitive.h : csg_intersect_sphere</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-intersect-sphere" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-bounds-zsphere">
<h2><a class="toc-backref" href="#id11">csg_intersect_primitive.h : csg_bounds_zsphere</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-bounds-zsphere" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-intersect-zsphere">
<h2><a class="toc-backref" href="#id12">csg_intersect_primitive.h : csg_intersect_zsphere</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-intersect-zsphere" title="Permalink to this headline">¶</a></h2>
<p>Plane eqn in general frame:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">point_in_plane</span><span class="o">.</span><span class="n">plane_normal</span> <span class="o">=</span> <span class="n">plane_dist_to_origin</span>
</pre></div>
</div>
<p>Ray-Plane intersection:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span> <span class="n">ray_origin</span> <span class="o">+</span> <span class="n">t</span> <span class="n">ray_direction</span> <span class="p">)</span><span class="o">.</span><span class="n">plane_normal</span> <span class="o">=</span> <span class="n">plane_dist_to_origin</span>

 <span class="n">t</span> <span class="o">=</span> <span class="n">plane_dist_to_origin</span> <span class="o">-</span> <span class="n">ray_origin</span><span class="o">.</span><span class="n">plane_normal</span>
    <span class="o">-------------------------------------------------</span>
            <span class="n">ray_direction</span><span class="o">.</span><span class="n">plane_normal</span>
</pre></div>
</div>
<p>Now consider plane normal to be +z axis and:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">plane_dist_to_origin</span> <span class="o">-</span> <span class="n">ray_origin</span><span class="o">.</span><span class="n">z</span>
   <span class="o">--------------------------------------</span>
         <span class="n">ray_direction</span><span class="o">.</span><span class="n">z</span>

<span class="n">plane_dist_to_orign</span> <span class="o">=</span> <span class="n">zmin</span> <span class="ow">or</span> <span class="n">zmax</span>
</pre></div>
</div>
<p>Intersect with sphere:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">O</span> <span class="o">=</span> <span class="n">ray_origin</span> <span class="o">-</span> <span class="n">center</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">ray_direction</span>

<span class="p">(</span><span class="n">O</span> <span class="o">+</span> <span class="n">t</span> <span class="n">D</span><span class="p">)</span><span class="o">.</span><span class="p">(</span><span class="n">O</span> <span class="o">+</span> <span class="n">t</span> <span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="n">rr</span>

<span class="n">t</span><span class="o">^</span><span class="mi">2</span> <span class="n">D</span><span class="o">.</span><span class="n">D</span> <span class="o">+</span> <span class="mi">2</span> <span class="n">t</span> <span class="n">O</span><span class="o">.</span><span class="n">D</span> <span class="o">+</span> <span class="n">O</span><span class="o">.</span><span class="n">O</span> <span class="o">-</span> <span class="n">rr</span>  <span class="o">=</span> <span class="mi">0</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">D</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">O</span><span class="o">.</span><span class="n">D</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">O</span><span class="o">.</span><span class="n">O</span> <span class="o">-</span> <span class="n">rr</span>
</pre></div>
</div>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-bounds-box">
<h2><a class="toc-backref" href="#id13">csg_intersect_primitive.h : csg_bounds_box</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-bounds-box" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-bounds-box3">
<h2><a class="toc-backref" href="#id14">csg_intersect_primitive.h : csg_bounds_box3</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-bounds-box3" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-intersect-box">
<h2><a class="toc-backref" href="#id15">csg_intersect_primitive.h : _csg_intersect_box</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-intersect-box" title="Permalink to this headline">¶</a></h2>
<p>Just because the ray intersects the box doesnt
mean its a usable intersect, there are 3 possibilities</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">t_near</span>       <span class="n">t_far</span>

          <span class="o">|</span>           <span class="o">|</span>
<span class="o">-----</span><span class="mi">1</span><span class="o">----|----</span><span class="mi">2</span><span class="o">------|------</span><span class="mi">3</span><span class="o">----------&gt;</span>
          <span class="o">|</span>           <span class="o">|</span>
</pre></div>
</div>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-intersect-box3">
<h2><a class="toc-backref" href="#id16">csg_intersect_primitive.h : csg_intersect_box3</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-intersect-box3" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id17">csg_intersect_primitive.h : csg_intersect_box</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-bounds-plane">
<h2><a class="toc-backref" href="#id18">csg_intersect_primitive.h : csg_bounds_plane</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-bounds-plane" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-intersect-plane">
<h2><a class="toc-backref" href="#id19">csg_intersect_primitive.h : csg_intersect_plane</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-intersect-plane" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-bounds-slab">
<h2><a class="toc-backref" href="#id20">csg_intersect_primitive.h : csg_bounds_slab</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-bounds-slab" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-intersect-slab">
<h2><a class="toc-backref" href="#id21">csg_intersect_primitive.h : csg_intersect_slab</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-intersect-slab" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-bounds-cylinder">
<h2><a class="toc-backref" href="#id22">csg_intersect_primitive.h : csg_bounds_cylinder</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-bounds-cylinder" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-bounds-disc">
<h2><a class="toc-backref" href="#id23">csg_intersect_primitive.h : csg_bounds_disc</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-bounds-disc" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-intersect-disc">
<h2><a class="toc-backref" href="#id24">csg_intersect_primitive.h : csg_intersect_disc</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-intersect-disc" title="Permalink to this headline">¶</a></h2>
<p>RTCD p197  (Real Time Collision Detection)</p>
<p>CSG_DISC was implemented to avoid degeneracy/speckle problems when using CSG_CYLINDER
to describe very flat cylinders such as Daya Bays ESR mirror surface.
Note that the simplicity of disc intersects compared to cylinder has allowed
inner radius handling (in param.f.z) for easy annulus definition without using CSG subtraction.</p>
<p>NB ray-plane intersects are performed with the center disc only at:  z = zc = (z1+z2)/2
The t_center obtained is then deltared up and down depending on (z2-z1)/2</p>
<p>This approach appears to avoid the numerical instability speckling problems encountered
with csg_intersect_cylinder when dealing with very flat disc like cylinders.</p>
<p>Note that intersects with the edge of the disk are not implemented, if such intersects
are relevant you need to use CSG_CYLINDER not CSG_DISC.</p>
<p>For testing see tboolean-esr and tboolean-disc.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>       <span class="n">r</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="n">O</span> <span class="o">+</span> <span class="n">t</span> <span class="n">n</span>

                      <span class="o">^</span> <span class="o">/</span>         <span class="o">^</span>
                      <span class="o">|/</span>          <span class="o">|</span> <span class="n">d</span>
<span class="o">----------------------+-----------|--------------------------------</span> <span class="n">z2</span>
                     <span class="o">/</span>            <span class="o">|</span>
<span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">*</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="n">C</span><span class="o">-</span> <span class="o">-</span> <span class="o">-</span>  <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="o">-</span> <span class="n">zc</span>
                   <span class="o">/</span>
<span class="o">------------------+------------------------------------------------</span> <span class="n">z1</span>
                 <span class="o">/|</span>
                <span class="o">/</span> <span class="n">V</span>
               <span class="o">/</span>
              <span class="n">O</span>

 <span class="n">m</span> <span class="o">=</span> <span class="n">O</span> <span class="o">-</span> <span class="n">C</span>
</pre></div>
</div>
<p>To work as a CSG sub-object MUST have a different intersect
on the other side and normals must be rigidly attached to
geometry (must not depend on ray direction)</p>
<p>Intersect of ray and plane:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="n">ray_origin</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">ray_direction</span>

<span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span><span class="o">.</span><span class="n">d</span>  <span class="o">=</span> <span class="p">(</span> <span class="n">m</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">n</span> <span class="p">)</span><span class="o">.</span><span class="n">d</span>  <span class="o">=</span> <span class="mi">0</span>    <span class="o">&lt;--</span> <span class="n">at</span> <span class="n">intersections</span> <span class="n">of</span> <span class="n">ray</span> <span class="ow">and</span> <span class="n">plane</span> <span class="n">thru</span> <span class="n">center</span> <span class="k">with</span> <span class="n">normal</span> <span class="n">d</span>

<span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">d</span> <span class="o">/</span> <span class="n">n</span><span class="o">.</span><span class="n">d</span>
</pre></div>
</div>
<p>Consider wiggling center up to z2 and down to z1 (in direction of normal d) n.d is unchanged:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">center</span><span class="o">+</span> <span class="n">delta</span> <span class="n">d</span> <span class="p">))</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>

<span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">delta</span> <span class="n">d</span> <span class="p">)</span><span class="o">.</span><span class="n">d</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">m</span><span class="o">.</span><span class="n">d</span> <span class="o">-</span> <span class="n">delta</span> <span class="o">+</span> <span class="n">t</span><span class="o">*</span> <span class="n">nd</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">t</span> <span class="o">=</span>  <span class="o">-</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">d</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="o">.</span><span class="n">d</span>

  <span class="o">=</span> <span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">n</span><span class="o">.</span><span class="n">d</span>  <span class="o">+-</span> <span class="n">delta</span><span class="o">/</span><span class="n">n</span><span class="o">.</span><span class="n">d</span>
</pre></div>
</div>
<p>Intersect is inside disc radius when:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rsq</span> <span class="o">=</span>   <span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span><span class="o">.</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">radius</span><span class="o">*</span><span class="n">radius</span>

<span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">t</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">t</span> <span class="n">n</span><span class="p">)</span>  <span class="o">&lt;</span>  <span class="n">rr</span>

<span class="n">t</span><span class="o">*</span><span class="n">t</span> <span class="n">nn</span> <span class="o">+</span> <span class="mi">2</span> <span class="n">t</span> <span class="n">nm</span> <span class="o">+</span> <span class="n">mm</span>  <span class="o">&lt;</span>  <span class="n">rr</span>

<span class="n">t</span> <span class="p">(</span> <span class="mi">2</span> <span class="n">nm</span> <span class="o">+</span> <span class="n">t</span> <span class="n">nn</span> <span class="p">)</span> <span class="o">+</span> <span class="n">mm</span>   <span class="o">&lt;</span>  <span class="n">rr</span>

<span class="n">rsq</span> <span class="o">&lt;</span> <span class="n">rr</span>    <span class="n">checkr</span><span class="p">(</span><span class="kn">from</span> <span class="nn">cylinder</span><span class="p">)</span> <span class="ow">is</span><span class="p">:</span> <span class="n">rsq</span> <span class="o">-</span> <span class="n">rr</span>
</pre></div>
</div>
<p>Determine whether the t_cand intersect hit after delta-ing
is on the upside (normal +Z) or downside (normal -Z) of disc
from the sign of the below dot product, allowing determination
of the rigid outward normal direction.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="n">ray_origin</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">ray_direction</span>

<span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="n">t_cand</span><span class="p">)</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span><span class="o">.</span><span class="n">d</span>  <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">d</span> <span class="o">+</span> <span class="n">t_cand</span> <span class="n">n</span><span class="o">.</span><span class="n">d</span>
</pre></div>
</div>
</div>
<div class="section" id="csg-intersect-primitive-h-csg-intersect-cylinder">
<h2><a class="toc-backref" href="#id25">csg_intersect_primitive.h : csg_intersect_cylinder</a><a class="headerlink" href="#csg-intersect-primitive-h-csg-intersect-cylinder" title="Permalink to this headline">¶</a></h2>
<p>Hmm supporting cylinder with inner radius
directly will add a boatload of cases…:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                 <span class="o">/</span>    <span class="o">/</span>        <span class="o">/</span>
                <span class="o">/</span>    <span class="o">/</span>        <span class="o">/</span>
    <span class="o">+------+</span>   <span class="o">/</span>  <span class="o">.</span> <span class="o">/</span>    <span class="o">+---*--+</span>
    <span class="o">|</span>      <span class="o">|</span>  <span class="o">/</span>   <span class="o">./</span>     <span class="o">|</span>  <span class="o">/</span>   <span class="o">|</span>
<span class="o">----*------*------/------*-/----*------</span>
    <span class="o">|</span>      <span class="o">|/</span>    <span class="o">/.</span>      <span class="o">|/</span>     <span class="o">|</span>
    <span class="o">|</span>      <span class="o">*</span>    <span class="o">/</span> <span class="o">.</span>      <span class="o">*</span>      <span class="o">|</span>
    <span class="o">|</span>     <span class="o">/|</span>   <span class="o">/</span>  <span class="o">.</span>     <span class="o">/|</span>      <span class="o">|</span>
    <span class="o">|</span>    <span class="o">/</span> <span class="o">|</span>  <span class="o">/</span>   <span class="o">.</span>    <span class="o">/</span> <span class="o">|</span>      <span class="o">|</span>
    <span class="o">+---*--+</span> <span class="o">/</span>    <span class="o">.</span>   <span class="o">/</span>  <span class="o">+------+</span>
       <span class="o">/</span>    <span class="o">/</span>        <span class="o">/</span>
      <span class="o">/</span>    <span class="o">/</span>        <span class="o">/</span>
     <span class="o">/</span>    <span class="o">/</span>        <span class="o">/</span>
</pre></div>
</div>
<p>Unless could implement by doing internal to the primitive
boolean combination intersects with the full cylinder
and inner cylinder. Hmm this just duplicates what
CSG difference or intersect with complement would do though…
so no point.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Opticks 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
  </body>
</html>