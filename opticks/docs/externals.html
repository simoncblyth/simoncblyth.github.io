
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Opticks Externals &#8212; Opticks 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Opticks Testing, Geocache Creation, Python setup" href="testing.html" />
    <link rel="prev" title="Opticks Install Instructions" href="install.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="testing.html" title="Opticks Testing, Geocache Creation, Python setup"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Opticks Install Instructions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Opticks 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Opticks Externals</a><ul>
<li><a class="reference internal" href="#three-type-of-externals-system-foreign-and-automated">Three type of externals : system, foreign and automated</a></li>
<li><a class="reference internal" href="#brief-description-of-foreign-and-automated-externals">Brief description of foreign and automated externals</a></li>
<li><a class="reference internal" href="#former-externals-that-are-no-longer-in-use">Former externals that are no longer in use</a></li>
<li><a class="reference internal" href="#separate-installation-of-externals-useful-for-debugging-the-build">Separate installation of externals : useful for debugging the build</a></li>
<li><a class="reference internal" href="#foreign-externals">Foreign Externals</a></li>
<li><a class="reference internal" href="#automated-externals">Automated Externals</a></li>
<li><a class="reference internal" href="#base-externals">Base externals</a></li>
<li><a class="reference internal" href="#visualization-externals">Visualization externals</a></li>
<li><a class="reference internal" href="#mesh-manipulation-and-polygonization-externals-planned-to-be-eliminated">Mesh manipulation and polygonization externals (planned to be eliminated)</a></li>
<li><a class="reference internal" href="#former-externals">Former externals</a></li>
<li><a class="reference internal" href="#boost-c-libraries">Boost C++ Libraries</a><ul>
<li><a class="reference internal" href="#updating-boost">Updating Boost</a></li>
</ul>
</li>
<li><a class="reference internal" href="#opticks-pre-requisites-nvidia-optix-and-nvidia-cuda">Opticks Pre-requisites : NVIDIA OptiX and NVIDIA CUDA</a><ul>
<li><a class="reference internal" href="#finding-cuda">Finding CUDA</a></li>
<li><a class="reference internal" href="#versions-of-cuda-and-optix">Versions of CUDA and OptiX</a></li>
<li><a class="reference internal" href="#nvidia-driver-versions">NVIDIA Driver Versions</a></li>
<li><a class="reference internal" href="#optix-6-5-0-august-26-2019">OptiX 6.5.0 (August 26, 2019)</a></li>
<li><a class="reference internal" href="#problems-with-optix-6-5-0-driver-440-33-01-cuda-10-2">Problems with OptiX 6.5.0, Driver 440.33.01, CUDA 10.2</a></li>
<li><a class="reference internal" href="#optix-7-0-0-july-29-2019">OptiX 7.0.0 (July 29, 2019)</a></li>
<li><a class="reference internal" href="#optix-6-0-0-february-2018">OptiX 6.0.0 (February 2018)</a></li>
<li><a class="reference internal" href="#using-a-non-standard-optix-version">Using a non-standard OptiX version</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-opticks-against-foreign-externals-such-as-geant4-boost">Building Opticks against “foreign” externals such as Geant4, Boost</a></li>
<li><a class="reference internal" href="#testing-cuda-and-optix-installs-and-nvcc-toolchain">Testing CUDA and OptiX Installs and nvcc toolchain</a></li>
<li><a class="reference internal" href="#testing-thrust">Testing Thrust</a></li>
<li><a class="reference internal" href="#geant4">Geant4</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="install.html"
                        title="previous chapter">Opticks Install Instructions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="testing.html"
                        title="next chapter">Opticks Testing, Geocache Creation, Python setup</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/docs/externals.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="opticks-externals">
<h1><a class="toc-backref" href="#id1">Opticks Externals</a><a class="headerlink" href="#opticks-externals" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#opticks-externals" id="id1">Opticks Externals</a><ul>
<li><a class="reference internal" href="#three-type-of-externals-system-foreign-and-automated" id="id2">Three type of externals : system, foreign and automated</a></li>
<li><a class="reference internal" href="#brief-description-of-foreign-and-automated-externals" id="id3">Brief description of foreign and automated externals</a></li>
<li><a class="reference internal" href="#former-externals-that-are-no-longer-in-use" id="id4">Former externals that are no longer in use</a></li>
<li><a class="reference internal" href="#separate-installation-of-externals-useful-for-debugging-the-build" id="id5">Separate installation of externals : useful for debugging the build</a></li>
<li><a class="reference internal" href="#foreign-externals" id="id6">Foreign Externals</a></li>
<li><a class="reference internal" href="#automated-externals" id="id7">Automated Externals</a></li>
<li><a class="reference internal" href="#base-externals" id="id8">Base externals</a></li>
<li><a class="reference internal" href="#visualization-externals" id="id9">Visualization externals</a></li>
<li><a class="reference internal" href="#mesh-manipulation-and-polygonization-externals-planned-to-be-eliminated" id="id10">Mesh manipulation and polygonization externals (planned to be eliminated)</a></li>
<li><a class="reference internal" href="#former-externals" id="id11">Former externals</a></li>
<li><a class="reference internal" href="#boost-c-libraries" id="id12">Boost C++ Libraries</a></li>
<li><a class="reference internal" href="#opticks-pre-requisites-nvidia-optix-and-nvidia-cuda" id="id13">Opticks Pre-requisites : NVIDIA OptiX and NVIDIA CUDA</a></li>
<li><a class="reference internal" href="#building-opticks-against-foreign-externals-such-as-geant4-boost" id="id14">Building Opticks against “foreign” externals such as Geant4, Boost</a></li>
<li><a class="reference internal" href="#testing-cuda-and-optix-installs-and-nvcc-toolchain" id="id15">Testing CUDA and OptiX Installs and nvcc toolchain</a></li>
<li><a class="reference internal" href="#testing-thrust" id="id16">Testing Thrust</a></li>
<li><a class="reference internal" href="#geant4" id="id17">Geant4</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="three-type-of-externals-system-foreign-and-automated">
<h2><a class="toc-backref" href="#id2">Three type of externals : system, foreign and automated</a><a class="headerlink" href="#three-type-of-externals-system-foreign-and-automated" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first"><strong>system</strong> externals: NVIDIA GPU Driver, NVIDIA CUDA, NVIDIA OptiX must be installed
following the instructions from NVIDIA and assistance from your system administrator.
The envvars OPTICKS_CUDA_PREFIX and OPTICKS_OPTIX_PREFIX exported from <cite>~/.opticks_config</cite> communicate
the install locations to Opticks.</p>
</li>
<li><p class="first"><strong>foreign</strong> externals are no longer automatically installed by <cite>opticks-full</cite> in order to facilitate integration of Opticks with detector
simulation frameworks.</p>
<p>The location of these foreign externals is communicated to the Opticks CMake machinery (<cite>om-cmake</cite> and <cite>om-cmake-okconf</cite>)
via the CMAKE_PREFIX_PATH envvar. This envvar and other PATH envvars such as LD_LIBRARY_PATH are
appended and exported by the <cite>~/.opticks_config</cite> lines starting <cite>opticks-prepend-prefix</cite></p>
<p>These foreign externals can optionally be installed using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opticks</span><span class="o">-</span><span class="n">foreign</span>    <span class="c1"># list them, currently : boost, clhep, xercesc, g4</span>
<span class="n">opticks</span><span class="o">-</span><span class="n">foreign</span><span class="o">-</span><span class="n">install</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>automated</strong> externals are automatically installed by <cite>opticks-full</cite>.  To list them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opticks</span><span class="o">-</span><span class="n">externals</span>   <span class="c1"># currently:  bcm, glm, glfw, glew, gleq, imgui, assimp, openmesh, plog, opticksaux, ...</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="brief-description-of-foreign-and-automated-externals">
<h2><a class="toc-backref" href="#id3">Brief description of foreign and automated externals</a><a class="headerlink" href="#brief-description-of-foreign-and-automated-externals" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="17%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">precursor</th>
<th class="head">pkg name</th>
<th class="head">notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>bcm-</td>
<td>BCM</td>
<td>My fork of Boost CMake Modules, which eases use of modern CMake target import/export</td>
</tr>
<tr class="row-odd"><td>glm-</td>
<td>GLM</td>
<td>OpenGL mathematics, 3D transforms</td>
</tr>
<tr class="row-even"><td>glfw-</td>
<td>GLFW</td>
<td>Interface between system and OpenGL, creating windows and receiving input</td>
</tr>
<tr class="row-odd"><td>glew-</td>
<td>GLEW</td>
<td>OpenGL extensions loading library, cmake build didnt work, includes vc12 sln for windows</td>
</tr>
<tr class="row-even"><td>gleq-</td>
<td>GLEQ</td>
<td>Keyboard event handling header from GLFW author, header only</td>
</tr>
<tr class="row-odd"><td>imgui-</td>
<td>ImGui</td>
<td>OpenGL immediate mode GUI, depends on glfw and glew</td>
</tr>
<tr class="row-even"><td>assimp-</td>
<td>Assimp</td>
<td>Assimp 3D asset importer, my fork that handles G4DAE extras</td>
</tr>
<tr class="row-odd"><td>openmesh-</td>
<td>OpenMesh</td>
<td>basis for mesh navigation and fixing</td>
</tr>
<tr class="row-even"><td>plog-</td>
<td>PLog</td>
<td>Header only logging, supporting multi dll logging on windows</td>
</tr>
<tr class="row-odd"><td>oimplicitmesher-</td>
<td>ImplicitMesher</td>
<td>Polygonization of implicitly defined shapes</td>
</tr>
<tr class="row-even"><td>odcs-</td>
<td>DualContouringSample</td>
<td>Alternate polygonization using Octree for multi-resolution, however its slow</td>
</tr>
<tr class="row-odd"><td>oyoctogl-</td>
<td>YoctoGL</td>
<td>Used for glTF geometry file format handling, parsing/serializing</td>
</tr>
<tr class="row-even"><td>ocsgbsp-</td>
<td>CSGBSP</td>
<td>Another BSP approach to polygonization under investigation</td>
</tr>
<tr class="row-odd"><td>xercesc</td>
<td>XercesC</td>
<td>XML handling dependency of Geant4, required for GDML parsing</td>
</tr>
<tr class="row-even"><td>g4-</td>
<td>Geant4</td>
<td>The preeminent simulation toolkit</td>
</tr>
<tr class="row-odd"><td>optickaux-</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>Some GDML geometry files for testing Opticks</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="former-externals-that-are-no-longer-in-use">
<h2><a class="toc-backref" href="#id4">Former externals that are no longer in use</a><a class="headerlink" href="#former-externals-that-are-no-longer-in-use" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="18%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">precursor</th>
<th class="head">pkg name</th>
<th class="head">notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>opticksdata-</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>Dayabay G4DAE and GDML geometry files for testing Opticks</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="separate-installation-of-externals-useful-for-debugging-the-build">
<h2><a class="toc-backref" href="#id5">Separate installation of externals : useful for debugging the build</a><a class="headerlink" href="#separate-installation-of-externals-useful-for-debugging-the-build" title="Permalink to this headline">¶</a></h2>
<p>The <em>opticks-externals</em> function lists current precursor names, <em>opticks-externals-install</em> runs each
of the precursor functions in turn.  To rerun a single external install, use the below pattern of running
the precursor function and then the installer function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">oyoctogl</span><span class="o">-</span>
<span class="n">oyoctogl</span><span class="o">--</span>
</pre></div>
</div>
<p>After installation has been done rerunning <em>opticks-externals-install</em> completes quickly,
and does no harm.</p>
</div>
<div class="section" id="foreign-externals">
<h2><a class="toc-backref" href="#id6">Foreign Externals</a><a class="headerlink" href="#foreign-externals" title="Permalink to this headline">¶</a></h2>
<p>Listing the foreign externals with bash function <strong>opticks-foreign</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>epsilon:opticks blyth$ opticks-foreign
boost
clhep
xercesc
g4
</pre></div>
</div>
<p>What these do:</p>
<dl class="docutils">
<dt>boost</dt>
<dd>system, program_options, filesystem, regex</dd>
<dt>clhep</dt>
<dd>optionally needed by geant4</dd>
<dt>xercesc</dt>
<dd>XML parsing needed by g4 GDML functionality</dd>
<dt>g4</dt>
<dd>geant4</dd>
</dl>
</div>
<div class="section" id="automated-externals">
<h2><a class="toc-backref" href="#id7">Automated Externals</a><a class="headerlink" href="#automated-externals" title="Permalink to this headline">¶</a></h2>
<p>Listing the automated externals with bash function <strong>opticks-externals</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>epsilon:opticks blyth$ opticks-externals
bcm
glm
glfw
glew
gleq
imgui
assimp
openmesh
plog
opticksaux
oimplicitmesher
odcs
oyoctogl
ocsgbsp
</pre></div>
</div>
<p>What these do is described in the below sections.</p>
</div>
<div class="section" id="base-externals">
<h2><a class="toc-backref" href="#id8">Base externals</a><a class="headerlink" href="#base-externals" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>bcm</dt>
<dd>boost CMake modules, target export/import for CMake 3.5+
allows config to direct dependencies only, the rest of the tree
gets configured automatically</dd>
<dt>glm</dt>
<dd>vector, matrix, 3D projection mathematics</dd>
<dt>plog</dt>
<dd>logging</dd>
<dt>oyoctogl</dt>
<dd>glTF 2.0 3D file format parsing/construction, json parsing</dd>
<dt>opticksaux</dt>
<dd>git repository containing example GDML files</dd>
</dl>
</div>
<div class="section" id="visualization-externals">
<h2><a class="toc-backref" href="#id9">Visualization externals</a><a class="headerlink" href="#visualization-externals" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>glfw</dt>
<dd>cross platform OpenGL and system events : keyboard, mouse</dd>
<dt>gleq</dt>
<dd>event queue for glfw</dd>
<dt>glew</dt>
<dd>OpenGL extension wrangler, providing access to OpenGL symbols</dd>
<dt>imgui</dt>
<dd>immediate mode OpenGL GUI</dd>
</dl>
</div>
<div class="section" id="mesh-manipulation-and-polygonization-externals-planned-to-be-eliminated">
<h2><a class="toc-backref" href="#id10">Mesh manipulation and polygonization externals (planned to be eliminated)</a><a class="headerlink" href="#mesh-manipulation-and-polygonization-externals-planned-to-be-eliminated" title="Permalink to this headline">¶</a></h2>
<p>All these are not needed with direct from G4 workflow, they
are used for mesh manipulation and polygonization functionality.</p>
<dl class="docutils">
<dt>assimp</dt>
<dd>used for COLLADA DAE file format loading
(not needed with direct from G4 workflow)</dd>
<dt>openmesh</dt>
<dd>provides mesh traversal</dd>
<dt>oimplicitmesher</dt>
<dd>creating meshes from SDF analytic geometries</dd>
<dt>odcs</dt>
<dd>dual-contouring-sample</dd>
<dt>ocsgbsp</dt>
<dd>polygonization</dd>
</dl>
</div>
<div class="section" id="former-externals">
<h2><a class="toc-backref" href="#id11">Former externals</a><a class="headerlink" href="#former-externals" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>opticksdata</dt>
<dd>common repository for geometry
(not needed with direct from G4 workflow)</dd>
</dl>
</div>
<div class="section" id="boost-c-libraries">
<h2><a class="toc-backref" href="#id12">Boost C++ Libraries</a><a class="headerlink" href="#boost-c-libraries" title="Permalink to this headline">¶</a></h2>
<p>The Boost components listed in the table need to be installed.
These are widely available via package managers. Use the standard one for
your system. The FindBoost.cmake provided with cmake is used to locate the installation.</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="12%" />
<col width="10%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">directory</th>
<th class="head">precursor</th>
<th class="head">pkg name</th>
<th class="head">notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>boost</td>
<td>boost-</td>
<td>Boost</td>
<td>components: system thread program_options log log_setup filesystem regex</td>
</tr>
</tbody>
</table>
<p>The recommended minimum boost version is 1.53 as that is what I am using.
You might be able to survive with an earlier version,
but anything before 1.41 is known not to work.</p>
<div class="section" id="updating-boost">
<h3>Updating Boost<a class="headerlink" href="#updating-boost" title="Permalink to this headline">¶</a></h3>
<p>If your version of Boost is not recent enough the cmake configuring
step will yield errors like the below.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CMake</span> <span class="n">Error</span> <span class="n">at</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">blyth</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">env</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">cmake</span><span class="o">-</span><span class="mf">3.5</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">cmake</span><span class="o">-</span><span class="mf">3.5</span><span class="o">/</span><span class="n">Modules</span><span class="o">/</span><span class="n">FindBoost</span><span class="o">.</span><span class="n">cmake</span><span class="p">:</span><span class="mi">1657</span> <span class="p">(</span><span class="n">message</span><span class="p">):</span>
<span class="n">Unable</span> <span class="n">to</span> <span class="n">find</span> <span class="n">the</span> <span class="n">requested</span> <span class="n">Boost</span> <span class="n">libraries</span><span class="o">.</span>

<span class="n">Boost</span> <span class="n">version</span><span class="p">:</span> <span class="mf">1.41</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</div>
<p>If possible use your system package manager to update Boost. If that is
not possible then do a local Boost install.  Opticks includes bash functions
starting <em>boost-</em> that can get and install Boost locally.</p>
</div>
</div>
<div class="section" id="opticks-pre-requisites-nvidia-optix-and-nvidia-cuda">
<h2><a class="toc-backref" href="#id13">Opticks Pre-requisites : NVIDIA OptiX and NVIDIA CUDA</a><a class="headerlink" href="#opticks-pre-requisites-nvidia-optix-and-nvidia-cuda" title="Permalink to this headline">¶</a></h2>
<p>OptiX requires your system to have a fairly recent NVIDIA GPU of CUDA compute capability 3.0 at least.</p>
<p>To download OptiX you need to join the NVIDIA Developer Program.
Use the links in the table to register, it is free but may take a few days to be approved.
Follow the NVIDIA instructions to download and install CUDA and OptiX.
Thrust is installed together with CUDA.</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="12%" />
<col width="10%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">directory</th>
<th class="head">precursor</th>
<th class="head">pkg name</th>
<th class="head">notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>cuda</td>
<td>cuda-</td>
<td>CUDA</td>
<td><a class="reference external" href="https://developer.nvidia.com/cuda-downloads">https://developer.nvidia.com/cuda-downloads</a> (includes Thrust)</td>
</tr>
<tr class="row-odd"><td>optix</td>
<td>optix-</td>
<td>OptiX</td>
<td><a class="reference external" href="https://developer.nvidia.com/optix">https://developer.nvidia.com/optix</a></td>
</tr>
</tbody>
</table>
<p>CUDA installation guides:</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html">http://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html</a></li>
<li><a class="reference external" href="http://docs.nvidia.com/cuda/cuda-installation-guide-mac-os-x/index.html">http://docs.nvidia.com/cuda/cuda-installation-guide-mac-os-x/index.html</a></li>
</ul>
<div class="section" id="finding-cuda">
<h3>Finding CUDA<a class="headerlink" href="#finding-cuda" title="Permalink to this headline">¶</a></h3>
<p>Opticks uses the <cite>FindCUDA.cmake</cite> supplied by CMake to, eg
on macOS at <cite>/opt/local/share/cmake-3.12/Modules/FindCUDA.cmake</cite>.
Quoting from that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">29</span> <span class="c1"># The script will prompt the user to specify ``CUDA_TOOLKIT_ROOT_DIR`` if</span>
<span class="mi">30</span> <span class="c1"># the prefix cannot be determined by the location of nvcc in the system</span>
<span class="mi">31</span> <span class="c1"># path and ``REQUIRED`` is specified to :command:`find_package`.</span>
</pre></div>
</div>
<p>Thus check that <cite>nvcc</cite> is in your PATH, and preferably compile some CUDA examples
on your system before installing Opticks.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>epsilon:opticks blyth$ which nvcc    # macOS
/Developer/NVIDIA/CUDA-9.1/bin/nvcc

[blyth@localhost ~]$ which nvcc   # Linux
/usr/local/cuda-9.2/bin/nvcc
</pre></div>
</div>
</div>
<div class="section" id="versions-of-cuda-and-optix">
<h3>Versions of CUDA and OptiX<a class="headerlink" href="#versions-of-cuda-and-optix" title="Permalink to this headline">¶</a></h3>
<p>I recommend you start your installation attempt with OptiX 6.5
together with the version of CUDA that it was built against, as stated in
the OptiX release notes.
This version pinning between CUDA and OptiX is because Opticks links against
both the OptiX library and the CUDA runtime.</p>
<p>If you cannot use the latest CUDA (because of kernel incompatibility) you will need to
use an older OptiX version contemporary with the CUDA version that your kernel supports.</p>
<p>Version combinations that have been used:</p>
<dl class="docutils">
<dt><em>current</em></dt>
<dd>CUDA 10.1, OptiX 6.5.0</dd>
<dt><em>previous</em></dt>
<dd>CUDA 9.1, OptiX 5.1.1
CUDA 9.1, OptiX 5.1.0</dd>
<dt><em>earlier</em></dt>
<dd>CUDA 7.0, OptiX 3.80</dd>
</dl>
<p>The <em>current</em> version combination is regularly tested, the <em>previous</em> one
relies on your bug reports <a class="reference external" href="https://groups.io/g/opticks/topics">https://groups.io/g/opticks/topics</a> to keep it working.
Any issues with <em>earlier</em> version combinations will not be addressed.</p>
<p>The reason for the extremes of caution regarding version combinations of drivers
is that the interface to the GPU is via kernel extensions where if anything goes
wrong there is no safety net. A bad kernel extension will cause kernel panics,
your machine crashes and continues to crash until the bad driver is removed
(on macOS the removal can be done by resetting NVRAM).</p>
</div>
<div class="section" id="nvidia-driver-versions">
<h3>NVIDIA Driver Versions<a class="headerlink" href="#nvidia-driver-versions" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="12%" />
<col width="16%" />
<col width="36%" />
<col width="29%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">OptiX</th>
<th class="head">Date</th>
<th class="head">Driver (Linux)</th>
<th class="head">Working</th>
<th class="head">Problems Reported</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>6.5.0</td>
<td>Aug 26, 2019</td>
<td>435.17</td>
<td>435.21 CUDA 10.1  TITAN RTX, TITAN V</td>
<td>Sajan: 440.33.01 and CUDA 10.2</td>
</tr>
<tr class="row-odd"><td>7.0.0</td>
<td>July 29, 2019</td>
<td>435.12</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>6.0.0</td>
<td>Feb 2018</td>
<td>418.30</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The release notes from every version of OptiX states the
required minimum version of the NVIDIA Driver that must be used
for that version of OptiX. In recent releases that driver version
has been from the so called short-lived series.</p>
<p>From <a class="reference external" href="https://www.nvidia.com/en-gb/drivers/unix/">https://www.nvidia.com/en-gb/drivers/unix/</a> on April 29, 2020:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Latest</span> <span class="n">Long</span> <span class="n">Lived</span> <span class="n">Branch</span> <span class="n">version</span><span class="p">:</span> <span class="mf">440.82</span>
<span class="n">Latest</span> <span class="n">Short</span> <span class="n">Lived</span> <span class="n">Branch</span> <span class="n">version</span><span class="p">:</span> <span class="mf">435.21</span>
</pre></div>
</div>
<p>Note that the long-lived series may have version numbers that exceed those
of the short-lived series but the features needed for OptiX take much longer
to appear in that series.</p>
<p>The releases from the longer-lived driver branches are intended for
users who do not need the latest and greatest features.</p>
<p>If you cannot change your driver version this sometimes means that
an older version of OptiX must be used to work with your driver.</p>
</div>
<div class="section" id="optix-6-5-0-august-26-2019">
<h3>OptiX 6.5.0 (August 26, 2019)<a class="headerlink" href="#optix-6-5-0-august-26-2019" title="Permalink to this headline">¶</a></h3>
<p>Quote from release notes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OptiX</span> <span class="mf">6.5</span><span class="o">.</span><span class="mi">0</span> <span class="n">requires</span> <span class="n">that</span> <span class="n">you</span> <span class="n">install</span> <span class="n">the</span> <span class="mf">436.02</span> <span class="n">driver</span> <span class="n">on</span> <span class="n">Windows</span> <span class="ow">or</span> <span class="n">the</span> <span class="mf">435.17</span> <span class="n">Driver</span> <span class="k">for</span> <span class="n">linux</span><span class="o">.</span> <span class="n">Operating</span> <span class="n">System</span><span class="p">:</span>

<span class="o">*</span> <span class="n">Windows</span> <span class="mi">7</span><span class="o">/</span><span class="mf">8.1</span><span class="o">/</span><span class="mi">10</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
<span class="o">*</span> <span class="n">Linux</span> <span class="n">RHEL</span> <span class="mf">4.8</span><span class="o">+</span> <span class="ow">or</span> <span class="n">Ubuntu</span> <span class="mf">10.10</span><span class="o">+</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
</pre></div>
</div>
</div>
<div class="section" id="problems-with-optix-6-5-0-driver-440-33-01-cuda-10-2">
<h3>Problems with OptiX 6.5.0, Driver 440.33.01, CUDA 10.2<a class="headerlink" href="#problems-with-optix-6-5-0-driver-440-33-01-cuda-10-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://www.nvidia.com/en-gb/drivers/unix/">https://www.nvidia.com/en-gb/drivers/unix/</a></li>
</ul>
<p>Search the OptiX forum for “driver” and looking for Linux reports:</p>
<ul class="simple">
<li><a class="reference external" href="https://forums.developer.nvidia.com/search?q=driver%20%20category%3A167">https://forums.developer.nvidia.com/search?q=driver%20%20category%3A167</a></li>
<li><a class="reference external" href="https://forums.developer.nvidia.com/t/optix7-and-game-ready-driver-440-97/83907">https://forums.developer.nvidia.com/t/optix7-and-game-ready-driver-440-97/83907</a></li>
</ul>
<p>From droettger of NVIDIA on Nov 20, 2019 regarding a problem with optix7:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Yes</span><span class="p">,</span> <span class="n">there</span> <span class="n">was</span> <span class="n">a</span> <span class="n">bug</span> <span class="ow">in</span> <span class="n">R440</span> <span class="n">drivers</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">serious</span> <span class="n">test</span> <span class="n">escape</span><span class="o">.</span>

<span class="n">This</span> <span class="n">has</span> <span class="n">been</span> <span class="n">fixed</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">meantime</span><span class="o">.</span> <span class="n">The</span> <span class="n">just</span> <span class="n">released</span> <span class="n">Windows</span> <span class="n">driver</span> <span class="mf">441.28</span> <span class="n">has</span> <span class="n">picked</span> <span class="n">up</span> <span class="n">the</span> <span class="n">fix</span> <span class="n">already</span><span class="o">.</span>
<span class="n">Unfortunately</span> <span class="n">Linux</span> <span class="mf">440.31</span> <span class="n">drivers</span> <span class="n">have</span> <span class="n">been</span> <span class="n">cut</span> <span class="n">before</span> <span class="n">the</span> <span class="n">fix</span><span class="o">.</span> <span class="n">The</span> <span class="nb">next</span> <span class="mi">441</span> <span class="n">Linux</span> <span class="n">drivers</span> <span class="n">should</span> <span class="n">have</span> <span class="n">it</span><span class="o">.</span>

<span class="n">If</span> <span class="n">you</span> <span class="n">already</span> <span class="n">hacked</span> <span class="n">that</span> <span class="n">integer</span> <span class="n">field</span> <span class="n">to</span> <span class="mi">0</span> <span class="n">when</span> <span class="n">preTransform</span> <span class="ow">is</span> <span class="n">null</span><span class="p">,</span> <span class="n">the</span> <span class="n">expected</span> <span class="n">value</span> <span class="n">when</span> <span class="n">preTransform</span> <span class="ow">is</span> <span class="n">actually</span> <span class="n">containing</span> <span class="mi">3</span><span class="n">x4</span> <span class="n">matrices</span> <span class="ow">is</span> <span class="mh">0x21E1</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="optix-7-0-0-july-29-2019">
<h3>OptiX 7.0.0 (July 29, 2019)<a class="headerlink" href="#optix-7-0-0-july-29-2019" title="Permalink to this headline">¶</a></h3>
<p><strong>An entirely new API : not yet supported by Opticks.</strong></p>
<p>Quote from release notes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OptiX</span> <span class="mf">7.0</span><span class="o">.</span><span class="mi">0</span> <span class="n">requires</span> <span class="n">that</span> <span class="n">you</span> <span class="n">install</span> <span class="n">the</span> <span class="mf">435.80</span> <span class="n">driver</span> <span class="n">on</span> <span class="n">Windows</span> <span class="ow">or</span> <span class="n">the</span> <span class="mf">435.12</span> <span class="n">Driver</span> <span class="k">for</span> <span class="n">linux</span><span class="o">.</span>
<span class="n">Note</span> <span class="n">OptiX</span> <span class="n">dll</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">SDK</span> <span class="n">are</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">needed</span> <span class="n">since</span> <span class="n">the</span> <span class="n">symbols</span> <span class="n">are</span> <span class="n">loaded</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">driver</span><span class="o">.</span>

<span class="o">*</span> <span class="n">Windows</span> <span class="mi">7</span><span class="o">/</span><span class="mf">8.1</span><span class="o">/</span><span class="mi">10</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span><span class="p">;</span>
<span class="o">*</span> <span class="n">Linux</span> <span class="n">RHEL</span> <span class="mf">4.8</span><span class="o">+</span> <span class="ow">or</span> <span class="n">Ubuntu</span> <span class="mf">10.10</span><span class="o">+</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
</pre></div>
</div>
</div>
<div class="section" id="optix-6-0-0-february-2018">
<h3>OptiX 6.0.0 (February 2018)<a class="headerlink" href="#optix-6-0-0-february-2018" title="Permalink to this headline">¶</a></h3>
<p><strong>first version of OptiX with support for Turing GPUs and RT Cores</strong></p>
<p>Quote from release notes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Graphics</span> <span class="n">Driver</span><span class="p">:</span>

<span class="o">*</span> <span class="n">Windows</span><span class="p">:</span> <span class="n">driver</span> <span class="n">version</span> <span class="mf">418.81</span> <span class="ow">or</span> <span class="n">later</span> <span class="ow">is</span> <span class="n">required</span><span class="o">.</span>
<span class="o">*</span> <span class="n">Linux</span><span class="p">:</span> <span class="n">driver</span> <span class="n">version</span> <span class="mf">418.30</span> <span class="ow">or</span> <span class="n">later</span> <span class="ow">is</span> <span class="n">required</span><span class="o">.</span>

<span class="n">OS</span><span class="p">:</span>

<span class="o">*</span> <span class="n">Windows</span> <span class="mi">7</span><span class="o">/</span><span class="mf">8.1</span><span class="o">/</span><span class="mi">10</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
<span class="o">*</span> <span class="n">Linux</span> <span class="n">RHEL</span> <span class="mf">4.8</span><span class="o">+</span> <span class="ow">or</span> <span class="n">Ubuntu</span> <span class="mf">10.10</span><span class="o">+</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
</pre></div>
</div>
</div>
<div class="section" id="using-a-non-standard-optix-version">
<h3>Using a non-standard OptiX version<a class="headerlink" href="#using-a-non-standard-optix-version" title="Permalink to this headline">¶</a></h3>
<p>Opticks tends to adopt new OptiX versions very soon after they become
available approximately twice per year. This is because OptiX continues
to improve rapidly. Updating OptiX typically also requires an update of
the CUDA version and the NVIDIA driver.</p>
<p>Sometimes due to the suitable NVIDIA driver not yet being installed by
your system admin it is necessary to use older OptiX+CUDA versions.
Opticks aims to allow this for recent version combinations only.</p>
</div>
</div>
<div class="section" id="building-opticks-against-foreign-externals-such-as-geant4-boost">
<h2><a class="toc-backref" href="#id14">Building Opticks against “foreign” externals such as Geant4, Boost</a><a class="headerlink" href="#building-opticks-against-foreign-externals-such-as-geant4-boost" title="Permalink to this headline">¶</a></h2>
<p>When integrating Opticks with a detector simulation framework
it is important that externals that are in common between Opticks and the framework
are one and the same to avoid symbol inconsistency between different versions of libraries.
The most likely packages to be in common are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boost</span>
<span class="n">Geant4</span>
<span class="n">XercesC</span>
<span class="n">GLEW</span>
</pre></div>
</div>
<p>The Opticks build is sensitive to the CMAKE_PREFIX_PATH envvar
allowing Opticks to build against “foreign” externals. To check which external that
the CMake based build will pick use the find_package.py script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>epsilon:opticks blyth$ find_package.py Geant4
Geant4                         : /usr/local/foreign/lib/Geant4-10.5.1/Geant4Config.cmake
Geant4                         : /usr/local/opticks/externals/lib/Geant4-10.4.2/Geant4Config.cmake
</pre></div>
</div>
<p>If you can integrate Opticks with your framework using CMake then the non-CMake
opticks-config system which is based on pkg-config pc files is not relevant to you.
Conversely if you need to integrate with legacy build systems such as CMT
then it is necessary to arrange consistency between the two config systems.
To check which external that non-CMake pkg-config based builds will pick use the
pkg_config.py script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>epsilon:~ blyth$ pkg_config.py Geant4
geant4                         : /usr/local/foreign/lib/pkgconfig/geant4.pc
geant4                         : /usr/local/opticks/externals/lib/pkgconfig/geant4.pc
</pre></div>
</div>
<p>And also directly with opticks-config (or shorthand oc):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opticks</span><span class="o">-</span><span class="n">config</span> <span class="o">--</span><span class="n">cflags</span> <span class="n">Geant4</span>
<span class="n">opticks</span><span class="o">-</span><span class="n">config</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>To keep consistency between the CMake and pkg-config configuration systems it is
necessary for do several things:</p>
<ol class="arabic">
<li><p class="first">ensure that the original CMAKE_PREFIX_PATH and PKG_CONFIG_PATH are consistent, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">CMAKE_PREFIX_PATH</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">foreign</span>
<span class="n">export</span> <span class="n">PKG_CONFIG_PATH</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">foreign</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">pkgconfig</span>
</pre></div>
</div>
</li>
<li><p class="first">ensure that pc files are present for relevant packages in the lib/pkgconfig
or lib64/pkgconfig directories beneath all relevant prefix dirs, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">foreign</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">pkgconfig</span><span class="o">/</span><span class="n">geant4</span><span class="o">.</span><span class="n">pc</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">foreign</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">pkgconfig</span><span class="o">/</span><span class="n">boost</span><span class="o">.</span><span class="n">pc</span>
</pre></div>
</div>
</li>
<li><p class="first">generate any missing pc files with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">g4</span><span class="o">-</span><span class="n">pcc</span><span class="o">-</span><span class="nb">all</span>
<span class="n">boost</span><span class="o">-</span><span class="n">pcc</span><span class="o">-</span><span class="nb">all</span>
</pre></div>
</div>
<p>These use find_package.py which iterates over prefixes in CMAKE_PREFIX_PATH
writing .pc files.</p>
</li>
<li><p class="first">check consistency with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">find_package</span><span class="o">.</span><span class="n">py</span> <span class="n">Boost</span>
<span class="n">pkg_config</span><span class="o">.</span><span class="n">py</span> <span class="n">Boost</span>
</pre></div>
</div>
</li>
<li><p class="first">do cleaninstalls following changes to CMAKE_PREFIX_PATH and PKG_CONFIG_PATH with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">opticks</span>
<span class="n">om</span><span class="o">-</span>
<span class="n">om</span><span class="o">-</span><span class="n">cleaninstall</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="testing-cuda-and-optix-installs-and-nvcc-toolchain">
<h2><a class="toc-backref" href="#id15">Testing CUDA and OptiX Installs and nvcc toolchain</a><a class="headerlink" href="#testing-cuda-and-optix-installs-and-nvcc-toolchain" title="Permalink to this headline">¶</a></h2>
<p>Before trying to install Opticks check your CUDA and OptiX installs:</p>
<ol class="arabic simple">
<li>run the precompiled CUDA and OptiX sample binaries</li>
<li>compile the CUDA and OptiX samples</li>
<li>run your compiled samples</li>
</ol>
</div>
<div class="section" id="testing-thrust">
<h2><a class="toc-backref" href="#id16">Testing Thrust</a><a class="headerlink" href="#testing-thrust" title="Permalink to this headline">¶</a></h2>
<p>Thrust provides a higher level C++ template approach to using CUDA that is used extensively
by Opticks. The Thrust headers are installed by the CUDA toolkit installater, eg at <cite>/usr/local/cuda/include/thrust</cite>.
You are recommended to try some of the Thrust examples to check your nvcc toolchain.</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.nvidia.com/cuda/thrust/index.html">http://docs.nvidia.com/cuda/thrust/index.html</a></li>
<li><a class="reference external" href="https://github.com/thrust/thrust/tree/master/examples">https://github.com/thrust/thrust/tree/master/examples</a></li>
</ul>
</div>
<div class="section" id="geant4">
<h2><a class="toc-backref" href="#id17">Geant4</a><a class="headerlink" href="#geant4" title="Permalink to this headline">¶</a></h2>
<p>Geant4 is no longer automatically installed by <em>opticks-full</em> it can be installed with <em>g4–</em>.
The <em>g4-</em> precursor selects a version of Geant4.  Currently a bit dated, this is intended to be brought uptodate sometime.
The coupling between Opticks and Geant4 is intended to be weak : so a range of
recent versions of Geant4 are intended to be supported.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="testing.html" title="Opticks Testing, Geocache Creation, Python setup"
             >next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Opticks Install Instructions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Opticks 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
  </body>
</html>