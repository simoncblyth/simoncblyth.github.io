
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Opticks Install Instructions &#8212; Opticks 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Updating this documentation" href="updating_this_documentation.html" />
    <link rel="prev" title="Opticks : GPU Accelerated Optical Photon Simulation using NVIDIA OptiX" href="../index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="updating_this_documentation.html" title="Updating this documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="Opticks : GPU Accelerated Optical Photon Simulation using NVIDIA OptiX"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Opticks 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Opticks Install Instructions</a><ul>
<li><a class="reference internal" href="#get-opticks">Get Opticks</a></li>
<li><a class="reference internal" href="#bash-shell-setup-with-opticks-setup">Bash Shell Setup with .opticks_setup</a></li>
<li><a class="reference internal" href="#recommended-bash-setup-arrangement">Recommended bash setup arrangement</a></li>
<li><a class="reference internal" href="#check-your-bash-environment-setup">Check your bash environment setup</a><ul>
<li><a class="reference internal" href="#bash-profile-or-bashrc-macos-and-linux">.bash_profile OR .bashrc, macOS and Linux</a></li>
</ul>
</li>
<li><a class="reference internal" href="#location-overrides-by-envvar">Location Overrides by envvar</a></li>
<li><a class="reference internal" href="#opticks-installation-overview">Opticks Installation Overview</a></li>
<li><a class="reference internal" href="#build-tools">Build Tools</a></li>
<li><a class="reference internal" href="#cmake-version-3-12">CMake Version 3.12+</a></li>
<li><a class="reference internal" href="#boost-c-libraries">Boost C++ Libraries</a><ul>
<li><a class="reference internal" href="#updating-boost">Updating Boost</a></li>
</ul>
</li>
<li><a class="reference internal" href="#platform-support">Platform Support</a></li>
<li><a class="reference internal" href="#opticks-pre-requisites-nvidia-optix-and-nvidia-cuda">Opticks Pre-requisites : NVIDIA OptiX and NVIDIA CUDA</a><ul>
<li><a class="reference internal" href="#finding-cuda">Finding CUDA</a></li>
<li><a class="reference internal" href="#opticks-without-an-cuda-capable-gpu">Opticks without an CUDA capable GPU ?</a></li>
<li><a class="reference internal" href="#versions-of-cuda-and-optix">Versions of CUDA and OptiX</a></li>
<li><a class="reference internal" href="#nvidia-driver-versions">NVIDIA Driver Versions</a></li>
<li><a class="reference internal" href="#optix-6-5-0-august-26-2019">OptiX 6.5.0 (August 26, 2019)</a></li>
<li><a class="reference internal" href="#problems-with-optix-6-5-0-driver-440-33-01-cuda-10-2">Problems with OptiX 6.5.0, Driver 440.33.01, CUDA 10.2</a></li>
<li><a class="reference internal" href="#optix-7-0-0-july-29-2019">OptiX 7.0.0 (July 29, 2019)</a></li>
<li><a class="reference internal" href="#optix-6-0-0-february-2018">OptiX 6.0.0 (February 2018)</a></li>
<li><a class="reference internal" href="#using-a-non-standard-optix-version">Using a non-standard OptiX version</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-opticks-against-foreign-externals-such-as-geant4-boost">Building Opticks against “foreign” externals such as Geant4, Boost</a></li>
<li><a class="reference internal" href="#testin-cuda-and-optix-installs-and-nvcc-toolchain">Testin CUDA and OptiX Installs and nvcc toolchain</a></li>
<li><a class="reference internal" href="#testing-thrust">Testing Thrust</a></li>
<li><a class="reference internal" href="#geant4">Geant4</a></li>
<li><a class="reference internal" href="#building-opticks">Building Opticks</a><ul>
<li><a class="reference internal" href="#externals">Externals</a></li>
<li><a class="reference internal" href="#separate-installation-of-externals">Separate installation of externals</a></li>
<li><a class="reference internal" href="#manually-configuring-opticks">Manually Configuring Opticks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#opticks-without-nvidia-optix-and-cuda">Opticks Without NVIDIA OptiX and CUDA ?</a></li>
<li><a class="reference internal" href="#geant4-dependency">Geant4 Dependency</a></li>
<li><a class="reference internal" href="#embedded-opticks-using-g4ok-package">Embedded Opticks using G4OK package</a></li>
<li><a class="reference internal" href="#testing-installation">Testing Installation</a></li>
<li><a class="reference internal" href="#creating-legacy-workflow-geocache">Creating Legacy Workflow Geocache</a></li>
<li><a class="reference internal" href="#creating-direct-workflow-geocache">Creating Direct Workflow Geocache</a></li>
<li><a class="reference internal" href="#opticks-numpy-based-analysis">Opticks NumPy based Analysis</a></li>
<li><a class="reference internal" href="#systems-where-opticks-has-been-installed">Systems where Opticks has been Installed</a><ul>
<li><a class="reference internal" href="#macos-10-13-4-17e199-high-sierra-xcode-9-2">macOS 10.13.4 (17E199) High Sierra, Xcode 9.2</a></li>
<li><a class="reference internal" href="#macos-10-9-4-mavericks-xcode-clang-toolchain">macOS 10.9.4 Mavericks : Xcode/clang toolchain</a></li>
<li><a class="reference internal" href="#linux-gcc-toolchain">Linux : GCC toolchain</a></li>
<li><a class="reference internal" href="#windows-microsoft-visual-studio-2015-community-edition">Windows : Microsoft Visual Studio 2015, Community edition</a></li>
</ul>
</li>
<li><a class="reference internal" href="#opengl-version-requirements">OpenGL Version Requirements</a></li>
<li><a class="reference internal" href="#using-a-shared-opticks-installation">Using a Shared Opticks Installation</a></li>
<li><a class="reference internal" href="#visualization-finding-geometry">Visualization Finding Geometry</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../index.html"
                        title="previous chapter">Opticks : GPU Accelerated Optical Photon Simulation using NVIDIA OptiX</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="updating_this_documentation.html"
                        title="next chapter">Updating this documentation</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/docs/opticks.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="opticks-install-instructions">
<h1>Opticks Install Instructions<a class="headerlink" href="#opticks-install-instructions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="get-opticks">
<h2>Get Opticks<a class="headerlink" href="#get-opticks" title="Permalink to this headline">¶</a></h2>
<p>Clone the repository from bitbucket:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">bitbucket</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">simoncblyth</span><span class="o">/</span><span class="n">opticks</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@bitbucket</span><span class="o">.</span><span class="n">org</span><span class="p">:</span><span class="n">simoncblyth</span><span class="o">/</span><span class="n">opticks</span><span class="o">.</span><span class="n">git</span>   <span class="c1"># via git url for developers, uses ssh keys for passwordless pushes</span>
</pre></div>
</div>
</div>
<div class="section" id="bash-shell-setup-with-opticks-setup">
<h2>Bash Shell Setup with .opticks_setup<a class="headerlink" href="#bash-shell-setup-with-opticks-setup" title="Permalink to this headline">¶</a></h2>
<p>Example <cite>~/.opticks_setup</cite>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># .opticks_setup</span>

<span class="nb">export</span> <span class="nv">LOCAL_BASE</span><span class="o">=</span><span class="nv">$HOME</span>/local
<span class="nb">export</span> <span class="nv">OPTICKS_HOME</span><span class="o">=</span><span class="nv">$HOME</span>/opticks
<span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$HOME</span>

opticks-<span class="o">(){</span>  <span class="o">[</span> -r <span class="nv">$OPTICKS_HOME</span>/opticks.bash <span class="o">]</span> <span class="o">&amp;&amp;</span> . <span class="nv">$OPTICKS_HOME</span>/opticks.bash <span class="o">&amp;&amp;</span> opticks-env <span class="nv">$*</span> <span class="p">;</span> <span class="o">}</span>
opticks-     <span class="c1">##</span>

o<span class="o">(){</span> <span class="nb">cd</span> <span class="k">$(</span>opticks-home<span class="k">)</span> <span class="p">;</span> git status <span class="p">;</span> <span class="o">}</span>
op<span class="o">(){</span> op.sh <span class="nv">$*</span> <span class="p">;</span> <span class="o">}</span>

<span class="nv">PATH</span><span class="o">=</span><span class="nv">$OPTICKS_HOME</span>/bin:<span class="nv">$OPTICKS_HOME</span>/ana:<span class="nv">$LOCAL_BASE</span>/opticks/lib:<span class="nv">$PATH</span>  <span class="c1">## easy access to scripts and executables</span>
<span class="nb">export</span> PATH

<span class="nb">export</span> <span class="nv">OPTICKS_KEY</span><span class="o">=</span>OKX4Test.X4PhysicalVolume.lWorld0x4bc2710_PV.f6cc352e44243f8fa536ab483ad390ce
<span class="c1">## picking a geometry</span>


<span class="nb">export</span> <span class="nv">TMP</span><span class="o">=</span>/home/blyth/local/opticks/tmp
tmp<span class="o">(){</span> <span class="nb">cd</span> <span class="nv">$TMP</span> <span class="p">;</span> <span class="nb">pwd</span> <span class="p">;</span>  <span class="o">}</span>
<span class="nb">export</span> <span class="nv">OPTICKS_EVENT_BASE</span><span class="o">=</span><span class="nv">$TMP</span>
<span class="c1">## define a directory in which to store test events, used by integration tests</span>
</pre></div>
</div>
<p>Envvars:</p>
<dl class="docutils">
<dt>LOCAL_BASE</dt>
<dd>configures the root of the install, canonically “/usr/local” but can be $HOME/local of you dont
have permissions for “/usr/local”</dd>
<dt>OPTICKS_HOME</dt>
<dd>path to the “opticks” source directory</dd>
<dt>PYTHONPATH</dt>
<dd>directory containing the “opticks” source directory, allowing “import opticks”
to work from python scripts</dd>
<dt>OPTICKS_KEY</dt>
<dd>picks a geometry geocache, created with the geocache-create function</dd>
<dt>PATH</dt>
<dd>Opticks executables including more than 400 tests are installed into $LOCAL_BASE/opticks/lib,
setting the PATH as indicated gives easy access to these as well as many scripts</dd>
<dt>TMP</dt>
<dd>when undefined a default directory of /tmp/username/opticks is used as scratch space by unit tests</dd>
<dt>OPTICKS_EVENT_BASE</dt>
<dd><p class="first">The OPTICKS_EVENT_BASE envvar is used by both C++ boostrap/BOpticksEvent.cc and
python ana/nload.py to define a directory beneath with events are stored.
When undefined this defaults to the TMP envvar value or its default.</p>
<p class="last">Some integration tests write photon propagation OpticksEvents which are loaded into
python for analysis by scripts directly invoked from the C++ executable.
OpticksEvents comprise several .npy arrays  necessitating the NumPy python module for loading.</p>
</dd>
</dl>
<p>The most important lines of the setup are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>opticks-(){ . $HOME/opticks/opticks.bash &amp;&amp; opticks-env $* ; }
opticks-
</pre></div>
</div>
<p>The first line defines the bash function <em>opticks-</em> that is termed a precursor function
as running it will define other functions all starting with <em>opticks-</em> such as <em>opticks-vi</em>
and <em>opticks-usage</em>.  The second line runs the function which defines further functions.</p>
</div>
<div class="section" id="recommended-bash-setup-arrangement">
<h2>Recommended bash setup arrangement<a class="headerlink" href="#recommended-bash-setup-arrangement" title="Permalink to this headline">¶</a></h2>
<p>The recommended arrangment of bash setup scripts:</p>
<ul class="simple">
<li><cite>~/.bash_profile</cite> should source <cite>~/.bashrc</cite></li>
<li><cite>~/.bashrc</cite> should source <cite>~/.opticks_setup</cite> (PRIOR to any early exits)</li>
</ul>
<p>Using this approach succeeds to setup the opticks bash functions
and exports with either “bash -l” or “bash -i” or from within
scripts using shebang line “#!/bin/bash -l”.</p>
<p>This makes the setup immune to differing treatments of when
<cite>~/.bash_profile</cite> and <cite>~/.bashrc</cite> are to invoked by various Linux
distros and macOS.</p>
<p>Example <cite>~/.bash_profile</cite>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># .bash_profile</span>

<span class="k">if</span> <span class="o">[</span> -f ~/.bashrc <span class="o">]</span><span class="p">;</span> <span class="k">then</span>                 <span class="c1">## typical setup</span>
        . ~/.bashrc
<span class="k">fi</span>
</pre></div>
</div>
<p>Some Linux distros (Ubuntu) have a default <cite>.bashrc</cite> which early exits.
It is necessary to <em>source ~/.opticks_setup</em> prior to the early exit.
Example <cite>~/.bashrc</cite>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># .bashrc</span>

vip<span class="o">(){</span> vim ~/.bash_profile ~/.bashrc ~/.opticks_setup <span class="p">;</span> <span class="o">}</span>
ini<span class="o">(){</span> <span class="nb">source</span> ~/.bashrc <span class="p">;</span> <span class="o">}</span>

<span class="nb">source</span> ~/.opticks_setup

<span class="c1">##### below from default Ubuntu .bashrc early exits if bash is not invoked with -i option</span>

<span class="c1"># If not running interactively, don&#39;t do anything</span>
<span class="k">case</span> <span class="nv">$-</span> in
    *i*<span class="o">)</span> <span class="p">;;</span>
      *<span class="o">)</span> <span class="k">return</span><span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
</div>
<p>For notes about this see <cite>notes/issues/ubuntu-bash-login-shell-differences.rst</cite></p>
</div>
<div class="section" id="check-your-bash-environment-setup">
<h2>Check your bash environment setup<a class="headerlink" href="#check-your-bash-environment-setup" title="Permalink to this headline">¶</a></h2>
<p>If the below commandline gives errors, compare your <em>.bash_profile</em>  <em>.bashrc</em> and <em>.opticks_setup</em> with
the above examples.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[blyth@localhost ~]$ bash -lc &quot;opticks- ; opticks-info &quot;    ## RHEL, Centos (and Ubuntu too)

opticks-locations
==================

      opticks-source   :   /home/blyth/opticks/opticks.bash
      opticks-home     :   /home/blyth/opticks
      opticks-name     :   opticks

      opticks-fold     :   /home/blyth/local/opticks

...
</pre></div>
</div>
<div class="section" id="bash-profile-or-bashrc-macos-and-linux">
<h3>.bash_profile OR .bashrc, macOS and Linux<a class="headerlink" href="#bash-profile-or-bashrc-macos-and-linux" title="Permalink to this headline">¶</a></h3>
<p>With most Linux distributions and terminal managers the <em>.bash_profile</em> is run
only on login and <em>.bashrc</em> is run for every new terminal window, BUT with macOS Terminal.app
the <em>.bash_profile</em> is run for every new terminal window.  Thus for compatibility
the best approach to put setup into <em>.bashrc</em> and source it from <em>.bash_profile</em> : giving
the same behaviour on both Linux and macOS.</p>
<p>For background on dotfiles <a class="reference external" href="http://mywiki.wooledge.org/DotFiles">http://mywiki.wooledge.org/DotFiles</a></p>
</div>
</div>
<div class="section" id="location-overrides-by-envvar">
<h2>Location Overrides by envvar<a class="headerlink" href="#location-overrides-by-envvar" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">envvar</th>
<th class="head">precursor-;funcname</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>OPTICKS_GEANT4_HOME</td>
<td>g4-;g4-prefix</td>
</tr>
<tr class="row-odd"><td>OPTICKS_OPTIX_HOME</td>
<td>optix-;optix-fold</td>
</tr>
<tr class="row-even"><td>OPTICKS_COMPUTE_CAPABILITY</td>
<td>opticks-;opticks-compute-capability</td>
</tr>
<tr class="row-odd"><td>OPTICKS_OPTIX_INSTALL_DIR</td>
<td>opticks-;opticks-optix-install-dir</td>
</tr>
</tbody>
</table>
<p>Use the <code class="docutils literal notranslate"><span class="pre">1_Utilities/deviceQuery</span></code> CUDA sample to show your compute capability.
A list is provided at <a class="reference external" href="https://developer.nvidia.com/cuda-gpus">https://developer.nvidia.com/cuda-gpus</a></p>
</div>
<div class="section" id="opticks-installation-overview">
<h2>Opticks Installation Overview<a class="headerlink" href="#opticks-installation-overview" title="Permalink to this headline">¶</a></h2>
<p>Opticks installation requires:</p>
<ul class="simple">
<li>bash shell and build tools such as mercurial, git, curl, etc..</li>
<li>recent cmake 3.8+</li>
<li>Boost C++ libraries 1.59+</li>
<li>installations of pre-requisites packages, see below for notes on versions<ul>
<li>NVIDIA OptiX</li>
<li>NVIDIA CUDA</li>
</ul>
</li>
</ul>
<p>After meeting these requirements you can install Opticks and its
external packages using a single command: <em>opticks-full</em></p>
</div>
<div class="section" id="build-tools">
<h2>Build Tools<a class="headerlink" href="#build-tools" title="Permalink to this headline">¶</a></h2>
<p>Getting, configuring, unpacking, building and installing Opticks and
its externals requires unix tools including:</p>
<ul class="simple">
<li>bash shell</li>
<li>git</li>
<li>curl</li>
<li>tar</li>
<li>zip</li>
<li>cmake 3.12+</li>
</ul>
</div>
<div class="section" id="cmake-version-3-12">
<h2>CMake Version 3.12+<a class="headerlink" href="#cmake-version-3-12" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>I recommend use of at least 3.12 for building Opticks</strong>.</li>
<li><strong>The most common Opticks build issues arise from using older CMake versions.</strong></li>
</ul>
<p>Check your version with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>simon:~ blyth$ cmake --version
cmake version 3.12.0
</pre></div>
</div>
<p>Although usually preferable to get build tools using your system
package manager, the system cmake version will almost certainly
not be recent enough.</p>
<p>Opticks CMake infrastructure makes heavy use of recent CMake target
import/export features used by BCM (Boost CMake Modules).
The current Opticks CMake infrastructure was developed in May 2018
using CMake 3.11 and 3.12 (I am currently using 3.14.1)
The Opticks repository includes bash functions for local installs of
cmake with precursor function <em>ocmake-</em> which will install 3.14.1</p>
<p>For what goes wrong if you use an older CMake version see:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">notes/issues/cmake_target_link_libraries_for_imported_target.rst</span></code></li>
</ul>
<p>To install CMake 3.14.1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[blyth@localhost opticks]$ ocmake-     ## run precursor function that defines the others
[blyth@localhost opticks]$ ocmake-vi   ## take a look at the bash functions
[blyth@localhost opticks]$ ocmake-info
ocmake-info
============

ocmake-vers : 3.14.1
ocmake-nam  : cmake-3.14.1
ocmake-url  : https://github.com/Kitware/CMake/releases/download/v3.14.1/cmake-3.14.1.tar.gz
ocmake-dir  : /home/blyth/local/opticks/externals/cmake/cmake-3.14.1

[blyth@localhost opticks]$ ocmake--    ## downloads, configures, builds, installs
</pre></div>
</div>
<p>After installation you will need to adjust you PATH to
use the newer <em>cmake</em> binary. Check with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">which</span> <span class="n">cmake</span>
<span class="n">cmake</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
</div>
<div class="section" id="boost-c-libraries">
<h2>Boost C++ Libraries<a class="headerlink" href="#boost-c-libraries" title="Permalink to this headline">¶</a></h2>
<p>The Boost components listed in the table need to be installed.
These are widely available via package managers. Use the standard one for
your system. The FindBoost.cmake provided with cmake is used to locate the installation.</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="12%" />
<col width="10%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">directory</th>
<th class="head">precursor</th>
<th class="head">pkg name</th>
<th class="head">notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>boost</td>
<td>boost-</td>
<td>Boost</td>
<td>components: system thread program_options log log_setup filesystem regex</td>
</tr>
</tbody>
</table>
<p>The recommended minimum boost version is 1.53 as that is what I am using.
You might be able to survive with an earlier version,
but anything before 1.41 is known not to work.</p>
<div class="section" id="updating-boost">
<h3>Updating Boost<a class="headerlink" href="#updating-boost" title="Permalink to this headline">¶</a></h3>
<p>If your version of Boost is not recent enough the cmake configuring
step will yield errors like the below.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CMake</span> <span class="n">Error</span> <span class="n">at</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">blyth</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">env</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">cmake</span><span class="o">-</span><span class="mf">3.5</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">cmake</span><span class="o">-</span><span class="mf">3.5</span><span class="o">/</span><span class="n">Modules</span><span class="o">/</span><span class="n">FindBoost</span><span class="o">.</span><span class="n">cmake</span><span class="p">:</span><span class="mi">1657</span> <span class="p">(</span><span class="n">message</span><span class="p">):</span>
<span class="n">Unable</span> <span class="n">to</span> <span class="n">find</span> <span class="n">the</span> <span class="n">requested</span> <span class="n">Boost</span> <span class="n">libraries</span><span class="o">.</span>

<span class="n">Boost</span> <span class="n">version</span><span class="p">:</span> <span class="mf">1.41</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</div>
<p>If possible use your system package manager to update Boost. If that is
not possible then do a local Boost install.  Opticks includes bash functions
starting <em>boost-</em> that can get and install Boost locally.</p>
</div>
</div>
<div class="section" id="platform-support">
<h2>Platform Support<a class="headerlink" href="#platform-support" title="Permalink to this headline">¶</a></h2>
<p>A recent Scientific Linux is the target platform for production running of Opticks,
but I am happy to try to help with installations on any Linux supported by CUDA.</p>
<p>Initial development was done on macOS (late 2013 MacBook pro : the last Mac laptop with an NVIDIA GPU)
with occasional ports to keep thinks working on Scientific Linux. But now due to the lack of Macs
with NVIDIA GPUs development has moved to Linux CentOS 7 and Scientific Linux.</p>
</div>
<div class="section" id="opticks-pre-requisites-nvidia-optix-and-nvidia-cuda">
<h2>Opticks Pre-requisites : NVIDIA OptiX and NVIDIA CUDA<a class="headerlink" href="#opticks-pre-requisites-nvidia-optix-and-nvidia-cuda" title="Permalink to this headline">¶</a></h2>
<p>OptiX requires your system to have a fairly recent NVIDIA GPU of CUDA compute capability 3.0 at least.</p>
<p>To download OptiX you need to join the NVIDIA Developer Program.
Use the links in the table to register, it is free but may take a few days to be approved.
Follow the NVIDIA instructions to download and install CUDA and OptiX.
Thrust is installed together with CUDA.</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="12%" />
<col width="10%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">directory</th>
<th class="head">precursor</th>
<th class="head">pkg name</th>
<th class="head">notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>cuda</td>
<td>cuda-</td>
<td>CUDA</td>
<td><a class="reference external" href="https://developer.nvidia.com/cuda-downloads">https://developer.nvidia.com/cuda-downloads</a> (includes Thrust)</td>
</tr>
<tr class="row-odd"><td>optix</td>
<td>optix-</td>
<td>OptiX</td>
<td><a class="reference external" href="https://developer.nvidia.com/optix">https://developer.nvidia.com/optix</a></td>
</tr>
</tbody>
</table>
<p>CUDA installation guides:</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html">http://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html</a></li>
<li><a class="reference external" href="http://docs.nvidia.com/cuda/cuda-installation-guide-mac-os-x/index.html">http://docs.nvidia.com/cuda/cuda-installation-guide-mac-os-x/index.html</a></li>
</ul>
<div class="section" id="finding-cuda">
<h3>Finding CUDA<a class="headerlink" href="#finding-cuda" title="Permalink to this headline">¶</a></h3>
<p>Opticks uses the <cite>FindCUDA.cmake</cite> supplied by CMake to, eg
on macOS at <cite>/opt/local/share/cmake-3.12/Modules/FindCUDA.cmake</cite>.
Quoting from that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">29</span> <span class="c1"># The script will prompt the user to specify ``CUDA_TOOLKIT_ROOT_DIR`` if</span>
<span class="mi">30</span> <span class="c1"># the prefix cannot be determined by the location of nvcc in the system</span>
<span class="mi">31</span> <span class="c1"># path and ``REQUIRED`` is specified to :command:`find_package`.</span>
</pre></div>
</div>
<p>Thus check that <cite>nvcc</cite> is in your PATH, and preferably compile some CUDA examples
on your system before installing Opticks.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>epsilon:opticks blyth$ which nvcc    # macOS
/Developer/NVIDIA/CUDA-9.1/bin/nvcc

[blyth@localhost ~]$ which nvcc   # Linux
/usr/local/cuda-9.2/bin/nvcc
</pre></div>
</div>
</div>
<div class="section" id="opticks-without-an-cuda-capable-gpu">
<h3>Opticks without an CUDA capable GPU ?<a class="headerlink" href="#opticks-without-an-cuda-capable-gpu" title="Permalink to this headline">¶</a></h3>
<p>In the past an experimental port of Opticks onto a Windows machine without a CUDA capable GPU
was made. Using saved propagations it was possible to visualize optical photon propagations through a
detector geometry using OpenGL.</p>
<p>Although this mode of operation is a low priority, it might be revived in future, for example
allowing outreach demonstrations in schools without CUDA capable GPUs.</p>
</div>
<div class="section" id="versions-of-cuda-and-optix">
<h3>Versions of CUDA and OptiX<a class="headerlink" href="#versions-of-cuda-and-optix" title="Permalink to this headline">¶</a></h3>
<p>I recommend you start your installation attempt with the lastest versions of OptiX
together with the version of CUDA that it was built against, as stated in
the OptiX release notes.
This version pinning between CUDA and OptiX is because Opticks links against
both the OptiX library and the CUDA runtime.</p>
<p>If you cannot use the latest CUDA (because of kernel incompatibility) you will need to
use an older OptiX version contemporary with the CUDA version that your kernel supports.</p>
<p>Version combinations that have been used:</p>
<dl class="docutils">
<dt><em>current</em></dt>
<dd>CUDA 10.1, OptiX 6.5.0</dd>
<dt><em>previous</em></dt>
<dd>CUDA 9.1, OptiX 5.1.1
CUDA 9.1, OptiX 5.1.0</dd>
<dt><em>earlier</em></dt>
<dd>CUDA 7.0, OptiX 3.80</dd>
</dl>
<p>The <em>current</em> version combination is regularly tested, the <em>previous</em> one
relies on your bug reports <a class="reference external" href="https://groups.io/g/opticks/topics">https://groups.io/g/opticks/topics</a> to keep it working.
Any issues with <em>earlier</em> version combinations will not be addressed.</p>
<p>The reason for the extremes of caution regarding version combinations of drivers
is that the interface to the GPU is via kernel extensions where if anything goes
wrong there is no safety net. A bad kernel extension will cause kernel panics,
your machine crashes and continues to crash until the bad driver is removed
(on macOS the removal can be done by resetting NVRAM).</p>
</div>
<div class="section" id="nvidia-driver-versions">
<h3>NVIDIA Driver Versions<a class="headerlink" href="#nvidia-driver-versions" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="12%" />
<col width="16%" />
<col width="36%" />
<col width="29%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">OptiX</th>
<th class="head">Date</th>
<th class="head">Driver (Linux)</th>
<th class="head">Working</th>
<th class="head">Problems Reported</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>6.5.0</td>
<td>Aug 26, 2019</td>
<td>435.17</td>
<td>435.21 CUDA 10.1  TITAN RTX, TITAN V</td>
<td>Sajan: 440.33.01 and CUDA 10.2</td>
</tr>
<tr class="row-odd"><td>7.0.0</td>
<td>July 29, 2019</td>
<td>435.12</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>6.0.0</td>
<td>Feb 2018</td>
<td>418.30</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The release notes from every version of OptiX states the
required minimum version of the NVIDIA Driver that must be used
for that version of OptiX. In recent releases that driver version
has been from the so called short-lived series.</p>
<p>From <a class="reference external" href="https://www.nvidia.com/en-gb/drivers/unix/">https://www.nvidia.com/en-gb/drivers/unix/</a> on April 29, 2020:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Latest</span> <span class="n">Long</span> <span class="n">Lived</span> <span class="n">Branch</span> <span class="n">version</span><span class="p">:</span> <span class="mf">440.82</span>
<span class="n">Latest</span> <span class="n">Short</span> <span class="n">Lived</span> <span class="n">Branch</span> <span class="n">version</span><span class="p">:</span> <span class="mf">435.21</span>
</pre></div>
</div>
<p>Note that the long-lived series may have version numbers that exceed those
of the short-lived series but the features needed for OptiX take much longer
to appear in that series.</p>
<p>The releases from the longer-lived driver branches are intended for
users who do not need the latest and greatest features.</p>
<p>If you cannot change your driver version this sometimes means that
an older version of OptiX must be used to work with your driver.</p>
</div>
<div class="section" id="optix-6-5-0-august-26-2019">
<h3>OptiX 6.5.0 (August 26, 2019)<a class="headerlink" href="#optix-6-5-0-august-26-2019" title="Permalink to this headline">¶</a></h3>
<p>Quote from release notes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OptiX</span> <span class="mf">6.5</span><span class="o">.</span><span class="mi">0</span> <span class="n">requires</span> <span class="n">that</span> <span class="n">you</span> <span class="n">install</span> <span class="n">the</span> <span class="mf">436.02</span> <span class="n">driver</span> <span class="n">on</span> <span class="n">Windows</span> <span class="ow">or</span> <span class="n">the</span> <span class="mf">435.17</span> <span class="n">Driver</span> <span class="k">for</span> <span class="n">linux</span><span class="o">.</span> <span class="n">Operating</span> <span class="n">System</span><span class="p">:</span>

<span class="o">*</span> <span class="n">Windows</span> <span class="mi">7</span><span class="o">/</span><span class="mf">8.1</span><span class="o">/</span><span class="mi">10</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
<span class="o">*</span> <span class="n">Linux</span> <span class="n">RHEL</span> <span class="mf">4.8</span><span class="o">+</span> <span class="ow">or</span> <span class="n">Ubuntu</span> <span class="mf">10.10</span><span class="o">+</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
</pre></div>
</div>
</div>
<div class="section" id="problems-with-optix-6-5-0-driver-440-33-01-cuda-10-2">
<h3>Problems with OptiX 6.5.0, Driver 440.33.01, CUDA 10.2<a class="headerlink" href="#problems-with-optix-6-5-0-driver-440-33-01-cuda-10-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://www.nvidia.com/en-gb/drivers/unix/">https://www.nvidia.com/en-gb/drivers/unix/</a></li>
</ul>
<p>Search the OptiX forum for “driver” and looking for Linux reports:</p>
<ul class="simple">
<li><a class="reference external" href="https://forums.developer.nvidia.com/search?q=driver%20%20category%3A167">https://forums.developer.nvidia.com/search?q=driver%20%20category%3A167</a></li>
<li><a class="reference external" href="https://forums.developer.nvidia.com/t/optix7-and-game-ready-driver-440-97/83907">https://forums.developer.nvidia.com/t/optix7-and-game-ready-driver-440-97/83907</a></li>
</ul>
<p>From droettger of NVIDIA on Nov 20, 2019 regarding a problem with optix7:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Yes</span><span class="p">,</span> <span class="n">there</span> <span class="n">was</span> <span class="n">a</span> <span class="n">bug</span> <span class="ow">in</span> <span class="n">R440</span> <span class="n">drivers</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">serious</span> <span class="n">test</span> <span class="n">escape</span><span class="o">.</span>

<span class="n">This</span> <span class="n">has</span> <span class="n">been</span> <span class="n">fixed</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">meantime</span><span class="o">.</span> <span class="n">The</span> <span class="n">just</span> <span class="n">released</span> <span class="n">Windows</span> <span class="n">driver</span> <span class="mf">441.28</span> <span class="n">has</span> <span class="n">picked</span> <span class="n">up</span> <span class="n">the</span> <span class="n">fix</span> <span class="n">already</span><span class="o">.</span>
<span class="n">Unfortunately</span> <span class="n">Linux</span> <span class="mf">440.31</span> <span class="n">drivers</span> <span class="n">have</span> <span class="n">been</span> <span class="n">cut</span> <span class="n">before</span> <span class="n">the</span> <span class="n">fix</span><span class="o">.</span> <span class="n">The</span> <span class="nb">next</span> <span class="mi">441</span> <span class="n">Linux</span> <span class="n">drivers</span> <span class="n">should</span> <span class="n">have</span> <span class="n">it</span><span class="o">.</span>

<span class="n">If</span> <span class="n">you</span> <span class="n">already</span> <span class="n">hacked</span> <span class="n">that</span> <span class="n">integer</span> <span class="n">field</span> <span class="n">to</span> <span class="mi">0</span> <span class="n">when</span> <span class="n">preTransform</span> <span class="ow">is</span> <span class="n">null</span><span class="p">,</span> <span class="n">the</span> <span class="n">expected</span> <span class="n">value</span> <span class="n">when</span> <span class="n">preTransform</span> <span class="ow">is</span> <span class="n">actually</span> <span class="n">containing</span> <span class="mi">3</span><span class="n">x4</span> <span class="n">matrices</span> <span class="ow">is</span> <span class="mh">0x21E1</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="optix-7-0-0-july-29-2019">
<h3>OptiX 7.0.0 (July 29, 2019)<a class="headerlink" href="#optix-7-0-0-july-29-2019" title="Permalink to this headline">¶</a></h3>
<p><strong>An entirely new API : not yet supported by Opticks.</strong></p>
<p>Quote from release notes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OptiX</span> <span class="mf">7.0</span><span class="o">.</span><span class="mi">0</span> <span class="n">requires</span> <span class="n">that</span> <span class="n">you</span> <span class="n">install</span> <span class="n">the</span> <span class="mf">435.80</span> <span class="n">driver</span> <span class="n">on</span> <span class="n">Windows</span> <span class="ow">or</span> <span class="n">the</span> <span class="mf">435.12</span> <span class="n">Driver</span> <span class="k">for</span> <span class="n">linux</span><span class="o">.</span>
<span class="n">Note</span> <span class="n">OptiX</span> <span class="n">dll</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">SDK</span> <span class="n">are</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">needed</span> <span class="n">since</span> <span class="n">the</span> <span class="n">symbols</span> <span class="n">are</span> <span class="n">loaded</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">driver</span><span class="o">.</span>

<span class="o">*</span> <span class="n">Windows</span> <span class="mi">7</span><span class="o">/</span><span class="mf">8.1</span><span class="o">/</span><span class="mi">10</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span><span class="p">;</span>
<span class="o">*</span> <span class="n">Linux</span> <span class="n">RHEL</span> <span class="mf">4.8</span><span class="o">+</span> <span class="ow">or</span> <span class="n">Ubuntu</span> <span class="mf">10.10</span><span class="o">+</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
</pre></div>
</div>
</div>
<div class="section" id="optix-6-0-0-february-2018">
<h3>OptiX 6.0.0 (February 2018)<a class="headerlink" href="#optix-6-0-0-february-2018" title="Permalink to this headline">¶</a></h3>
<p><strong>first version of OptiX with support for Turing GPUs and RT Cores</strong></p>
<p>Quote from release notes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Graphics</span> <span class="n">Driver</span><span class="p">:</span>

<span class="o">*</span> <span class="n">Windows</span><span class="p">:</span> <span class="n">driver</span> <span class="n">version</span> <span class="mf">418.81</span> <span class="ow">or</span> <span class="n">later</span> <span class="ow">is</span> <span class="n">required</span><span class="o">.</span>
<span class="o">*</span> <span class="n">Linux</span><span class="p">:</span> <span class="n">driver</span> <span class="n">version</span> <span class="mf">418.30</span> <span class="ow">or</span> <span class="n">later</span> <span class="ow">is</span> <span class="n">required</span><span class="o">.</span>

<span class="n">OS</span><span class="p">:</span>

<span class="o">*</span> <span class="n">Windows</span> <span class="mi">7</span><span class="o">/</span><span class="mf">8.1</span><span class="o">/</span><span class="mi">10</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
<span class="o">*</span> <span class="n">Linux</span> <span class="n">RHEL</span> <span class="mf">4.8</span><span class="o">+</span> <span class="ow">or</span> <span class="n">Ubuntu</span> <span class="mf">10.10</span><span class="o">+</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
</pre></div>
</div>
</div>
<div class="section" id="using-a-non-standard-optix-version">
<h3>Using a non-standard OptiX version<a class="headerlink" href="#using-a-non-standard-optix-version" title="Permalink to this headline">¶</a></h3>
<p>Opticks tends to adopt new OptiX versions very soon after they become
available approximately twice per year. This is because OptiX continues
to improve rapidly. Updating OptiX typically also requires an update of
the CUDA version and the NVIDIA driver.</p>
<p>Sometimes due to the suitable NVIDIA driver not yet being installed by
your system admin it is necessary to use older OptiX+CUDA versions.
Opticks aims to allow this for recent version combinations only.</p>
<p>Extract from .opticks_setup:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># The location to look for OptiX libs defaults to $(opticks-prefix)/externals/OptiX
# to override that while testing a non-standard OptiX version set the OPTICKS_OPTIX_INSTALL_DIR envvar
# which overrides the default in bash function opticks-optix-install-dir
#
unset OPTICKS_OPTIX_INSTALL_DIR
export OPTICKS_OPTIX_INSTALL_DIR=/usr/local/OptiX_511

export CUDA_VERSION=10.1
unset LD_LIBRARY_PATH
export LD_LIBRARY_PATH=/usr/local/cuda-${CUDA_VERSION}/lib64

# Normally Opticks executables find the OptiX libs via the RPATH
#  &quot;$ORIGIN/../lib:$ORIGIN/../lib64:$ORIGIN/../externals/lib:$ORIGIN/../externals/lib64:$ORIGIN/../externals/OptiX/lib64&quot;
#
# when using a non-standard OptiX version (older or newer)
# it is necessary to append to LD_LIBRARY_PATH as penance for being non-standard
#
[ -n &quot;$OPTICKS_OPTIX_INSTALL_DIR&quot; ] &amp;&amp; LD_LIBRARY_PATH=$LD_LIBRARY_PATH:${OPTICKS_OPTIX_INSTALL_DIR}/lib64
</pre></div>
</div>
</div>
</div>
<div class="section" id="building-opticks-against-foreign-externals-such-as-geant4-boost">
<h2>Building Opticks against “foreign” externals such as Geant4, Boost<a class="headerlink" href="#building-opticks-against-foreign-externals-such-as-geant4-boost" title="Permalink to this headline">¶</a></h2>
<p>When integrating Opticks with a detector simulation framework
it is important that externals that are incommon between Opticks and the framework
are one and the same to avoid symbol inconsistency between different versions of libraries.
The most likely packages to be in common are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boost</span>
<span class="n">Geant4</span>
<span class="n">XercesC</span>
<span class="n">GLEW</span>
</pre></div>
</div>
<p>The Opticks build is sensitive to the CMAKE_PREFIX_PATH envvar
allowing Opticks to build against “foreign” externals. To check which external that
the CMake based build will pick use the find_package.py script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>epsilon:opticks blyth$ find_package.py Geant4
Geant4                         : /usr/local/foreign/lib/Geant4-10.5.1/Geant4Config.cmake
Geant4                         : /usr/local/opticks/externals/lib/Geant4-10.4.2/Geant4Config.cmake
</pre></div>
</div>
<p>If you can integrate Opticks with your framework using CMake then the non-CMake
opticks-config system which is based on pkg-config pc files is not relevant to you.
Conversely if you need to integrate with legacy build systems such as CMT
then it is necessary to arrange consistency between the two config systems.
To check which external that non-CMake pkg-config based builds will pick use the
pkg_config.py script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>epsilon:~ blyth$ pkg_config.py Geant4
geant4                         : /usr/local/foreign/lib/pkgconfig/geant4.pc
geant4                         : /usr/local/opticks/externals/lib/pkgconfig/geant4.pc
</pre></div>
</div>
<p>And also directly with opticks-config (or shorthand oc):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opticks</span><span class="o">-</span><span class="n">config</span> <span class="o">--</span><span class="n">cflags</span> <span class="n">Geant4</span>
<span class="n">opticks</span><span class="o">-</span><span class="n">config</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>To keep consistency between the CMake and pkg-config configuration systems it is
necessary for do several things:</p>
<ol class="arabic">
<li><p class="first">ensure that the original CMAKE_PREFIX_PATH and PKG_CONFIG_PATH are consistent, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">CMAKE_PREFIX_PATH</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">foreign</span>
<span class="n">export</span> <span class="n">PKG_CONFIG_PATH</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">foreign</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">pkgconfig</span>
</pre></div>
</div>
</li>
<li><p class="first">ensure that pc files are present for relevant packages in the lib/pkgconfig
or lib64/pkgconfig directories beneath all relevant prefix dirs, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">foreign</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">pkgconfig</span><span class="o">/</span><span class="n">geant4</span><span class="o">.</span><span class="n">pc</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">foreign</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">pkgconfig</span><span class="o">/</span><span class="n">boost</span><span class="o">.</span><span class="n">pc</span>
</pre></div>
</div>
</li>
<li><p class="first">generate any missing pc files with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">g4</span><span class="o">-</span><span class="n">pcc</span><span class="o">-</span><span class="nb">all</span>
<span class="n">boost</span><span class="o">-</span><span class="n">pcc</span><span class="o">-</span><span class="nb">all</span>
</pre></div>
</div>
<p>These use find_package.py which iterates over prefixes in CMAKE_PREFIX_PATH
writing .pc files.</p>
</li>
<li><p class="first">check consistency with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">find_package</span><span class="o">.</span><span class="n">py</span> <span class="n">Boost</span>
<span class="n">pkg_config</span><span class="o">.</span><span class="n">py</span> <span class="n">Boost</span>
</pre></div>
</div>
</li>
<li><p class="first">do cleaninstalls following changes to CMAKE_PREFIX_PATH and PKG_CONFIG_PATH with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">opticks</span>
<span class="n">om</span><span class="o">-</span>
<span class="n">om</span><span class="o">-</span><span class="n">cleaninstall</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="testin-cuda-and-optix-installs-and-nvcc-toolchain">
<h2>Testin CUDA and OptiX Installs and nvcc toolchain<a class="headerlink" href="#testin-cuda-and-optix-installs-and-nvcc-toolchain" title="Permalink to this headline">¶</a></h2>
<p>Before trying to install Opticks check your CUDA and OptiX installs:</p>
<ol class="arabic simple">
<li>run the precompiled CUDA and OptiX sample binaries</li>
<li>compile the CUDA and OptiX samples</li>
<li>run your compiled samples</li>
</ol>
</div>
<div class="section" id="testing-thrust">
<h2>Testing Thrust<a class="headerlink" href="#testing-thrust" title="Permalink to this headline">¶</a></h2>
<p>Thrust provides a higher level C++ template approach to using CUDA that is used extensively
by Opticks. The Thrust headers are installed by the CUDA toolkit installater, eg at <cite>/usr/local/cuda/include/thrust</cite>.
You are recommended to try some of the Thrust examples to check your nvcc toolchain.</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.nvidia.com/cuda/thrust/index.html">http://docs.nvidia.com/cuda/thrust/index.html</a></li>
<li><a class="reference external" href="https://github.com/thrust/thrust/tree/master/examples">https://github.com/thrust/thrust/tree/master/examples</a></li>
</ul>
</div>
<div class="section" id="geant4">
<h2>Geant4<a class="headerlink" href="#geant4" title="Permalink to this headline">¶</a></h2>
<p>Geant4 installed as the last external in the <em>opticks-externals</em> list.
The <em>g4-</em> precursor selects a version of Geant4.  Currently a bit dated, this is intended to be brought uptodate sometime.
The coupling between Opticks and Geant4 is intended to be weak : so a range of
recent versions of Geant4 are intended to be supported.</p>
</div>
<div class="section" id="building-opticks">
<h2>Building Opticks<a class="headerlink" href="#building-opticks" title="Permalink to this headline">¶</a></h2>
<p>Once you have the necessary build tools and the pre-requisites you
can download and install the externals and build Opticks itself with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opticks</span><span class="o">-</span>
<span class="n">opticks</span><span class="o">-</span><span class="n">full</span>
</pre></div>
</div>
<p>Note that repeating <em>opticks-full</em> will wipe the Opticks build directory
and run again from scratch.</p>
<p>After the first full build, much faster update builds can be done with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opticks</span><span class="o">--</span>
</pre></div>
</div>
<div class="section" id="externals">
<h3>Externals<a class="headerlink" href="#externals" title="Permalink to this headline">¶</a></h3>
<p>The <em>opticks-full</em> command automatically downloads and installs the below external packages
into the places required by Opticks.</p>
<p>To list the externals installed by <em>opticks-full</em> use the <em>opticks-externals</em> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[blyth@localhost opticks]$ opticks-externals
bcm
glm
glfw
glew
gleq
imgui
assimp
openmesh
plog
opticksdata
oimplicitmesher
odcs
oyoctogl
ocsgbsp
xercesc
g4
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="17%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">precursor</th>
<th class="head">pkg name</th>
<th class="head">notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>bcm</td>
<td>BCM</td>
<td>My fork of Boost CMake Modules, which eases use of modern CMake target import/export</td>
</tr>
<tr class="row-odd"><td>glm-</td>
<td>GLM</td>
<td>OpenGL mathematics, 3D transforms</td>
</tr>
<tr class="row-even"><td>glfw-</td>
<td>GLFW</td>
<td>Interface between system and OpenGL, creating windows and receiving input</td>
</tr>
<tr class="row-odd"><td>glew-</td>
<td>GLEW</td>
<td>OpenGL extensions loading library, cmake build didnt work, includes vc12 sln for windows</td>
</tr>
<tr class="row-even"><td>gleq-</td>
<td>GLEQ</td>
<td>Keyboard event handling header from GLFW author, header only</td>
</tr>
<tr class="row-odd"><td>imgui-</td>
<td>ImGui</td>
<td>OpenGL immediate mode GUI, depends on glfw and glew</td>
</tr>
<tr class="row-even"><td>assimp-</td>
<td>Assimp</td>
<td>Assimp 3D asset importer, my fork that handles G4DAE extras</td>
</tr>
<tr class="row-odd"><td>openmesh-</td>
<td>OpenMesh</td>
<td>basis for mesh navigation and fixing</td>
</tr>
<tr class="row-even"><td>plog-</td>
<td>PLog</td>
<td>Header only logging, supporting multi dll logging on windows</td>
</tr>
<tr class="row-odd"><td>opticksdata-</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>Dayabay G4DAE and GDML geometry files for testing Opticks</td>
</tr>
<tr class="row-even"><td>oimplicitmesher-</td>
<td>ImplicitMesher</td>
<td>Polygonization of implicitly defined shapes</td>
</tr>
<tr class="row-odd"><td>odcs-</td>
<td>DualContouringSample</td>
<td>Alternate polygonization using Octree for multi-resolution, however its slow</td>
</tr>
<tr class="row-even"><td>oyoctogl-</td>
<td>YoctoGL</td>
<td>Used for glTF geometry file format handling, parsing/serializing</td>
</tr>
<tr class="row-odd"><td>ocsgbsp-</td>
<td>CSGBSP</td>
<td>Another BSP approach to polygonization under investigation</td>
</tr>
<tr class="row-even"><td>xercesc</td>
<td>XercesC</td>
<td>XML handling dependency of Geant4, required for GDML parsing</td>
</tr>
<tr class="row-odd"><td>g4</td>
<td>Geant4</td>
<td>The preeminent simulation toolkit</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="separate-installation-of-externals">
<h3>Separate installation of externals<a class="headerlink" href="#separate-installation-of-externals" title="Permalink to this headline">¶</a></h3>
<p>The <em>opticks-externals</em> function lists current precursor names, <em>opticks-externals-install</em> runs each
of the precursor functions in turn.  To rerun a single external install, use the below pattern of running
the precursor function and then the installer function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">oyoctogl</span><span class="o">-</span>
<span class="n">oyoctogl</span><span class="o">--</span>
</pre></div>
</div>
<p>After installation has been done rerunning <em>opticks-externals-install</em> completes quickly,
and does no harm.</p>
</div>
<div class="section" id="manually-configuring-opticks">
<h3>Manually Configuring Opticks<a class="headerlink" href="#manually-configuring-opticks" title="Permalink to this headline">¶</a></h3>
<p>If the automated configuring done by <em>opticks-full</em> failed to find the
pre-requisites you may need to specify some options to <em>opticks-configure</em>
to help the build scripts.</p>
<p>CMake is used to configure Opticks and generate Makefiles or Visual Studio solution files on Windows.
For a visualization only build with system Boost
the defaults should work OK and there is no need to explicitly configure.
If a local Boost was required then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>opticks-configure -DBOOST_ROOT=$(boost-prefix)
</pre></div>
</div>
<p>For a full build with CUDA and OptiX configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>opticks-configure -DCUDA_TOOLKIT_ROOT_DIR=/Developer/NVIDIA/CUDA-7.0 \
                  -DOptiX_INSTALL_DIR=/Developer/OptiX \
                  -DCOMPUTE_CAPABILITY=52 \
                  -DBOOST_ROOT=$(boost-prefix)
</pre></div>
</div>
<p>Another configure example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opticks</span><span class="o">-</span><span class="n">configure</span> <span class="o">-</span><span class="n">DCUDA_TOOLKIT_ROOT_DIR</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cuda</span><span class="o">-</span><span class="mf">7.0</span> \
                  <span class="o">-</span><span class="n">DOptiX_INSTALL_DIR</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">gpu</span><span class="o">/</span><span class="n">NVIDIA</span><span class="o">-</span><span class="n">OptiX</span><span class="o">-</span><span class="n">SDK</span><span class="o">-</span><span class="mf">3.8</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">linux64</span><span class="o">/</span> \
                  <span class="o">-</span><span class="n">DCOMPUTE_CAPABILITY</span><span class="o">=</span><span class="mi">52</span> \
                  <span class="o">-</span><span class="n">DBOOST_ROOT</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span>
</pre></div>
</div>
<p>The argument <cite>-DCOMPUTE_CAPABILITY=52</cite> specifies to compile for compute capability 5.2 architectures
corresponding to Maxwell 2nd generation GPUs.
Lookup the appropriate capability for your GPU in the below short table.</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="34%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Compute Capability</th>
<th class="head">Architecture</th>
<th class="head">GPU Examples</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2.1</td>
<td>Fermi</td>
<td><strong>NOT SUPPORTED BY OPTICKS</strong></td>
</tr>
<tr class="row-odd"><td>3.0</td>
<td>Kepler</td>
<td>GeForce GT 750M</td>
</tr>
<tr class="row-even"><td>5.0</td>
<td>Maxwell 1st generation</td>
<td>Quadro M2000M</td>
</tr>
<tr class="row-odd"><td>5.2</td>
<td>Maxwell 2nd generation</td>
<td>Quadro M5000</td>
</tr>
<tr class="row-even"><td>6.1</td>
<td>Pascal</td>
<td>GeForce GTX 1080</td>
</tr>
</tbody>
</table>
<p>For more complete tables see</p>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/CUDA">https://en.wikipedia.org/wiki/CUDA</a></li>
<li><a class="reference external" href="https://developer.nvidia.com/cuda-gpus">https://developer.nvidia.com/cuda-gpus</a>.</li>
</ul>
<p>Opticks requires a compute capability of at least 3.0, if you have no suitable GPU
or would like to test without GPU acceleration use <cite>-DCOMPUTE_CAPABILITY=0</cite>.</p>
<p>These configuration values are cached in the CMakeCache.txt file
in the build directory. These values are not overridden by rebuilding
with the <em>opticks–</em> bash function.
A subsequent <em>opticks-configure</em> however will wipe the build directory
allowing new values to be set.</p>
<p>To build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opticks</span><span class="o">--</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="opticks-without-nvidia-optix-and-cuda">
<h2>Opticks Without NVIDIA OptiX and CUDA ?<a class="headerlink" href="#opticks-without-nvidia-optix-and-cuda" title="Permalink to this headline">¶</a></h2>
<p>High performance optical photon simulation requires an NVIDIA GPU
with compute capability of 3.0 or better (Kepler, Maxwell or Pascal architectures).
However if your GPU is not able to run OptiX/CUDA but is able to run OpenGL 4.0
(eg if you have an AMD GPU or an integrated Intel GPU)
it is still possible to make a partial build of Opticks
using cmake switch WITH_OPTIX=OFF.</p>
<p>The partial mode provides OpenGL visualizations of geometry and
photon propagations loaded from file.
This mode is not tested often, so provide copy/paste errors if it fails for you.</p>
</div>
<div class="section" id="geant4-dependency">
<h2>Geant4 Dependency<a class="headerlink" href="#geant4-dependency" title="Permalink to this headline">¶</a></h2>
<p>Opticks is structured as a collection of packages
organized by their local and external dependencies, see <a class="reference internal" href="overview.html"><span class="doc">Opticks Overview</span></a> for a table
or run the bash function <em>opticks-deps</em>.
Only a few of the very highest level packages depend on Geant4.</p>
<dl class="docutils">
<dt>cfg4</dt>
<dd>validation comparisons</dd>
<dt>okg4</dt>
<dd>integrated Opticks+G4 for “gun running”</dd>
<dt>g4ok</dt>
<dd>minimal interface for embedding Opticks inside Geant4 applications</dd>
</dl>
<p>Opticks dependency on Geant4 is intended to be loose
in order to allow working with multiple G4 versions (within a certain version range),
using version preprocessor macros to accommodate differences.
So please send copy/paste reports of incompatibilities together with G4 versions.</p>
<p>The weak G4 dependency allows you to test most of Opticks even
without G4 installed.</p>
</div>
<div class="section" id="embedded-opticks-using-g4ok-package">
<h2>Embedded Opticks using G4OK package<a class="headerlink" href="#embedded-opticks-using-g4ok-package" title="Permalink to this headline">¶</a></h2>
<p>In production, Opticks is intended to be run in an embedded mode
where, Geant4 and Opticks communicate via “gensteps” and “hits”
without using any Geant4 headers. This works via some
Geant4 dependant glue code within each detectors simulation framework
that does the below:</p>
<ul class="simple">
<li>inhibits CPU generation of optical photons from G4Scintillation and G4Cerenkov processes,
instead “gensteps” are collected</li>
<li>invokes embedded Opticks (typically at the end of each event)
passing the collected “gensteps” across to Opticks which performs the
propagation</li>
<li>pulls back the PMT hits and populates standard Geant4 hit collections with these</li>
</ul>
<p>Once the details of the above integration have been revisted for JUNO example
integration code will be provided within the Opticks repository.</p>
</div>
<div class="section" id="testing-installation">
<h2>Testing Installation<a class="headerlink" href="#testing-installation" title="Permalink to this headline">¶</a></h2>
<p>The <em>opticks-t</em> functions runs ctests for all the opticks projects:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>simon:opticks blyth$ opticks-
simon:opticks blyth$ opticks-t
Test project /usr/local/opticks/build
      Start  1: SysRapTest.SEnvTest
 1/65 Test  #1: SysRapTest.SEnvTest ........................   Passed    0.00 sec
      Start  2: SysRapTest.SSysTest
 2/65 Test  #2: SysRapTest.SSysTest ........................   Passed    0.00 sec
      Start  3: SysRapTest.SDigestTest
 3/65 Test  #3: SysRapTest.SDigestTest .....................   Passed    0.00 sec
.....
.....
      Start 59: cfg4Test.CPropLibTest
59/65 Test #59: cfg4Test.CPropLibTest ......................   Passed    0.05 sec
      Start 60: cfg4Test.CTestDetectorTest
60/65 Test #60: cfg4Test.CTestDetectorTest .................   Passed    0.04 sec
      Start 61: cfg4Test.CGDMLDetectorTest
61/65 Test #61: cfg4Test.CGDMLDetectorTest .................   Passed    0.45 sec
      Start 62: cfg4Test.CG4Test
62/65 Test #62: cfg4Test.CG4Test ...........................   Passed    5.06 sec
      Start 63: cfg4Test.G4MaterialTest
63/65 Test #63: cfg4Test.G4MaterialTest ....................   Passed    0.02 sec
      Start 64: cfg4Test.G4StringTest
64/65 Test #64: cfg4Test.G4StringTest ......................   Passed    0.02 sec
      Start 65: cfg4Test.G4BoxTest
65/65 Test #65: cfg4Test.G4BoxTest .........................   Passed    0.02 sec

100% tests passed, 0 tests failed out of 65

Total Test time (real) =  59.89 sec
opticks-ctest : use -V to show output
</pre></div>
</div>
</div>
<div class="section" id="creating-legacy-workflow-geocache">
<h2>Creating Legacy Workflow Geocache<a class="headerlink" href="#creating-legacy-workflow-geocache" title="Permalink to this headline">¶</a></h2>
<p>Some tests depend on the geometry cache being present. To create the legacy geometry cache:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">op</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">G</span>   <span class="c1">## NB this legacy approach is slated to be removed, instead try the below direct workflow approach</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-direct-workflow-geocache">
<h2>Creating Direct Workflow Geocache<a class="headerlink" href="#creating-direct-workflow-geocache" title="Permalink to this headline">¶</a></h2>
<p>The integration tests require a direct workflow geocache to exist as they
need it as their base geometry. The direct geocache is created by the OKX4Test executable
which loads a GDML file and directly translates it into an Opticks GGeo geometry
instance and persists that into a direct geocache.
The bash function to do this is <em>geocache-create</em>, use that with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geocache</span><span class="o">-</span>              <span class="c1"># run precursor function which defines the others</span>
<span class="nb">type</span> <span class="n">geocache</span><span class="o">-</span><span class="n">create</span>   <span class="c1"># take a look at what its doing</span>
<span class="n">geocache</span><span class="o">-</span><span class="n">create</span>
</pre></div>
</div>
<p>Geocache creation is time and memory consuming, taking about 1 minute for the JUNO geometry
on a workstation with lots of memory. Fortunately this only needs to be done once per geometry, and
as the geocache is composed of binary .npy files they are fast to load and upload to the GPU.</p>
<p>Near to the end of the logging from geocache creation you should find output
similar to the below which reports the OPTICKS_KEY value of the geometry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">16</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mf">08.129</span> <span class="n">INFO</span>  <span class="p">[</span><span class="mi">263983</span><span class="p">]</span> <span class="p">[</span><span class="n">Opticks</span><span class="p">::</span><span class="n">reportGeoCacheCoordinates</span><span class="nd">@755</span><span class="p">]</span>  <span class="n">ok</span><span class="o">.</span><span class="n">idpath</span>  <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">blyth</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">opticks</span><span class="o">/</span><span class="n">geocache</span><span class="o">/</span><span class="n">OKX4Test_lWorld0x4bc2710_PV_g4live</span><span class="o">/</span><span class="n">g4ok_gltf</span><span class="o">/</span><span class="n">f6cc352e44243f8fa536ab483ad390ce</span><span class="o">/</span><span class="mi">1</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">16</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mf">08.129</span> <span class="n">INFO</span>  <span class="p">[</span><span class="mi">263983</span><span class="p">]</span> <span class="p">[</span><span class="n">Opticks</span><span class="p">::</span><span class="n">reportGeoCacheCoordinates</span><span class="nd">@756</span><span class="p">]</span>  <span class="n">ok</span><span class="o">.</span><span class="n">keyspec</span> <span class="n">OKX4Test</span><span class="o">.</span><span class="n">X4PhysicalVolume</span><span class="o">.</span><span class="n">lWorld0x4bc2710_PV</span><span class="o">.</span><span class="n">f6cc352e44243f8fa536ab483ad390ce</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">16</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mf">08.129</span> <span class="n">INFO</span>  <span class="p">[</span><span class="mi">263983</span><span class="p">]</span> <span class="p">[</span><span class="n">Opticks</span><span class="p">::</span><span class="n">reportGeoCacheCoordinates</span><span class="nd">@757</span><span class="p">]</span>  <span class="n">To</span> <span class="n">reuse</span> <span class="n">this</span> <span class="n">geometry</span><span class="p">:</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">16</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mf">08.129</span> <span class="n">INFO</span>  <span class="p">[</span><span class="mi">263983</span><span class="p">]</span> <span class="p">[</span><span class="n">Opticks</span><span class="p">::</span><span class="n">reportGeoCacheCoordinates</span><span class="nd">@758</span><span class="p">]</span>    <span class="mf">1.</span> <span class="nb">set</span> <span class="n">envvar</span> <span class="n">OPTICKS_KEY</span><span class="o">=</span><span class="n">OKX4Test</span><span class="o">.</span><span class="n">X4PhysicalVolume</span><span class="o">.</span><span class="n">lWorld0x4bc2710_PV</span><span class="o">.</span><span class="n">f6cc352e44243f8fa536ab483ad390ce</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">16</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mf">08.129</span> <span class="n">INFO</span>  <span class="p">[</span><span class="mi">263983</span><span class="p">]</span> <span class="p">[</span><span class="n">Opticks</span><span class="p">::</span><span class="n">reportGeoCacheCoordinates</span><span class="nd">@759</span><span class="p">]</span>    <span class="mf">2.</span> <span class="n">enable</span> <span class="n">envvar</span> <span class="n">sensitivity</span> <span class="k">with</span> <span class="o">--</span><span class="n">envkey</span> <span class="n">argument</span> <span class="n">to</span> <span class="n">Opticks</span> <span class="n">executables</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">16</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mf">08.129</span> <span class="n">FATAL</span> <span class="p">[</span><span class="mi">263983</span><span class="p">]</span> <span class="p">[</span><span class="n">Opticks</span><span class="p">::</span><span class="n">reportGeoCacheCoordinates</span><span class="nd">@767</span><span class="p">]</span> <span class="n">THE</span> <span class="n">LIVE</span> <span class="n">keyspec</span> <span class="n">DOES</span> <span class="n">NOT</span> <span class="n">MATCH</span> <span class="n">THAT</span> <span class="n">OF</span> <span class="n">THE</span> <span class="n">CURRENT</span> <span class="n">ENVVAR</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">16</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mf">08.129</span> <span class="n">INFO</span>  <span class="p">[</span><span class="mi">263983</span><span class="p">]</span> <span class="p">[</span><span class="n">Opticks</span><span class="p">::</span><span class="n">reportGeoCacheCoordinates</span><span class="nd">@768</span><span class="p">]</span>  <span class="p">(</span><span class="n">envvar</span><span class="p">)</span> <span class="n">OPTICKS_KEY</span><span class="o">=</span><span class="n">NONE</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">16</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mf">08.129</span> <span class="n">INFO</span>  <span class="p">[</span><span class="mi">263983</span><span class="p">]</span> <span class="p">[</span><span class="n">Opticks</span><span class="p">::</span><span class="n">reportGeoCacheCoordinates</span><span class="nd">@769</span><span class="p">]</span>  <span class="p">(</span><span class="n">live</span><span class="p">)</span>   <span class="n">OPTICKS_KEY</span><span class="o">=</span><span class="n">OKX4Test</span><span class="o">.</span><span class="n">X4PhysicalVolume</span><span class="o">.</span><span class="n">lWorld0x4bc2710_PV</span><span class="o">.</span><span class="n">f6cc352e44243f8fa536ab483ad390ce</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">16</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mf">08.129</span> <span class="n">INFO</span>  <span class="p">[</span><span class="mi">263983</span><span class="p">]</span> <span class="p">[</span><span class="n">Opticks</span><span class="p">::</span><span class="n">dumpRC</span><span class="nd">@202</span><span class="p">]</span>  <span class="n">rc</span> <span class="mi">0</span> <span class="n">rcmsg</span> <span class="p">:</span> <span class="o">-</span>
</pre></div>
</div>
<p>To reuse the geometry the OPTICKS_KEY envvar needs to be exported from
<cite>.opticks_setup</cite>, see the next section for an example.</p>
</div>
<div class="section" id="opticks-numpy-based-analysis">
<h2>Opticks NumPy based Analysis<a class="headerlink" href="#opticks-numpy-based-analysis" title="Permalink to this headline">¶</a></h2>
<p>Opticks uses the NumPy (NPY) buffer serialization format
for geometry and event data, thus analysis and debugging requires
python and the ipython and numpy extensions.</p>
</div>
<div class="section" id="systems-where-opticks-has-been-installed">
<h2>Systems where Opticks has been Installed<a class="headerlink" href="#systems-where-opticks-has-been-installed" title="Permalink to this headline">¶</a></h2>
<div class="section" id="macos-10-13-4-17e199-high-sierra-xcode-9-2">
<h3>macOS 10.13.4 (17E199) High Sierra, Xcode 9.2<a class="headerlink" href="#macos-10-13-4-17e199-high-sierra-xcode-9-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>macOS 10.13.4 (17E199) High Sierra</li>
<li>Xcode 9.2 (actually on 9.3 but xcode-select back to 9.2) as required by nvcc (the CUDA compiler)</li>
<li>NVIDIA GPU Driver Version: 387.10.10.10.30.103  (aka Web Driver)</li>
<li>NVIDIA CUDA Driver : 387.178</li>
<li>NVIDIA CUDA 9.1</li>
<li>NVIDUA OptiX 5.0.1</li>
</ul>
</div>
<div class="section" id="macos-10-9-4-mavericks-xcode-clang-toolchain">
<h3>macOS 10.9.4 Mavericks : Xcode/clang toolchain<a class="headerlink" href="#macos-10-9-4-mavericks-xcode-clang-toolchain" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Primary development platfom : Mavericks 10.9.4</li>
<li>NVIDIA Geforce GT 750M (mobile GPU)</li>
</ul>
</div>
<div class="section" id="linux-gcc-toolchain">
<h3>Linux : GCC toolchain<a class="headerlink" href="#linux-gcc-toolchain" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>DELL Precision Workstation, running Ubuntu</li>
<li>DELL Precision Workstation, running CentOS 7</li>
<li>NVIDIA Quadro M5000</li>
</ul>
</div>
<div class="section" id="windows-microsoft-visual-studio-2015-community-edition">
<h3>Windows : Microsoft Visual Studio 2015, Community edition<a class="headerlink" href="#windows-microsoft-visual-studio-2015-community-edition" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Ported to Windows 7 SP1 machine</li>
<li>non-CUDA capable GPU</li>
</ul>
<p>Opticks installation uses the bash shell.
The Windows bash shell that comes with
the git-for-windows project was used for this purpose</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/git-for-windows">https://github.com/git-for-windows</a></li>
</ul>
<p>Despite lack of an CUDA capable GPU, the OpenGL Opticks
visualization was found to operate successfully.</p>
</div>
</div>
<div class="section" id="opengl-version-requirements">
<h2>OpenGL Version Requirements<a class="headerlink" href="#opengl-version-requirements" title="Permalink to this headline">¶</a></h2>
<p>Opticks uses GLSL shaders with version 400,
corresponding to at least OpenGL 4.0</p>
<p>OpenGL versions supported by various systems are listed at the below links.</p>
<ul class="simple">
<li>macOS : <a class="reference external" href="https://support.apple.com/en-us/HT202823">https://support.apple.com/en-us/HT202823</a>  (approx all macOS systems from 2010 onwards)</li>
</ul>
</div>
<div class="section" id="using-a-shared-opticks-installation">
<h2>Using a Shared Opticks Installation<a class="headerlink" href="#using-a-shared-opticks-installation" title="Permalink to this headline">¶</a></h2>
<p>If someone has installed Opticks for you already
you just need to set the PATH variable in your .bash_profile
to easily find the Opticks executables and scripts.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># .bash_profile</span>

<span class="c1"># Get the aliases and functions</span>
<span class="k">if</span> <span class="o">[</span> -f ~/.bashrc <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    . ~/.bashrc
<span class="k">fi</span>

<span class="c1"># User specific environment and startup programs</span>

<span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$HOME</span>/.local/bin:<span class="nv">$HOME</span>/bin
ini<span class="o">(){</span> . ~/.bash_profile <span class="p">;</span> <span class="o">}</span>

ok-local<span class="o">(){</span>    <span class="nb">echo</span> /home/simonblyth/local <span class="p">;</span> <span class="o">}</span>
ok-opticks<span class="o">(){</span>  <span class="nb">echo</span> /home/simonblyth/opticks <span class="p">;</span> <span class="o">}</span>
ok-ctest<span class="o">(){</span>    <span class="o">(</span> <span class="nb">cd</span> <span class="k">$(</span>ok-local<span class="k">)</span>/opticks/build <span class="p">;</span> ctest3 <span class="nv">$*</span> <span class="p">;</span> <span class="o">)</span> <span class="o">}</span>

<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="k">$(</span>ok-opticks<span class="k">)</span>/ana:<span class="k">$(</span>ok-opticks<span class="k">)</span>/bin:<span class="k">$(</span>ok-local<span class="k">)</span>/opticks/lib:<span class="nv">$PATH</span>
</pre></div>
</div>
<p>You can test the installation using the <cite>ok-ctest</cite> function defined in
the .bash_profile. The output shoule look like the below.
The permission denied error is not a problem.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>blyth@optix ~<span class="o">]</span>$ ok-ctest
Test project /home/simonblyth/local/opticks/build
CMake Error: Cannot open file <span class="k">for</span> write: /home/simonblyth/local/opticks/build/Testing/Temporary/LastTest.log.tmp
CMake Error: : System Error: Permission denied
Problem opening file: /home/simonblyth/local/opticks/build/Testing/Temporary/LastTest.log
Cannot create log file: LastTest.log
        Start   <span class="m">1</span>: SysRapTest.SEnvTest
  <span class="m">1</span>/155 Test   <span class="c1">#1: SysRapTest.SEnvTest ........................   Passed    0.00 sec</span>
        Start   <span class="m">2</span>: SysRapTest.SSysTest
...
...
<span class="m">154</span>/155 Test <span class="c1">#154: cfg4Test.G4StringTest ......................   Passed    0.06 sec</span>
        Start <span class="m">155</span>: cfg4Test.G4BoxTest
<span class="m">155</span>/155 Test <span class="c1">#155: cfg4Test.G4BoxTest .........................   Passed    0.05 sec</span>

<span class="m">100</span>% tests passed, <span class="m">0</span> tests failed out of <span class="m">155</span>

Total Test <span class="nb">time</span> <span class="o">(</span>real<span class="o">)</span> <span class="o">=</span>  <span class="m">48</span>.30 sec
</pre></div>
</div>
</div>
<div class="section" id="visualization-finding-geometry">
<h2>Visualization Finding Geometry<a class="headerlink" href="#visualization-finding-geometry" title="Permalink to this headline">¶</a></h2>
<p>Visualization:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OTracerTest</span> <span class="o">--</span><span class="n">target</span> <span class="mi">3153</span> <span class="o">--</span><span class="n">dbgaim</span>   <span class="c1"># just viz, fast start as does no simulation</span>
<span class="n">OKTest</span> <span class="o">--</span><span class="n">target</span> <span class="mi">3153</span> <span class="o">--</span><span class="n">dbgaim</span>        <span class="c1"># does Opticks simulation before viz</span>
<span class="n">OKG4Test</span> <span class="o">--</span><span class="n">target</span> <span class="mi">3153</span> <span class="o">--</span><span class="n">dbgaim</span>      <span class="c1"># does both Geant4 and Opticks simulations before viz</span>

<span class="c1">## --target volume-index</span>
<span class="c1">## --dbgaim : dump some logging about geometry volumes and targetting</span>
</pre></div>
</div>
<p>To avoid having to use the target option use an envvar:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">OPTICKS_DEFAULT_TARGET</span><span class="o">=</span><span class="mi">3153</span>
<span class="c1">## do this together setting the OPTICKS_KEY which picks the geocache</span>
</pre></div>
</div>
<p>At startup things to try:</p>
<ul class="simple">
<li>press Q twice, this toggles the global (non-instanced) geometry on/off</li>
<li>press B several times, this swiches the render style of the instanced geometry</li>
<li>press V, this toggles rotation of the geometry</li>
<li>press A, this starts the optical photon propagation animation</li>
<li>press O, switches between OpenGL rasterized and OptiX ray trace rendering</li>
</ul>
<p>If after all that you still have a black screen, try:</p>
<ul class="simple">
<li>changing the target to a volume appropriate to your geometry,
it defaults to 0 corresponding to the world volume. However
maybe you have a very large world volume causing your detector to
not be visible.</li>
<li>press G, this brings up a GUI with help menus etc..</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="updating_this_documentation.html" title="Updating this documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="Opticks : GPU Accelerated Optical Photon Simulation using NVIDIA OptiX"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Opticks 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
  </body>
</html>