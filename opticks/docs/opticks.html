<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Opticks Install Instructions &mdash; Opticks 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Opticks 0.0.1 documentation" href="../index.html" />
    <link rel="next" title="Opticks Overview" href="overview.html" />
    <link rel="prev" title="Opticks : GPU Accelerated Optical Photon Simulation using NVIDIA OptiX" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="overview.html" title="Opticks Overview"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="Opticks : GPU Accelerated Optical Photon Simulation using NVIDIA OptiX"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Opticks 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Opticks Install Instructions</a><ul>
<li><a class="reference internal" href="#get-opticks">Get Opticks</a></li>
<li><a class="reference internal" href="#bash-setup-envvars">Bash setup, envvars</a></li>
<li><a class="reference internal" href="#location-overrides-by-envvar">Location Overrides by envvar</a></li>
<li><a class="reference internal" href="#opticks-installation-overview">Opticks Installation Overview</a></li>
<li><a class="reference internal" href="#build-tools">Build Tools</a></li>
<li><a class="reference internal" href="#cmake">CMake</a></li>
<li><a class="reference internal" href="#boost-c-libraries">Boost C++ Libraries</a><ul>
<li><a class="reference internal" href="#updating-boost">Updating Boost</a></li>
</ul>
</li>
<li><a class="reference internal" href="#opticks-pre-requisites-nvidia-optix-and-nvidia-cuda">Opticks Pre-requisites : NVIDIA OptiX and NVIDIA CUDA</a></li>
<li><a class="reference internal" href="#building-opticks">Building Opticks</a><ul>
<li><a class="reference internal" href="#externals">Externals</a></li>
<li><a class="reference internal" href="#separate-installation-of-externals">Separate installation of externals</a></li>
<li><a class="reference internal" href="#manually-configuring-opticks">Manually Configuring Opticks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration-machinery">Configuration Machinery</a></li>
<li><a class="reference internal" href="#opticks-without-nvidia-optix-and-cuda">Opticks Without NVIDIA OptiX and CUDA ?</a></li>
<li><a class="reference internal" href="#geant4-dependency">Geant4 Dependency</a></li>
<li><a class="reference internal" href="#embedded-opticks">Embedded Opticks</a></li>
<li><a class="reference internal" href="#testing-installation">Testing Installation</a></li>
<li><a class="reference internal" href="#issues-with-tests">Issues With Tests</a></li>
<li><a class="reference internal" href="#running-opticks-scripts-and-executables">Running Opticks Scripts and Executables</a></li>
<li><a class="reference internal" href="#systems-where-opticks-has-been-installed">Systems where Opticks has been Installed</a><ul>
<li><a class="reference internal" href="#macos-xcode-clang-toolchain">macOS : Xcode/clang toolchain</a></li>
<li><a class="reference internal" href="#linux-gcc-toolchain">Linux : GCC toolchain</a></li>
<li><a class="reference internal" href="#windows-microsoft-visual-studio-2015-community-edition">Windows : Microsoft Visual Studio 2015, Community edition</a></li>
</ul>
</li>
<li><a class="reference internal" href="#opengl-version-requirements">OpenGL Version Requirements</a></li>
<li><a class="reference internal" href="#using-a-shared-opticks-installation">Using a Shared Opticks Installation</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../index.html"
                        title="previous chapter">Opticks : GPU Accelerated Optical Photon Simulation using NVIDIA OptiX</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="overview.html"
                        title="next chapter">Opticks Overview</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/docs/opticks.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="opticks-install-instructions">
<h1>Opticks Install Instructions<a class="headerlink" href="#opticks-install-instructions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="get-opticks">
<h2>Get Opticks<a class="headerlink" href="#get-opticks" title="Permalink to this headline">¶</a></h2>
<p>Clone the repository from bitbucket:</p>
<div class="highlight-python"><pre>cd
hg clone http://bitbucket.org/simoncblyth/opticks
hg clone ssh://hg@bitbucket.org/simoncblyth/opticks   # via SSH for developers</pre>
</div>
</div>
<div class="section" id="bash-setup-envvars">
<h2>Bash setup, envvars<a class="headerlink" href="#bash-setup-envvars" title="Permalink to this headline">¶</a></h2>
<p>Connect the opticks bash functions to your shell by adding a line to your .bash_profile
and configure the location of the install with the LOCAL_BASE environment variable
and the location of the source with the OPTICKS_HOME envvar:</p>
<div class="highlight-python"><pre>opticks-(){ . $HOME/opticks/opticks.bash &amp;&amp; opticks-env $* ; }
export LOCAL_BASE=/usr/local
export OPTICKS_HOME=$HOME/opticks</pre>
</div>
<p>The first line defines the bash function <em>opticks-</em> that is termed a precursor function
as running it will define other functions all starting with <em>opticks-</em> such as <em>opticks-vi</em>
and <em>opticks-usage</em>.</p>
<p>Some further .bash_profile setup simplifies use of Opticks binaries and analysis scripts:</p>
<div class="highlight-python"><pre>op(){ op.sh $* ; }

export PYTHONPATH=$HOME
export PATH=$LOCAL_BASE/opticks/lib:$OPTICKS_HOME/bin:$OPTICKS_HOME/ana:$PATH</pre>
</div>
</div>
<div class="section" id="location-overrides-by-envvar">
<h2>Location Overrides by envvar<a class="headerlink" href="#location-overrides-by-envvar" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">envvar</th>
<th class="head">precursor-;funcname</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>OPTICKS_GEANT4_HOME</td>
<td>g4-;g4-prefix</td>
</tr>
<tr class="row-odd"><td>OPTICKS_OPTIX_HOME</td>
<td>optix-;optix-fold</td>
</tr>
<tr class="row-even"><td>OPTICKS_COMPUTE_CAPABILITY</td>
<td>opticks-;opticks-compute-capability</td>
</tr>
<tr class="row-odd"><td>OPTICKS_OPTIX_INSTALL_DIR</td>
<td>opticks-;opticks-optix-install-dir</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="opticks-installation-overview">
<h2>Opticks Installation Overview<a class="headerlink" href="#opticks-installation-overview" title="Permalink to this headline">¶</a></h2>
<p>Opticks installation requires:</p>
<ul class="simple">
<li>bash shell and build tools such as mercurial, git, curl, etc..</li>
<li>recent cmake 2.8.9+</li>
<li>Boost C++ libraries 1.59+</li>
<li>installations of pre-requisites packages<ul>
<li>NVIDIA OptiX 3.80</li>
<li>NVIDIA CUDA 7.0</li>
</ul>
</li>
</ul>
<p>I advise those precise versions of OptiX and CUDA, if you use other versions
you become a developer rather than a user, please report your findings.
The pre-requisite packages from NVIDIA need to be installed
following the instructions from NVIDIA. You will also need to
register as an NVIDIA developer.</p>
<p>After meeting these requirements you can install Opticks and its
external packages using a single command: <em>opticks-full</em></p>
</div>
<div class="section" id="build-tools">
<h2>Build Tools<a class="headerlink" href="#build-tools" title="Permalink to this headline">¶</a></h2>
<p>Getting, configuring, unpacking, building and installing Opticks and
its externals requires unix tools including:</p>
<ul class="simple">
<li>bash shell</li>
<li>mercurial hg</li>
<li>git</li>
<li>curl</li>
<li>tar</li>
<li>zip</li>
<li>cmake 2.8.9+</li>
</ul>
</div>
<div class="section" id="cmake">
<h2>CMake<a class="headerlink" href="#cmake" title="Permalink to this headline">¶</a></h2>
<p>A rather recent cmake version is required. Check your version with:</p>
<div class="highlight-python"><pre>simon:~ blyth$ cmake --version
cmake version 3.4.1</pre>
</div>
<p>Updating build tools is best done via your system package manager.
For example on OSX with macports update cmake with:</p>
<div class="highlight-python"><pre>port info cmake           # check the version the package manager proposes
sudo port install cmake   # do the install</pre>
</div>
<p>If you or your system administrator are unable to update a tool via the system
package manager then a local install of the tool must be done and your
login shell PATH modified to use the updated tool. The Opticks repository
includes bash functions for local installs of cmake with
precursor function <em>cmake-</em>.</p>
</div>
<div class="section" id="boost-c-libraries">
<h2>Boost C++ Libraries<a class="headerlink" href="#boost-c-libraries" title="Permalink to this headline">¶</a></h2>
<p>The Boost components listed in the table need to be installed.
These are widely available via package managers. Use the standard one for
your system. The FindBoost.cmake provided with cmake is used to locate the installation.</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="12%" />
<col width="10%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">directory</th>
<th class="head">precursor</th>
<th class="head">pkg name</th>
<th class="head">notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>boost</td>
<td>boost-</td>
<td>Boost</td>
<td>components: system thread program_options log log_setup filesystem regex</td>
</tr>
</tbody>
</table>
<div class="section" id="updating-boost">
<h3>Updating Boost<a class="headerlink" href="#updating-boost" title="Permalink to this headline">¶</a></h3>
<p>If your version of Boost is not recent enough the cmake configuring
step will yield errors like the below.:</p>
<div class="highlight-python"><pre>CMake Error at /home/blyth/local/env/tools/cmake/cmake-3.5.2-Linux-x86_64/share/cmake-3.5/Modules/FindBoost.cmake:1657 (message):
Unable to find the requested Boost libraries.

Boost version: 1.41.0</pre>
</div>
<p>If possible use your system package manager to update Boost. If that is
not possible then do a local Boost install.  Opticks includes bash functions
starting <em>boost-</em> that can get and install Boost locally.</p>
<div class="highlight-python"><pre>opticks-
boost-
opticks-configure -DBOOST_ROOT=$(boost-prefix)</pre>
</div>
</div>
</div>
<div class="section" id="opticks-pre-requisites-nvidia-optix-and-nvidia-cuda">
<h2>Opticks Pre-requisites : NVIDIA OptiX and NVIDIA CUDA<a class="headerlink" href="#opticks-pre-requisites-nvidia-optix-and-nvidia-cuda" title="Permalink to this headline">¶</a></h2>
<p>OptiX requires your system to have a fairly recent NVIDIA GPU of CUDA compute capability 3.0 at least.
However without such a GPU the OpenGL visualization should still work, using saved propagations.</p>
<p>To download OptiX you need to join the NVIDIA Developer Program.
Use the links in the table to register, it is free but may take a few days to be approved.
Follow the NVIDIA instructions to download and install CUDA and OptiX.
Thrust is installed together with CUDA.</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="12%" />
<col width="10%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">directory</th>
<th class="head">precursor</th>
<th class="head">pkg name</th>
<th class="head">notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>cuda</td>
<td>cuda-</td>
<td>CUDA</td>
<td><a class="reference external" href="https://developer.nvidia.com/cuda-downloads">https://developer.nvidia.com/cuda-downloads</a> (includes Thrust)</td>
</tr>
<tr class="row-odd"><td>optix</td>
<td>optix-</td>
<td>OptiX</td>
<td><a class="reference external" href="https://developer.nvidia.com/optix">https://developer.nvidia.com/optix</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="building-opticks">
<h2>Building Opticks<a class="headerlink" href="#building-opticks" title="Permalink to this headline">¶</a></h2>
<p>Once you have the necessary build tools and the pre-requisites you
can download and install the externals and build Opticks itself with:</p>
<div class="highlight-python"><pre>opticks-
opticks-full</pre>
</div>
<p>Note that repeating <em>opticks-full</em> will wipe the Opticks build directory
and run again from scratch.</p>
<p>After the first full build, much faster update builds can be done with:</p>
<div class="highlight-python"><pre>opticks--</pre>
</div>
<div class="section" id="externals">
<h3>Externals<a class="headerlink" href="#externals" title="Permalink to this headline">¶</a></h3>
<p>The <em>opticks-full</em> command automatically downloads and installs the below external packages
into the places required by Opticks.</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="17%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">precursor</th>
<th class="head">pkg name</th>
<th class="head">notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>glm-</td>
<td>GLM</td>
<td>OpenGL mathematics, 3D transforms</td>
</tr>
<tr class="row-odd"><td>assimp-</td>
<td>Assimp</td>
<td>Assimp 3D asset importer, my fork that handles G4DAE extras</td>
</tr>
<tr class="row-even"><td>openmesh-</td>
<td>OpenMesh</td>
<td>basis for mesh navigation and fixing</td>
</tr>
<tr class="row-odd"><td>glew-</td>
<td>GLEW</td>
<td>OpenGL extensions loading library, cmake build didnt work, includes vc12 sln for windows</td>
</tr>
<tr class="row-even"><td>glfw-</td>
<td>GLFW</td>
<td>Interface between system and OpenGL, creating windows and receiving input</td>
</tr>
<tr class="row-odd"><td>gleq-</td>
<td>GLEQ</td>
<td>Keyboard event handling header from GLFW author, header only</td>
</tr>
<tr class="row-even"><td>imgui-</td>
<td>ImGui</td>
<td>OpenGL immediate mode GUI, depends on glfw and glew</td>
</tr>
<tr class="row-odd"><td>plog-</td>
<td>PLog</td>
<td>Header only logging, supporting multi dll logging on windows</td>
</tr>
<tr class="row-even"><td>opticksdata-</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>Dayabay G4DAE and GDML geometry files for testing Opticks</td>
</tr>
<tr class="row-odd"><td>oimplicitmesher-</td>
<td>ImplicitMesher</td>
<td>Polygonization of implicitly defined shapes</td>
</tr>
<tr class="row-even"><td>odcs-</td>
<td>DualContouringSample</td>
<td>Alternate polygonization using Octree for multi-resolution, however its slow</td>
</tr>
<tr class="row-odd"><td>ocsgbsp-</td>
<td>CSGBSP</td>
<td>Another BSP approach to polygonization under investigation</td>
</tr>
<tr class="row-even"><td>oyoctogl-</td>
<td>YoctoGL</td>
<td>Used for glTF geometry file format handling, parsing/serializing</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="separate-installation-of-externals">
<h3>Separate installation of externals<a class="headerlink" href="#separate-installation-of-externals" title="Permalink to this headline">¶</a></h3>
<p>The <em>opticks-externals</em> function lists current precursor names, <em>opticks-externals-install</em> runs each
of the precursor functions in turn.  To rerun a single external install, use the below pattern of running
the precursor function and then the installer function.</p>
<div class="highlight-python"><pre>oyoctogl-
oyoctogl--</pre>
</div>
<p>After installation has been done rerunning <em>opticks-externals-install</em> completes quickly,
and does no harm.</p>
</div>
<div class="section" id="manually-configuring-opticks">
<h3>Manually Configuring Opticks<a class="headerlink" href="#manually-configuring-opticks" title="Permalink to this headline">¶</a></h3>
<p>If the automated configuring done by <em>opticks-full</em> failed to find the
pre-requisites you may need to specify some options to <em>opticks-configure</em>
to help the build scripts.</p>
<p>CMake is used to configure Opticks and generate Makefiles or Visual Studio solution files on Windows.
For a visualization only build with system Boost
the defaults should work OK and there is no need to explicitly configure.
If a local Boost was required then:</p>
<div class="highlight-python"><pre>opticks-configure -DBOOST_ROOT=$(boost-prefix)</pre>
</div>
<p>For a full build with CUDA and OptiX configure with:</p>
<div class="highlight-python"><pre>opticks-configure -DCUDA_TOOLKIT_ROOT_DIR=/Developer/NVIDIA/CUDA-7.0 \
                  -DOptiX_INSTALL_DIR=/Developer/OptiX \
                  -DCOMPUTE_CAPABILITY=52 \
                  -DBOOST_ROOT=$(boost-prefix)</pre>
</div>
<p>Another configure example:</p>
<div class="highlight-python"><pre>opticks-configure -DCUDA_TOOLKIT_ROOT_DIR=/usr/local/cuda-7.0 \
                  -DOptiX_INSTALL_DIR=/home/gpu/NVIDIA-OptiX-SDK-3.8.0-linux64/ \
                  -DCOMPUTE_CAPABILITY=52 \
                  -DBOOST_ROOT=/usr/local/lib</pre>
</div>
<p>The argument <cite>-DCOMPUTE_CAPABILITY=52</cite> specifies to compile for compute capability 5.2 architectures
corresponding to Maxwell 2nd generation GPUs.
Lookup the appropriate capability for your GPU in the below short table.</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="34%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Compute Capability</th>
<th class="head">Architecture</th>
<th class="head">GPU Examples</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2.1</td>
<td>Fermi</td>
<td><strong>NOT SUPPORTED BY OPTICKS</strong></td>
</tr>
<tr class="row-odd"><td>3.0</td>
<td>Kepler</td>
<td>GeForce GT 750M</td>
</tr>
<tr class="row-even"><td>5.0</td>
<td>Maxwell 1st generation</td>
<td>Quadro M2000M</td>
</tr>
<tr class="row-odd"><td>5.2</td>
<td>Maxwell 2nd generation</td>
<td>Quadro M5000</td>
</tr>
<tr class="row-even"><td>6.1</td>
<td>Pascal</td>
<td>GeForce GTX 1080</td>
</tr>
</tbody>
</table>
<p>For more complete tables see</p>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/CUDA">https://en.wikipedia.org/wiki/CUDA</a></li>
<li><a class="reference external" href="https://developer.nvidia.com/cuda-gpus">https://developer.nvidia.com/cuda-gpus</a>.</li>
</ul>
<p>Opticks requires a compute capability of at least 3.0, if you have no suitable GPU
or would like to test without GPU acceleration use <cite>-DCOMPUTE_CAPABILITY=0</cite>.</p>
<p>These configuration values are cached in the CMakeCache.txt file
in the build directory. These values are not overridden by rebuilding
with the <em>opticks&#8211;</em> bash function.
A subsequent <em>opticks-configure</em> however will wipe the build directory
allowing new values to be set.</p>
<p>To build:</p>
<div class="highlight-python"><pre>opticks--</pre>
</div>
</div>
</div>
<div class="section" id="configuration-machinery">
<h2>Configuration Machinery<a class="headerlink" href="#configuration-machinery" title="Permalink to this headline">¶</a></h2>
<p>If the above configuration suceeded for you then
you do not need to understand this machinery.</p>
<p>The below commands from the <em>opticks-cmake</em> bash function
change directory to the build folder and invokes cmake
to generate a configuration cache file and multiple Makefiles.:</p>
<div class="highlight-python"><pre>opticks-bcd
cmake \
    -DCMAKE_BUILD_TYPE=Debug \
    -DCMAKE_INSTALL_PREFIX=$(opticks-prefix) \
    -DOptiX_INSTALL_DIR=$(optix-prefix) \
    $* \
    $(opticks-sdir)</pre>
</div>
<p>CMake is controlled via CMakeLists.txt files.
The top level one includes the below lines that
locate the CUDA and OptiX:</p>
<div class="highlight-python"><pre>set(OPTICKS_CUDA_VERSION 7.0)
set(OPTICKS_OPTIX_VERSION 3.8)
...
find_package(CUDA ${OPTICKS_CUDA_VERSION})
find_package(OptiX ${OPTICKS_OPTIX_VERSION})</pre>
</div>
</div>
<div class="section" id="opticks-without-nvidia-optix-and-cuda">
<h2>Opticks Without NVIDIA OptiX and CUDA ?<a class="headerlink" href="#opticks-without-nvidia-optix-and-cuda" title="Permalink to this headline">¶</a></h2>
<p>High performance optical photon simulation requires an NVIDIA GPU
with compute capability of 3.0 or better (Kepler, Maxwell or Pascal architectures).
However if your GPU is not able to run OptiX/CUDA but is able to run OpenGL 4.0
(eg if you have an AMD GPU or an integrated Intel GPU)
it is still possible to make a partial build of Opticks
using cmake switch WITH_OPTIX=OFF.</p>
<p>The partial mode provides OpenGL visualizations of geometry and
photon propagations loaded from file.
This mode is not tested often, so provide copy/paste errors if it fails for you.</p>
</div>
<div class="section" id="geant4-dependency">
<h2>Geant4 Dependency<a class="headerlink" href="#geant4-dependency" title="Permalink to this headline">¶</a></h2>
<p>Opticks is structured as a collection of packages
organized by their local and external dependencies, see <a class="reference internal" href="overview.html"><em>Opticks Overview</em></a> for a table.
Only the two very highest level packages depend on Geant4.</p>
<dl class="docutils">
<dt>cfg4</dt>
<dd>validation comparisons</dd>
<dt>okg4</dt>
<dd>integrated Opticks+G4 for “gun running&#8221;</dd>
</dl>
<p>Opticks dependency on Geant4 is intended to be loose
in order to allow working with multiple G4 versions (within a certain version range),
using version preprocessor macros to accommodate differences.
So please send copy/paste reports of incompatibilities together with G4 versions.</p>
<p>The weak G4 dependency allows you to test most of Opticks even
without G4 installed.</p>
</div>
<div class="section" id="embedded-opticks">
<h2>Embedded Opticks<a class="headerlink" href="#embedded-opticks" title="Permalink to this headline">¶</a></h2>
<p>In production, Opticks is intended to be run in an embedded mode
where, Geant4 and Opticks communicate via “gensteps” and “hits”
without using any Geant4 headers. This works via some
Geant4 dependant glue code within each detectors simulation framework
that does the below:</p>
<ul class="simple">
<li>inhibits CPU generation of optical photons from G4Scintillation and G4Cerenkov processes,
instead &#8220;gensteps&#8221; are collected</li>
<li>invokes embedded Opticks (typically at the end of each event)
passing the collected &#8220;gensteps&#8221; across to Opticks which performs the
propagation</li>
<li>pulls back the PMT hits and populates standard Geant4 hit collections with these</li>
</ul>
<p>Once the details of the above integration have been revisted for JUNO example
integration code will be provided within the Opticks repository.</p>
</div>
<div class="section" id="testing-installation">
<h2>Testing Installation<a class="headerlink" href="#testing-installation" title="Permalink to this headline">¶</a></h2>
<p>The <em>opticks-t</em> functions runs ctests for all the opticks projects:</p>
<div class="highlight-python"><pre>simon:opticks blyth$ opticks-
simon:opticks blyth$ opticks-t
Test project /usr/local/opticks/build
      Start  1: SysRapTest.SEnvTest
 1/65 Test  #1: SysRapTest.SEnvTest ........................   Passed    0.00 sec
      Start  2: SysRapTest.SSysTest
 2/65 Test  #2: SysRapTest.SSysTest ........................   Passed    0.00 sec
      Start  3: SysRapTest.SDigestTest
 3/65 Test  #3: SysRapTest.SDigestTest .....................   Passed    0.00 sec
.....
.....
      Start 59: cfg4Test.CPropLibTest
59/65 Test #59: cfg4Test.CPropLibTest ......................   Passed    0.05 sec
      Start 60: cfg4Test.CTestDetectorTest
60/65 Test #60: cfg4Test.CTestDetectorTest .................   Passed    0.04 sec
      Start 61: cfg4Test.CGDMLDetectorTest
61/65 Test #61: cfg4Test.CGDMLDetectorTest .................   Passed    0.45 sec
      Start 62: cfg4Test.CG4Test
62/65 Test #62: cfg4Test.CG4Test ...........................   Passed    5.06 sec
      Start 63: cfg4Test.G4MaterialTest
63/65 Test #63: cfg4Test.G4MaterialTest ....................   Passed    0.02 sec
      Start 64: cfg4Test.G4StringTest
64/65 Test #64: cfg4Test.G4StringTest ......................   Passed    0.02 sec
      Start 65: cfg4Test.G4BoxTest
65/65 Test #65: cfg4Test.G4BoxTest .........................   Passed    0.02 sec

100% tests passed, 0 tests failed out of 65

Total Test time (real) =  59.89 sec
opticks-ctest : use -V to show output</pre>
</div>
</div>
<div class="section" id="issues-with-tests">
<h2>Issues With Tests<a class="headerlink" href="#issues-with-tests" title="Permalink to this headline">¶</a></h2>
<p>Some tests depend on the geometry cache being present. To create the geometry cache:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">op</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">G</span>
</pre></div>
</div>
</div>
<div class="section" id="running-opticks-scripts-and-executables">
<h2>Running Opticks Scripts and Executables<a class="headerlink" href="#running-opticks-scripts-and-executables" title="Permalink to this headline">¶</a></h2>
<p>All Opticks executables including the tests are installed
into $LOCAL_BASE/opticks/lib/ an example <cite>.bash_profile</cite>
to is provided below:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="c"># .bash_profile</span>

<span class="k">if</span> <span class="o">[</span> -f ~/.bashrc <span class="o">]</span>; <span class="k">then</span>                 <span class="c">## typical setup</span>
        . ~/.bashrc
<span class="k">fi</span>

<span class="nb">export </span><span class="nv">LOCAL_BASE</span><span class="o">=</span><span class="nv">$HOME</span>/local             <span class="c">## opticks hookup is needed by all Opticks users</span>
<span class="nb">export </span><span class="nv">OPTICKS_HOME</span><span class="o">=</span><span class="nv">$HOME</span>/opticks

opticks-<span class="o">(){</span>  <span class="o">[</span> -r <span class="nv">$HOME</span>/opticks/opticks.bash <span class="o">]</span> <span class="o">&amp;&amp;</span> . <span class="nv">$HOME</span>/opticks/opticks.bash <span class="o">&amp;&amp;</span> opticks-env <span class="nv">$*</span> ; <span class="o">}</span>
opticks-                                  <span class="c">## defines several bash functions beginning opticks- eg opticks-info</span>

o<span class="o">(){</span> <span class="nb">cd</span> <span class="k">$(</span>opticks-home<span class="k">)</span> ; hg st ; <span class="o">}</span>
op<span class="o">(){</span> op.sh <span class="nv">$*</span> ; <span class="o">}</span>

<span class="nv">PATH</span><span class="o">=</span><span class="nv">$OPTICKS_HOME</span>/bin:<span class="nv">$LOCAL_BASE</span>/opticks/lib:<span class="nv">$PATH</span>  <span class="c">## easy access to scripts and executables</span>
<span class="nb">export </span>PATH
</pre></div>
</div>
</div>
<div class="section" id="systems-where-opticks-has-been-installed">
<h2>Systems where Opticks has been Installed<a class="headerlink" href="#systems-where-opticks-has-been-installed" title="Permalink to this headline">¶</a></h2>
<div class="section" id="macos-xcode-clang-toolchain">
<h3>macOS : Xcode/clang toolchain<a class="headerlink" href="#macos-xcode-clang-toolchain" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Primary development platfom : Mavericks 10.9.4</li>
<li>NVIDIA Geforce GT 750M (mobile GPU)</li>
</ul>
</div>
<div class="section" id="linux-gcc-toolchain">
<h3>Linux : GCC toolchain<a class="headerlink" href="#linux-gcc-toolchain" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Opticks has been ported to a DELL Precision Workstation, running Ubuntu</li>
<li>NVIDIA Quadro M5000</li>
</ul>
</div>
<div class="section" id="windows-microsoft-visual-studio-2015-community-edition">
<h3>Windows : Microsoft Visual Studio 2015, Community edition<a class="headerlink" href="#windows-microsoft-visual-studio-2015-community-edition" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Ported to Windows 7 SP1 machine</li>
<li>non-CUDA capable GPU</li>
</ul>
<p>Opticks installation uses the bash shell.
The Windows bash shell that comes with
the git-for-windows project was used for this purpose</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/git-for-windows">https://github.com/git-for-windows</a></li>
</ul>
<p>Despite lack of an CUDA capable GPU, the OpenGL Opticks
visualization was found to operate successfully.</p>
</div>
</div>
<div class="section" id="opengl-version-requirements">
<h2>OpenGL Version Requirements<a class="headerlink" href="#opengl-version-requirements" title="Permalink to this headline">¶</a></h2>
<p>Opticks uses GLSL shaders with version 400,
corresponding to at least OpenGL 4.0</p>
<p>OpenGL versions supported by various systems are listed at the below links.</p>
<ul class="simple">
<li>macOS : <a class="reference external" href="https://support.apple.com/en-us/HT202823">https://support.apple.com/en-us/HT202823</a>  (approx all macOS systems from 2010 onwards)</li>
</ul>
</div>
<div class="section" id="using-a-shared-opticks-installation">
<h2>Using a Shared Opticks Installation<a class="headerlink" href="#using-a-shared-opticks-installation" title="Permalink to this headline">¶</a></h2>
<p>If someone has installed Opticks for you already
you just need to set the PATH variable in your .bash_profile
to easily find the Opticks executables and scripts.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="c"># .bash_profile</span>

<span class="c"># Get the aliases and functions</span>
<span class="k">if</span> <span class="o">[</span> -f ~/.bashrc <span class="o">]</span>; <span class="k">then</span>
    . ~/.bashrc
<span class="k">fi</span>

<span class="c"># User specific environment and startup programs</span>

<span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$HOME</span>/.local/bin:<span class="nv">$HOME</span>/bin
ini<span class="o">(){</span> . ~/.bash_profile ; <span class="o">}</span>

ok-local<span class="o">(){</span>    <span class="nb">echo</span> /home/simonblyth/local ; <span class="o">}</span>
ok-opticks<span class="o">(){</span>  <span class="nb">echo</span> /home/simonblyth/opticks ; <span class="o">}</span>
ok-ctest<span class="o">(){</span>    <span class="o">(</span> <span class="nb">cd</span> <span class="k">$(</span>ok-local<span class="k">)</span>/opticks/build ; ctest3 <span class="nv">$*</span> ; <span class="o">)</span> <span class="o">}</span>

<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="k">$(</span>ok-opticks<span class="k">)</span>/ana:<span class="k">$(</span>ok-opticks<span class="k">)</span>/bin:<span class="k">$(</span>ok-local<span class="k">)</span>/opticks/lib:<span class="nv">$PATH</span>
</pre></div>
</div>
<p>You can test the installation using the <cite>ok-ctest</cite> function defined in
the .bash_profile. The output shoule look like the below.
The permission denied error is not a problem.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">[</span>blyth@optix ~<span class="o">]</span><span class="nv">$ </span>ok-ctest
Test project /home/simonblyth/local/opticks/build
CMake Error: Cannot open file <span class="k">for </span>write: /home/simonblyth/local/opticks/build/Testing/Temporary/LastTest.log.tmp
CMake Error: : System Error: Permission denied
Problem opening file: /home/simonblyth/local/opticks/build/Testing/Temporary/LastTest.log
Cannot create log file: LastTest.log
        Start   1: SysRapTest.SEnvTest
  1/155 Test   <span class="c">#1: SysRapTest.SEnvTest ........................   Passed    0.00 sec</span>
        Start   2: SysRapTest.SSysTest
...
...
154/155 Test <span class="c">#154: cfg4Test.G4StringTest ......................   Passed    0.06 sec</span>
        Start 155: cfg4Test.G4BoxTest
155/155 Test <span class="c">#155: cfg4Test.G4BoxTest .........................   Passed    0.05 sec</span>

100% tests passed, 0 tests failed out of 155

Total Test <span class="nb">time</span> <span class="o">(</span>real<span class="o">)</span> <span class="o">=</span>  48.30 sec
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="overview.html" title="Opticks Overview"
             >next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="Opticks : GPU Accelerated Optical Photon Simulation using NVIDIA OptiX"
             >previous</a> |</li>
        <li><a href="../index.html">Opticks 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2017, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>