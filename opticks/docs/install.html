
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Opticks Install Instructions &#8212; Opticks 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Opticks Externals" href="externals.html" />
    <link rel="prev" title="Opticks Documentation" href="opticks.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="externals.html" title="Opticks Externals"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="opticks.html" title="Opticks Documentation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Opticks 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Opticks Install Instructions</a><ul>
<li><a class="reference internal" href="#overview-of-opticks-installation-steps">Overview of Opticks installation steps</a></li>
<li><a class="reference internal" href="#platform-support">Platform Support</a></li>
<li><a class="reference internal" href="#get-opticks">Get Opticks</a></li>
<li><a class="reference internal" href="#update-an-existing-clone">Update an existing clone</a></li>
<li><a class="reference internal" href="#bash-shell-setup-with-opticks-config">Bash Shell Setup with .opticks_config</a></li>
<li><a class="reference internal" href="#bash-environment-setup-checking-bash-environment">Bash environment setup, checking bash environment</a><ul>
<li><a class="reference internal" href="#check-your-bash-environment-setup">Check your bash environment setup</a></li>
</ul>
</li>
<li><a class="reference internal" href="#opticks-installation-build-tools">Opticks Installation Build Tools</a><ul>
<li><a class="reference internal" href="#cmake-version-3-12">CMake Version 3.12+</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-requirements">Version Requirements</a><ul>
<li><a class="reference internal" href="#optix-6-5">OptiX 6.5</a></li>
<li><a class="reference internal" href="#opengl-4-1">OpenGL 4.1</a></li>
<li><a class="reference internal" href="#boost-1-53">Boost 1.53+</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-opticks-with-opticks-full">Building Opticks with <strong>opticks-full</strong></a><ul>
<li><a class="reference internal" href="#externals">Externals</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="opticks.html"
                        title="previous chapter">Opticks Documentation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="externals.html"
                        title="next chapter">Opticks Externals</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/docs/install.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="opticks-install-instructions">
<h1><a class="toc-backref" href="#id1">Opticks Install Instructions</a><a class="headerlink" href="#opticks-install-instructions" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#opticks-install-instructions" id="id1">Opticks Install Instructions</a><ul>
<li><a class="reference internal" href="#overview-of-opticks-installation-steps" id="id2">Overview of Opticks installation steps</a></li>
<li><a class="reference internal" href="#platform-support" id="id3">Platform Support</a></li>
<li><a class="reference internal" href="#get-opticks" id="id4">Get Opticks</a></li>
<li><a class="reference internal" href="#update-an-existing-clone" id="id5">Update an existing clone</a></li>
<li><a class="reference internal" href="#bash-shell-setup-with-opticks-config" id="id6">Bash Shell Setup with .opticks_config</a></li>
<li><a class="reference internal" href="#bash-environment-setup-checking-bash-environment" id="id7">Bash environment setup, checking bash environment</a></li>
<li><a class="reference internal" href="#opticks-installation-build-tools" id="id8">Opticks Installation Build Tools</a></li>
<li><a class="reference internal" href="#version-requirements" id="id9">Version Requirements</a></li>
<li><a class="reference internal" href="#building-opticks-with-opticks-full" id="id10">Building Opticks with <strong>opticks-full</strong></a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview-of-opticks-installation-steps">
<h2><a class="toc-backref" href="#id2">Overview of Opticks installation steps</a><a class="headerlink" href="#overview-of-opticks-installation-steps" title="Permalink to this headline">¶</a></h2>
<p>A high level overview of the sequence of steps to install Opticks are listed below.</p>
<ol class="arabic simple" start="0">
<li>install “system” externals : NVIDIA GPU Driver, CUDA, OptiX 6.5
following instructions from NVIDIA. Check they are working.</li>
<li>use git to clone opticks bitbucket repository to your home directory, creating ~/opticks</li>
<li>hookup the opticks bash functions to your bash shell<ul>
<li>cp ~/opticks/example.opticks_config ~/.opticks_config</li>
<li>ensure that your .bash_profile sources .bashrc</li>
<li>add line to .bashrc “source ~/.opticks_config”</li>
</ul>
</li>
<li>start a new session and check the bash functions are hooked up correctly with:<ul>
<li>opticks-info</li>
<li>bash -lc “opticks-info”</li>
</ul>
</li>
<li>install the foreign externals OR use preexisting installs of boost,clhep,xercesc,g4<ul>
<li>opticks-foreign     # lists them</li>
<li>opticks-foreign-install    # installs them</li>
<li>see <a class="reference internal" href="externals.html"><span class="doc">Opticks Externals</span></a> for the difference between <strong>system</strong>, <strong>foreign</strong> and <strong>automated</strong> externals</li>
</ul>
</li>
<li>edit ~/.opticks_config setting the paths appropriately for the
prefixes of the “system” and “foreign” externals and setting
the prefix for the opticks install (eg /usr/local/opticks)</li>
<li>install the “automated” externals and opticks itself with<ul>
<li>opticks-full</li>
</ul>
</li>
<li>test the opticks build with<ul>
<li>opticks-t</li>
<li>see <a class="reference internal" href="testing.html"><span class="doc">Opticks Testing, Geocache Creation, Python setup</span></a></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="platform-support">
<h2><a class="toc-backref" href="#id3">Platform Support</a><a class="headerlink" href="#platform-support" title="Permalink to this headline">¶</a></h2>
<p>A recent Scientific Linux or CentOS Linux are the target platforms for production running of Opticks,
but I am happy to try to help with installations on any Linux supported by CUDA.</p>
<p>Initial development was done on macOS (late 2013 MacBook pro : the last Mac laptop with an NVIDIA GPU)
with occasional ports to keep thinks working on Scientific Linux. But now due to the lack of Macs
with NVIDIA GPUs development has moved to Linux CentOS 7 and Scientific Linux.</p>
</div>
<div class="section" id="get-opticks">
<h2><a class="toc-backref" href="#id4">Get Opticks</a><a class="headerlink" href="#get-opticks" title="Permalink to this headline">¶</a></h2>
<p>Clone the repository from bitbucket:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">bitbucket</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">simoncblyth</span><span class="o">/</span><span class="n">opticks</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@bitbucket</span><span class="o">.</span><span class="n">org</span><span class="p">:</span><span class="n">simoncblyth</span><span class="o">/</span><span class="n">opticks</span><span class="o">.</span><span class="n">git</span>   <span class="c1"># via git url for developers, uses ssh keys for passwordless pushes</span>
</pre></div>
</div>
</div>
<div class="section" id="update-an-existing-clone">
<h2><a class="toc-backref" href="#id5">Update an existing clone</a><a class="headerlink" href="#update-an-existing-clone" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">opticks</span>
<span class="n">git</span> <span class="n">remote</span> <span class="o">-</span><span class="n">v</span>   <span class="c1"># should list bitbucket.org urls</span>
<span class="n">git</span> <span class="n">status</span>
<span class="n">git</span> <span class="n">pull</span>
</pre></div>
</div>
</div>
<div class="section" id="bash-shell-setup-with-opticks-config">
<h2><a class="toc-backref" href="#id6">Bash Shell Setup with .opticks_config</a><a class="headerlink" href="#bash-shell-setup-with-opticks-config" title="Permalink to this headline">¶</a></h2>
<p>Copy the <cite>example.opticks_config</cite> to your home directory and hook it up to your
bash environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">~/</span><span class="n">opticks</span><span class="o">/</span><span class="n">example</span><span class="o">.</span><span class="n">opticks_config</span> <span class="o">~/.</span><span class="n">opticks_config</span>
<span class="n">echo</span> <span class="s2">&quot;source ~/.opticks_config&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">~/.</span><span class="n">bashrc</span>
</pre></div>
</div>
<p>Ensure that <cite>.bashrc</cite> is sourced from your <cite>~/.bash_profile</cite>.  The <cite>~/.opticks_config</cite>
must be customized for your system, changing the PREFIX envvar paths and directory arguments to <cite>opticks-prepend-prefix</cite>.
Extracts from the example <cite>~/.opticks_config</cite> are shown below.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># .opticks_config</span>
<span class="c1"># .bash_profile &gt; .bashrc &gt; .opticks_config</span>

opticks-<span class="o">(){</span>  <span class="o">[</span> -r <span class="nv">$HOME</span>/opticks/opticks.bash <span class="o">]</span> <span class="o">&amp;&amp;</span> . <span class="nv">$HOME</span>/opticks/opticks.bash <span class="o">&amp;&amp;</span> opticks-env <span class="nv">$*</span> <span class="p">;</span> <span class="o">}</span>
opticks-
o<span class="o">(){</span> opticks- <span class="p">;</span> <span class="nb">cd</span> <span class="k">$(</span>opticks-home<span class="k">)</span> <span class="p">;</span> git status <span class="p">;</span> <span class="o">}</span>
t<span class="o">(){</span> <span class="nb">typeset</span> -f <span class="nv">$*</span> <span class="p">;</span> <span class="o">}</span>

<span class="c1"># PATH envvars control the externals that opticks/CMake or pkg-config will find</span>
<span class="nb">unset</span> CMAKE_PREFIX_PATH
<span class="nb">unset</span> PKG_CONFIG_PATH

<span class="c1"># mandatory envvars in buildenv</span>
<span class="nb">export</span> <span class="nv">OPTICKS_PREFIX</span><span class="o">=</span>/usr/local/opticks
<span class="nb">export</span> <span class="nv">OPTICKS_CUDA_PREFIX</span><span class="o">=</span>/usr/local/cuda
<span class="nb">export</span> <span class="nv">OPTICKS_OPTIX_PREFIX</span><span class="o">=</span>/usr/local/optix

<span class="nb">export</span> <span class="nv">OPTICKS_COMPUTE_CAPABILITY</span><span class="o">=</span><span class="m">30</span>

<span class="c1">## hookup paths to access &quot;foreign&quot; externals</span>
opticks-prepend-prefix /usr/local/opticks_externals/clhep
opticks-prepend-prefix /usr/local/opticks_externals/xercesc
opticks-prepend-prefix /usr/local/opticks_externals/g4
opticks-prepend-prefix /usr/local/opticks_externals/boost

<span class="c1">## NB changing any directory paths demands an opticks-full rebuild</span>
<span class="c1">## This is enforced by $OPTICKS_PREFIX/bin/opticks-setup.sh  which</span>
<span class="c1">## is generated by opticks-full with opticks-setup-generate.</span>
</pre></div>
</div>
<p>What this <cite>.opticks_config</cite> script does:</p>
<ol class="arabic simple">
<li>defines the <cite>opticks-</cite> bash function, this is termed a precursor function as running it will define other functions all starting with <em>opticks-</em> such as <em>opticks-vi</em></li>
<li>invokes the <cite>opticks-</cite> bash function which defines <cite>opticks-*</cite> functions as well as other precursor functions such as <cite>g4-</cite></li>
<li>exports three mandatory PREFIX envvars identifying where to install Opticks and where CUDA and OptiX are installed.</li>
<li>exports mandatory envvar OPTICKS_COMPUTE_CAPABILITY identifying the capability of the GPU</li>
<li>invokes opticks-prepend-prefix for “foreign” externals, this
prepends to path envvars including PATH, CMAKE_PREFIX_PATH, PKG_CONFIG_PATH and LD_LIBRARY_PATH</li>
</ol>
<p>Note that the directory paths in the above config are examples that you may need to change as appropriate for you.
To determine the appropriate value for OPTICKS_COMPUTE_CAPABILITY, use the <code class="docutils literal notranslate"><span class="pre">1_Utilities/deviceQuery</span></code> CUDA sample.</p>
</div>
<div class="section" id="bash-environment-setup-checking-bash-environment">
<h2><a class="toc-backref" href="#id7">Bash environment setup, checking bash environment</a><a class="headerlink" href="#bash-environment-setup-checking-bash-environment" title="Permalink to this headline">¶</a></h2>
<p>Opticks installation and usage is based on bash functions, thus it
is essential that the bash functions are connected to your
bash environment correctly.</p>
<p>The recommended arrangment of bash setup scripts:</p>
<ul class="simple">
<li><cite>~/.bash_profile</cite> should source <cite>~/.bashrc</cite></li>
<li><cite>~/.bashrc</cite> should source <cite>~/.opticks_config</cite> (PRIOR to any early exits)</li>
</ul>
<p>Using this approach succeeds to setup the opticks bash functions
and exports with either “bash -l” or “bash -i” or from within
scripts using shebang line “#!/bin/bash -l”.</p>
<p>This makes the setup immune to differing treatments of when
<cite>~/.bash_profile</cite> and <cite>~/.bashrc</cite> are to invoked by various Linux
distros and macOS.</p>
<div class="section" id="check-your-bash-environment-setup">
<h3>Check your bash environment setup<a class="headerlink" href="#check-your-bash-environment-setup" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[blyth@localhost ~]$ bash -lc &quot;opticks- ; opticks-info &quot;    ## RHEL, Centos (and Ubuntu too)

opticks-locations
==================

      opticks-source   :   /home/blyth/opticks/opticks.bash
      opticks-home     :   /home/blyth/opticks
      opticks-name     :   opticks

      opticks-fold     :   /home/blyth/local/opticks

...
</pre></div>
</div>
<p>If the above commandline gives errors, compare your <em>.opticks_config</em> with
the above example and consult <a class="reference internal" href="misc/bash_setup.html"><span class="doc">Bash Setup</span></a>.</p>
</div>
</div>
<div class="section" id="opticks-installation-build-tools">
<h2><a class="toc-backref" href="#id8">Opticks Installation Build Tools</a><a class="headerlink" href="#opticks-installation-build-tools" title="Permalink to this headline">¶</a></h2>
<p>Getting, configuring, unpacking, building and installing Opticks and
its externals requires unix tools including:</p>
<ul class="simple">
<li>bash shell</li>
<li>git</li>
<li>mercurial (is this still needed?)</li>
<li>curl</li>
<li>tar</li>
<li>zip</li>
<li>recent cmake 3.12+</li>
<li>python</li>
</ul>
<div class="section" id="cmake-version-3-12">
<h3>CMake Version 3.12+<a class="headerlink" href="#cmake-version-3-12" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>I recommend use of at least 3.12 for building Opticks</strong>.</li>
<li><strong>The most common Opticks build issues arise from using older CMake versions.</strong></li>
</ul>
<p>Check your version with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>simon:~ blyth$ cmake --version
cmake version 3.12.0
</pre></div>
</div>
<p>Although usually preferable to get build tools using your system
package manager, the system cmake version will almost certainly
not be recent enough.</p>
<p>Opticks CMake infrastructure makes heavy use of recent CMake target
import/export features used by BCM (Boost CMake Modules).
The current Opticks CMake infrastructure was developed in May 2018
using CMake 3.11 and 3.12 (I am currently using 3.14.1)
The Opticks repository includes bash functions for local installs of
cmake with precursor function <em>ocmake-</em> which will install 3.14.1</p>
<p>For what goes wrong if you use an older CMake version see:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">notes/issues/cmake_target_link_libraries_for_imported_target.rst</span></code></li>
</ul>
<p>To install CMake 3.14.1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[blyth@localhost opticks]$ ocmake-     ## run precursor function that defines the others
[blyth@localhost opticks]$ ocmake-vi   ## take a look at the bash functions
[blyth@localhost opticks]$ ocmake-info
ocmake-info
============

ocmake-vers : 3.14.1
ocmake-nam  : cmake-3.14.1
ocmake-url  : https://github.com/Kitware/CMake/releases/download/v3.14.1/cmake-3.14.1.tar.gz
ocmake-dir  : /home/blyth/local/opticks/externals/cmake/cmake-3.14.1

[blyth@localhost opticks]$ ocmake--    ## downloads, configures, builds, installs
</pre></div>
</div>
<p>After installation you will need to adjust you PATH to
use the newer <em>cmake</em> binary. Check with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">which</span> <span class="n">cmake</span>
<span class="n">cmake</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="version-requirements">
<h2><a class="toc-backref" href="#id9">Version Requirements</a><a class="headerlink" href="#version-requirements" title="Permalink to this headline">¶</a></h2>
<p>For details, see <a class="reference internal" href="externals.html"><span class="doc">Opticks Externals</span></a></p>
<div class="section" id="optix-6-5">
<h3>OptiX 6.5<a class="headerlink" href="#optix-6-5" title="Permalink to this headline">¶</a></h3>
<p>The latest OptiX 7.1 is not yet supported.</p>
</div>
<div class="section" id="opengl-4-1">
<h3>OpenGL 4.1<a class="headerlink" href="#opengl-4-1" title="Permalink to this headline">¶</a></h3>
<p>Opticks uses GLSL shaders with version 410, corresponding to at least OpenGL 4.1</p>
</div>
<div class="section" id="boost-1-53">
<h3>Boost 1.53+<a class="headerlink" href="#boost-1-53" title="Permalink to this headline">¶</a></h3>
<p>The recommended minimum boost version is 1.53 as that is what I am using.
You might be able to survive with an earlier version,
but anything before 1.41 is known not to work.</p>
</div>
</div>
<div class="section" id="building-opticks-with-opticks-full">
<h2><a class="toc-backref" href="#id10">Building Opticks with <strong>opticks-full</strong></a><a class="headerlink" href="#building-opticks-with-opticks-full" title="Permalink to this headline">¶</a></h2>
<p>Once you have the necessary build tools and the pre-requisites you
can download and install the externals and build Opticks itself with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opticks</span><span class="o">-</span>
<span class="n">opticks</span><span class="o">-</span><span class="n">full</span>
</pre></div>
</div>
<p>Note that repeating <em>opticks-full</em> will wipe the Opticks build directory
and run again from scratch.</p>
<p>After the first full build, much faster update builds can be done with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opticks</span><span class="o">--</span>
</pre></div>
</div>
<div class="section" id="externals">
<h3>Externals<a class="headerlink" href="#externals" title="Permalink to this headline">¶</a></h3>
<p>The <em>opticks-full</em> command automatically downloads and installs the <strong>automated</strong>
external packages into the places required by Opticks.  See <a class="reference internal" href="externals.html"><span class="doc">Opticks Externals</span></a>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="externals.html" title="Opticks Externals"
             >next</a> |</li>
        <li class="right" >
          <a href="opticks.html" title="Opticks Documentation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Opticks 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
  </body>
</html>