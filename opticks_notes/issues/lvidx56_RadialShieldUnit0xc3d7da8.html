<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>lvidx 56 RadialShieldUnit0xc3d7da8 &mdash; OpticksDevNotes 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="OpticksDevNotes 0.0.1 documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">OpticksDevNotes 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">lvidx 56 RadialShieldUnit0xc3d7da8</a><ul>
<li><a class="reference internal" href="#viz-following-move-to-csg-segment-python-primitive-phi0-phi1-z-rmax">Viz : following move to CSG_SEGMENT python primitive (phi0,phi1,z,rmax)</a></li>
<li><a class="reference internal" href="#issues-with-two-slab-intersects-avoided-by-move-to-csg-segment">Issues with two slab intersects : AVOIDED BY MOVE TO CSG_SEGMENT</a></li>
<li><a class="reference internal" href="#parsurf-bb-is-kinda-mute-because-raytrace-not-working">parsurf bb is kinda mute because raytrace not working</a></li>
<li><a class="reference internal" href="#dumping-the-raw-and-blanced-trees">dumping the raw and blanced trees</a></li>
<li><a class="reference internal" href="#raytrace-tree-height-limit-max-7">Raytrace tree height limit : max 7</a></li>
<li><a class="reference internal" href="#opticks-tbool-56">opticks-tbool 56</a></li>
<li><a class="reference internal" href="#checking-tree-balancing-with-slab-cuts">Checking tree balancing with slab cuts</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/issues/lvidx56_RadialShieldUnit0xc3d7da8.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="lvidx-56-radialshieldunit0xc3d7da8">
<h1>lvidx 56 RadialShieldUnit0xc3d7da8<a class="headerlink" href="#lvidx-56-radialshieldunit0xc3d7da8" title="Permalink to this headline">¶</a></h1>
<div class="section" id="viz-following-move-to-csg-segment-python-primitive-phi0-phi1-z-rmax">
<h2>Viz : following move to CSG_SEGMENT python primitive (phi0,phi1,z,rmax)<a class="headerlink" href="#viz-following-move-to-csg-segment-python-primitive-phi0-phi1-z-rmax" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>op --dlv56 --gltf 3
    looks reasonable : loada panels, each with 6 holes for PMTs : g4poly is kinda whacky</pre>
</div>
</div>
<div class="section" id="issues-with-two-slab-intersects-avoided-by-move-to-csg-segment">
<h2>Issues with two slab intersects : AVOIDED BY MOVE TO CSG_SEGMENT<a class="headerlink" href="#issues-with-two-slab-intersects-avoided-by-move-to-csg-segment" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>adding slab intersects pushes tree height above limit of 7</li>
<li>problem is that tree balancing rearranges to put two slabs together which doesnt work : produces empty raytrace</li>
<li>a single slab intersect does work however ... because no double unbounded ?</li>
</ul>
</div>
<div class="section" id="parsurf-bb-is-kinda-mute-because-raytrace-not-working">
<h2>parsurf bb is kinda mute because raytrace not working<a class="headerlink" href="#parsurf-bb-is-kinda-mute-because-raytrace-not-working" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>332.587               RadialShieldUnit0xc3d7da8 lvidx  56 nsp    288             intersection difference cylinder slab   nds[ 64]  4393 4394 4395 4396 4397 4398 4399 4400 4401 4402 ...
332.587               RadialShieldUnit0xc3d7da8 lvidx  56 nsp    288

amn (   1878.414     0.000  -498.500)
bmn (   1607.600     0.000  -498.500)
dmn (    270.814     0.000     0.000)

amx (   2262.150  1256.783   498.500)
bmx (   2262.150  1589.370   498.500)
dmx (      0.000  -332.587     0.000)

opticks-;opticks-tbool-vi 56</pre>
</div>
</div>
<div class="section" id="dumping-the-raw-and-blanced-trees">
<h2>dumping the raw and blanced trees<a class="headerlink" href="#dumping-the-raw-and-blanced-trees" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>moving slab intersects to the top work when only one, but not with two</li>
</ul>
<div class="highlight-python"><pre>delta:cu blyth$ opticks-;opticks-tbool- 56

opticks-tbool- : sourcing /usr/local/opticks/opticksdata/export/DayaBay_VGDX_20140414-1300/extras/56/tbool56.bash
args:
[2017-07-08 10:18:08,359] p6906 {/Users/blyth/opticks/analytic/csg.py:822} INFO - raw name:intersection
in(in(di(di(di(di(di(di(di(cy,cy),cy),cy),cy),cy),cy),cy),sl),sl) height:9 totnodes:1023

                                                                    in abcdefghij
                                                            in abcdefghi         sl j
                                                    di abcdefgh         sl i
                                            di abcdefg         cy h
                                    di abcdef         cy g
                            di abcde         cy f
                    di abcd         cy e
            di abc         cy d
    di ab         cy c
cy a     cy b
[2017-07-08 10:18:08,361] p6906 {/Users/blyth/opticks/analytic/csg.py:822} INFO - optimized name:intersection_prim_balanced
in(in(in(in(cy,!cy),in(!cy,!cy)),in(in(!cy,!cy),in(!cy,!cy))),in(sl,sl)) height:4 totnodes:31

                                                            in abcdefghij
                            in abcdefgh                                     in ij
            in abcd                             in efgh                 sl i     sl j
    in ab             in cd             in ef             in gh
cy a     !cy b     !cy c     !cy d     !cy e     !cy f     !cy g     !cy h
[2017-07-08 10:18:08,361] p6906 {/Users/blyth/opticks/analytic/csg.py:417} INFO - CSG.Serialize : writing 2 trees to directory /tmp/blyth/opticks/tbool/56
analytic=1_csgpath=/tmp/blyth/opticks/tbool/56_name=56_mode=PyCsgInBox</pre>
</div>
</div>
<div class="section" id="raytrace-tree-height-limit-max-7">
<h2>Raytrace tree height limit : max 7<a class="headerlink" href="#raytrace-tree-height-limit-max-7" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>slab intersects add 2 levels to the tree which pushes height above limit of 7</li>
<li>normally such deep trees get positivized and balanced, but thats disabled for
trees with slab segmenting</li>
</ul>
<div class="highlight-python"><pre>evaluative_csg tranOffset 0 numParts 1023 perfect tree height 9 exceeds current limit
evaluative_csg tranOffset 0 numParts 1023 perfect tree height 9 exceeds current limit
evaluative_csg tranOffset 0 numParts 1023 perfect tree height 9 exceeds current limit
evaluative_csg tranOffset 0 numParts 1023 perfect tree height 9 exceeds current limit</pre>
</div>
<div class="highlight-python"><pre>542 #define USE_TWIDDLE_POSTORDER 1
543
544 static __device__
545 void evaluative_csg( const Prim&amp; prim, const uint4&amp; identity )
546 {
547     unsigned partOffset = prim.partOffset() ;
548     unsigned numParts   = prim.numParts() ;
549     unsigned tranOffset = prim.tranOffset() ;
550
551     unsigned height = TREE_HEIGHT(numParts) ; // 1-&gt;0, 3-&gt;1, 7-&gt;2, 15-&gt;3, 31-&gt;4
552
553 #ifdef USE_TWIDDLE_POSTORDER
554     // bit-twiddle postorder limited to height 7, ie maximum of 0xff (255) nodes
555     // (using 2-bytes with PACK2 would bump that to 0xffff (65535) nodes)
556     // In any case 0xff nodes are far more than this is expected to be used with
557     //
558     if(height &gt; 7)
559     {
560         rtPrintf("evaluative_csg tranOffset %u numParts %u perfect tree height %u exceeds current limit\n", tranOffset, numParts, height ) ;
561         return ;
562     }
563 #else
564     // pre-baked postorder limited to height 3 tree,  ie maximum of 0xf nodes
565     // by needing to stuff the postorder sequence 0x137fe6dc25ba498ull into 64 bits</pre>
</div>
</div>
<div class="section" id="opticks-tbool-56">
<h2>opticks-tbool 56<a class="headerlink" href="#opticks-tbool-56" title="Permalink to this headline">¶</a></h2>
<p>Segment of ring with 6 holes cut by cylinders:</p>
<div class="highlight-python"><pre>078 # generated by tboolean.py : 20170707-2050
 79 # opticks-;opticks-tbool 56
 80 # opticks-;opticks-tbool-vi 56
 81
 82
 83 a = CSG("cylinder", param = [0.000,0.000,0.000,2262.150],param1 = [-498.500,498.500,0.000,0.000])
 84 b = CSG("cylinder", param = [0.000,0.000,0.000,2259.150],param1 = [-503.485,503.485,0.000,0.000])
 85 ab = CSG("difference", left=a, right=b)
 86
 87 c = CSG("slab", param = [0.000,1.000,0.000,0.000],param1 = [0.000,2263.150,0.000,0.000])
 88 abc = CSG("intersection", left=ab, right=c)
 89
 90 d = CSG("slab", param = [0.703,-0.712,0.000,0.000],param1 = [0.000,2263.150,0.000,0.000])
 91 abcd = CSG("intersection", left=abc, right=d)
 92
 93 e = CSG("cylinder", param = [0.000,0.000,0.000,106.600],param1 = [-250.000,250.000,0.000,0.000])
 94 e.transform = [[0.000,-0.127,0.992,0.000],[0.000,0.992,0.127,0.000],[-1.000,-0.000,0.000,0.000],[2242.238,287.939,250.000,1.000]]
 95 abcde = CSG("difference", left=abcd, right=e)
 96
 97 f = CSG("cylinder", param = [0.000,0.000,0.000,106.600],param1 = [-250.000,250.000,0.000,0.000])
 98 f.transform = [[0.000,-0.380,0.925,0.000],[0.000,0.925,0.380,0.000],[-1.000,-0.000,0.000,0.000],[2091.311,858.461,250.000,1.000]]
 99 abcdef = CSG("difference", left=abcde, right=f)
100
101 g = CSG("cylinder", param = [0.000,0.000,0.000,106.600],param1 = [-250.000,250.000,0.000,0.000])
102 g.transform = [[0.000,-0.606,0.795,0.000],[0.000,0.795,0.606,0.000],[-1.000,-0.000,0.000,0.000],[1797.865,1370.481,250.000,1.000]]
103 abcdefg = CSG("difference", left=abcdef, right=g)
104
105 h = CSG("cylinder", param = [0.000,0.000,0.000,106.600],param1 = [-250.000,250.000,0.000,0.000])
106 h.transform = [[0.000,-0.127,0.992,0.000],[0.000,0.992,0.127,0.000],[-1.000,-0.000,0.000,0.000],[2242.238,287.939,-250.000,1.000]]
107 abcdefgh = CSG("difference", left=abcdefg, right=h)
108
109 i = CSG("cylinder", param = [0.000,0.000,0.000,106.600],param1 = [-250.000,250.000,0.000,0.000])
110 i.transform = [[0.000,-0.380,0.925,0.000],[0.000,0.925,0.380,0.000],[-1.000,-0.000,0.000,0.000],[2091.311,858.461,-250.000,1.000]]
111 abcdefghi = CSG("difference", left=abcdefgh, right=i)
112
113 j = CSG("cylinder", param = [0.000,0.000,0.000,106.600],param1 = [-250.000,250.000,0.000,0.000])
114 j.transform = [[0.000,-0.606,0.795,0.000],[0.000,0.795,0.606,0.000],[-1.000,-0.000,0.000,0.000],[1797.865,1370.481,-250.000,1.000]]
115 abcdefghij = CSG("difference", left=abcdefghi, right=j)
116
117
118
119 obj = abcdefghij
120
121 con = CSG("sphere",  param=[0,0,0,10], container="1", containerscale="2", boundary=args.container , poly="IM", resolution="20" )
122 CSG.Serialize([con, obj], args.csgpath )</pre>
</div>
</div>
<div class="section" id="checking-tree-balancing-with-slab-cuts">
<h2>Checking tree balancing with slab cuts<a class="headerlink" href="#checking-tree-balancing-with-slab-cuts" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>moving slab cuts to top of tree works with balancing when only one cut but not two
(presumably slab-slab double unbounded issue)</li>
</ul>
<div class="highlight-python"><pre>opticks-tbool-vi 56


123 abcdefghij_c = CSG("intersection", left=abcdefghij, right=c )
124 abcdefghij_cd = CSG("intersection", left=abcdefghij_c, right=d )
125
126
127 #raw = abcdefghij
128 #raw = abcdefghij_c
129 raw = abcdefghij_cd
130
131 raw.dump("raw")
132
133 maxcsgheight = 4
134 maxcsgheight2 = 5
135 obj = Sc.optimize_csg(raw, maxcsgheight, maxcsgheight2 )
136
137 obj.dump("optimized")
138
139
140
141 objs = [obj]</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">OpticksDevNotes 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>