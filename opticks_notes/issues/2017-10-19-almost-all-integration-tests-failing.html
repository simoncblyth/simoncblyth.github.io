<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2017-10-19-almost-all-integration-tests-failing &mdash; OpticksDevNotes 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="OpticksDevNotes 0.0.1 documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">OpticksDevNotes 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2017-10-19-almost-all-integration-tests-failing</a><ul>
<li><a class="reference internal" href="#tests-t-all-9-enabled-tests-now-working">2017-10-23 tests-t All 9 enabled tests now working</a></li>
<li><a class="reference internal" href="#tests-t-fails">2017-10-19 tests-t fails</a></li>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#status">Status</a></li>
<li><a class="reference internal" href="#tlens-t">tlens-t</a></li>
<li><a class="reference internal" href="#test-geometry-review">test geometry review</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/issues/2017-10-19-almost-all-integration-tests-failing.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="almost-all-integration-tests-failing">
<h1>2017-10-19-almost-all-integration-tests-failing<a class="headerlink" href="#almost-all-integration-tests-failing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="tests-t-all-9-enabled-tests-now-working">
<h2>2017-10-23 tests-t All 9 enabled tests now working<a class="headerlink" href="#tests-t-all-9-enabled-tests-now-working" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>fixes were mostly updating outdated python analysis scripts</li>
</ul>
<div class="highlight-python"><pre>simon:tests blyth$ tests-t
==                     treflect-t ==  -&gt;    0
==                         tbox-t ==  -&gt;    0
==                       tprism-t ==  -&gt;    0
==                      tnewton-t ==  -&gt;    0
==                       twhite-t ==  -&gt;    0
==                         tpmt-t ==  -&gt;    0
==                     trainbow-t ==  -&gt;    0
==                        tlens-t ==  -&gt;    0
==                       tg4gun-t ==  -&gt;    0
simon:tests blyth$</pre>
</div>
<div class="highlight-python"><pre>simon:tests blyth$ tests-enabled-
treflect
tbox
tprism
tnewton
twhite
tpmt
trainbow
tlens
tg4gun</pre>
</div>
</div>
<div class="section" id="tests-t-fails">
<h2>2017-10-19 tests-t fails<a class="headerlink" href="#tests-t-fails" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>simon:tests blyth$ tests-
simon:tests blyth$ tests-t
==                     treflect-t ==  -&gt;    1
WARNING : FAILURE OF treflect.bash : RC 1
==                         tbox-t ==  -&gt;    1
WARNING : FAILURE OF tbox.bash : RC 1
==                       tprism-t ==  -&gt;    1
WARNING : FAILURE OF tprism.bash : RC 1
==                      tnewton-t ==  -&gt;    1
WARNING : FAILURE OF tnewton.bash : RC 1
==                       twhite-t ==  -&gt;  134
WARNING : FAILURE OF twhite.bash : RC 134
==                         tpmt-t ==  -&gt;  139
WARNING : FAILURE OF tpmt.bash : RC 139
==                     trainbow-t ==  -&gt;    1
WARNING : FAILURE OF trainbow.bash : RC 1
==                        tlens-t ==  -&gt;  134
WARNING : FAILURE OF tlens.bash : RC 134
==                       tg4gun-t ==  -&gt;    0
simon:tests blyth$</pre>
</div>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>All the tests are using the old geometry on the commandline approach.
Which has fallen into disuse following introduction of
the python serialized CSG geometry approach.</p>
<p>Have vague recollection that GGeoTestConfig was
changed substantially whilst working in tboolean-
prior to introduction of python geometry.</p>
<p>So revive some old style tboolean funcs before tackling
integration tests, which are a few generations behind.</p>
<ul class="simple">
<li><a class="reference internal" href="revive-old-style-tboolean.html"><em>revive old style tboolean funs</em></a></li>
</ul>
</div>
<div class="section" id="status">
<h2>Status<a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h2>
<p>Dump status with:</p>
<div class="highlight-python"><pre>tests-
tests-status</pre>
</div>
</div>
<div class="section" id="tlens-t">
<h2>tlens-t<a class="headerlink" href="#tlens-t" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>simon:tests blyth$ tlens-- --debugger

2017-10-19 17:16:49.832 INFO  [369395] [GGeoLib::loadConstituents@122] GGeoLib::loadConstituents mm.reldir GMergedMesh gp.reldir GParts MAX_MERGED_MESH  10
2017-10-19 17:16:49.832 INFO  [369395] [GGeoLib::loadConstituents@129] /usr/local/opticks/opticksdata/export/DayaBay_VGDX_20140414-1300/g4_00.96ff965744a2f6b78c24e33c80d3a4cd.dae
2017-10-19 17:16:49.960 INFO  [369395] [GGeoLib::loadConstituents@178] GGeoLib::loadConstituents loaded 6 ridx (  0,  1,  2,  3,  4,  5,)
2017-10-19 17:16:50.036 INFO  [369395] [GMeshLib::loadMeshes@214] idpath /usr/local/opticks/opticksdata/export/DayaBay_VGDX_20140414-1300/g4_00.96ff965744a2f6b78c24e33c80d3a4cd.dae
2017-10-19 17:16:50.069 INFO  [369395] [GGeo::loadFromCache@672] GGeo::loadFromCache DONE
2017-10-19 17:16:50.069 INFO  [369395] [GGeo::loadAnalyticPmt@788] GGeo::loadAnalyticPmt AnalyticPMTIndex 0 AnalyticPMTSlice ALL Path /usr/local/opticks/opticksdata/export/DayaBay/GPmt/0
2017-10-19 17:16:50.078 INFO  [369395] [GGeo::loadGeometry@594] GGeo::loadGeometry DONE
2017-10-19 17:16:50.078 INFO  [369395] [OpticksGeometry::loadGeometryBase@283] OpticksGeometry::loadGeometryBase DONE
2017-10-19 17:16:50.078 WARN  [369395] [GGeoTestConfig::getArg@171] GGeoTestConfig::getArg UNRECOGNIZED arg shape
2017-10-19 17:16:50.079 WARN  [369395] [GGeoTestConfig::set@194] GGeoTestConfig::set WARNING ignoring unrecognized parameter box
2017-10-19 17:16:50.079 WARN  [369395] [GGeoTestConfig::getArg@171] GGeoTestConfig::getArg UNRECOGNIZED arg shape
2017-10-19 17:16:50.079 WARN  [369395] [GGeoTestConfig::set@194] GGeoTestConfig::set WARNING ignoring unrecognized parameter lens
2017-10-19 17:16:50.079 WARN  [369395] [GGeoTest::init@57] GGeoTest::init booting from m_ggeo
2017-10-19 17:16:50.079 WARN  [369395] [GMaker::init@178] GMaker::init booting from cache
2017-10-19 17:16:50.081 INFO  [369395] [GMaterialLib::postLoadFromCache@67] GMaterialLib::postLoadFromCache  nore 0 noab 0 nosc 0 xxre 0 xxab 0 xxsc 0 fxre 0 fxab 0 fxsc 0 groupvel 1
2017-10-19 17:16:50.081 INFO  [369395] [GMaterialLib::replaceGROUPVEL@552] GMaterialLib::replaceGROUPVEL  ni 38
2017-10-19 17:16:50.082 INFO  [369395] [GPropertyLib::getIndex@338] GPropertyLib::getIndex type GMaterialLib TRIGGERED A CLOSE  shortname [GdDopedLS]
2017-10-19 17:16:50.082 INFO  [369395] [GPropertyLib::close@384] GPropertyLib::close type GMaterialLib buf 38,2,39,4
2017-10-19 17:16:50.085 INFO  [369395] [GGeoLib::loadConstituents@122] GGeoLib::loadConstituents mm.reldir GMergedMesh gp.reldir GParts MAX_MERGED_MESH  10
2017-10-19 17:16:50.085 INFO  [369395] [GGeoLib::loadConstituents@129] /usr/local/opticks/opticksdata/export/DayaBay_VGDX_20140414-1300/g4_00.96ff965744a2f6b78c24e33c80d3a4cd.dae
2017-10-19 17:16:50.216 INFO  [369395] [GGeoLib::loadConstituents@178] GGeoLib::loadConstituents loaded 6 ridx (  0,  1,  2,  3,  4,  5,)
2017-10-19 17:16:50.216 FATAL [369395] [GGeoTestConfig::getNumElements@210] GGeoTestConfig::getNumElements ELEMENT MISMATCH IN TEST GEOMETRY CONFIGURATION  nbnd (boundaries) 2 nnod (nodes) 0 npar (parameters) 2 ntra (transforms) 0
Assertion failed: (equal &amp;&amp; "need equal number of boundaries, parameters, transforms and nodes"), function getNumElements, file /Users/blyth/opticks/ggeo/GGeoTestConfig.cc, line 218.
Process 92690 stopped
* thread #1: tid = 0x5a2f3, 0x00007fff8b576866 libsystem_kernel.dylib`__pthread_kill + 10, queue = 'com.apple.main-thread', stop reason = signal SIGABRT
    frame #0: 0x00007fff8b576866 libsystem_kernel.dylib`__pthread_kill + 10
libsystem_kernel.dylib`__pthread_kill + 10:
-&gt; 0x7fff8b576866:  jae    0x7fff8b576870            ; __pthread_kill + 20
   0x7fff8b576868:  movq   %rax, %rdi
   0x7fff8b57686b:  jmp    0x7fff8b573175            ; cerror_nocancel
   0x7fff8b576870:  retq
(lldb)
(lldb) bt
* thread #1: tid = 0x5a2f3, 0x00007fff8b576866 libsystem_kernel.dylib`__pthread_kill + 10, queue = 'com.apple.main-thread', stop reason = signal SIGABRT
  * frame #0: 0x00007fff8b576866 libsystem_kernel.dylib`__pthread_kill + 10
    frame #1: 0x00007fff82c1335c libsystem_pthread.dylib`pthread_kill + 92
    frame #2: 0x00007fff89963b1a libsystem_c.dylib`abort + 125
    frame #3: 0x00007fff8992d9bf libsystem_c.dylib`__assert_rtn + 321
    frame #4: 0x000000010211b6d2 libGGeo.dylib`GGeoTestConfig::getNumElements(this=0x000000010841aeb0) + 722 at GGeoTestConfig.cc:218
    frame #5: 0x0000000102114ee0 libGGeo.dylib`GGeoTest::create(this=0x000000010841c0c0) + 496 at GGeoTest.cc:128
    frame #6: 0x0000000102114c0d libGGeo.dylib`GGeoTest::modifyGeometry(this=0x000000010841c0c0) + 157 at GGeoTest.cc:85
    frame #7: 0x000000010214073c libGGeo.dylib`GGeo::modifyGeometry(this=0x0000000105c38b40, config=0x000000010841ae00) + 668 at GGeo.cc:818
    frame #8: 0x00000001022a4844 libOpticksGeometry.dylib`OpticksGeometry::modifyGeometry(this=0x0000000105c36ae0) + 868 at OpticksGeometry.cc:294
    frame #9: 0x00000001022a3aec libOpticksGeometry.dylib`OpticksGeometry::loadGeometry(this=0x0000000105c36ae0) + 572 at OpticksGeometry.cc:224
    frame #10: 0x00000001022a81b9 libOpticksGeometry.dylib`OpticksHub::loadGeometry(this=0x0000000105c2fe20) + 409 at OpticksHub.cc:282
    frame #11: 0x00000001022a720d libOpticksGeometry.dylib`OpticksHub::init(this=0x0000000105c2fe20) + 77 at OpticksHub.cc:102
    frame #12: 0x00000001022a7110 libOpticksGeometry.dylib`OpticksHub::OpticksHub(this=0x0000000105c2fe20, ok=0x0000000105c21cf0) + 432 at OpticksHub.cc:88
    frame #13: 0x00000001022a72fd libOpticksGeometry.dylib`OpticksHub::OpticksHub(this=0x0000000105c2fe20, ok=0x0000000105c21cf0) + 29 at OpticksHub.cc:90
    frame #14: 0x0000000103c471e6 libOK.dylib`OKMgr::OKMgr(this=0x00007fff5fbfe558, argc=23, argv=0x00007fff5fbfe638, argforced=0x0000000000000000) + 262 at OKMgr.cc:46
    frame #15: 0x0000000103c4764b libOK.dylib`OKMgr::OKMgr(this=0x00007fff5fbfe558, argc=23, argv=0x00007fff5fbfe638, argforced=0x0000000000000000) + 43 at OKMgr.cc:49
    frame #16: 0x000000010000adad OKTest`main(argc=23, argv=0x00007fff5fbfe638) + 1373 at OKTest.cc:58
    frame #17: 0x00007fff869e95fd libdyld.dylib`start + 1
    frame #18: 0x00007fff869e95fd libdyld.dylib`start + 1
(lldb)</pre>
</div>
</div>
<div class="section" id="test-geometry-review">
<h2>test geometry review<a class="headerlink" href="#test-geometry-review" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>805 void GGeo::modifyGeometry(const char* config)
806 {
807     // NB only invoked with test option : "op --test"
808     //   controlled from OpticksGeometry::loadGeometry
809
810     GGeoTestConfig* gtc = new GGeoTestConfig(config);
811
812     LOG(trace) &lt;&lt; "GGeo::modifyGeometry"
813               &lt;&lt; " config [" &lt;&lt; ( config ? config : "" ) &lt;&lt; "]" ;
814
815     assert(m_geotest == NULL);
816
817     m_geotest = new GGeoTest(m_ok, gtc, this);
818     m_geotest-&gt;modifyGeometry();
819
820 }

078 void GGeoTest::modifyGeometry()
 79 {
 80     const char* csgpath = m_config-&gt;getCsgPath();
 81     bool analytic = m_config-&gt;getAnalytic();
 82
 83     if(csgpath) assert(analytic == true);
 84
 85     GMergedMesh* tmm_ = create();
 86
 87     GMergedMesh* tmm = m_lod &gt; 0 ? GMergedMesh::MakeLODComposite(tmm_, m_lodconfig-&gt;levels ) : tmm_ ;
 88
 89
 90     char geocode =  analytic ? OpticksConst::GEOCODE_ANALYTIC : OpticksConst::GEOCODE_TRIANGULATED ;  // message to OGeo
 91     tmm-&gt;setGeoCode( geocode );
 92
 93     if(tmm-&gt;isTriangulated())
 94     {
 95         tmm-&gt;setITransformsBuffer(NULL); // avoiding FaceRepeated complications
 96     }
 97
 98     //tmm-&gt;dump("GGeoTest::modifyGeometry tmm ");
 99     m_geolib-&gt;clear();
100     m_geolib-&gt;setMergedMesh( 0, tmm );
101 }


104 GMergedMesh* GGeoTest::create()
105 {
106     //TODO: unify all these modes into CSG
107     //      whilst still supporting the old partlist approach
108
109     const char* csgpath = m_config-&gt;getCsgPath();
110     const char* mode = m_config-&gt;getMode();
111
112     GMergedMesh* tmm = NULL ;
113
114     if( mode != NULL &amp;&amp; strcmp(mode, "PmtInBox") == 0)
115     {
116         tmm = createPmtInBox();
117     }
118     else
119     {
120         std::vector&lt;GSolid*&gt; solids ;
121         if(csgpath != NULL)
122         {
123             assert( strlen(csgpath) &gt; 3 &amp;&amp; "unreasonable csgpath strlen");
124             loadCSG(csgpath, solids);
125         }
126         else
127         {
128             unsigned int nelem = m_config-&gt;getNumElements();
129             assert(nelem &gt; 0);
130             if(     strcmp(mode, "BoxInBox") == 0) createBoxInBox(solids);
131             else  LOG(warning) &lt;&lt; "GGeoTest::create mode not recognized " &lt;&lt; mode ;
132         }
133         tmm = combineSolids(solids);
134     }
135     assert(tmm);
136     return tmm ;
137 }</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">OpticksDevNotes 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>