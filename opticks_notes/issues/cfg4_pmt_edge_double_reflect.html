<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>CFG4 PMT Edge Double Reflect &mdash; OpticksDevNotes 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="OpticksDevNotes 0.0.1 documentation" href="../index.html" />
    <link rel="up" title="issues" href="index.html" />
    <link rel="next" title="PMT Test" href="pmttest.html" />
    <link rel="prev" title="[RESOLVED] Containing Material placeholder leading to DUD in buffer" href="containing_material/index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="pmttest.html" title="PMT Test"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="containing_material/index.html" title="[RESOLVED] Containing Material placeholder leading to DUD in buffer"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">OpticksDevNotes 0.0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">issues</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">CFG4 PMT Edge Double Reflect</a><ul>
<li><a class="reference internal" href="#fixed-a-tir-bug">FIXED : a TIR bug</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="containing_material/index.html"
                        title="previous chapter">[RESOLVED] Containing Material placeholder leading to DUD in buffer</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pmttest.html"
                        title="next chapter">PMT Test</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/issues/cfg4_pmt_edge_double_reflect.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="cfg4-pmt-edge-double-reflect">
<h1>CFG4 PMT Edge Double Reflect<a class="headerlink" href="#cfg4-pmt-edge-double-reflect" title="Permalink to this headline">¶</a></h1>
<p>Loading cfg4 tag 2 (0.97,1) ie edge photons with optixviz enabled then
adjusting near/far and scanparam.z to just look at thin slice.  NB the OptiX
analytic geometry visualized is not the actual (G4) geometry being used :
however the boundary positions look correct.</p>
<div class="highlight-python"><pre>ggv-;ggv-pmt-test --cfg4 --load --optixviz</pre>
</div>
<a class="reference internal image-reference" href="/env/graphics/ggeoview/issues/cfg4-pyrex-br-br.png"><img alt="/env/graphics/ggeoview/issues/cfg4-pyrex-br-br.png" class="align-center" src="/env/graphics/ggeoview/issues/cfg4-pyrex-br-br.png" style="width: 900px;" /></a>
<div class="highlight-python"><pre>96.995 100.005
96.995 100.005
                      2:PmtInBox   -2:PmtInBox           c2
                8ccd       391394       391429             0.00  [4 ] TO BT BT SA
                4ccd        29418        29306             0.21  [4 ] TO BT BT AB
                  4d        22602        22571             0.02  [2 ] TO AB
                 8bd        18671        19186             7.01  [3 ] TO BR SA
                 8cd        10338        10116             2.41  [3 ] TO BT SA
                 4cd         7554         7510             0.13  [3 ] TO BT AB
               86ccd         4602         4626             0.06  [5 ] TO BT BT SC SA
                 86d         3762         3729             0.15  [3 ] TO SC SA
                 7cd         3233         3181             0.42  [3 ] TO BT SD
                 4bd         1811         1662             6.39  [3 ] TO BR AB

              8cbbcd            0         3598          3598.00  [6 ] TO BT BR BR BT SA
           8cccccbcd         1885            0          1885.00  [9 ] TO BT BR BT BT BT BT BT SA
            8ccccbcd          762            0           762.00  [8 ] TO BT BR BT BT BT BT SA
          8ccccccbcd          746            0           746.00  [10] TO BT BR BT BT BT BT BT BT SA


                8c6d          509          440             5.02  [4 ] TO SC BT SA
            8ccc6ccd          386            2           380.04  [8 ] TO BT BT SC BT BT BT SA
               46ccd          275          310             2.09  [5 ] TO BT BT SC AB
            8cbc6ccd           26          307           237.12  [8 ] TO BT BT SC BT BR BT SA
              8c6ccd           20          296           241.06  [6 ] TO BT BT SC BT SA</pre>
</div>
<a class="reference internal image-reference" href="/env/graphics/ggeoview/issues/pmt_edge_geometry.png"><img alt="/env/graphics/ggeoview/issues/pmt_edge_geometry.png" class="align-center" src="/env/graphics/ggeoview/issues/pmt_edge_geometry.png" style="width: 900px;" /></a>
<p>Push out the edge to accentuate the problem, the radial range from 99:100 mm should always do
this edge clipping.</p>
<p>How are all these things still happening right out at edge ?</p>
<div class="highlight-python"><pre>98.994 100.005
98.995 100.005
WARNING:env.numerics.npy.seq:code bad abbr ?0?
WARNING:env.numerics.npy.seq:code sees 1 bad abbr in TO BR SC BT BT BT BT ?0? BT BT
                      5:PmtInBox   -5:PmtInBox           c2
                8ccd       385483       385663             0.04  [4 ] TO BT BT SA
                 8bd        38310        38104             0.56  [3 ] TO BR SA
                4ccd        29398        29220             0.54  [4 ] TO BT BT AB
                  4d        22949        23089             0.43  [2 ] TO AB
               86ccd         4633         4570             0.43  [5 ] TO BT BT SC SA
                 4cd         4541         4435             1.25  [3 ] TO BT AB
              8cbbcd            0         4268          4268.00  [6 ] TO BT BR BR BT SA
                 86d         3802         3702             1.33  [3 ] TO SC SA
                 4bd         3102         3248             3.36  [3 ] TO BR AB
           8cccccbcd         2332            0          2332.00  [9 ] TO BT BR BT BT BT BT BT SA
            8ccccbcd          898            0           898.00  [8 ] TO BT BR BT BT BT BT SA
          8ccccccbcd          887            0           887.00  [10] TO BT BR BT BT BT BT BT BT SA
                86bd          557          542             0.20  [4 ] TO BR SC SA</pre>
</div>
<p>Switch to pencil beam in hope for simplification.</p>
<div class="highlight-python"><pre>if [ "$tag" == "5" ]; then
    typ=point
    src=99,0,300
    tgt=99,0,0
fi


98.999 98.999
98.999 98.999
                      5:PmtInBox   -5:PmtInBox           c2
                8ccd       406449       404024             7.26  [4 ] TO BT BT SA
                4ccd        30692        30456             0.91  [4 ] TO BT BT AB
                  4d        22743        23062             2.22  [2 ] TO AB
                 8bd        17024        18367            50.96  [3 ] TO BR SA
                 4cd         6302         6266             0.10  [3 ] TO BT AB
               86ccd         4984         4866             1.41  [5 ] TO BT BT SC SA
              8cbbcd            0         4280          4280.00  [6 ] TO BT BR BR BT SA
                 86d         3758         3725             0.15  [3 ] TO SC SA
          8ccccccbcd         3666            0          3666.00  [10] TO BT BR BT BT BT BT BT BT SA
                 4bd         1469         1672            13.12  [3 ] TO BR AB
                8c6d          498          505             0.05  [4 ] TO SC BT SA
            8ccc6ccd          334            2           328.05  [8 ] TO BT BT SC BT BT BT SA
               46ccd          321          327             0.06  [5 ] TO BT BT SC AB
            8cbc6ccd           16          301           256.23  [8 ] TO BT BT SC BT BR BT SA
              8c6ccd           20          295           240.08  [6 ] TO BT BT SC BT SA
              4cbbcd            0          287           287.00  [6 ] TO BT BR BR BT AB
                86bd          274          257             0.54  [4 ] TO BR SC SA
                 46d          253          209             4.19  [3 ] TO SC AB
          cccccc6ccd          126          220            25.54  [10] TO BT BT SC BT BT BT BT BT BT</pre>
</div>
<p>Use circular beam of radous 0.5mm centered in the point (tag 6) for better visibility
Visualize the optix equivalent process &#8220;TO BT BR BT BT BT BT BT BT SA&#8221; with a single
reflect.</p>
<a class="reference internal image-reference" href="/env/graphics/ggeoview/issues/op_pmt_edge_reflect_transmit_closeup.png"><img alt="/env/graphics/ggeoview/issues/op_pmt_edge_reflect_transmit_closeup.png" class="align-center" src="/env/graphics/ggeoview/issues/op_pmt_edge_reflect_transmit_closeup.png" style="width: 900px;" /></a>
<div class="highlight-python"><pre>TO
BT enter Pyrex
BR 1st reflect on inner side of lower Pyrex hemi
BT ... angles look like a reflect but labelled BT
BT ??? subsequent transmit out into MO looks like it happens at wrong position</pre>
</div>
<p>Make this explicit with pmt_skimmer.py</p>
<p>With CPropLib::m_groupvel_kludge=true 1st 4 recs agree, apart from 4th flag BT/BR:</p>
<div class="highlight-python"><pre>INFO:env.numerics.npy.evt:Evt seqs ['TO BT BR BR BT SA']
A(Op)
  0 z    300.000    300.000    300.000 r     98.999     98.999     98.999  t      0.098      0.098      0.098    smry m1/m2   4/ 14 MO/Py  -28 ( 27)  13:TO
  1 z     67.559     67.559     67.559 r     98.999     98.999     98.999  t      1.251      1.251      1.251    smry m1/m2  14/  4 Py/MO   28 ( 27)  12:BT
  2 z     50.832     50.832     50.832 r    100.372    100.372    100.372  t      1.331      1.331      1.331    smry m1/m2  14/ 11 Py/OV -125 (124)  11:BR
  3 z     35.551     35.551     35.551 r     93.176     93.176     93.176  t      1.416      1.416      1.416    smry m1/m2  14/  4 Py/MO   28 ( 27)  12:BT

  4 z      2.005      2.005      2.005 r     81.137     81.137     81.137  t      1.532      1.532      1.532    smry m1/m2   4/ 14 MO/Py  -28 ( 27)  12:BT
  5 z   -114.115   -114.115   -114.115 r     42.253     42.253     42.253  t      1.953      1.953      1.953    smry m1/m2  14/ 13 Py/Vm  -29 ( 28)  12:BT
  6 z   -123.875   -123.875   -123.875 r     39.250     39.250     39.250  t      1.990      1.990      1.990    smry m1/m2  14/ 13 Py/Vm  -29 ( 28)  12:BT
  7 z   -150.810   -150.810   -150.810 r     39.250     39.250     39.250  t      2.051      2.051      2.051    smry m1/m2   4/ 14 MO/Py  -28 ( 27)  12:BT
  8 z   -169.002   -169.002   -169.002 r     39.250     39.250     39.250  t      2.081      2.081      2.081    smry m1/m2   4/ 12 MO/Rk  124 (123)  12:BT
  9 z   -300.000   -300.000   -300.000 r     39.250     39.250     39.250  t      2.301      2.301      2.301    smry m1/m2   4/ 12 MO/Rk  124 (123)   8:SA
B(G4)
  0 z    300.000    300.000    300.000 r     98.999     98.999     98.999  t      0.098      0.098      0.098    smry m1/m2   4/  0 MO/?0?    0 ( -1)  13:TO
  1 z     67.559     67.559     67.559 r     98.999     98.999     98.999  t      1.251      1.251      1.251    smry m1/m2  14/  0 Py/?0?    0 ( -1)  12:BT
  2 z     50.832     50.832     50.832 r    100.372    100.372    100.372  t      1.331      1.331      1.331    smry m1/m2  14/  0 Py/?0?    0 ( -1)  11:BR
  3 z     35.551     35.551     35.551 r     93.176     93.176     93.176  t      1.416      1.416      1.416    smry m1/m2  14/  0 Py/?0?    0 ( -1)  11:BR

  4 z     19.181     19.181     19.181 r     89.001     89.001     89.001  t      1.495      1.495      1.495    smry m1/m2   4/  0 MO/?0?    0 ( -1)  12:BT
  5 z   -300.000   -300.000   -300.000 r     26.569     26.569     26.569  t      3.107      3.107      3.107    smry m1/m2   4/  0 MO/?0?    0 ( -1)   8:SA</pre>
</div>
<p>Note that OpaqueVacuum arrives dynamically (from high boundary index), it differs from Vacuum on by 0.1*absorption length:</p>
<div class="highlight-python"><pre>simon:npy blyth$ ggv --mat 10
[2016-Mar-04 17:36:56.130002]:info: GPropertyMap&lt;T&gt;:: 10       material m:OpaqueVacuum k:refractive_index absorption_length scattering_length reemission_prob OpaqueVacuum
              domain    refractive_index   absorption_length   scattering_length     reemission_prob
                  60                   1               1e+06               1e+06                   0
simon:npy blyth$ ggv --mat 12
[2016-Mar-04 17:38:23.829733]:info: GPropertyMap&lt;T&gt;:: 12       material m:Vacuum k:refractive_index absorption_length scattering_length reemission_prob Vacuum
              domain    refractive_index   absorption_length   scattering_length     reemission_prob
                  60                   1               1e+07               1e+06                   0</pre>
</div>
<div class="section" id="fixed-a-tir-bug">
<h2>FIXED : a TIR bug<a class="headerlink" href="#fixed-a-tir-bug" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>reported in npy-/pmt_skimmer.py</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="pmttest.html" title="PMT Test"
             >next</a> |</li>
        <li class="right" >
          <a href="containing_material/index.html" title="[RESOLVED] Containing Material placeholder leading to DUD in buffer"
             >previous</a> |</li>
        <li><a href="../index.html">OpticksDevNotes 0.0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >issues</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>