<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>resource_review &mdash; OpticksDevNotes 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="OpticksDevNotes 0.0.1 documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">OpticksDevNotes 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">resource_review</a><ul>
<li><a class="reference internal" href="#issue">ISSUE</a></li>
<li><a class="reference internal" href="#approach">APPROACH</a></li>
<li><a class="reference internal" href="#todo-avoid-ointerpolationtest-casualty">TODO : avoid OInterpolationTest casualty</a></li>
<li><a class="reference internal" href="#todo-eliminate-envvar-opticks-resource-layout">TODO : eliminate envvar OPTICKS_RESOURCE_LAYOUT</a></li>
<li><a class="reference internal" href="#done-eliminate-opticks-srcpath">DONE : eliminate OPTICKS_SRCPATH</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/issues/resource_review.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="resource-review">
<h1>resource_review<a class="headerlink" href="#resource-review" title="Permalink to this headline">¶</a></h1>
<div class="section" id="issue">
<h2>ISSUE<a class="headerlink" href="#issue" title="Permalink to this headline">¶</a></h2>
<p>Resource rejig migrating from layout 0 to layout 1
splits geometry sources from the derived geocache.</p>
<p>Initially used kludge envvars as expedient ways to
make the migration.</p>
<p>But juggling envvars is a kludge, and support nightmare,
so trying to reduce.</p>
</div>
<div class="section" id="approach">
<h2>APPROACH<a class="headerlink" href="#approach" title="Permalink to this headline">¶</a></h2>
<p>Used the known layouts to convert IDPATH into SRCPATH in</p>
<ul class="simple">
<li>brap/BPath.cc brap/BOpticksResource.cc  see BPathTest</li>
<li>base/bpath.py</li>
<li>opticks.bash:opticks-idpath2srcpath</li>
</ul>
</div>
<div class="section" id="todo-avoid-ointerpolationtest-casualty">
<h2>TODO : avoid OInterpolationTest casualty<a class="headerlink" href="#todo-avoid-ointerpolationtest-casualty" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>2017-12-05 12:21:49.718 ERROR [257952] [*GBndLib::createBufferForTex2d@677] GBndLib::createBufferForTex2d mat 0x7fc5e355b8e0 sur 0x7fc5e355e280
2017-12-05 12:21:49.720 INFO  [257952] [SLog::operator@15] OScene::OScene DONE
2017-12-05 12:21:49.720 INFO  [257952] [main@131]  ok
2017-12-05 12:21:49.720 INFO  [257952] [GBndLib::saveAllOverride@896] GBndLib::saveAllOverride
2017-12-05 12:21:49.720 ERROR [257952] [GPropertyLib::saveToCache@434] GPropertyLib::saveToCache dir /usr/local/opticks/geocache/DayaBay_VGDX_20140414-1300/g4_00.dae/96ff965744a2f6b78c24e33c80d3a4cd/1/GBndLib name GBndLibIndex.npy type GBndLib
2017-12-05 12:21:49.720 ERROR [257952] [*GBndLib::createBufferForTex2d@677] GBndLib::createBufferForTex2d mat 0x7fc5e355b8e0 sur 0x7fc5e355e280
2017-12-05 12:21:49.722 INFO  [257952] [GPropertyLib::close@409] GPropertyLib::close type GBndLib buf 123,4,2,39,4
2017-12-05 12:21:49.724 ERROR [257952] [GPropertyLib::saveToCache@434] GPropertyLib::saveToCache dir /usr/local/opticks/geocache/DayaBay_VGDX_20140414-1300/g4_00.dae/96ff965744a2f6b78c24e33c80d3a4cd/1/GBndLib name GBndLibOptical.npy type GBndLib
2017-12-05 12:21:49.724 INFO  [257952] [OInterpolationTest::launch@87] OInterpolationTest::launch nb   123 nx   761 ny   984 progname             OInterpolationTest name OInterpolationTest_interpol.npy base $TMP/InterpolationTest
2017-12-05 12:21:49.724 INFO  [257952] [OLaunchTest::init@50] OLaunchTest entry   0 width       1 height       1 ptx                          OInterpolationTest.cu.ptx prog                                 OInterpolationTest
2017-12-05 12:21:49.724 INFO  [257952] [OLaunchTest::launch@61] OLaunchTest entry   0 width     761 height     123 ptx                          OInterpolationTest.cu.ptx prog                                 OInterpolationTest
2017-12-05 12:21:49.724 INFO  [257952] [OContext::close@236] OContext::close numEntryPoint 1
2017-12-05 12:21:49.724 INFO  [257952] [OContext::close@240] OContext::close setEntryPointCount done.
2017-12-05 12:21:49.737 INFO  [257952] [OContext::close@246] OContext::close m_cfg-&gt;apply() done.
2017-12-05 12:21:53.126 INFO  [257952] [OContext::launch@323] OContext::launch LAUNCH time: 3.38909
args: /Users/blyth/opticks/optixrap/tests/OInterpolationTest_interpol.py
Traceback (most recent call last):
  File "/Users/blyth/opticks/optixrap/tests/OInterpolationTest_interpol.py", line 17, in &lt;module&gt;
    blib = PropLib.load_GBndLib(base)
  File "/Users/blyth/opticks/ana/proplib.py", line 96, in load_GBndLib
    t = np.load(os.path.expandvars(os.path.join(base,"GBndLib/GBndLib.npy")))
  File "/opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/numpy/lib/npyio.py", line 369, in load
    fid = open(file, "rb")
IOError: [Errno 2] No such file or directory: '/tmp/blyth/opticks/InterpolationTest/GBndLib/GBndLib.npy'
2017-12-05 12:21:53.281 INFO  [257952] [SSys::run@46] python /Users/blyth/opticks/optixrap/tests/OInterpolationTest_interpol.py rc_raw : 256 rc : 1
2017-12-05 12:21:53.281 WARN  [257952] [SSys::run@53] SSys::run FAILED with  cmd python /Users/blyth/opticks/optixrap/tests/OInterpolationTest_interpol.py
simon:opticks blyth$</pre>
</div>
</div>
<div class="section" id="todo-eliminate-envvar-opticks-resource-layout">
<h2>TODO : eliminate envvar OPTICKS_RESOURCE_LAYOUT<a class="headerlink" href="#todo-eliminate-envvar-opticks-resource-layout" title="Permalink to this headline">¶</a></h2>
<p>Initially:</p>
<div class="highlight-python"><pre>simon:~ blyth$ opticks-find OPTICKS_RESOURCE_LAYOUT
./boostrap/BOpticksResource.cc:    m_layout(SSys::getenvint("OPTICKS_RESOURCE_LAYOUT", 0)),
./boostrap/BOpticksResource.cc:    addName("OPTICKS_RESOURCE_LAYOUT", layout );
./ana/base.py:        #self.layout = int(os.environ.get("OPTICKS_RESOURCE_LAYOUT", 0))
simon:opticks blyth$</pre>
</div>
<p>Src side is same in layout 0,1 so cannot extract from SRCPATH.
Hmm have to just fix it to 1.</p>
<p>This means can only get rid of the envvar once ready to fix to layout 1.</p>
<ul class="simple">
<li>python always needs the IDPATH, so it can detect the layout</li>
</ul>
</div>
<div class="section" id="done-eliminate-opticks-srcpath">
<h2>DONE : eliminate OPTICKS_SRCPATH<a class="headerlink" href="#done-eliminate-opticks-srcpath" title="Permalink to this headline">¶</a></h2>
<p>Finally:</p>
<div class="highlight-python"><pre>simon:boostrap blyth$ opticks-find OPTICKS_SRCPATH
./boostrap/tests/BOpticksResourceTest.cc:    const char* srcpath   = SSys::getenvvar("DEBUG_OPTICKS_SRCPATH");
./opticksnpy/tests/NSceneTest.cc:    const char* srcpath = SSys::getenvvar("DEBUG_OPTICKS_SRCPATH");
simon:opticks blyth$</pre>
</div>
<p>Initially:</p>
<div class="highlight-python"><pre>simon:boostrap blyth$ opticks-find SRCPATH
./opticks.bash:opticks-srcfold(){ echo $(dirname $OPTICKS_SRCPATH) ; }
./opticks.bash:  OPTICKS_SRCPATH          : $OPTICKS_SRCPATH
./boostrap/BOpticksResource.cc:    const char* srcpath = SSys::getenvvar("OPTICKS_SRCPATH");
./boostrap/tests/BOpticksResourceTest.cc:    const char* srcpath   = SSys::getenvvar("OPTICKS_SRCPATH");
./boostrap/tests/BOpticksResourceTest.cc:                  &lt;&lt; " OPTICKS_SRCPATH " &lt;&lt; srcpath
./opticksnpy/tests/HitsNPYTest.cc:        printf("%s : requires OPTICKS_SRCPATH  envvar \n", argv[0]);
./opticksnpy/tests/NSceneTest.cc:    const char* srcpath = SSys::getenvvar("OPTICKS_SRCPATH");
./opticksnpy/tests/NSensorListTest.cc:        printf("%s : requires OPTICKS_SRCPATH  envvar \n", argv[0]);
./boostrap/BOpticksResource.hh:       static const char* IdMapSrcPath(); // requires OPTICKS_SRCPATH  envvar
./ana/base.py:OPTICKS_SRCPATH = os.path.expandvars("$OPTICKS_SRCPATH")
./ana/base.py:            if OPTICKS_SRCPATH == "$OPTICKS_SRCPATH":
./ana/base.py:                print "ana/base.py:OpticksEnv missing OPTICKS_SRCPATH envvar [%s] (full path to .dae geometry file) " % OPTICKS_SRCPATH
./ana/base.py:            if not os.path.isfile(OPTICKS_SRCPATH):
./ana/base.py:                print "ana/base.py:OpticksEnv warning OPTICKS_SRCPATH file does not exist [%s] " % OPTICKS_SRCPATH
./ana/base.py:            self.srcpath = OPTICKS_SRCPATH
simon:opticks blyth$
simon:opticks blyth$

simon:ana blyth$ opticks-find SRCPATH
./opticks.bash:opticks-srcfold(){ echo $(dirname $OPTICKS_SRCPATH) ; }
./opticks.bash:  OPTICKS_SRCPATH          : $OPTICKS_SRCPATH

./boostrap/BOpticksResource.cc:    const char* srcpath = SSys::getenvvar("OPTICKS_SRCPATH");
./boostrap/tests/BOpticksResourceTest.cc:    const char* srcpath   = SSys::getenvvar("DEBUG_OPTICKS_SRCPATH");

./opticksnpy/tests/HitsNPYTest.cc:        printf("%s : requires OPTICKS_SRCPATH  envvar \n", argv[0]);
./opticksnpy/tests/NSceneTest.cc:    const char* srcpath = SSys::getenvvar("DEBUG_OPTICKS_SRCPATH");
./opticksnpy/tests/NSensorListTest.cc:        printf("%s : requires OPTICKS_SRCPATH  envvar \n", argv[0]);
./boostrap/BOpticksResource.hh:       static const char* IdMapSrcPath(); // requires OPTICKS_SRCPATH  envvar</pre>
</div>
<p>Got did of this, with BPath:</p>
<div class="highlight-python"><pre>267 const char* BOpticksResource::IdMapSrcPath()
268 {
269     const char* srcpath = SSys::getenvvar("OPTICKS_SRCPATH");
270     return srcpath ? MakeSrcPath( srcpath, ".idmap" ) : NULL ;
271
272 }

simon:opticksnpy blyth$ opticks-find IdMapSrcPath
./boostrap/BOpticksResource.cc:const char* BOpticksResource::IdMapSrcPath()
./opticksnpy/tests/HitsNPYTest.cc:    const char* idmpath = BOpticksResource::IdMapSrcPath();
./opticksnpy/tests/NSensorListTest.cc:    const char* idmpath = BOpticksResource::IdMapSrcPath();
./boostrap/BOpticksResource.hh:       static const char* IdMapSrcPath(); // requires OPTICKS_SRCPATH  envvar
simon:opticks blyth$</pre>
</div>
<p>Now for bash:</p>
<div class="highlight-python"><pre>simon:opticks blyth$ opticks-find OPTICKS_SRCPATH
./opticks.bash:opticks-srcfold(){ echo $(dirname $OPTICKS_SRCPATH) ; }
./opticks.bash:  OPTICKS_SRCPATH          : $OPTICKS_SRCPATH
./boostrap/tests/BOpticksResourceTest.cc:    const char* srcpath   = SSys::getenvvar("DEBUG_OPTICKS_SRCPATH");
./opticksnpy/tests/NSceneTest.cc:    const char* srcpath = SSys::getenvvar("DEBUG_OPTICKS_SRCPATH");
simon:opticks blyth$</pre>
</div>
<p>See bash functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">opticks</span><span class="o">-</span><span class="n">paths</span>
<span class="n">opticks</span><span class="o">-</span><span class="n">idpath2srcpath</span>
<span class="n">opticks</span><span class="o">-</span><span class="n">idpath2srcpath</span><span class="o">-</span><span class="n">test</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">OpticksDevNotes 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>