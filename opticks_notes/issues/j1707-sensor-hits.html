<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>j1707 sensor hits &mdash; OpticksDevNotes 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="OpticksDevNotes 0.0.1 documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">OpticksDevNotes 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">j1707 sensor hits</a><ul>
<li><a class="reference internal" href="#ggeo">ggeo-</a></li>
<li><a class="reference internal" href="#assimp">assimp</a></li>
<li><a class="reference internal" href="#assimprap">assimprap-</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/issues/j1707-sensor-hits.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="j1707-sensor-hits">
<h1>j1707 sensor hits<a class="headerlink" href="#j1707-sensor-hits" title="Permalink to this headline">¶</a></h1>
<div class="section" id="ggeo">
<h2>ggeo-<a class="headerlink" href="#ggeo" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>315 GMaterial* GGeo::getCathode()
316 {
317     return m_cathode ;
318 }
319 void GGeo::setCathode(GMaterial* cathode)
320 {
321     m_cathode = cathode ;
322 }
323
324 void GGeo::addCathodeLV(const char* lv)
325 {
326    m_cathode_lv.insert(lv);
327 }
328
329 unsigned int GGeo::getNumCathodeLV()
330 {
331    return m_cathode_lv.size() ;
332 }
333 const char* GGeo::getCathodeLV(unsigned int index)
334 {
335     typedef std::unordered_set&lt;std::string&gt;::const_iterator UCI ;
336     UCI it = m_cathode_lv.begin() ;
337     std::advance( it, index );
338     return it != m_cathode_lv.end() ? it-&gt;c_str() : NULL  ;
339 }
340
341 void GGeo::dumpCathodeLV(const char* msg)
342 {
343     printf("%s\n", msg);
344     typedef std::unordered_set&lt;std::string&gt;::const_iterator UCI ;
345     for(UCI it=m_cathode_lv.begin() ; it != m_cathode_lv.end() ; it++)
346     {
347         printf("GGeo::dumpCathodeLV %s \n", it-&gt;c_str() );
348     }
349 }</pre>
</div>
<div class="highlight-python"><pre>delta:ggeo blyth$ opticks-f setCathode
./assimprap/AssimpGGeo.cc:                gg-&gt;setCathode(gmat) ;
./ggeo/GGeo.cc:void GGeo::setCathode(GMaterial* cathode)
./ggeo/GGeo.hh:        void setCathode(GMaterial* cathode);
delta:opticks blyth$</pre>
</div>
</div>
<div class="section" id="assimp">
<h2>assimp<a class="headerlink" href="#assimp" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>/usr/local/opticks/externals/assimp/assimp-fork/code

delta:code blyth$ grep g4dae_ *.*
ColladaLoader.cpp:            const char* prefix = "g4dae_" ;
ColladaParser.cpp:const std::string ColladaParser::g4dae_bordersurface_physvolume1 = "g4dae_bordersurface_physvolume1" ;
ColladaParser.cpp:const std::string ColladaParser::g4dae_bordersurface_physvolume2 = "g4dae_bordersurface_physvolume2" ;
ColladaParser.cpp:const std::string ColladaParser::g4dae_skinsurface_volume = "g4dae_skinsurface_volume" ;
ColladaParser.cpp:const std::string ColladaParser::g4dae_opticalsurface_name   = "g4dae_opticalsurface_name" ;
ColladaParser.cpp:const std::string ColladaParser::g4dae_opticalsurface_finish = "g4dae_opticalsurface_finish" ;
ColladaParser.cpp:const std::string ColladaParser::g4dae_opticalsurface_model  = "g4dae_opticalsurface_model" ;
ColladaParser.cpp:const std::string ColladaParser::g4dae_opticalsurface_type   = "g4dae_opticalsurface_type" ;
ColladaParser.cpp:const std::string ColladaParser::g4dae_opticalsurface_value  = "g4dae_opticalsurface_value" ;
ColladaParser.cpp:    pProperties[g4dae_opticalsurface_name]   = pOpticalSurface.mName ;
ColladaParser.cpp:    pProperties[g4dae_opticalsurface_model]  = pOpticalSurface.mModel ;
ColladaParser.cpp:    pProperties[g4dae_opticalsurface_type]   = pOpticalSurface.mType ;
ColladaParser.cpp:    pProperties[g4dae_opticalsurface_finish] = pOpticalSurface.mFinish ;
ColladaParser.cpp:    pProperties[g4dae_opticalsurface_value]  = pOpticalSurface.mValue ;
ColladaParser.cpp:        pMaterial.mExtra-&gt;mProperties[g4dae_skinsurface_volume] = pSkinSurface.mVolume ;
ColladaParser.cpp:        pMaterial.mExtra-&gt;mProperties[g4dae_bordersurface_physvolume1] = pBorderSurface.mPhysVolume1 ;
ColladaParser.cpp:        pMaterial.mExtra-&gt;mProperties[g4dae_bordersurface_physvolume2] = pBorderSurface.mPhysVolume2 ;
ColladaParser.h:    static const std::string g4dae_bordersurface_physvolume1 ;
ColladaParser.h:    static const std::string g4dae_bordersurface_physvolume2 ;
ColladaParser.h:    static const std::string g4dae_skinsurface_volume ;
ColladaParser.h:    static const std::string g4dae_opticalsurface_name ;
ColladaParser.h:    static const std::string g4dae_opticalsurface_finish ;
ColladaParser.h:    static const std::string g4dae_opticalsurface_model ;
ColladaParser.h:    static const std::string g4dae_opticalsurface_type ;
ColladaParser.h:    static const std::string g4dae_opticalsurface_value ;
delta:code blyth$</pre>
</div>
<div class="highlight-python"><pre>24420     &lt;material id="Steel0x14aa2a0"&gt;
24421       &lt;instance_effect url="#Steel_fx_0x14aa2a0"/&gt;
24422       &lt;extra&gt;
24423         &lt;matrix coldim="2" name="ABSLENGTH0x14aabd0"&gt;1.55e-06 0.001 6.2e-06 0.001 1.033e-05 0.001 1.55e-05 0.001&lt;/matrix&gt;
24424         &lt;property name="ABSLENGTH" ref="ABSLENGTH0x14aabd0"/&gt;
24425       &lt;/extra&gt;
24426     &lt;/material&gt;
24427     &lt;material id="Tyvek0x14a7890"&gt;
24428       &lt;instance_effect url="#Tyvek_fx_0x14a7890"/&gt;
24429       &lt;extra&gt;
24430         &lt;matrix coldim="2" name="ABSLENGTH0x14a7bf0"&gt;1.55e-06 10000 6.2e-06 10000 1.033e-05 10000 1.55e-05 10000&lt;/matrix&gt;
24431         &lt;property name="ABSLENGTH" ref="ABSLENGTH0x14a7bf0"/&gt;
24432       &lt;/extra&gt;
24433     &lt;/material&gt;</pre>
</div>
<p>DYB .dae has EFFICIENCY property on the Bialkali material of the cathode:</p>
<div class="highlight-python"><pre>065902     &lt;material id="__dd__Materials__Bialkali0xc2f2428"&gt;
 65903       &lt;instance_effect url="#__dd__Materials__Bialkali_fx_0xc2f2428"/&gt;
 65904       &lt;extra&gt;
 65905         &lt;matrix coldim="2" name="ABSLENGTH0xc0b7a90"&gt;1.55e-06 0.0001 1.61e-06 500 2.07e-06 1000 2.48e-06 2000 3.56e-06 1000 4.13e-06 1000 6.2e-06 1000 1.033e-05 1000 1.55e-05 1000&lt;/matr       ix&gt;
 65906         &lt;property name="ABSLENGTH" ref="ABSLENGTH0xc0b7a90"/&gt;
 65907         &lt;matrix coldim="2" name="EFFICIENCY0xc2c6598"&gt;1.55e-06 0.0001 1.8e-06 0.002 1.9e-06 0.005 2e-06 0.01 2.05e-06 0.017 2.16e-06 0.03 2.19e-06 0.04 2.23e-06 0.05 2.27e-06 0.06 2.32e       -06 0.07 2.36e-06 0.08 2.41e-06 0.09 2.46e-06 0.1 2.5e-06 0.11 2.56e-06 0.13 2.61e-06 0.15 2.67e-06 0.16 2.72e-06 0.18 2.79e-06 0.19 2.85e-06 0.2 2.92e-06 0.21 2.99e-06 0.22 3.06e-06 0.       22 3.14e-06 0.23 3.22e-06 0.24 3.31e-06 0.24 3.4e-06 0.24 3.49e-06 0.23 3.59e-06 0.22 3.7e-06 0.21 3.81e-06 0.17 3.94e-06 0.14 4.07e-06 0.09 4.1e-06 0.035 4.4e-06 0.005 5e-06 0.001 6.2e       -06 0.0001 1.033e-05 0 1.55e-05 0&lt;/matrix&gt;
 65908         &lt;property name="EFFICIENCY" ref="EFFICIENCY0xc2c6598"/&gt;
 65909         &lt;matrix coldim="2" name="RINDEX0xc0fd260"&gt;1.55e-06 1.458 2.07e-06 1.458 4.13e-06 1.458 6.2e-06 1.458 1.033e-05 1.458 1.55e-05 1.458&lt;/matrix&gt;
 65910         &lt;property name="RINDEX" ref="RINDEX0xc0fd260"/&gt;
 65911       &lt;/extra&gt;
 65912     &lt;/material&gt;

152930       &lt;opticalsurface finish="3" model="1" name="__dd__Geometry__PoolDetails__NearPoolSurfaces__NearPoolCoverSurface" type="0" value="1"&gt;
152931         &lt;matrix coldim="2" name="REFLECTIVITY0xc04f6a8"&gt;1.5e-06 0 6.5e-06 0&lt;/matrix&gt;
152932         &lt;property name="REFLECTIVITY" ref="REFLECTIVITY0xc04f6a8"/&gt;
152933         &lt;matrix coldim="2" name="RINDEX0xc33da70"&gt;1.5e-06 0 6.5e-06 0&lt;/matrix&gt;
152934         &lt;property name="RINDEX" ref="RINDEX0xc33da70"/&gt;
152935       &lt;/opticalsurface&gt;
152936       &lt;opticalsurface finish="3" model="1" name="__dd__Geometry__AdDetails__AdSurfacesAll__RSOilSurface" type="0" value="1"&gt;
152937         &lt;matrix coldim="2" name="BACKSCATTERCONSTANT0xc28d340"&gt;1.55e-06 0 6.2e-06 0 1.033e-05 0 1.55e-05 0&lt;/matrix&gt;
152938         &lt;property name="BACKSCATTERCONSTANT" ref="BACKSCATTERCONSTANT0xc28d340"/&gt;
152939         &lt;matrix coldim="2" name="REFLECTIVITY0xc563328"&gt;1.55e-06 0.0393 1.771e-06 0.0393 2.066e-06 0.0394 2.48e-06 0.03975 2.755e-06 0.04045 3.01e-06 0.04135 3.542e-06 0.0432 4.133e-06        0.04655 4.959e-06 0.0538 6.2e-06 0.067 1.033e-05 0.114 1.55e-05 0.173&lt;/matrix&gt;
152940         &lt;property name="REFLECTIVITY" ref="REFLECTIVITY0xc563328"/&gt;
152941         &lt;matrix coldim="2" name="SPECULARLOBECONSTANT0xbfa85d0"&gt;1.55e-06 0 6.2e-06 0 1.033e-05 0 1.55e-05 0&lt;/matrix&gt;
152942         &lt;property name="SPECULARLOBECONSTANT" ref="SPECULARLOBECONSTANT0xbfa85d0"/&gt;
152943         &lt;matrix coldim="2" name="SPECULARSPIKECONSTANT0xc03fc20"&gt;1.55e-06 0 6.2e-06 0 1.033e-05 0 1.55e-05 0&lt;/matrix&gt;
152944         &lt;property name="SPECULARSPIKECONSTANT" ref="SPECULARSPIKECONSTANT0xc03fc20"/&gt;
152945       &lt;/opticalsurface&gt;
152946       &lt;opticalsurface finish="0" model="1" name="__dd__Geometry__AdDetails__AdSurfacesAll__ESRAirSurfaceTop" type="0" value="0"&gt;
152947         &lt;matrix coldim="2" name="REFLECTIVITY0xc359d00"&gt;1.55e-06 0.98505 1.63e-06 0.98406 1.68e-06 0.96723 1.72e-06 0.9702 1.77e-06 0.97119 1.82e-06 0.96624 1.88e-06 0.95139 1.94e-06 0.       98307 2e-06 0.9801 2.07e-06 0.98901 2.14e-06 0.98505 2.21e-06 0.96525 2.3e-06 0.97614 2.38e-06 0.97812 2.48e-06 0.97515 2.58e-06 0.96525 2.7e-06 0.96624 2.82e-06 0.96129 2.95e-06 0.9583       2 3.1e-06 0.95733 3.26e-06 0.73656 3.44e-06 0.11583 3.65e-06 0.10395 3.88e-06 0.11682 4.13e-06 0.14256 4.43e-06 0.1188 4.77e-06 0.18018 4.96e-06 0.21384 6.2e-06 0.0099 1.033e-05 0.0099        1.55e-05 0.0099&lt;/matrix&gt;
152948         &lt;property name="REFLECTIVITY" ref="REFLECTIVITY0xc359d00"/&gt;
152949       &lt;/opticalsurface&gt;</pre>
</div>
<p>JUNO .dae has EFFICIENCY on the opticalsurface of Photocathode_opsurf and Photocathode_opsurf_3inch</p>
<div class="highlight-python"><pre>854339     &lt;extra&gt;
854340       &lt;opticalsurface finish="3" model="1" name="UpperChimneyTyvekOpticalSurface" type="0" value="0.2"&gt;
854341         &lt;matrix coldim="2" name="REFLECTIVITY0x180de20"&gt;1.55e-06 0.1 6.2e-06 0.1 1.033e-05 0.1 1.55e-05 0.1&lt;/matrix&gt;
854342         &lt;property name="REFLECTIVITY" ref="REFLECTIVITY0x180de20"/&gt;
854343       &lt;/opticalsurface&gt;
854344       &lt;opticalsurface finish="0" model="0" name="Photocathode_opsurf" type="0" value="1"&gt;
854345         &lt;matrix coldim="2" name="EFFICIENCY0x14c0780"&gt;1.55e-06 0.002214 1.77143e-06 0.002214 1.7971e-06 0.003426 1.82353e-06 0.005284 1.85075e-06 0.007921 1.87879e-06 0.011425 1.90769e-       06 0.015808 1.9375e-06 0.021143 1.96825e-06 0.026877 2e-06 0.033344 2.03279e-06 0.040519 2.06667e-06 0.048834 2.10169e-06 0.057679 2.13793e-06 0.067843 2.17544e-06 0.079047 2.21429e-06        0.091286 2.25454e-06 0.104205 2.2963e-06 0.119611 2.33962e-06 0.135205 2.38462e-06 0.154528 2.43137e-06 0.17464 2.48e-06 0.194504 2.53061e-06 0.210267 2.58333e-06 0.223053 2.6383e-06 0.       234931 2.69565e-06 0.248108 2.75556e-06 0.26528 2.81818e-06 0.281478 2.88372e-06 0.293765 2.95238e-06 0.30198 3.02439e-06 0.302932 3.1e-06 0.303274 3.17949e-06 0.299854 3.26316e-06 0.28       5137 3.35135e-06 0.270132 3.44444e-06 0.252713 3.54286e-06 0.227767 3.64706e-06 0.192104 3.75758e-06 0.143197 3.875e-06 0.063755 4e-06 0.015229 4.13333e-06 0.007972 1.55e-05 1e-06&lt;/matr       ix&gt;
854346         &lt;property name="EFFICIENCY" ref="EFFICIENCY0x14c0780"/&gt;
854347         &lt;matrix coldim="2" name="KINDEX0x14c0520"&gt;1.55e-06 1.6 6.2e-06 1.6 1.033e-05 1.6 1.55e-05 1.6&lt;/matrix&gt;
854348         &lt;property name="KINDEX" ref="KINDEX0x14c0520"/&gt;
854349         &lt;matrix coldim="2" name="REFLECTIVITY0x14c0630"&gt;1.55e-06 0 6.2e-06 0 1.033e-05 0 1.55e-05 0&lt;/matrix&gt;
854350         &lt;property name="REFLECTIVITY" ref="REFLECTIVITY0x14c0630"/&gt;
854351         &lt;matrix coldim="2" name="RINDEX0x14c0470"&gt;1.55e-06 2.9 6.2e-06 2.9 1.033e-05 2.9 1.55e-05 2.9&lt;/matrix&gt;
854352         &lt;property name="RINDEX" ref="RINDEX0x14c0470"/&gt;
854353         &lt;matrix coldim="2" name="THICKNESS0x14c1000"&gt;0 2.6e-05 375 2.6e-05&lt;/matrix&gt;
854354         &lt;property name="THICKNESS" ref="THICKNESS0x14c1000"/&gt;
854355       &lt;/opticalsurface&gt;
854356       &lt;opticalsurface finish="1" model="0" name="Mirror_opsurf" type="0" value="0.999"&gt;
854357         &lt;matrix coldim="2" name="REFLECTIVITY0x17feaf0"&gt;1.55e-06 0.9999 1.55e-05 0.9999&lt;/matrix&gt;
854358         &lt;property name="REFLECTIVITY" ref="REFLECTIVITY0x17feaf0"/&gt;
854359       &lt;/opticalsurface&gt;
854360       &lt;opticalsurface finish="0" model="0" name="Photocathode_opsurf_3inch" type="0" value="1"&gt;
854361         &lt;matrix coldim="2" name="EFFICIENCY0x14c1b70"&gt;1.55e-06 1e-05 1.737e-06 0.00159 1.769e-06 0.00255 1.791e-06 0.00355 1.808e-06 0.00469 1.825e-06 0.00605 1.844e-06 0.00774 1.864e-0       6 0.01003 1.884e-06 0.01325 1.904e-06 0.01718 1.923e-06 0.02059 1.947e-06 0.02608 1.978e-06 0.03229 2.008e-06 0.0396 2.041e-06 0.0479 2.069e-06 0.0548 2.104e-06 0.06387 2.141e-06 0.0779       7 2.174e-06 0.09129 2.211e-06 0.10541 2.251e-06 0.12003 2.303e-06 0.13668 2.361e-06 0.15564 2.41e-06 0.17078 2.462e-06 0.19267 2.522e-06 0.21437 2.595e-06 0.23089 2.675e-06 0.24073 2.77       1e-06 0.24868 2.857e-06 0.24983 2.954e-06 0.24753 3.04e-06 0.24185 3.147e-06 0.23304 3.248e-06 0.22351 3.355e-06 0.20848 3.482e-06 0.19001 3.594e-06 0.1692 3.661e-06 0.14451 3.744e-06 0       .12059 3.78e-06 0.09924 3.831e-06 0.07906 3.868e-06 0.06154 3.912e-06 0.04971 3.956e-06 0.0396 4.002e-06 0.03126 4.043e-06 0.02525 4.09e-06 0.01894 4.122e-06 0.01516 4.161e-06 0.01185 4       .194e-06 0.00893 4.222e-06 0.0067 4.251e-06 0.00521 4.286e-06 0.004 4.315e-06 0.00307 4.363e-06 0.00229 4.394e-06 0.00181 4.437e-06 0.00137 6.2e-06 1e-05 1.033e-05 1e-05 1.55e-05 1e-05&lt;       /matrix&gt;
854362         &lt;property name="EFFICIENCY" ref="EFFICIENCY0x14c1b70"/&gt;
854363         &lt;matrix coldim="2" name="KINDEX0x14c1910"&gt;1.55e-06 1.6 6.2e-06 1.6 1.033e-05 1.6 1.55e-05 1.6&lt;/matrix&gt;
854364         &lt;property name="KINDEX" ref="KINDEX0x14c1910"/&gt;
854365         &lt;matrix coldim="2" name="REFLECTIVITY0x14c1a20"&gt;1.55e-06 0 6.2e-06 0 1.033e-05 0 1.55e-05 0&lt;/matrix&gt;
854366         &lt;property name="REFLECTIVITY" ref="REFLECTIVITY0x14c1a20"/&gt;
854367         &lt;matrix coldim="2" name="RINDEX0x14c1860"&gt;1.55e-06 2.9 6.2e-06 2.9 1.033e-05 2.9 1.55e-05 2.9&lt;/matrix&gt;
854368         &lt;property name="RINDEX" ref="RINDEX0x14c1860"/&gt;
854369         &lt;matrix coldim="2" name="THICKNESS0x14c2610"&gt;0 2.6e-05 375 2.6e-05&lt;/matrix&gt;
854370         &lt;property name="THICKNESS" ref="THICKNESS0x14c2610"/&gt;
854371       &lt;/opticalsurface&gt;
854372       &lt;opticalsurface finish="0" model="0" name="Absorb_opsurf" type="0" value="1"&gt;
854373         &lt;matrix coldim="2" name="REFLECTIVITY0x18374e0"&gt;1.55e-06 0 1.55e-05 0&lt;/matrix&gt;
854374         &lt;property name="REFLECTIVITY" ref="REFLECTIVITY0x18374e0"/&gt;
854375       &lt;/opticalsurface&gt;</pre>
</div>
<p>JUNO .gdml solids have associated opticalsurface but no properties</p>
<div class="highlight-python"><pre>243   &lt;solids&gt;
...
358     &lt;intersection name="PMT_20inch_inner1_solid0x1814a90"&gt;
359       &lt;first ref="PMT_20inch_inner_solid0x1814800"/&gt;
360       &lt;second ref="Inner_Separator0x1814990"/&gt;
361       &lt;position name="PMT_20inch_inner1_solid0x1814a90_pos" unit="mm" x="0" y="0" z="91.999999999"/&gt;
362     &lt;/intersection&gt;
363     &lt;opticalsurface finish="0" model="0" name="Photocathode_opsurf" type="0" value="1"/&gt;
364     &lt;subtraction name="PMT_20inch_inner2_solid0x1863010"&gt;
365       &lt;first ref="PMT_20inch_inner_solid0x1814800"/&gt;
366       &lt;second ref="Inner_Separator0x1814990"/&gt;
367       &lt;position name="PMT_20inch_inner2_solid0x1863010_pos" unit="mm" x="0" y="0" z="91.999999999"/&gt;
368     &lt;/subtraction&gt;
369     &lt;opticalsurface finish="1" model="0" name="Mirror_opsurf" type="0" value="0.999"/&gt;


412     &lt;ellipsoid ax="38" by="38" cz="22" lunit="mm" name="PMT_3inch_inner1_solid_ell_helper0x1c9e510" zcut1="7.04319871929267" zcut2="22"/&gt;
413     &lt;opticalsurface finish="0" model="0" name="Photocathode_opsurf_3inch" type="0" value="1"/&gt;
414     &lt;ellipsoid ax="38" by="38" cz="22" lunit="mm" name="PMT_3inch_inner2_solid_ell_helper0x1c9e5d0" zcut1="-15.8745078663875" zcut2="7.04319871929267"/&gt;
415     &lt;opticalsurface finish="0" model="0" name="Absorb_opsurf" type="0" value="1"/&gt;</pre>
</div>
<div class="highlight-python"><pre>277146     &lt;skinsurface name="Tube_surf" surfaceproperty="TubeSurface"&gt;
277147       &lt;volumeref ref="lSurftube0x254b8d0"/&gt;
277148     &lt;/skinsurface&gt;
277149     &lt;bordersurface name="UpperChimneyTyvekSurface" surfaceproperty="UpperChimneyTyvekOpticalSurface"&gt;
277150       &lt;physvolref ref="pUpperChimneyLS0x2547680"/&gt;
277151       &lt;physvolref ref="pUpperChimneyTyvek0x2547de0"/&gt;
277152     &lt;/bordersurface&gt;
277153     &lt;bordersurface name="PMT_20inch_photocathode_logsurf1" surfaceproperty="Photocathode_opsurf"&gt;
277154       &lt;physvolref ref="PMT_20inch_inner1_phys0x18012e0"/&gt;
277155       &lt;physvolref ref="PMT_20inch_body_phys0xe4d580"/&gt;
277156     &lt;/bordersurface&gt;
277157     &lt;bordersurface name="PMT_20inch_mirror_logsurf1" surfaceproperty="Mirror_opsurf"&gt;
277158       &lt;physvolref ref="PMT_20inch_inner2_phys0x1821730"/&gt;
277159       &lt;physvolref ref="PMT_20inch_body_phys0xe4d580"/&gt;
277160     &lt;/bordersurface&gt;
277161     &lt;bordersurface name="PMT_20inch_photocathode_logsurf2" surfaceproperty="Photocathode_opsurf"&gt;
277162       &lt;physvolref ref="PMT_20inch_body_phys0xe4d580"/&gt;
277163       &lt;physvolref ref="PMT_20inch_inner1_phys0x18012e0"/&gt;
277164     &lt;/bordersurface&gt;
277165     &lt;bordersurface name="PMT_3inch_photocathode_logsurf1" surfaceproperty="Photocathode_opsurf_3inch"&gt;
277166       &lt;physvolref ref="PMT_3inch_inner1_phys0x1c9f370"/&gt;
277167       &lt;physvolref ref="PMT_3inch_body_phys0x1c9f2c0"/&gt;
277168     &lt;/bordersurface&gt;
277169     &lt;bordersurface name="PMT_3inch_absorb_logsurf1" surfaceproperty="Absorb_opsurf"&gt;
277170       &lt;physvolref ref="PMT_3inch_inner2_phys0x1c9f420"/&gt;
277171       &lt;physvolref ref="PMT_3inch_body_phys0x1c9f2c0"/&gt;
277172     &lt;/bordersurface&gt;
277173     &lt;bordersurface name="PMT_3inch_photocathode_logsurf2" surfaceproperty="Photocathode_opsurf_3inch"&gt;
277174       &lt;physvolref ref="PMT_3inch_body_phys0x1c9f2c0"/&gt;
277175       &lt;physvolref ref="PMT_3inch_inner1_phys0x1c9f370"/&gt;
277176     &lt;/bordersurface&gt;
277177     &lt;bordersurface name="PMT_3inch_absorb_logsurf3" surfaceproperty="Absorb_opsurf"&gt;
277178       &lt;physvolref ref="PMT_3inch_cntr_phys0x1c9f4d0"/&gt;
277179       &lt;physvolref ref="PMT_3inch_body_phys0x1c9f2c0"/&gt;
277180     &lt;/bordersurface&gt;
277181     &lt;bordersurface name="ChimneyTyvekSurface" surfaceproperty="ChimneyTyvekOpticalSurface"&gt;
277182       &lt;physvolref ref="pLowerChimneyAcrylic0x254afc0"/&gt;
277183       &lt;physvolref ref="pLowerChimneyTyvek0x254af30"/&gt;
277184     &lt;/bordersurface&gt;
277185     &lt;bordersurface name="CDTyvekSurface" surfaceproperty="CDTyvekOpticalSurface"&gt;
277186       &lt;physvolref ref="pOuterWaterPool0x14dba40"/&gt;
277187       &lt;physvolref ref="pCentralDetector0x14ddb50"/&gt;
277188     &lt;/bordersurface&gt;
277189   &lt;/structure&gt;








2556 void ColladaParser::addCommonOpticalSurfaceProperties( Collada::ExtraProperties::ExtraPropertiesMap&amp; pProperties, Collada::OpticalSurface&amp; pOpticalSurface )
2557 {
2558     pProperties[g4dae_opticalsurface_name]   = pOpticalSurface.mName ;
2559     pProperties[g4dae_opticalsurface_model]  = pOpticalSurface.mModel ;
2560     pProperties[g4dae_opticalsurface_type]   = pOpticalSurface.mType ;
2561     pProperties[g4dae_opticalsurface_finish] = pOpticalSurface.mFinish ;
2562     pProperties[g4dae_opticalsurface_value]  = pOpticalSurface.mValue ;
2563 }
2564
2565
2566 void ColladaParser::FakeExtraSkinSurface(Collada::SkinSurface&amp; pSkinSurface,  Collada::Material&amp; pMaterial)
2567 {
2568     // hijack Assimp material infrastructure to hold skin surface properties
2569     if(!pMaterial.mExtra )
2570         pMaterial.mExtra = new Collada::ExtraProperties();
2571
2572     if(pSkinSurface.mOpticalSurface)
2573     {
2574         std::map&lt;std::string,std::string&gt;&amp; ssm = pSkinSurface.mOpticalSurface-&gt;mExtra-&gt;mProperties ;
2575         pMaterial.mExtra-&gt;mProperties.insert( ssm.begin(), ssm.end() );
2576         pMaterial.mExtra-&gt;mProperties[g4dae_skinsurface_volume] = pSkinSurface.mVolume ;
2577
2578         addCommonOpticalSurfaceProperties( pMaterial.mExtra-&gt;mProperties , *pSkinSurface.mOpticalSurface);
2579     }
2580 }
2581
....
2642 void ColladaParser::FakeExtraBorderSurface(Collada::BorderSurface&amp; pBorderSurface, Collada::Material&amp; pMaterial)
2643 {
2644     // hijack Assimp material infrastructure to hold skin surface properties
2645     if(!pMaterial.mExtra )
2646         pMaterial.mExtra = new Collada::ExtraProperties();
2647
2648     if(pBorderSurface.mOpticalSurface)
2649     {
2650         std::map&lt;std::string,std::string&gt;&amp; bsm = pBorderSurface.mOpticalSurface-&gt;mExtra-&gt;mProperties ;
2651         pMaterial.mExtra-&gt;mProperties.insert( bsm.begin(), bsm.end() );
2652         pMaterial.mExtra-&gt;mProperties[g4dae_bordersurface_physvolume1] = pBorderSurface.mPhysVolume1 ;
2653         pMaterial.mExtra-&gt;mProperties[g4dae_bordersurface_physvolume2] = pBorderSurface.mPhysVolume2 ;
2654
2655         addCommonOpticalSurfaceProperties( pMaterial.mExtra-&gt;mProperties, *pBorderSurface.mOpticalSurface);
2656     }
2657 }</pre>
</div>
</div>
<div class="section" id="assimprap">
<h2>assimprap-<a class="headerlink" href="#assimprap" title="Permalink to this headline">¶</a></h2>
<p>Hmm below setCathode is DYB specific, assuming cathode material</p>
<div class="highlight-python"><pre>368 void AssimpGGeo::convertMaterials(const aiScene* scene, GGeo* gg, const char* query )
369 {
370     LOG(info)&lt;&lt;"AssimpGGeo::convertMaterials "
371              &lt;&lt; " query " &lt;&lt; query
372              &lt;&lt; " mNumMaterials " &lt;&lt; scene-&gt;mNumMaterials
373              ;
374
...
379     for(unsigned int i = 0; i &lt; scene-&gt;mNumMaterials; i++)
380     {
381         unsigned int index = i ;  // hmm, make 1-based later
382
383         aiMaterial* mat = scene-&gt;mMaterials[i] ;
384
385         aiString name_;
386         mat-&gt;Get(AI_MATKEY_NAME, name_);
387
388         const char* name = name_.C_Str();
389
390         //if(strncmp(query, name, strlen(query))!=0) continue ;
391
392         LOG(debug) &lt;&lt; "AssimpGGeo::convertMaterials " &lt;&lt; i &lt;&lt; " " &lt;&lt; name ;
393
394         const char* bspv1 = getStringProperty(mat, g4dae_bordersurface_physvolume1 );
395         const char* bspv2 = getStringProperty(mat, g4dae_bordersurface_physvolume2 );
396
397         const char* sslv  = getStringProperty(mat, g4dae_skinsurface_volume );
398
399         const char* osnam = getStringProperty(mat, g4dae_opticalsurface_name );
400         const char* ostyp = getStringProperty(mat, g4dae_opticalsurface_type );
401         const char* osmod = getStringProperty(mat, g4dae_opticalsurface_model );
402         const char* osfin = getStringProperty(mat, g4dae_opticalsurface_finish );
403         const char* osval = getStringProperty(mat, g4dae_opticalsurface_value );
404

...
422         if( sslv )
423         {
424             assert(os &amp;&amp; "all ss must have associated os");
425
426             GSkinSurface* gss = new GSkinSurface(name, index, os);
...
449         }
450         else if (bspv1 &amp;&amp; bspv2 )
451         {
452             assert(os &amp;&amp; "all bs must have associated os");
453             GBorderSurface* gbs = new GBorderSurface(name, index, os);
...
471         else
472         {
473             assert(os==NULL);
474
475
476             //printf("AssimpGGeo::convertMaterials aiScene materialIndex %u (GMaterial) name %s \n", i, name);
477             GMaterial* gmat = new GMaterial(name, index);
478             gmat-&gt;setStandardDomain(standard_domain);
479             addProperties(gmat, mat );
480             gg-&gt;add(gmat);
481
482             {
483                 // without standard domain applied
484                 GMaterial* gmat_raw = new GMaterial(name, index);
485                 addProperties(gmat_raw, mat );
486                 gg-&gt;addRaw(gmat_raw);
487             }
488
489             if(hasVectorProperty(mat, EFFICIENCY ))
490             {
491                 assert(gg-&gt;getCathode() == NULL &amp;&amp; "only expecting one material with an EFFICIENCY property" );
492                 gg-&gt;setCathode(gmat) ;
493                 m_cathode = mat ;
494             }
495
496         }</pre>
</div>
<div class="highlight-python"><pre>517 void AssimpGGeo::convertSensors(GGeo* gg)
518 {
519 /*
520 Opticks is a surface based simulation, as opposed to
521 Geant4 which is CSG volume based. In Geant4 hits are formed
522 on stepping into volumes with associated SensDet.
523 The Opticks equivalent is intersecting with a "SensorSurface",
524 which are fabricated by AssimpGGeo::convertSensors.
525 */
526     convertSensors( gg, m_tree-&gt;getRoot(), 0);
527
528     //assert(m_cathode);
529     if(!m_cathode)
530     {
531          LOG(warning) &lt;&lt; "AssimpGGeo::convertSensors m_cathode NULL : no material with an efficiency property ?  " ;
532          return ;
533     }
534
535     unsigned int nclv = gg-&gt;getNumCathodeLV();
536
537
538     LOG(info) &lt;&lt; "AssimpGGeo::convertSensors"
539               &lt;&lt; " nclv " &lt;&lt; nclv
540               ;
541
542     GDomain&lt;float&gt;* standard_domain = gg-&gt;getBndLib()-&gt;getStandardDomain();
543
544     // DYB: nclv=2 for hemi and headon PMTs
545     for(unsigned int i=0 ; i &lt; nclv ; i++)
546     {
547         const char* sslv = gg-&gt;getCathodeLV(i);
548         LOG(info) &lt;&lt; "AssimpGGeo::convertSensors"
549                   &lt;&lt; " i " &lt;&lt; i
550                   &lt;&lt; " sslv " &lt;&lt; sslv
551                   ;
552
553         std::string name = BStr::trimPointerSuffixPrefix(sslv, NULL );
554         name += GSurfaceLib::SENSOR_SURFACE ;


    36
    37 const char* GSurfaceLib::REFLECTIVITY = "REFLECTIVITY" ;
    38 const char* GSurfaceLib::EFFICIENCY   = "EFFICIENCY" ;
    39 const char* GSurfaceLib::SENSOR_SURFACE = "SensorSurface" ;
    40


555
556         const char* osnam = name.c_str() ;
557         const char* ostyp = "0" ;
558         const char* osmod = "1" ;
559         const char* osfin = "3" ;
560         const char* osval = "1" ;
561
562         // TODO: check effects of above adhoc choice of common type/model/finish/value
563         // TODO: add parse ctor that understands: "type=dielectric_dielectric;model=unified;finish=ground;value=1.0"
564
565         GOpticalSurface* os = new GOpticalSurface(osnam, ostyp, osmod, osfin, osval) ;
566
567         // standard materials/surfaces use the originating aiMaterial index,
568         // extend that for fake SensorSurface by toting up all
569
570         unsigned int index = gg-&gt;getNumMaterials() + gg-&gt;getNumSkinSurfaces() + gg-&gt;getNumBorderSurfaces() ;
571
572
573         GSkinSurface* gss = new GSkinSurface(name.c_str(), index, os);
574
575         gss-&gt;setStandardDomain(standard_domain);
576
577         gss-&gt;setSkinSurface(sslv);
578
579         gss-&gt;setSensor();
580         // story continues in GBoundaryLib::standardizeSurfaceProperties
581         // that no longer exists, now probably GSurfaceLib::getSensorSurface
582        //
583
584         addProperties(gss, m_cathode );
585
586         LOG(info) &lt;&lt; "AssimpGGeo::convertSensors gss " &lt;&lt; gss-&gt;description();
587
588         gg-&gt;add(gss);
589
590         {
591             // without standard domain applied
592             GSkinSurface*  gss_raw = new GSkinSurface(name.c_str(), index, os);
593             gss_raw-&gt;setSkinSurface(sslv);
594             // not setting sensor, only the standardized need that
595             addProperties(gss_raw, m_cathode );
596             gg-&gt;addRaw(gss_raw);
597         }
598     }
599 }


601 void AssimpGGeo::convertSensors(GGeo* gg, AssimpNode* node, unsigned int depth)
602 {
603     // addCathodeLV into gg
604     convertSensorsVisit(gg, node, depth);
605     for(unsigned int i = 0; i &lt; node-&gt;getNumChildren(); i++) convertSensors(gg, node-&gt;getChild(i), depth + 1);
606 }
...
...
608 void AssimpGGeo::convertSensorsVisit(GGeo* gg, AssimpNode* node, unsigned int depth)
609 {
610     // collects lv of nodes of cathode material allowing construction
611     // of "fake" GSkinSurface
612     //
613     // NB border surface sensors at not handled, as there are non of those in DYB
614     //
615
616     unsigned int nodeIndex = node-&gt;getIndex();
617
618     const char* lv   = node-&gt;getName(0);
619
620     const char* pv   = node-&gt;getName(1);
621
622     unsigned int mti = node-&gt;getMaterialIndex() ;
623
624     GMaterial* mt = gg-&gt;getMaterial(mti);
625
626     NSensorList* sens = gg-&gt;getSensorList();
627     /*
628     NSensor* sensor0 = sens-&gt;getSensor( nodeIndex );
629     NSensor* sensor1 = sens-&gt;findSensorForNode( nodeIndex );
630     assert(sensor0 == sensor1);
631     // these do not match
632     */
633     NSensor* sensor = sens-&gt;findSensorForNode( nodeIndex );
634
635     if(sensor &amp;&amp; mt == gg-&gt;getCathode())
636     {
637          LOG(debug) &lt;&lt; "AssimpGGeo::convertSensorsVisit "
638                    &lt;&lt; " depth " &lt;&lt; depth
639                    &lt;&lt; " lv " &lt;&lt; lv
640                    &lt;&lt; " pv " &lt;&lt; pv
641                    ;
642          gg-&gt;addCathodeLV(lv) ;
643     }
644 }</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">OpticksDevNotes 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>