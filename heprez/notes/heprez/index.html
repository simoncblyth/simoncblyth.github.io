<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>HEPREZ &mdash; Heprez Unversioned directory documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'Unversioned directory',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Heprez Unversioned directory documentation" href="../" />
    <link rel="next" title="REZDB" href="../rezdb/" />
    <link rel="prev" title="end_of_2011 LOG" href="../log/end_of_2011/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../rezdb/" title="REZDB"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../log/end_of_2011/" title="end_of_2011 LOG"
             accesskey="P">previous</a> |</li>
        <li><a href="../">Heprez Unversioned directory documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> /e </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">/h</a>   </li>
	<li> <a href="http://cms01.phys.ntu.edu.tw/"> cms01 </a> </li>
	<li> <a href="http://cms01.phys.ntu.edu.tw/downloads/"> downloads </a> </li>
	<li> <a href="http://cms01.phys.ntu.edu.tw/rezdb/db/hfagc/"> rezdb/db/hfagc/ </a> </li>
</ul>






<h3>Content Skeleton</h3>

<ul>
<li class="toctree-l1"><a class="reference internal" href="../SOP/">SOP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../log/end_of_2011/">LOG</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">HEPREZ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#workflow-steps-after-editing">workflow steps after editing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#initial-heprez-propagate-onto-a-new-node">initial <em>heprez-propagate</em> onto a new node</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#define-a-reference-backup">define a reference backup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#server-control">server control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#close-open-editing">close/open editing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debug-non-operational-editing">debug non-operational editing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#osx-control">OSX control</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#migration-to-new-node">Migration to new node</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#heprez-propagate-onto-new-node-k"><em>heprez-propagate</em> onto new node K</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bash-functions">bash functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bash-debugging">BASH DEBUGGING</a></li>
<li class="toctree-l2"><a class="reference internal" href="#full-machinery-test">FULL MACHINERY TEST</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#heprez-usage-log">HEPREZ USAGE LOG</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mon-7th-july-2008">Mon 7th July 2008</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sun-31st-may-2009">Sun 31st May 2009</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mon-1st-june-2009">Mon 1st June 2009</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nov-15th-2011">Nov 15th 2011</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nov-18th-2011">Nov 18th 2011</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dec-5th-2011">Dec 5th 2011</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dec-17th-2011">Dec 17th 2011</a></li>
<li class="toctree-l2"><a class="reference internal" href="#apr-23rd-2012">Apr 23rd 2012</a></li>
<li class="toctree-l2"><a class="reference internal" href="#may-10th-2012">May 10th 2012</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../rezdb/">REZDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compilation/">Compilation latex document</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docs/math/">Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hepex/hepex/">Hepex Building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../future/">Future of b2c</a></li>
<li class="toctree-l1"><a class="reference internal" href="../environment/">Environment for heprez installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chiba/">Chiba</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chibatomcat/chibatomcat/">CHIBA TOMCAT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../batik/">Batik</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inkscape/">Inkscape</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dvisvgm/">DVISVGM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../images/">Binary Image creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backup/backup/">Partial Backup Machinery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backup/part/build/">BACKUP ANT BUILD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exist_/">LOW LEVEL EXIST USAGE FUNCTIONS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exist/">exist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../macports/">macports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../porting/">porting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eperl/">eperl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../svg/">svg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scrape/">scrape</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/heprez.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../log/end_of_2011/"
                        title="previous chapter">end_of_2011 LOG</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../rezdb/"
                        title="next chapter">REZDB</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="heprez">
<h1>HEPREZ<a class="headerlink" href="#heprez" title="Permalink to this headline">¶</a></h1>
<p>Bash functions for providing high level control of heprez machinery.
Being aware of what the functions do before running them is advisable, eg using <em>type</em>:</p>
<div class="highlight-python"><pre>type heprez-propagate

heprez-propagate is a function
heprez-propagate ()
{
    local msg="=== $FUNCNAME :";
    local-is-server &amp;&amp; echo $msg ABORT this must be done from dev machine &amp;&amp; return 1;
    exist_;
    exist_assert_running;
...</pre>
</div>
<div class="section" id="workflow-steps-after-editing">
<h2>workflow steps after editing<a class="headerlink" href="#workflow-steps-after-editing" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">on the dev machine (the scraper) bump HFAG_SCRAPE_DATE with <em>scrape-vi</em> then:</p>
<blockquote>
<div><ul class="simple">
<li>stop exist <em>exist-unload</em></li>
<li>reconfig <em>exist-cfg</em> propagates changes via template filling into the webapp</li>
<li>start again <em>exist-load</em></li>
<li>check consistent environment <em>envchk-;envchk-cf</em></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">make sure editing machine is directly accessible then <em>heprez-propagate</em></p>
</li>
<li><p class="first">run <em>heprez-prepare&#8211;</em> updates images and indices, when no new modes are added by the edits this does nothing</p>
</li>
<li><p class="first">run <em>heprez-update</em> (takes ~6hrs, for much of which the machine is unusable, due to windows coming and going)</p>
</li>
<li><p class="first"><em>heprez-check</em> (quickly adjust apache config to use the new statics, after bouncing apache)</p>
<ul>
<li><p class="first">check <a class="reference external" href="http://localhost">http://localhost</a> and random sample pages to look for issues</p>
</li>
<li><p class="first">manually update ~/h/compilation/blurb.tex with totals from the front page then <em>compilation-update</em> to
recompile that into the PDF</p>
</li>
<li><p class="first">check the table compilation, look for wides etc:</p>
<div class="highlight-python"><pre>g4pb:compilation blyth$ compilation-
g4pb:compilation blyth$ compilation-cd
g4pb:00000 blyth$ pwd
/data/heprez/data/scrape/20130617/hfagc/00000/00000
g4pb:00000 blyth$ open b2charm_end_of_2011_v011.pdf</pre>
</div>
</li>
<li><p class="first">for details on changing pagination and small font pages see <a class="reference internal" href="../compilation/compilation/"><em>Latex Tables Compilation</em></a></p>
</li>
</ul>
</li>
<li><p class="first"><em>heprez-sync</em> from the scraping machine, as detailed below</p>
</li>
<li><p class="first"><em>heprez-server</em>  on the server, as detailed below</p>
</li>
<li><p class="first">check new PDF and tex containing tarball is listed at <a class="reference external" href="http://cms01.phys.ntu.edu.tw/downloads/">http://cms01.phys.ntu.edu.tw/downloads/</a></p>
</li>
<li><p class="first"><em>compilation-tgztest</em> for details <a class="reference internal" href="../compilation/compilation/"><em>Latex Tables Compilation</em></a></p>
</li>
<li><p class="first">request checking from the group via email, eg <em>~/h/admin/end_of_2011_v011.txt</em></p>
</li>
</ol>
</div>
<div class="section" id="initial-heprez-propagate-onto-a-new-node">
<h2>initial <em>heprez-propagate</em> onto a new node<a class="headerlink" href="#initial-heprez-propagate-onto-a-new-node" title="Permalink to this headline">¶</a></h2>
<p>When first doing a <em>heprez-propagate</em> on a new node, say NO to the <em>backup-load</em> dialog:</p>
<div class="highlight-python"><pre>=== backup-load : ARE YOU SURE : THIS WILL REMOVE CURRENT /db/hfagc AND LOAD THE LAST BACKUP 2013/Jun21-1145 FROM PRODUCTION INTO THE LOCAL NODE /Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4
=== backup-load : enter YES to proceed</pre>
</div>
<p>And then run <em>backup-load-users-insitu</em> to load the users file from eg:</p>
<div class="highlight-python"><pre>b2mc:~ heprez$ backup-users-path
/Users/heprez/data/data/backup/part/cms01.phys.ntu.edu.tw/last/db/system/users.xml</pre>
</div>
<p>This avoids java.lang.NullPointerException from attempting to load resources belonging
to users that do not yet exist. See <a class="reference internal" href="../porting/kek/"><em>KEK Port Notes</em></a></p>
<p>After loading the users, the <em>heprez-propagate</em> can be rerun, to grab and load the content from the remote
into the new local instance.</p>
<div class="section" id="define-a-reference-backup">
<h3>define a reference backup<a class="headerlink" href="#define-a-reference-backup" title="Permalink to this headline">¶</a></h3>
<p>This is necessary to prevent <em>images-preillus</em> from aborting, but the purpose is
simply to provide relevant diffs against a prior reference. For details on
how to define this see <a class="reference internal" href="../backup/backup/"><em>Partial Backup Machinery</em></a></p>
</div>
</div>
<div class="section" id="server-control">
<h2>server control<a class="headerlink" href="#server-control" title="Permalink to this headline">¶</a></h2>
<div class="section" id="close-open-editing">
<h3>close/open editing<a class="headerlink" href="#close-open-editing" title="Permalink to this headline">¶</a></h3>
<p>CLOSE EDITING by switching off tomcat/chiba with:</p>
<div class="highlight-python"><pre>sudo /sbin/service tomcat stop   OR tom-stop</pre>
</div>
<p>this allows backups/propagations/registrations (which operate via exist)
to continue.  Attempts to login in this state hang.</p>
<p>OPEN EDITING: by resuming tomcat/chiba with:</p>
<div class="highlight-python"><pre>sudo /sbin/service tomcat start</pre>
</div>
</div>
<div class="section" id="debug-non-operational-editing">
<h3>debug non-operational editing<a class="headerlink" href="#debug-non-operational-editing" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://cms01.phys.ntu.edu.tw/rezdb/db/test/0460.xml">http://cms01.phys.ntu.edu.tw/rezdb/db/test/0460.xml</a></li>
</ul>
<p>IF EDITING NOT OPERATIONAL</p>
<ul class="simple">
<li>SWITCH OFF ALL 3 SERVICES THEN RESUME WITH heprez-start</li>
<li>NB browsers (especially ppc/Safari) have tendency to hang onto bad
state regards servers, requiring them to be bounced
<strong>ALWAYS TRY ANOTHER BROWSER WHEN SAFARI IS HANGING</strong></li>
</ul>
</div>
<div class="section" id="osx-control">
<h3>OSX control<a class="headerlink" href="#osx-control" title="Permalink to this headline">¶</a></h3>
<p>Thus on OSX  open new Terminal.app windows and run:</p>
<div class="highlight-python"><pre>heprez-
exist-  ; exist-start  (REQUIRED for doing heprez-propagate )
tomcat- ; tomcat-start  (usually not needed on dev server as all inputs done one real server)</pre>
</div>
<p>Apache will be running already although may need to diddle the config</p>
</div>
</div>
<div class="section" id="migration-to-new-node">
<h2>Migration to new node<a class="headerlink" href="#migration-to-new-node" title="Permalink to this headline">¶</a></h2>
<div class="section" id="heprez-propagate-onto-new-node-k">
<h3><em>heprez-propagate</em> onto new node K<a class="headerlink" href="#heprez-propagate-onto-new-node-k" title="Permalink to this headline">¶</a></h3>
<p><em>heprez-propagate</em> fails when attempting to grab into a fresh empty DB,
due to no /db/system/users.xml presumably:</p>
<div class="highlight-python"><pre>part-backup:
     [echo] grabbing the database results data from target server
    [mkdir] Created dir: /Users/heprez/data/data/backup/part/cms01.phys.ntu.edu.tw/2013/Jun20-1959
[xdb:backup] Creating backup of collection: xmldb:exist://cms01.phys.ntu.edu.tw:9090/xmlrpc/db/hfagc
[xdb:backup] Backup directory: /Users/heprez/data/data/backup/part/cms01.phys.ntu.edu.tw/2013/Jun20-1959
[xdb:backup] org.xmldb.api.base.XMLDBException: org.apache.xmlrpc.XmlRpcException: Invalid password for user admin
[xdb:backup]    at org.exist.xmldb.RemoteCollection.readCollection(RemoteCollection.java:329)
[xdb:backup]    at org.exist.xmldb.RemoteCollection.getChildCollection(RemoteCollection.java:127)
[xdb:backup]    at org.exist.xmldb.DatabaseImpl.readCollection(DatabaseImpl.java:98)</pre>
</div>
</div>
</div>
<div class="section" id="bash-functions">
<h2>bash functions<a class="headerlink" href="#bash-functions" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><em>heprez-log</em></dt>
<dd>operations log</dd>
<dt><em>heprez-start</em></dt>
<dd>start the triplet of proceses : exist, httpd, tomcat using sudo service</dd>
<dt><em>heprez-build-from-scratch</em></dt>
<dd>stop exist, delete it and its code, rebuild it and restart
CAUTION: THIS DELETES THE DATABASE AND ITS ENTIRE CONTENT</dd>
<dt><em>heprez-build</em></dt>
<dd>build the webapp, to works on both dev machine and server.
Everying up to starting the servers</dd>
<dt><em>heprez-propagate</em></dt>
<dd><p class="first">transfer new results from server instance to the dev machine instance,
registering new results as needed : both DB must be running
and direct XMLRPC backdoor connection is required, this can be tested ahead of time with:</p>
<div class="highlight-python"><pre>exist_assert_directly_accessible $HEPREZ_SERVER</pre>
</div>
<p>if not modify the firewall according to the calling ip on C, determine that with
using whatismyip to find the IP:</p>
<div class="highlight-python"><pre>[blyth@cms01 ~]$ iptables- ; IPTABLES_PORT=9090 iptables-webopen-ip $(local-tag2ip G)</pre>
</div>
<p class="last">[2012-04-09] This failed to restore onto G following addition of new user yasmine #104 #174</p>
</dd>
<dt><em>heprez-prepare&#8211;</em></dt>
<dd><p class="first">post server start preparations for doing a scrape aka update,
is invoked by -update but does not harm to do separately as a warm up.</p>
<p>Before which:</p>
<ol class="last arabic simple">
<li><em>open -a &#8220;/Applications/Adobe Illustrator CS3/Adobe Illustrator.app&#8221;</em></li>
<li>review scrape config <em>scrape-vi</em></li>
<li>after scrape config updates : <em>envchk-cf</em> and restart exist if needed</li>
</ol>
</dd>
<dt><em>heprez-update</em></dt>
<dd><p class="first">accomodate new results creating needed images,
doing classification and averages and updating  the scrape</p>
<p>NB before running this update the HFAG_* settings such
as HFAG_SCRAPE_DATE with scrape-vi</p>
<p>follow progress with:</p>
<div class="highlight-python"><pre>exist-;exist-tail
exist-;exist-tail access</pre>
</div>
<p>Do a restricted update for testing with eg:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">heprez</span><span class="o">-</span><span class="n">update</span> <span class="o">-</span><span class="n">Dpos</span><span class="o">=</span><span class="mo">00101</span>
</pre></div>
</div>
</dd>
<dt><em>heprez-update-from-scratch</em></dt>
<dd><p class="first">Does a <em>scrape-wipe</em> before doing the update.</p>
<p>Wipe a preexisting scrape from fs and db before proceeding to scrape
do a restricted update for testing with eg:</p>
<div class="last highlight-python"><pre>heprez-update-from-scratch -Dpos=00101</pre>
</div>
</dd>
<dt><em>heprez-check</em></dt>
<dd><p class="first">update apache configuration to allow viewing of the newly created
statics, NB you must bounce the server for the change to take effect with:</p>
<div class="last highlight-python"><pre>sudo apachectl stop ; sudo apachectl start</pre>
</div>
</dd>
</dl>
<p><em>heprez-sync  &lt;override-target&gt;</em></p>
<blockquote>
<div><p>transfer from dev machine to HEPREZ_SERVER target machine (the editing machine)
invokes the below <em>-sync</em> functions which are all implemented with local-sync:</p>
<div class="highlight-python"><pre>backup-sync     \$HEPREZ_DATA/backup
images-sync     \$HEPREZ_DATA/images
scrape-sync     \$HEPREZ_DATA/scrape
compilation-sync   calls compilation-scp-to-downloads , dependant on \$B2C_COMPILATION_NAME</pre>
</div>
<p>rsync resulting backup, image and scrape files to HEPREZ_DATA on server
and scp the compilation pdf to downloads</p>
<p>NB check free disk space on target before doing this</p>
<p>Usage example:</p>
<div class="highlight-python"><pre>HEPREZ_SYNC_YES=1 heprez-sync                           # to default \$HEPREZ_SERVER
HEPREZ_SYNC_YES=1 heprez-sync hfag.phys.ntu.edu.tw      # override default destination</pre>
</div>
<p>The <span class="target" id="index-0"></span><tt class="xref std std-envvar docutils literal"><span class="pre">HEPREZ_SYNC_YES</span></tt> avoids having to interactively confirm some steps</p>
<p>[2013/06/24] Despite scp-ing the tarball and PDF to C:/var/www/html/downloads
the files were not visible at http://cms01.phys.ntu.edu.tw/downloads/ and
direct download attempts gave permission denied.</p>
<p>Something has changed wrt SELinux permissions since last time, fixing SELinux labelling
solved the problem</p>
<div class="highlight-python"><pre>[blyth@cms01 downloads]$ ls -Z b2charm_end_of_2011_v010.pdf b2charm_end_of_2011_v011.pdf
-rw-r--r--  blyth    blyth    user_u:object_r:httpd_sys_content_t b2charm_end_of_2011_v010.pdf
-rw-r--r--  blyth    blyth                                     b2charm_end_of_2011_v011.pdf
[blyth@cms01 downloads]$ chcon -R -h user_u:object_r:httpd_sys_content_t  /var/www/html/downloads/b2charm_end_of_2011_v011*
[blyth@cms01 downloads]$  ls -Z b2charm_end_of_2011_v010.pdf b2charm_end_of_2011_v011.pdf
-rw-r--r--  blyth    blyth    user_u:object_r:httpd_sys_content_t b2charm_end_of_2011_v010.pdf
-rw-r--r--  blyth    blyth    user_u:object_r:httpd_sys_content_t b2charm_end_of_2011_v011.pdf</pre>
</div>
</div></blockquote>
<dl class="docutils">
<dt><em>heprez-du</em></dt>
<dd><p class="first">disk usage:</p>
<div class="last highlight-python"><pre>g4pb:data blyth$ du -hs $HEPREZ_DATA/*
51M    /data/heprez/data/backup
82M    /data/heprez/data/images
1.2M   /data/heprez/data/register
232M   /data/heprez/data/scrape</pre>
</div>
</dd>
<dt><em>heprez-server</em></dt>
<dd><p class="first">prepare the server for editing and static presentation, <strong>not scraping</strong>
typically used after a heprez-sync from the dev machine</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Before running this ensure to <em>svn up ~/heprez</em> on the server
then <em>heprez-</em> to pick up the new <em>scrape-</em> environment settings that point
to the new scrape date for example</p>
</div>
<p>Must be run on HEPREZ_SERVER (editing machine) only, invokes:</p>
<div class="highlight-python"><pre>backup-prepare   : deals in rezults: does nothing when /db/hfagc is pre-existing
images-prepare   : on server does indices-upload loading into /db/hfagc_system
exist-prepare    : putts examples.xml members.xml \$HFAG_PDG_NAME into /db/hfagc_system
chiba-prepare    : stylesheets into /db/stylesheets
hapache-prepare  : selinux permissions + heprez.conf apache hookup</pre>
</div>
<p>Changing the apache config may prompt for password, to allow sudo operations.</p>
<p>To see the changed pages at <a class="reference external" href="http://cms01.phys.ntu.edu.tw">http://cms01.phys.ntu.edu.tw</a> OR <a class="reference external" href="http://hfag.phys.ntu.edu.tw">http://hfag.phys.ntu.edu.tw</a>
after doing this, need to bounce apache with:</p>
<div class="highlight-python"><pre>[blyth@cms01 ~]$ sudo /sbin/service httpd stop
Stopping httpd:                                            [  OK  ]
[blyth@cms01 ~]$ sudo /sbin/service httpd start
Starting httpd:                                            [  OK  ]</pre>
</div>
<p class="last">Also browser page reloading and cache clearing may be needed.</p>
</dd>
</dl>
</div>
<div class="section" id="bash-debugging">
<h2>BASH DEBUGGING<a class="headerlink" href="#bash-debugging" title="Permalink to this headline">¶</a></h2>
<p>Debug a function with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">set</span> <span class="o">-</span><span class="n">x</span>
<span class="n">foo</span><span class="o">-</span><span class="n">bar</span>
</pre></div>
</div>
</div>
<div class="section" id="full-machinery-test">
<h2>FULL MACHINERY TEST<a class="headerlink" href="#full-machinery-test" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>heprez-build-from-scratch               # this monopolises the shell so run from fresh Terminal.app window
heprez-update-from-scratch -Dpos=00101  #  can take 4hrs or more for a full scrape so do in another fresh Terminal.app window also
heprez-sync                             # across to production machine</pre>
</div>
</div>
</div>
<div class="section" id="heprez-usage-log">
<h1>HEPREZ USAGE LOG<a class="headerlink" href="#heprez-usage-log" title="Permalink to this headline">¶</a></h1>
<div class="section" id="mon-7th-july-2008">
<h2>Mon 7th July 2008<a class="headerlink" href="#mon-7th-july-2008" title="Permalink to this headline">¶</a></h2>
<p>while investigating ahead before performing &#8220;heprez-server&#8221; on the server encounter
issue that the exist_exists reports that /db/hfagc does not exist when it
patently does due to lack of credentials causing the false report ... this would
have triggered an backup-load into server...</p>
<p>not time to investigate this now so just do &#8220;heprez-check&#8221; on the server
this only does &#8220;hapache-prepare&#8221; on the server to provide the statics</p>
</div>
<div class="section" id="sun-31st-may-2009">
<h2>Sun 31st May 2009<a class="headerlink" href="#sun-31st-may-2009" title="Permalink to this headline">¶</a></h2>
<p>completed scrape on dev machine + sync:</p>
<div class="highlight-python"><pre>G&gt; heprez-sync hfag.phys.ntu.edu.tw</pre>
</div>
<p>to avoid problems (on this venerable node with its manual build) just did:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">H</span><span class="o">&gt;</span> <span class="n">hapache</span><span class="o">-</span><span class="n">prepare</span>
</pre></div>
</div>
<p>for statics presentation</p>
</div>
<div class="section" id="mon-1st-june-2009">
<h2>Mon 1st June 2009<a class="headerlink" href="#mon-1st-june-2009" title="Permalink to this headline">¶</a></h2>
<p>synced updated indices etc
to data entry machine <em>cms01.phys.ntu.edu.tw</em> and current HEPREZ_SERVER:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">G</span><span class="o">&gt;</span> <span class="n">heprez</span><span class="o">-</span><span class="n">sync</span>
</pre></div>
</div>
<p>and then loaded these with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">&gt;</span> <span class="n">heprez</span><span class="o">-</span><span class="n">server</span>  <span class="c">#loads the indices</span>
</pre></div>
</div>
</div>
<div class="section" id="nov-15th-2011">
<h2>Nov 15th 2011<a class="headerlink" href="#nov-15th-2011" title="Permalink to this headline">¶</a></h2>
<p>Before embarking on EndOf2011 editing, bring the editing machine into sync with the
dev (scraping) machine.</p>
<p>Principal passenger was the checking backup 2011/Nov10-1344/ this included indices such
as part/localhost/2011/Nov10-1344/db/hfagc_system/qtag2latex.xml:</p>
<div class="highlight-python"><pre>G&gt; heprez-sync
=== heprez-sync : syncing the file system updates such as the scrape on the dev machine to target cms01.phys.ntu.edu.tw Tue 15 Nov 2011 16:39:10 CST</pre>
</div>
</div>
<div class="section" id="nov-18th-2011">
<h2>Nov 18th 2011<a class="headerlink" href="#nov-18th-2011" title="Permalink to this headline">¶</a></h2>
<p>Note the hfag incursion was webonly to : /data/usr/local/jars/xforms/chiba/live/chiba-web-2.0.0rc1-cvs/2
PLAN TO ONLY USE THE NODE FOR APACHE STATICS IN FUTURE</p>
</div>
<div class="section" id="dec-5th-2011">
<h2>Dec 5th 2011<a class="headerlink" href="#dec-5th-2011" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Synced 1st wave scrape to cms01 <em>heprez-sync</em> and reconfigured apache to serve it <em>heprez-check</em></li>
<li>did not update scrape environmennt for 2nd scrape <em>scrape-vi</em></li>
<li>should not update scrape environment prior to <em>heprez-server</em>
as that does <em>hapache-prepare</em>, which would have messed up the apache environment
which is needed for checking the 1st wave scrape during 2nd wave editing</li>
<li>primed the server indices <em>heprez-server</em> for 2nd wave editing</li>
</ul>
</div>
<div class="section" id="dec-17th-2011">
<h2>Dec 17th 2011<a class="headerlink" href="#dec-17th-2011" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Synced 2nd wave to cms01 using (new envvar to avoid all the YES inputs):</p>
<div class="highlight-python"><pre>HEPREZ_SYNC_YES=1 heprez-sync</pre>
</div>
</li>
<li><p class="first">an example of the resulting rsync commands, with no &#8220;&#8211;delete&#8221; option, so directories accumulate:</p>
<div class="highlight-python"><pre>rsync -e ssh -razv --exclude '.DS_Store' /data/heprez/data/scrape/ C:/data/heprez/data/scrape/</pre>
</div>
</li>
<li><p class="first">performed heprez-server on C to</p>
</li>
<li><p class="first">sync to hfag too so the inside PDF links are valid:</p>
<div class="highlight-python"><pre>HEPREZ_SYNC_YES=1 heprez-sync hfag.phys.ntu.edu.tw</pre>
</div>
</li>
<li><p class="first">r667 then cautions hapache-prepare (or heprez-check):</p>
<div class="highlight-python"><pre>[blyth@hfag apache]$ pwd
/data/usr/local/heprez/install/apache
[blyth@hfag apache]$ cp -r conf conf.19dec2011</pre>
</div>
</li>
<li><p class="first">after heprez-check find expected changes:</p>
<div class="highlight-python"><pre>[blyth@hfag apache]$ diff -r --brief conf.19dec2011 conf
Files conf.19dec2011/b2charm.conf and conf/b2charm.conf differ
Files conf.19dec2011/heprez.conf and conf/heprez.conf differ
Files conf.19dec2011/liststatic.conf and conf/liststatic.conf differ
Only in conf/static: end_of_2011.conf
files conf.19dec2011/static/implicit.conf and conf/static/implicit.conf differ
[blyth@hfag apache]$</pre>
</div>
</li>
</ul>
</div>
<div class="section" id="apr-23rd-2012">
<h2>Apr 23rd 2012<a class="headerlink" href="#apr-23rd-2012" title="Permalink to this headline">¶</a></h2>
<p>Scrape including LHCb results:</p>
<div class="highlight-python"><pre>HEPREZ_SYNC_YES=1 heprez-sync
HEPREZ_SYNC_YES=1 heprez-sync hfag.phys.ntu.edu.tw</pre>
</div>
</div>
<div class="section" id="may-10th-2012">
<h2>May 10th 2012<a class="headerlink" href="#may-10th-2012" title="Permalink to this headline">¶</a></h2>
<p>heprez-propagate failed for lack of direct connection, I thought this
was already persisted into the iptables:</p>
<div class="highlight-python"><pre>[blyth@cms01 ~]$ iptables- ; IPTABLES_PORT=9090 iptables-webopen-ip $(local-tag2ip G)</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../rezdb/" title="REZDB"
             >next</a> |</li>
        <li class="right" >
          <a href="../log/end_of_2011/" title="end_of_2011 LOG"
             >previous</a> |</li>
        <li><a href="../">Heprez Unversioned directory documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>