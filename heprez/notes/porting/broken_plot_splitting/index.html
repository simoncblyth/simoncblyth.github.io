<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Broken Plot Splitting &mdash; Heprez Unversioned directory documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'Unversioned directory',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Heprez Unversioned directory documentation" href="../../" />
    <link rel="up" title="porting" href="../" />
    <link rel="next" title="empty unit error" href="../empty_unit_error/" />
    <link rel="prev" title="Scrape Interation on b2mc without Illustrator" href="../scrape_iteration/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../empty_unit_error/" title="empty unit error"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../scrape_iteration/" title="Scrape Interation on b2mc without Illustrator"
             accesskey="P">previous</a> |</li>
        <li><a href="../../">Heprez Unversioned directory documentation</a> &raquo;</li>
          <li><a href="../" accesskey="U">porting</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> /e </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">/h</a>   </li>
	<li> <a href="http://cms01.phys.ntu.edu.tw/"> cms01 </a> </li>
	<li> <a href="http://cms01.phys.ntu.edu.tw/downloads/"> downloads </a> </li>
	<li> <a href="http://cms01.phys.ntu.edu.tw/rezdb/db/hfagc/"> rezdb/db/hfagc/ </a> </li>
</ul>






<h3>Content Skeleton</h3>

<ul>
<li class="toctree-l1"><a class="reference internal" href="../../SOP/">SOP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../log/end_of_2011/">LOG</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../heprez/">HEPREZ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../heprez/#heprez-usage-log">HEPREZ USAGE LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rezdb/">REZDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../compilation/">Compilation latex document</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../docs/math/">Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hepex/hepex/">Hepex Building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../future/">Future of b2c</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../environment/">Environment for heprez installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chiba/">Chiba</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chibatomcat/chibatomcat/">CHIBA TOMCAT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../batik/">Batik</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../inkscape/">Inkscape</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dvisvgm/">DVISVGM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../images/">Binary Image creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../backup/backup/">Partial Backup Machinery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../backup/part/build/">BACKUP ANT BUILD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../exist_/">LOW LEVEL EXIST USAGE FUNCTIONS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../exist/">exist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../macports/">macports</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">porting</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../kek/">KEK Port Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../b2mc_install/">b2mc installation notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scrape_iteration/">Scrape Interation on b2mc without Illustrator</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Broken Plot Splitting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#broken-plot-invalid-actually-broken-splitting">broken plot, [INVALID actually broken splitting]</a></li>
<li class="toctree-l3"><a class="reference internal" href="#broken-range-splitting-suspect-algorithm-edge-case">broken range splitting (suspect algorithm edge case)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fixed-cannot-view-cache-html-thru-xmldb-interface">[FIXED] cannot view cache html thru xmldb interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#identifying-the-issue">Identifying the issue</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#manual-edit-to-render-the-errant-div-invisible">manual edit to render the errant div invisible</a></li>
<li class="toctree-l4"><a class="reference internal" href="#make-that-edit-in-stylesheet">make that edit in stylesheet</a></li>
<li class="toctree-l4"><a class="reference internal" href="#works-after-moving-error-style-to-strip-metadata-xsl">works after moving error style to strip-metadata.xsl</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../empty_unit_error/">empty unit error</a></li>
<li class="toctree-l2"><a class="reference internal" href="../no_qtys_in_range/">[DEFER] No Qtys in range</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cannot_add_extra_errors/">[MAYBE FIXED] Cannot Add Extra Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../indices_compare_no_backup/">Indices Compare No Backups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/">Other issues and feature ideas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../server_migration/">Server Migration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../eperl/">eperl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../svg/">svg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scrape/">scrape</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/porting/broken_plot_splitting.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../scrape_iteration/"
                        title="previous chapter">Scrape Interation on b2mc without Illustrator</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../empty_unit_error/"
                        title="next chapter">empty unit error</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="broken-plot-splitting">
<h1>Broken Plot Splitting<a class="headerlink" href="#broken-plot-splitting" title="Permalink to this headline">¶</a></h1>
<p>In rare cases the plot split algoritm makes a bad split which has
no content in the 2nd plot, causing an errort text message SVG rather than a plot.</p>
<div class="section" id="broken-plot-invalid-actually-broken-splitting">
<h2>broken plot, [INVALID actually broken splitting]<a class="headerlink" href="#broken-plot-invalid-actually-broken-splitting" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first"><a class="reference external" href="http://130.87.106.59:8080/b2charm/end_of_2011/00201.html">http://130.87.106.59:8080/b2charm/end_of_2011/00201.html</a></p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://130.87.106.59:8080/b2charm/end_of_2011/03221.svg">http://130.87.106.59:8080/b2charm/end_of_2011/03221.svg</a></li>
<li>formerly such an issue was caused by excessive range, but seems not the case here</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><a class="reference external" href="http://130.87.106.59:8080/b2charm/end_of_2011/00109.html">http://130.87.106.59:8080/b2charm/end_of_2011/00109.html</a>  No qtys in range ?</p>
</li>
<li><p class="first">use HFAG_SCRAPE_FOLDER/log.xml to determine the dynamic call</p>
</li>
</ul>
<div class="highlight-python"><pre>b2mc:~ heprez$ grep 03221 $HFAG_SCRAPE_FOLDER/log.xml
&lt;get pos="03221"  status="NPPUCPNCPUSRNSR"  err="0"  time="0.137"  size="633"  pro-path="/Users/heprez/data/data/scrape/20130704/hfagc/00201/03221/03221.svg"  &gt;
&lt;uurl&gt;&lt;![CDATA[http://localhost:9090/hfagc/03221/plot/svg?sqz=0.3&amp;vmi=0.7033333333333333&amp;vmx=100000.0&amp;uni=1.0&amp;opt=plot,head,sabel,onlycom,nex,npo,dvi&amp;apt=save&amp;bpt=save]]&gt;&lt;/uurl&gt;</pre>
</div>
<ul>
<li><p class="first"><a class="reference external" href="http://130.87.106.59:9090/hfagc/03221/plot/svg?sqz=0.3&amp;vmi=0.7033333333333333&amp;vmx=100000.0&amp;uni=1.0&amp;opt=plot,head,sabel,onlycom,nex,npo,dvi&amp;apt=save&amp;bpt=save">http://130.87.106.59:9090/hfagc/03221/plot/svg?sqz=0.3&amp;vmi=0.7033333333333333&amp;vmx=100000.0&amp;uni=1.0&amp;opt=plot,head,sabel,onlycom,nex,npo,dvi&amp;apt=save&amp;bpt=save</a></p>
<blockquote>
<div><ul class="simple">
<li>this reproduces the text plot error message</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><a class="reference external" href="http://130.87.106.59:9090/hfagc/03211/plot/svg?sqz=0.3&amp;vmi=-100.0&amp;vmx=0.7033333333333333&amp;uni=1.0&amp;opt=plot,head,sabel,onlycom,nex,npo,dvi&amp;apt=save&amp;bpt=save">http://130.87.106.59:9090/hfagc/03211/plot/svg?sqz=0.3&amp;vmi=-100.0&amp;vmx=0.7033333333333333&amp;uni=1.0&amp;opt=plot,head,sabel,onlycom,nex,npo,dvi&amp;apt=save&amp;bpt=save</a></p>
<blockquote>
<div><ul class="simple">
<li>sibling plot is OK, seems the problem is an unneeded range split resulting in no qtys in the bad split range ?</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><a class="reference external" href="http://130.87.106.59:9090/hfagc/03211/plot/svg?sqz=0.7&amp;vmi=-100.0&amp;vmx=0.7033333333333333&amp;uni=1.0&amp;opt=plot,head,sabel,onlycom,nex,npo,dvi&amp;apt=save&amp;bpt=save">http://130.87.106.59:9090/hfagc/03211/plot/svg?sqz=0.7&amp;vmi=-100.0&amp;vmx=0.7033333333333333&amp;uni=1.0&amp;opt=plot,head,sabel,onlycom,nex,npo,dvi&amp;apt=save&amp;bpt=save</a></p>
<blockquote>
<div><ul class="simple">
<li>increasing <em>sqz</em> makes it easier to see the layout, spreading in y</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><a class="reference external" href="http://130.87.106.59:9090/hfagc/03211/plot/svg?sqz=0.7&amp;vmi=-100.0&amp;vmx=0.7033333333333333&amp;uni=1.0&amp;opt=plot,head,sabel,onlycom,nex,npo,dvi,dbg&amp;apt=save&amp;bpt=save">http://130.87.106.59:9090/hfagc/03211/plot/svg?sqz=0.7&amp;vmi=-100.0&amp;vmx=0.7033333333333333&amp;uni=1.0&amp;opt=plot,head,sabel,onlycom,nex,npo,dvi,dbg&amp;apt=save&amp;bpt=save</a></p>
<blockquote>
<div><ul class="simple">
<li>add <strong>dbg</strong> to <em>opt</em> gives detailed info in the metadata element, use Safari inspect element on the SVG to inspect this</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="broken-range-splitting-suspect-algorithm-edge-case">
<h2>broken range splitting (suspect algorithm edge case)<a class="headerlink" href="#broken-range-splitting-suspect-algorithm-edge-case" title="Permalink to this headline">¶</a></h2>
<p>A workaround of making the aflicted area invisible seems appropriate:</p>
<div class="highlight-python"><pre>&lt;div style="display:none;" &gt;</pre>
</div>
<ul class="simple">
<li><a class="reference external" href="http://130.87.106.59:9090/hfagc/00201/html?apt=save&amp;bpt=save">http://130.87.106.59:9090/hfagc/00201/html?apt=save&amp;bpt=save</a></li>
</ul>
<p>Lots of broken image links, but the bad split is apparent.</p>
<p>Trace, thru <a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/heprez/intertrac/source:trunk/hfag/mods/webapp/hfagc/sitemap.xmap.template">heprez:source:trunk/hfag/mods/webapp/hfagc/sitemap.xmap.template</a> at top level an aggregate of many other things off the cocoon pipeline:</p>
<div class="highlight-python"><pre>1038              &lt;map:match type="regexp" pattern="^(\d\{5})/(htm|html)$"&gt;                             &lt;!-- multi qty page --&gt;
1039                   &lt;map:aggregate element="book" label="sauce" &gt;
1040                        &lt;map:part src="cocoon:/{1}/bookinfo/{2}" element="bookinfo" strip-root="true" /&gt;
1041                        &lt;map:part src="cocoon:/{1}/sidebar/{2}"  element="sidebar" strip-root="true" ns="http://exist-db.org/NS/sidebar" prefix="sidebar" /&gt;
1042                        &lt;map:part src="cocoon:/{1}/comb/{2}"     element="chapter" strip-root="true" /&gt;
1043                        &lt;map:part src="cocoon:/{1}/table/{2}" element="chapter" strip-root="true" /&gt;  &lt;!-- remove table to get scrape working quickly --&gt;
1044                        &lt;map:part src="cocoon:/00000/key/{2}"     element="chapter" strip-root="true" /&gt;
1045                        &lt;map:part src="cocoon:/{1}/notes/{2}"    element="chapter" strip-root="true" /&gt;
1046                   &lt;/map:aggregate&gt;</pre>
</div>
<p>Like:</p>
<div class="highlight-python"><pre>826              &lt;map:match type="regexp" pattern="^(\d)(\d)(\d)(\d)(\d)/comb/(htm|html)$"&gt;   &lt;!-- multi qty chapter --&gt;
827                 &lt;map:generate src="modes-comb.xq" type="xquery" label="sauce"  &gt;
828                     &lt;map:parameter name="create-session" value="true"/&gt;
829                     &lt;map:parameter name="sm-quo"   value="{1}"/&gt;
830                     &lt;map:parameter name="sm-qwn"   value="{2}"/&gt;
831                     &lt;map:parameter name="sm-src"   value="{3}"/&gt;
832                     &lt;map:parameter name="sm-zer"   value="{4}"/&gt;
833                     &lt;map:parameter name="sm-pro"   value="{5}"/&gt;
834                     &lt;map:parameter name="sm-grp"   value="{1}{2}{3}{4}{5}"/&gt;
835                     &lt;map:parameter name="sm-pos"   value="{1}{2}{3}{4}{5}"/&gt;
836                     &lt;map:parameter name="sm-beg"   value="{1}{2}{3}{4}{5}/comb"/&gt;
837                     &lt;map:parameter name="sm-end"   value="{6}"/&gt;
838                     &lt;map:parameter name="sm-uri"   value="{0}"/&gt;
839                     &lt;map:parameter name="sm-hfag-scrape" value="{global:hfag-scrape}"/&gt;
840                     &lt;map:parameter name="sm-cache-scrape" value="{global:cache-scrape}"/&gt;
841                     &lt;map:parameter name="sm-dir" value="{global:cache-scrape}/{1}{2}{3}{4}{5}"/&gt;
842                     &lt;map:parameter name="sm-path" value="{global:cache-scrape}/{1}{2}{3}{4}{5}/comb.{6}"/&gt;
843                     &lt;map:parameter name="sm-prefix" value="{global:hfag-prefix}" /&gt;
844                     &lt;map:parameter name="sm-cnf"    value="{global:hfag-conf}" /&gt;
845                 &lt;/map:generate&gt;
846                 &lt;map:serialize type="xml"/&gt;
847             &lt;/map:match&gt;</pre>
</div>
<p>Note that the cache path is passed into the query from the sitemap as <strong>sm-path</strong></p>
<ul class="simple">
<li><a class="reference external" href="http://130.87.106.59:9090/xmldb/db/cache/hfagc/20130705/00201/">http://130.87.106.59:9090/xmldb/db/cache/hfagc/20130705/00201/</a></li>
</ul>
<p>Grab just the <em>comb</em> returns docbook xml with the issue apparent:</p>
<div class="highlight-python"><pre>b2mc:20130704 heprez$ curl -s "http://130.87.106.59:9090/hfagc/00201/comb/html?apt=save&amp;bpt=save" | xmllint --format -
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;div&gt;
  &lt;chapter xmlns:exist="http://exist.sourceforge.net/NS/exist" exist:id="1" exist:source="/db/cache/hfagc/20130704/00201/comb.html"&gt;
    &lt;chapter&gt;
      &lt;title&gt;Neutral B,new particles&lt;/title&gt;
      &lt;div&gt;
        &lt;metadata&gt;
        ...
         &lt;table border="1"&gt;
            &lt;tr&gt;
              &lt;td align="center"&gt;
                &lt;metadata papt="save:save::" is-indv="false" skip-get="true" src-path="/db/cache/hfagc/20130704/00201/03221/plot.svg" pend="html" narea="0" dynurl="http://localhost:9090/hfagc/03221/plot/svg?sqz=0.3&amp;amp;vmi=0.7033333333333333&amp;amp;vmx=100000.0&amp;amp;uni=1.0&amp;amp;opt=plot,head,sabel,onlycom,nex,npo,dvi&amp;amp;apt=save"/&gt;
                &lt;div&gt;
                  &lt;para&gt;present-plot:present-plot ERROR the image map is not available : /db/cache/hfagc/20130704/00201/03221/plot.svg&lt;/para&gt;
                  &lt;img width="600" height="198" src="03221.png"/&gt;
                &lt;/div&gt;
              &lt;/td&gt;
            &lt;/tr&gt;
          &lt;/table&gt;</pre>
</div>
<p>The <em>table</em> chapter, dumping some erros regarding unknown exist namespace prefix:</p>
<div class="highlight-python"><pre>b2mc:~ heprez$ curl -s "http://130.87.106.59:9090/hfagc/00201/table/html?apt=save&amp;bpt=save" | xmllint --format - 2&gt; /dev/null
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;chapter exist:id="1" exist:source="/db/cache/hfagc/20130705/00201/table.html"&gt;
  &lt;title&gt;Compilation  Latex Table&lt;/title&gt;
  &lt;metadata date="2013-07-05T13:10:52.099+09:00" time="1372997452099" table-src="/db/cache/hfagc/20130705/00201/00201/table.tml" msg="this presentation of the result table depends only on the table src, namely the tml"&gt;
    &lt;metalinks nraw="1" nbase="1"&gt;
      &lt;now stamp="1372997452099" modified="2013-07-05T13:10:52.099+09:00"/&gt;
      &lt;ulink url="/xmldb/db/cache/hfagc/20130705/00201/00201/table.tml" src-path="/db/cache/hfagc/20130705/00201/00201/table.tml" src-time="1372997453872" src-date="2013-07-05T13:10:53.872+09:00"&gt;/db/cache/hfagc/20130705/00201/00201/table.tml&lt;/ulink&gt;
    &lt;/metalinks&gt;
  &lt;/metadata&gt;
  &lt;table&gt;
    &lt;tr&gt;
      &lt;td&gt;
        &lt;table&gt;
        ....</pre>
</div>
<p>From <a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/heprez/intertrac/source:trunk/hfag/mods/webapp/hfagc/modes-comb.xq">heprez:source:trunk/hfag/mods/webapp/hfagc/modes-comb.xq</a> find that range debug info given by <cite>opt=rbg</cite></p>
<ul class="simple">
<li><a class="reference external" href="http://130.87.106.59:9090/hfagc/00201/html?apt=save&amp;bpt=save&amp;opt=rbg">http://130.87.106.59:9090/hfagc/00201/html?apt=save&amp;bpt=save&amp;opt=rbg</a></li>
</ul>
<div class="highlight-python"><pre>vi ./hfag/mods/webapp/hfagc/xquery/rezx.xqm ./hfag/mods/webapp/hfagc/modes-comb.xq</pre>
</div>
<div class="highlight-python"><pre>&lt;para&gt;
   &lt;dbg&gt;
     &lt;rnge&gt;-0.984 3.332 4.316 -0.265 1.000 2.612 -3.000 2.877 -1.000 0.410 1.000 0.410 1.000 0.700 0.700 -1.000 0.703 0.163&lt;/rnge&gt;
     &lt;args punit="1.0" nqts="2"&gt;BR:-511:-311,81*/BR:-521:-321,81 BR:-511:-311,83*/BR:-521:-321,83&lt;/args&gt;
     &lt;lhvi msg="left hand edges from avg cache, and their min" lhvix="-0.265"&gt;-0.080 -0.265 -0.080 -0.265 0.068 0.068&lt;/lhvi&gt;
     &lt;rhvi msg="right hand edges from avg cache, and their max" rhvix="2.612"&gt;0.900 2.612 0.900 2.612 1.525 1.525&lt;/rhvi&gt;
     &lt;chvi msg="central values from avg cache " cavg="0.703" cmin="0.410" cmax="1.000" crng="0.590"&gt;0.410 1.000 0.410 1.000 0.700 0.700&lt;/chvi&gt;
     &lt;pdgrng msg="incorp pdg ?" npdg="2" pdgfr="-1.1483466556119561"&gt;1.000 -3.000&lt;/pdgrng&gt;
     &lt;lha msg="lhs after pdg" lhv="-0.265 1.000"&gt;-0.265&lt;/lha&gt;
     &lt;rha msg="rhs after pdg" rhv="2.612 -3.000"&gt;2.612&lt;/rha&gt;
     &lt;xha msg="range after pdg" lha="-0.265" rha="2.612"&gt;2.877&lt;/xha&gt;
     &lt;xmargin xha="2.877"&gt;0.719&lt;/xmargin&gt;
     &lt;lhf msg="lha/xha  to zero fraction "&gt;-0.092&lt;/lhf&gt;
     &lt;chf msg="cmin/crng left hand center point fraction of range " chfsnap="0.25"&gt;0.695&lt;/chf&gt;
     &lt;lh msg="lhs after margin + zero snapping" cmin="0.410" lhf="-0.092"&gt;-0.984&lt;/lh&gt;
     &lt;rh msg="rhs after margin " cmax="1.000"&gt;3.332&lt;/rh&gt;
     &lt;ulh msg="ultimate lh"&gt;-0.984&lt;/ulh&gt;
     &lt;urh msg="ultimate rh"&gt;3.332&lt;/urh&gt;
   &lt;/dbg&gt;
 &lt;/para&gt;
 &lt;para&gt;regi:1 -100.0 0.7033333333333333
            2 0.7033333333333333 100000.0
       nreg:2
              ulh                  urh                 urh - ulh      [     lhv              ] [  rhv              ] [ rhv - lhv     ]      [ chvi                  ]         cavg              xspl
       rnge: -0.9842517174991172 3.3317922030914753 4.316043920590593 -0.26491106406735176 1.0 2.61245154965971 -3.0 2.877362613727062 -1.0 0.41 1.0 0.41 1.0 0.7 0.7 -1.0 0.7033333333333333 0.1629578721333057
       unit: 1.0
       nlins: 8 3 2 3


              0.70333333/4.316043920590593

&lt;/para&gt;</pre>
</div>
<div class="highlight-python"><pre>In [6]: 0.70333333/4.316043920590593       cavg/(urh - ulh) is less than $rezx:plot-split 0.2 causing the split .... how did the range get so wide, maybe an old value non-active value is sneaking in
Out[6]: 0.16295787136099352</pre>
</div>
</div>
<div class="section" id="fixed-cannot-view-cache-html-thru-xmldb-interface">
<h2>[FIXED] cannot view cache html thru xmldb interface<a class="headerlink" href="#fixed-cannot-view-cache-html-thru-xmldb-interface" title="Permalink to this headline">¶</a></h2>
<div class="sidebar">
<p class="first sidebar-title">Fixed by <a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/heprez/intertrac/r942">heprez:r942</a></p>
<p class="last">BUT there might be side effects</p>
</div>
<p>Get <cite>Resource not found</cite> errors for cached docbook.
This is due to poor naming of this docbook as <cite>.html</cite> that trips up the pipeline.
Maybe change the <cite>.html</cite> OR pipeline handling of <cite>.html</cite> within xmldb.</p>
<ul class="simple">
<li><a class="reference external" href="http://130.87.106.59:9090/xmldb/db/cache/hfagc/20130711/00201/">http://130.87.106.59:9090/xmldb/db/cache/hfagc/20130711/00201/</a></li>
<li><a class="reference external" href="http://130.87.106.59:9090/xmldb/db/cache/hfagc/20130711/00201/comb.html">http://130.87.106.59:9090/xmldb/db/cache/hfagc/20130711/00201/comb.html</a></li>
</ul>
</div>
<div class="section" id="identifying-the-issue">
<h2>Identifying the issue<a class="headerlink" href="#identifying-the-issue" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://130.87.106.59:9090/xmldb/db/cache/hfagc/20130711/00201/">http://130.87.106.59:9090/xmldb/db/cache/hfagc/20130711/00201/</a></p>
<div class="highlight-python"><pre>doc("comb.html")//metadata[@narea=0]

&lt;metadata exist:id ="1851018" exist:source ="/db/cache/hfagc/20130711/00201/comb.html" papt ="save:save::" is-indv ="false" skip-get ="false" src-path ="/db/cache/hfagc/20130711/00201/03221/plot.svg" pend ="html" narea ="0" dynurl ="http://localhost:9090/hfagc/03221/plot/svg?sqz=0.3&amp;vmi=0.7033333333333333&amp;vmx=100000.0&amp;uni=1.0&amp;opt=plot,head,sabel,onlycom,nex,npo,dvi&amp;apt=save" /&gt;</pre>
</div>
<p>the immediate table:</p>
<div class="highlight-python"><pre>doc("comb.html")//table[tr/td/metadata/@narea=0]

&lt;table exist:id ="92489" exist:source ="/db/cache/hfagc/20130711/00201/comb.html" border ="1" &gt;
&lt;tr &gt;
&lt;td align ="center" &gt;
&lt;metadata papt ="save:save::" is-indv ="false" skip-get ="false" src-path ="/db/cache/hfagc/20130711/00201/03221/plot.svg" pend ="html" narea ="0" dynurl ="http://localhost:9090/hfagc/03221/plot/svg?sqz=0.3&amp;vmi=0.7033333333333333&amp;vmx=100000.0&amp;uni=1.0&amp;opt=plot,head,sabel,onlycom,nex,npo,dvi&amp;apt=save" /&gt;
&lt;div &gt;
&lt;para &gt; present-plot:present-plot ERROR the image map is not available : /db/cache/hfagc/20130711/00201/03221/plot.svg &lt;/ para &gt;
&lt;img width ="600" height ="198" src ="03221.png" /&gt;
&lt;/ div &gt;
&lt;/ td &gt;
&lt;/ tr &gt;
&lt;/ table &gt;</pre>
</div>
<p>pluck the containing div that holds the empty region:</p>
<div class="highlight-python"><pre>doc("comb.html")//div[table/tr/td/table/tr/td/metadata/@narea=0]</pre>
</div>
<ul class="simple">
<li><a class="reference external" href="http://130.87.106.59:9090/xmldb/db/cache/hfagc/20130711/00201/comb.html">http://130.87.106.59:9090/xmldb/db/cache/hfagc/20130711/00201/comb.html</a> combined presentation cache, incorporates the below</li>
<li><a class="reference external" href="http://130.87.106.59:9090/xmldb/db/cache/hfagc/20130711/00201/03221/plot.html">http://130.87.106.59:9090/xmldb/db/cache/hfagc/20130711/00201/03221/plot.html</a> plot presentation cache for single region</li>
</ul>
<div class="section" id="manual-edit-to-render-the-errant-div-invisible">
<h3>manual edit to render the errant div invisible<a class="headerlink" href="#manual-edit-to-render-the-errant-div-invisible" title="Permalink to this headline">¶</a></h3>
<p>For checking better to use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">style</span><span class="o">=</span><span class="s">&quot;background-color:grey;&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><pre>b2mc:20130711 heprez$ vi ./hfagc/00201/00201.html

510 &lt;div ireg="2"  style="display:none;" &gt;
511 &lt;table&gt;
512 &lt;tr&gt;
513 &lt;td&gt;(&lt;/td&gt;&lt;td&gt;0.703&lt;/td&gt;&lt;td&gt;&amp;lt;&lt;/td&gt;&lt;td&gt;values&lt;/td&gt;&lt;td&gt;)&lt;/td&gt;
514 &lt;/tr&gt;
515 &lt;/table&gt;
516 &lt;table date="2013-07-11T20:48:10.961+09:00" sm-path="/db/cache/hfagc/20130711/00201/03221/plot.html" &gt;
517 &lt;tr&gt;
518 &lt;td&gt;
519 &lt;table&gt;
520 &lt;tr&gt;
521 &lt;td&gt;&lt;a href="03221.svg"&gt;SVG&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="03221.pdf"&gt;PDF&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="03221.png"&gt;PNG&lt;/a&gt;&lt;/td&gt;
522 &lt;/tr&gt;
523 &lt;/table&gt;</pre>
</div>
</div>
<div class="section" id="make-that-edit-in-stylesheet">
<h3>make that edit in stylesheet<a class="headerlink" href="#make-that-edit-in-stylesheet" title="Permalink to this headline">¶</a></h3>
<p>Try to apply this edit via <cite>hfag/mods/webapp/hfagc/stylesheets/db2html-scb.xsl</cite>:</p>
<div class="highlight-python"><pre>030 &lt;xsl:param name="sm-errstyle" &gt;background-color:grey;&lt;/xsl:param&gt;

624
625    &lt;xsl:template match="div[table/tr/td/table/tr/td/metadata/@narea=0]" &gt;
626         &lt;div&gt;
627             &lt;xsl:attribute name="style"&gt;&lt;xsl:value-of select="$sm-errstyle" /&gt;&lt;/xsl:attribute&gt;
628             &lt;xsl:apply-templates/&gt;
629         &lt;/div&gt;
630    &lt;/xsl:template&gt;</pre>
</div>
<p>Testing with <a class="reference external" href="http://130.87.106.59:9090/hfagc/00201/html?apt=save&amp;bpt=save">http://130.87.106.59:9090/hfagc/00201/html?apt=save&amp;bpt=save</a> it failed to apply.</p>
<p>Doing the transform stanfalone works howevee:</p>
<div class="highlight-python"><pre>b2mc:logs heprez$ mkdir /tmp/k
b2mc:logs heprez$ curl http://localhost:9090/servlet/db/cache/hfagc/20130711/00201/comb.html -o /tmp/k/comb.xml

b2mc:logs heprez$ find $EXIST_HOME -name db2html-scb.xsl
/Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4/webapp/hfagc/stylesheets/db2html-scb.xsl

b2mc:logs heprez$ xsltproc $xsl /tmp/k/comb.xml &gt; /Users/heprez/data/data/scrape/20130711/hfagc/00201/00201.html</pre>
</div>
<p>Aha, was not applying as the metadata was stripped in the step before, retaining metadata with <strong>met=yes</strong> succeeds to apply</p>
<ul class="simple">
<li><a class="reference external" href="http://130.87.106.59:9090/hfagc/00201/html?apt=save&amp;bpt=save&amp;met=yes">http://130.87.106.59:9090/hfagc/00201/html?apt=save&amp;bpt=save&amp;met=yes</a></li>
</ul>
</div>
<div class="section" id="works-after-moving-error-style-to-strip-metadata-xsl">
<h3>works after moving error style to strip-metadata.xsl<a class="headerlink" href="#works-after-moving-error-style-to-strip-metadata-xsl" title="Permalink to this headline">¶</a></h3>
<p>Leaving as red for now, for a full scrape check.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../empty_unit_error/" title="empty unit error"
             >next</a> |</li>
        <li class="right" >
          <a href="../scrape_iteration/" title="Scrape Interation on b2mc without Illustrator"
             >previous</a> |</li>
        <li><a href="../../">Heprez Unversioned directory documentation</a> &raquo;</li>
          <li><a href="../" >porting</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>