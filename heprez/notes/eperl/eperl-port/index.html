<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>EMBEDDED PERL ON b2mc &mdash; Heprez Unversioned directory documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'Unversioned directory',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Heprez Unversioned directory documentation" href="../../" />
    <link rel="up" title="eperl" href="../" />
    <link rel="next" title="PERL EMBEDDED INTO JAVA" href="../eperl/" />
    <link rel="prev" title="EPERL ANT BUILD" href="../build/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../eperl/" title="PERL EMBEDDED INTO JAVA"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../build/" title="EPERL ANT BUILD"
             accesskey="P">previous</a> |</li>
        <li><a href="../../">Heprez Unversioned directory documentation</a> &raquo;</li>
          <li><a href="../" accesskey="U">eperl</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> /e </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">/h</a>   </li>
	<li> <a href="http://cms01.phys.ntu.edu.tw/"> cms01 </a> </li>
	<li> <a href="http://cms01.phys.ntu.edu.tw/downloads/"> downloads </a> </li>
	<li> <a href="http://cms01.phys.ntu.edu.tw/rezdb/db/hfagc/"> rezdb/db/hfagc/ </a> </li>
</ul>






<h3>Content Skeleton</h3>

<ul>
<li class="toctree-l1"><a class="reference internal" href="../../SOP/">SOP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../log/end_of_2011/">LOG</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../heprez/">HEPREZ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../heprez/#heprez-usage-log">HEPREZ USAGE LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rezdb/">REZDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../compilation/">Compilation latex document</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../docs/math/">Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hepex/hepex/">Hepex Building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../future/">Future of b2c</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../environment/">Environment for heprez installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chiba/">Chiba</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chibatomcat/chibatomcat/">CHIBA TOMCAT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../batik/">Batik</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../inkscape/">Inkscape</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dvisvgm/">DVISVGM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../images/">Binary Image creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../backup/backup/">Partial Backup Machinery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../backup/part/build/">BACKUP ANT BUILD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../exist_/">LOW LEVEL EXIST USAGE FUNCTIONS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../exist/">exist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../macports/">macports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../porting/">porting</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">eperl</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../build/">EPERL ANT BUILD</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">EMBEDDED PERL ON b2mc</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#missing-eperllib">Missing EPerlLib</a></li>
<li class="toctree-l3"><a class="reference internal" href="#segfault-exist-server">Segfault exist server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#jni-segfault">JNI Segfault</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#can-i-replace-eperl-with-something-barebones">CAN I REPLACE EPERL WITH SOMETHING BAREBONES ?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#perl-scripts-used-from-xqueries-via-iperl-eperlscript-function">Perl scripts used from XQueries via <em>iperl:eperlscript</em> function</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../eperl/">PERL EMBEDDED INTO JAVA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../svg/">svg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scrape/">scrape</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/eperl/eperl-port.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../build/"
                        title="previous chapter">EPERL ANT BUILD</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../eperl/"
                        title="next chapter">PERL EMBEDDED INTO JAVA</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="embedded-perl-on-b2mc">
<h1>EMBEDDED PERL ON b2mc<a class="headerlink" href="#embedded-perl-on-b2mc" title="Permalink to this headline">¶</a></h1>
<div class="section" id="missing-eperllib">
<h2>Missing EPerlLib<a class="headerlink" href="#missing-eperllib" title="Permalink to this headline">¶</a></h2>
<p>from exist-start stdout during <em>heprez-update</em>  JNI issues</p>
<div class="highlight-python"><pre>...
Method 0:       2.92 +/-   0.04
Method 2:       2.92 ( +0.04  -0.04)
out to java
2.922532912058983
0.04333196209914236
-0.043331962099143695
hits: 934163; misses: 642; thrashing: 3; thrashing: 3
hits: 1885718; misses: 120; thrashing: 1; thrashing: 1
log4j: rolling over count=5002068
log4j: maxBackupIndex=1
log4j: Renaming file /Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4/webapp/WEB-INF/logs/exist.log to /Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4/webapp/WEB-INF/logs/exist.log.1
log4j: setFile called: /Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4/webapp/WEB-INF/logs/exist.log, false
log4j: setFile ended
log4j: rolling over count=5000827
log4j: maxBackupIndex=1
log4j: Renaming file /Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4/webapp/WEB-INF/logs/exist.log to /Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4/webapp/WEB-INF/logs/exist.log.1
log4j: setFile called: /Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4/webapp/WEB-INF/logs/exist.log, false
log4j: setFile ended
hits: 1194034; misses: 972; thrashing: 4; thrashing: 4
no EPerlLib in java.library.path /Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4/lib/native
eperl.InterpreterException no EPerlLib in java.library.path, /Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4/lib/native
27 Jun 2013 19:13:08,812 [P1-9] WARN  (ServletHandler.java [handle]:574) - Error for /hfagc/00101/html?apt=save&amp;bpt=save
java.lang.UnsatisfiedLinkError: eperl.jni.PerlInterpreter.allocate(I)V
    at eperl.jni.PerlInterpreter.allocate(Native Method)
    at eperl.jni.PerlInterpreter.constructor(Unknown Source)
    at eperl.jni.PerlInterpreter.&lt;init&gt;(Unknown Source)
    at eperl.util.EPerlScript.&lt;init&gt;(Unknown Source)
    at eperl.util.EPerlScript.getInstance(Unknown Source)
    at org.hfag.util.EPerlScriptAdapter.&lt;init&gt;(EPerlScriptAdapter.java:142)
    at org.hfag.xquery.modules.iperl.EPerlScriptFunction.eval(EPerlScriptFunction.java:121)
    at org.exist.xquery.BasicFunction.eval(BasicFunction.java:52)
    at org.exist.xquery.PathExpr.eval(PathExpr.java:144)</pre>
</div>
<p>java.lang.UnsatisfiedLinkError:</p>
<div class="highlight-python"><pre>at org.mortbay.http.HttpConnection.handle(HttpConnection.java:846)
at org.mortbay.http.SocketListener.handleConnection(SocketListener.java:244)
at org.mortbay.util.ThreadedServer.handle(ThreadedServer.java:345)
at org.mortbay.util.ThreadPool$PoolThread.run(ThreadPool.java:530)
27 Jun 2013 19:13:10,551 [P1-9] WARN  (ServletHandler.java [handle]:574) - Error for /hfagc/00102/html?apt=save&amp;bpt=save
java.lang.UnsatisfiedLinkError: eperl.jni.PerlInterpreter.allocate(I)V
at eperl.jni.PerlInterpreter.allocate(Native Method)
at eperl.jni.PerlInterpreter.constructor(Unknown Source)
at eperl.jni.PerlInterpreter.&lt;init&gt;(Unknown Source)
at eperl.util.EPerlScript.&lt;init&gt;(Unknown Source)
at eperl.util.EPerlScript.getInstance(Unknown Source)
at org.hfag.util.EPerlScriptAdapter.&lt;init&gt;(EPerlScriptAdapter.java:142)
at org.hfag.xquery.modules.iperl.EPerlScriptFunction.eval(EPerlScriptFunction.java:121)
at org.exist.xquery.BasicFunction.eval(BasicFunction.java:52)
at org.exist.xquery.PathExpr.eval(PathExpr.java:144)
at org.exist.xquery.DynamicCardinalityCheck.eval(DynamicCardinalityCheck.java:63)
at org.exist.xquery.functions.util.CatchFunction.eval(CatchFunction.java:74)
at org.exist.xquery.PathExpr.eval(PathExpr.java:144)</pre>
</div>
<p>can tickle with:</p>
<div class="highlight-python"><pre>b2mc:~ heprez$ curl "http://localhost:9090/hfagc/00101/html?apt=save&amp;bpt=save"</pre>
</div>
<div class="highlight-python"><pre>== exist-start : with JAVA_OPTIONS
-Xms512M
-Xmx1024M
-Dfile.encoding=UTF-8
-Dwebapp.home=/Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4
-Dlog4j.debug=
-Dlog4j.configuration=file:///Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4/log4j.xml
-Djava.library.path=/Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4/lib/native
-Dperl.script.path=/Users/heprez/data/install/eperl/scripts/tpdflatex.pl
-Dhfag.scrape=
-Dhfag.images.folder=/Users/heprez/data/data/images/apache
-Dlocal.admin.passwd=censored
-Djava.awt.headless=true</pre>
</div>
<p>No natives:</p>
<div class="highlight-python"><pre>b2mc:~ heprez$ ll /Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4/lib/native/
total 0
drwxr-xr-x  8 heprez  staff  272 Mar 20 18:26 ..
drwxr-xr-x  2 heprez  staff   68 Mar 20 18:26 .
b2mc:~ heprez$</pre>
</div>
<p>From <em>exist-start</em>:</p>
<div class="highlight-python"><pre>export JAVA_OPTIONS=$(cat &lt;&lt; EOO
   $jvm -Dfile.encoding=UTF-8 $EXIST_JVM_EXTRA
  -Dwebapp.home=$EXIST_HOME
  -Dlog4j.debug=
  -Dlog4j.configuration=file://$EXIST_HOME/log4j.xml
  -Djava.library.path=$EXIST_HOME/lib/native
  -Dperl.script.path=$HEPREZ_INSTALL/eperl/scripts/tpdflatex.pl
  -Dhfag.scrape=$HFAG_SCRAPE
  -Dhfag.images.folder=$HFAG_IMAGES_FOLDER
  -Dlocal.admin.passwd=$LOCAL_ADMIN_PASSWD
  -Djava.awt.headless=true
EOO);</pre>
</div>
<p>From G:</p>
<div class="highlight-python"><pre>simon:~ blyth$ heprez-
simon:~ blyth$ exist-
simon:~ blyth$ ll $EXIST_HOME/lib/native/
total 2632
drwxr-xr-x  8 blyth  admin      272 19 May  2009 ..
-rw-r--r--  1 blyth  admin  1346880  4 Feb  2010 libEPerlLib.jnilib
drwxr-xr-x  3 blyth  admin      102  4 Feb  2010 .</pre>
</div>
<p>The K build is deficient. Due to non-ppc the is-darwin flag was not set and
part of <em>eperl-build</em> was missing.:</p>
<div class="highlight-python"><pre>b2mc:~ heprez$ eperl-build
=== eperl-build :
=== cpptasks-get : jar /Users/heprez/data/install/ant/cpptasks-1.0b5/target/lib/cpptasks.jar exists already
=== cpptasks-get : lrwxr-xr-x 1 heprez staff 69 Mar 19 20:02 cpptasks.jar -&gt; /Users/heprez/data/install/ant/cpptasks-1.0b5/target/lib/cpptasks.jar
=== cpptasks-get : -rw-r--r-- 1 heprez staff 363944 Mar 19 20:02 /Users/heprez/data/install/ant/cpptasks-1.0b5/target/lib/cpptasks.jar
=== junit-get : this is used by the eperl build
=== log4j-get : this is used by the eperl build
Buildfile: build.xml

perl-place:
     [echo] placing perl modules ready for inclusion in the jar
     [echo] placing perl modules ready for file system reads, flexible during development

example:
     [echo] EPerl: /Users/heprez/heprez/eperl/build.xml

init:

jar:

java-compile:
     [echo] EPerl: /Users/heprez/heprez/eperl/build.xml

jni-headers:
    [javah] [Search path = /System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Classes/jsfd.jar:/System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Classes/classes.jar:/System/Library/Frameworks/JavaVM.framework/Frameworks/JavaRuntimeSupport.framework/Resources/Java/JavaRuntimeSupport.jar:/System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Classes/ui.jar:/System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Classes/laf.jar:/System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Classes/sunrsasign.jar:/System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Classes/jsse.jar:/System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Classes/jce.jar:/System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Classes/charsets.jar:/Users/heprez/data/install/log4j/log4j.jar:/Users/heprez/data/install/junit/junit.jar:/tmp/eperl.build/classes]
    [javah] [Loaded /tmp/eperl.build/classes/eperl/jni/PerlInterpreter.class]
    [javah] [Loaded /System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Classes/classes.jar(java/lang/Object.class)]
    [javah] [Loaded /tmp/eperl.build/classes/eperl/collections/StringArray.class]
    [javah] [Loaded /tmp/eperl.build/classes/eperl/collections/StringHash.class]
    [javah] [No need to update file /tmp/eperl.build/headers/eperl_jni_PerlInterpreter.h]

cpp-compile-darwin:
       [cc] Starting dependency analysis for 1 files.
       [cc] 1 files are up to date.
       [cc] 0 files to be recompiled from dependency analysis.
       [cc] 1 total files to be compiled.
       [cc] /Users/heprez/heprez/eperl/src/cpp/EPerlInterpreter_jni.cpp:7:17: error: jni.h: No such file or directory
       [cc] In file included from /Users/heprez/heprez/eperl/src/cpp/EPerlInterpreter_jni.cpp:12:
       [cc] /Users/heprez/heprez/eperl/src/cpp/JniUtility.h:8: error: 'jni::ConvJString' declared as an 'inline' variable
       [cc] /Users/heprez/heprez/eperl/src/cpp/JniUtility.h:8: error: 'JNIEnv' was not declared in this scope
       [cc] /Users/heprez/heprez/eperl/src/cpp/JniUtility.h:8: error: 'env' was not declared in this scope
       [cc] /Users/heprez/heprez/eperl/src/cpp/JniUtility.h:8: error: expected primary-expression before 'const'
       [cc] /Users/heprez/heprez/eperl/src/cpp/JniUtility.h:8: error: initializer expression list treated as compound expression</pre>
</div>
<p>On G:</p>
<div class="highlight-python"><pre>simon:e blyth$  echo $JAVA_HOME

simon:e blyth$ java-
simon:e blyth$  echo $JAVA_HOME
/Library/Java/Home
simon:e blyth$
simon:e blyth$ ll $JAVA_HOME/include/
total 488
drwxr-xr-x   8 root  wheel    272  7 Dec  2007 ..
-rw-r--r--   1 root  wheel  64940 11 Aug  2009 jvmti.h
-rw-r--r--   1 root  wheel  22210 11 Aug  2009 jvmpi.h
-rw-r--r--   1 root  wheel  39354 11 Aug  2009 jvmdi.h
-rw-r--r--   1 root  wheel    468 11 Aug  2009 jni_md.h
-rw-r--r--   1 root  wheel  68529 11 Aug  2009 jni.h
-rw-r--r--   1 root  wheel   5926 11 Aug  2009 jdwpTransport.h
-rw-r--r--   1 root  wheel    490 11 Aug  2009 jawt_md.h
-rw-r--r--   1 root  wheel   8498 11 Aug  2009 jawt.h
-rw-r--r--   1 root  wheel  10052 11 Aug  2009 JDWPCommands.h
-rw-r--r--   1 root  wheel   1701 11 Aug  2009 JDWP.h
-rw-r--r--   1 root  wheel    472 11 Aug  2009 AWTCocoaComponent.h
drwxr-xr-x  13 root  wheel    442 12 Sep  2009 .
simon:e blyth$</pre>
</div>
<p>On K, the java headers have moved:</p>
<div class="highlight-python"><pre>b2mc:~ heprez$ echo $JAVA_HOME
/Library/Java/Home
b2mc:~ heprez$ ll $JAVA_HOME/include/
ls: /Library/Java/Home/include/: No such file or directory
b2mc:~ heprez$

b2mc:~ heprez$ ll /System/Library/Frameworks/JavaVM.framework/Headers/
total 408
-rw-r--r--   1 root  wheel  77539 Nov  8  2011 jvmti.h
-rw-r--r--   1 root  wheel    507 Nov  8  2011 jni_md.h
-rw-r--r--   1 root  wheel  68336 Nov  8  2011 jni.h
-rw-r--r--   1 root  wheel   5926 Nov  8  2011 jdwpTransport.h
-rw-r--r--   1 root  wheel   1987 Nov  8  2011 jawt_md.h
-rw-r--r--   1 root  wheel   8498 Nov  8  2011 jawt.h
-rw-r--r--   1 root  wheel   2060 Nov  8  2011 NSJavaVirtualMachine.h
-rw-r--r--   1 root  wheel   2390 Nov  8  2011 NSJavaConfiguration.h
-rw-r--r--   1 root  wheel    179 Nov  8  2011 JavaVM.h
-rw-r--r--   1 root  wheel  11217 Nov  8  2011 JDWPCommands.h
-rw-r--r--   1 root  wheel   1708 Nov  8  2011 JDWP.h
-rw-r--r--   1 root  wheel    472 Nov  8  2011 AWTCocoaComponent.h
drwxr-xr-x  14 root  wheel    476 Nov  8  2011 .
drwxr-xr-x   8 root  wheel    272 Sep  6  2012 ..
b2mc:~ heprez$</pre>
</div>
<ul class="simple">
<li><a class="reference external" href="https://discussions.apple.com/thread/2630649?start=0&amp;tstart=0">https://discussions.apple.com/thread/2630649?start=0&amp;tstart=0</a></li>
</ul>
<p>Missing &#8220;$PERL_CORE/../auto/DynaLoader/DynaLoader.a&#8221; on K:</p>
<div class="highlight-python"><pre>b2mc:~ heprez$ ll $PERL_CORE/../auto/DynaLoader/
total 32
-r--r--r--   1 root  admin  2970 Apr 19 15:12 dl_findfile.al
-r--r--r--   1 root  admin   505 Apr 19 15:12 dl_find_symbol_anywhere.al
-r--r--r--   1 root  admin  1115 Apr 19 15:12 dl_expandspec.al
-r--r--r--   1 root  admin   181 Apr 19 15:12 autosplit.ix
drwxr-xr-x  38 root  admin  1292 Jun 21 17:49 ..
drwxr-xr-x   6 root  admin   204 Jun 21 17:49 .</pre>
</div>
<ul class="simple">
<li><a class="reference external" href="http://www.google.com/search?q=OSX ../auto/DynaLoader/DynaLoader.a">google:OSX ../auto/DynaLoader/DynaLoader.a</a></li>
</ul>
<div class="highlight-python"><pre>simon:~ blyth$ /usr/bin/perlsystem -MExtUtils::Embed -e ldopts
  -arch ppc -arch i386 -L/usr/local/lib /System/Library/Perl/5.8.8/darwin-thread-multi-2level/auto/DynaLoader/DynaLoader.a -L/System/Library/Perl/5.8.8/darwin-thread-multi-2level/CORE -lperl -ldl -lm -lutil -lc

b2mc:eperl heprez$ perl -MExtUtils::Embed -e ldopts
  -L/opt/local/lib  -fstack-protector  -L/opt/local/lib/perl5/5.12.4/darwin-thread-multi-2level/CORE -lperl -ldl -lm -lutil -lc

b2mc:eperl heprez$ /usr/bin/perl -MExtUtils::Embed -e ldopts
  -arch x86_64 -arch i386 -fstack-protector -L/usr/local/lib  -L/System/Library/Perl/5.12/darwin-thread-multi-2level/CORE -lperl -ldl -lm -lutil -lc</pre>
</div>
</div>
<div class="section" id="segfault-exist-server">
<h2>Segfault exist server<a class="headerlink" href="#segfault-exist-server" title="Permalink to this headline">¶</a></h2>
<p>Succeed to build the libs with <a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/heprez/intertrac/r903">heprez:r903</a> but segfaulting:</p>
<div class="highlight-python"><pre>b2mc:eperl heprez$ curl "http://localhost:9090/hfagc/00101/html?apt=save&amp;bpt=save"
curl: (52) Empty reply from server
b2mc:eperl heprez$</pre>
</div>
<p>The JNI call from eperl causes the server to segfault:</p>
<div class="highlight-python"><pre>28 Jun 2013 17:33:03,260 [main] INFO  (AJP13Listener.java [start]:143) - NOTICE: AJP13 is not a secure protocol. Please protect the port 0.0.0.0:9009
28 Jun 2013 17:33:03,260 [main] INFO  (HttpServer.java [start]:690) - Started org.mortbay.jetty.Server@7f6877f8
Loading mime table from file /Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4/mime-types.xml
Invalid memory access of location 0xffffffffffffffff rip=0x116e1da84
/Users/heprez/data/install/exist/eXist-snapshot-20051026/unpack/4/bin/startup.sh: line 50: 88749 Segmentation fault: 11  $JAVA_CMD $JAVA_OPTIONS $OPTIONS -Djava.endorsed.dirs=$JAVA_ENDORSED_DIRS -jar "$EXIST_HOME/start.jar" jetty $*
b2mc:~ heprez$</pre>
</div>
<div class="section" id="jni-segfault">
<h3>JNI Segfault<a class="headerlink" href="#jni-segfault" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>reproduce the segfault outside of server environment with <em>eperl-check</em></li>
</ul>
<p>Segmenting on the first native call</p>
<div class="highlight-python"><pre>401   protected native void allocate(int interpreterId)
402           throws InterpreterException;
403</pre>
</div>
</div>
</div>
<div class="section" id="can-i-replace-eperl-with-something-barebones">
<h2>CAN I REPLACE EPERL WITH SOMETHING BAREBONES ?<a class="headerlink" href="#can-i-replace-eperl-with-something-barebones" title="Permalink to this headline">¶</a></h2>
<p>For example, just open a pipe to the run the perl script rather than
bothering to compile em together.</p>
<div class="highlight-python"><pre>b2mc:~ heprez$ cd ~/h/hfag/extensions/src/org/hfag/xquery/modules/iperl/
b2mc:iperl heprez$ l
total 48
-rw-r--r--  1 heprez  staff  5425 Mar 18 12:16 EPerlScriptFunction.java
-rw-r--r--  1 heprez  staff  4978 Mar 18 12:16 PerlFunction.java
-rw-r--r--  1 heprez  staff   898 Mar 18 12:16 PerlModule.java
-rw-r--r--  1 heprez  staff  2249 Mar 18 12:16 PerlSubFunction.java</pre>
</div>
<p>EPerlScriptFunction.java:</p>
<div class="highlight-python"><pre>54     public final static FunctionSignature signature =
55         new FunctionSignature(
56             new QName("eperlscript", PerlModule.NAMESPACE_URI, PerlModule.PREFIX),
57             " convert tex, obtained from url to pdf and png returing XML log of actions ",</pre>
</div>
<ul class="simple">
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/env/intertrac//java/runtime">env:/java/runtime</a></li>
</ul>
<div class="section" id="perl-scripts-used-from-xqueries-via-iperl-eperlscript-function">
<h3>Perl scripts used from XQueries via <em>iperl:eperlscript</em> function<a class="headerlink" href="#perl-scripts-used-from-xqueries-via-iperl-eperlscript-function" title="Permalink to this headline">¶</a></h3>
<p><em>hfag/mods/webapp/hfagc/xquery/present-table.xqm</em>:</p>
<div class="highlight-python"><pre>125         let $params :=  if( $do-pdflatex ) then
126
127             &lt;parameters&gt;
128                 &lt;subname&gt;tpdflatex&lt;/subname&gt;
129                 &lt;urlbody&gt;{concat(  $rezu:dev-base-url , $ctx , "/table_body/tex",$reqpar)}&lt;/urlbody&gt;
130                 &lt;urlshell&gt;{concat( $rezu:dev-base-url , $ctx , "/table_/tex",$reqpar)}&lt;/urlshell&gt;
131                 &lt;workdir&gt;{$majordir}&lt;/workdir&gt;
132                 &lt;user&gt;admin&lt;/user&gt;
133                 &lt;passwd&gt;{$uppas}&lt;/passwd&gt;
134                 &lt;logfold&gt;{$logdir}&lt;/logfold&gt;
135                 &lt;logname&gt;{$logname}&lt;/logname&gt;
136                 &lt;opt&gt;{$popt}&lt;/opt&gt;
137                 &lt;apt&gt;{$uapt}&lt;/apt&gt;
138             &lt;/parameters&gt;
139
140                 else
141                                     ()
...
235              (: see ~/heprez/hfag/extensions/src/org/hfag/util/EPerlScriptAdapter.java :)
236
237          let $tpdflatex := if( not(empty($params))) then
238                     &lt;tpdflatex&gt;
239                     {
240                         util:catch("java.lang.Exception",
241                                 iperl:eperlscript( $params )
242                                 ,x:error-table(
243                                    ("Exception in iperl:eperlscript bad passwd ? cannot create log folder ? ",$util:exception-message ))
244                         )
245                     }
246                 &lt;/tpdflatex&gt;
247                  else
248                     x:info-table(( "No update required ", concat("papt:",string-join($papt,":") ) ))
249
250</pre>
</div>
<p>The <em>h/hfag/extensions/src/org/hfag/xquery/modules/iperl/EPerlScriptFunction.java</em></p>
<ol class="arabic simple">
<li>translates the <em>parameters</em> node argument of the function into a java.lang.Properties object <em>pars</em></li>
<li><em>pars</em> is passed to the <em>EPerlScriptAdapter</em> which performs the script actions when execute is called</li>
<li>an xml log document is written into the XMLDB following the execution, to the path returned by the execute</li>
</ol>
<div class="highlight-python"><pre>120
121         EPerlScriptAdapter epsa = new EPerlScriptAdapter( pars , context );
122         String path = epsa.execute();
123
124</pre>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../eperl/" title="PERL EMBEDDED INTO JAVA"
             >next</a> |</li>
        <li class="right" >
          <a href="../build/" title="EPERL ANT BUILD"
             >previous</a> |</li>
        <li><a href="../../">Heprez Unversioned directory documentation</a> &raquo;</li>
          <li><a href="../" >eperl</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>