<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>G4DAEView Ideas &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>
 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pycuda/">pycuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../geant4/">geant4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hg/">hg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../simoncblyth.bitbucket.org/">simoncblyth.bitbucket.org</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../numpy/">numpy</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/g4daeview/g4daeview_ideas.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="g4daeview-ideas">
<h1>G4DAEView Ideas<a class="headerlink" href="#g4daeview-ideas" title="Permalink to this headline">¶</a></h1>
<div class="section" id="json-state-vending">
<h2>JSON State vending<a class="headerlink" href="#json-state-vending" title="Permalink to this headline">¶</a></h2>
<p>It would be useful for g4daeview.py to vend some JSON regarding current high level state
over ZMQ or UDP ? EG for interoperation with an ipython session.</p>
<ul class="simple">
<li>are communicating JSON metadata over ZMQ already, but this only flows with the
photon propagation request/response</li>
</ul>
</div>
<div class="section" id="tight-zooming-not-easy">
<h2>Tight zooming not easy<a class="headerlink" href="#tight-zooming-not-easy" title="Permalink to this headline">¶</a></h2>
<p>Tight zooming (eg viewing steps propagating thru the acrylic surfaces)
is difficult as bookmarking cause view jumps.</p>
</div>
<div class="section" id="attempts-to-do-rotation-interpolation-with-no-geometry-visible-cause-nan-fails">
<h2>Attempts to do rotation interpolation with no geometry visible cause NaN fails<a class="headerlink" href="#attempts-to-do-rotation-interpolation-with-no-geometry-visible-cause-nan-fails" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="during-vbo-structural-changes">
<h2>During VBO structural changes<a class="headerlink" href="#during-vbo-structural-changes" title="Permalink to this headline">¶</a></h2>
<p>Avoid VBO comparison assertions using <cite>&#8211;wipepropagate</cite> to delete any
preexisting persisted propagation files, rather that compare against them
and assert on differences:</p>
<div class="highlight-python"><pre>g4daeview.sh --with-chroma --load 1 --debugkernel --wipepropagate</pre>
</div>
<p>Some rare discrepancies in material codes have been observered
between propagations see <a class="reference internal" href="../propagated_flags_mismatch/"><em>Propagated Flags Mismatch</em></a></p>
</div>
<div class="section" id="live-style-change-issues-fixed">
<h2>Live Style Change issues FIXED<a class="headerlink" href="#live-style-change-issues-fixed" title="Permalink to this headline">¶</a></h2>
<p>Formerly could not make style transitions in some directions. In particular
styles that use geometry shaders (noodles, movie) cannot be transitioned to from
styles that do not. Actually the transition happens without error but a blank render results.</p>
<p>This was fixed by moving to keeping GLSL shaders around and swapping between them
rather than attempting to delete shaders.</p>
</div>
<div class="section" id="step-interpolation-visualization-implemented">
<h2>Step Interpolation Visualization IMPLEMENTED<a class="headerlink" href="#step-interpolation-visualization-implemented" title="Permalink to this headline">¶</a></h2>
<p>Keeping multiple propagation steps in the VBO at once provides an interesting
visualization possibility.</p>
<ol class="arabic simple">
<li>Run the propagation at event load to a fixed maximum number of steps<ul>
<li>in propagate_vbo.cu store the step results into the vbo in slots by step number</li>
<li>within the pre-draw DAEPhotonsRenderer/DAEPhotonsKernel CUDA call calculate
photon parameters based on an input &#8220;time&#8221; constant (that can be varied
forwards and backwards interactively)<ul>
<li>find the pair of steps whose times straddle the input time and
use linear interpolation to calculate the photon position at that time,
lay down the result into a slot in the VBO</li>
<li>invoke geometry shader rendereing as normal with appropriate stride to
pickup the dynamically calculated photon parameters</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>This way you have a &#8220;real&#8221; time view of simulation progression rather than
the very artificicial view of discrete steps.</p>
<div class="section" id="what-about-non-chroma-devices">
<h3>What about non-Chroma devices ?<a class="headerlink" href="#what-about-non-chroma-devices" title="Permalink to this headline">¶</a></h3>
<p>Chroma needs CUDA.
To visualize on devices without Chroma/CUDA but
with OpenCL (or Metal):</p>
<ul class="simple">
<li>provide way to pullback/persist/transport VBO, without ROOT dependency.</li>
</ul>
<p>Dumb (non-compute) devices will not be able to do the interpolation,
but they could do the fake glDrawElements time cutting via changing the count.</p>
</div>
<div class="section" id="geometry-shaders">
<h3>Geometry Shaders<a class="headerlink" href="#geometry-shaders" title="Permalink to this headline">¶</a></h3>
<p>Current rendering requires geometry shading capability, that is
not available on OpenGL ES would need to construct line strip VBO
rather than generating lines.</p>
<p>Even OpenGL ES Next (expected released 2014) will not have geometry
shaders.</p>
<ul class="simple">
<li><a class="reference external" href="http://www.anandtech.com/show/7657/khronos-offers-a-quick-peek-at-the-next-version-of-opengl-es">http://www.anandtech.com/show/7657/khronos-offers-a-quick-peek-at-the-next-version-of-opengl-es</a></li>
</ul>
</div>
</div>
<div class="section" id="node-selection-only-applies-to-to-particular-geometry-dyb-juno-lxe">
<h2>Node selection only applies to to particular geometry dyb/juno/lxe<a class="headerlink" href="#node-selection-only-applies-to-to-particular-geometry-dyb-juno-lxe" title="Permalink to this headline">¶</a></h2>
<p>Current workaround is via envvars like DAE_GEOMETRY_DYB.
That does not scale so well, probably need to adopt defaults files maybe:</p>
<ul class="simple">
<li><cite>~/.g4daeview/defaults.cfg</cite></li>
<li><cite>~/.g4daeview/dyb/defaults.cfg</cite></li>
<li><cite>~/.g4daeview/juno/defaults.cfg</cite></li>
</ul>
<p>Pulled out the default geometry nodeselection, but not geo specific starting eye, near etc..:</p>
<div class="highlight-python"><pre>g4daeview.sh -p lxe -C</pre>
</div>
</div>
<div class="section" id="live-updating-test">
<h2>Live Updating Test<a class="headerlink" href="#live-updating-test" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">start the &#8220;worker&#8221; with ZMQ tunnel node specified as the SSH config &#8220;alias&#8221; of the node
on which the broker is running:</p>
<p>g4daeview.sh &#8211;zmqtunnelnode=N       # starts up within a few seconds</p>
</li>
<li><p class="first">start the &#8220;client&#8221; on N:</p>
<p>csa.sh    # takes several minutes to get going, currently only 100 events</p>
</li>
</ol>
<p>The &#8220;worker&#8221; can be stopped and started whilst the &#8220;client&#8221; runs and
new live ChromaPhotonList are presented as they are simulated and ZMQ
transported. Use auto-created bookmark 9 to find them.</p>
<p>The Segmentation Violation issue due to changing GLUT menus whilst
they are in use appears solved by the improved menu structuring
and using a pending update slot. However suspect that menu entries
from multiple events may appear together in some difficult to
reproduce circumstances.</p>
</div>
<div class="section" id="next">
<h2>Next<a class="headerlink" href="#next" title="Permalink to this headline">¶</a></h2>
<div class="section" id="improved-structuring">
<h3>improved structuring<a class="headerlink" href="#improved-structuring" title="Permalink to this headline">¶</a></h3>
<p>Should look into adopting some design patterns to make the code
more tractable, things are getting unweildy eg Menu-ing.</p>
<ul class="simple">
<li><a class="reference external" href="http://www.songho.ca/opengl/gl_mvc.html">http://www.songho.ca/opengl/gl_mvc.html</a></li>
</ul>
</div>
<div class="section" id="histogramming">
<h3>Histogramming<a class="headerlink" href="#histogramming" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>GPU histogramming, eg photon wavelength spectrum</li>
<li>how to present ?<ul>
<li>dump numpy arrays for separate presentation</li>
<li>separate OpenGL window, would allow live updating during propagation</li>
<li>communicate to a separate ipython session over ZMQ ? and use matplotlib from there<ul>
<li>i like the compartmentalization</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="section" id="issues">
<h4>issues<a class="headerlink" href="#issues" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>fmcpmuon.py refers to volumes with DE names like <cite>/dd/Structure/Pool/db-ows</cite>  geometry
nodes available via daenode are all <cite>/dd/Geometry/..</cite></li>
</ul>
</div>
</div>
<div class="section" id="photon-provenance">
<h3>Photon provenance<a class="headerlink" href="#photon-provenance" title="Permalink to this headline">¶</a></h3>
<p>Use the currently unused CPL pmtid as a bitfield for provenance info</p>
<ol class="arabic simple">
<li>process: Cerenkov, Scintillation</li>
<li>some compressed generation tree info  (full parentID, trackID not needed ) perhaps<ul>
<li>if parent is primary (trackID 1)</li>
<li>PDG code of parent, look at possibilities counts and compress into 2-3 bits</li>
</ul>
</li>
<li>need some explorations to arrive at an appropriately terse sketch of the tree</li>
</ol>
</div>
<div class="section" id="chromaotherlist-for-transport-over-zmq">
<h3>ChromaOtherList for transport over ZMQ<a class="headerlink" href="#chromaotherlist-for-transport-over-zmq" title="Permalink to this headline">¶</a></h3>
<p>It would be interesting for debugging to visualize other tracks, not just optical photons.
Do some counting to see how complete want to go, and arrive at a terse representation
analogous to CPL.</p>
</div>
<div class="section" id="geant4-chroma-process">
<h3>Geant4 Chroma Process<a class="headerlink" href="#geant4-chroma-process" title="Permalink to this headline">¶</a></h3>
<p>Geant4 frowns on changing track in anything other than a process. So look into
when and how a process gets access to OPs compared to a stack action.</p>
</div>
<div class="section" id="avoid-geometry-duplication">
<h3>Avoid Geometry Duplication<a class="headerlink" href="#avoid-geometry-duplication" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>currently geometry info is on GPU twice, once for OpenGL once for Chroma
investigate getting them to share the same arrays (similar to whats done with pixels and now photon steps)</li>
</ol>
</div>
<div class="section" id="interactive-target-switching-needs-overhaul">
<h3>interactive target switching  <strong>NEEDS OVERHAUL</strong><a class="headerlink" href="#interactive-target-switching-needs-overhaul" title="Permalink to this headline">¶</a></h3>
<p>While pressing &#8220;Q&#8221; clicking a solid switches target to that solid.</p>
<ul class="simple">
<li>currently the default launch eye,look,up parameters are adopted, which is jarring</li>
<li>adopting the parameters of the prior view is also jarring</li>
<li>need to transform transient/offset eye/look/up to world</li>
<li>unclear how best to do this : maybe interpolate views</li>
</ul>
<p>Using bookmarks is a better way, but that often makes the
target disappear due to near cull. Perhaps need to auto-adjust
near.</p>
<p>Intend:</p>
<ul class="simple">
<li>switch coordinate frame to adopt that of the target, ie switching view</li>
<li>changes &#8220;look&#8221; rotation point to the center of the clicked solid</li>
<li>allows to raycast for any viewpoint without relying on raycasting
being fast enough to be interactive</li>
</ul>
</div>
<div class="section" id="smaller-things">
<h3>smaller things<a class="headerlink" href="#smaller-things" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>there is no point proceeding when Chroma is forced into &#8220;splitting&#8221;
geometry due to congested GPU memory. Chroma renders will not succeed.
Detect when this happens and assert at launch.
Better to do this independantly of chroma with env.cuda.cuda_info
and have a configurable minimum required GPU memory free to proceed.</li>
<li>key to reverse animation direction</li>
<li>key to temporarily allow about-eye-point rather than about-look-point trackball rotation ?</li>
<li>calculate what the trackball translate factor should actually be based on the
camera nearsize/farsize, and size of the virtual trackball
rather than using adhoc factor<ul>
<li>will probably need to scale it up anyhow, but would be better not
to require user tweaking all the time when move between scales</li>
</ul>
</li>
<li>take control of lighting, add headlamp (for inside AD)</li>
<li>chroma hybrid mode, record propagation progress in VBO, provide
OpenGL representation of that</li>
<li>improve screen text flexibility, columns, matrices, ...</li>
<li>coloring by material</li>
</ol>
<div class="sidebar">
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>