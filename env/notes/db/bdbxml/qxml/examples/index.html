<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>QXML Examples &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../../../" />
    <link rel="up" title="QXML" href="../" />
    <link rel="next" title="QXML" href="../../../../qxml/" />
    <link rel="prev" title="Exist to QXML migration" href="../exist2qxml/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../../qxml/" title="QXML"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../exist2qxml/" title="Exist to QXML migration"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../" >DB scripts</a> &raquo;</li>
          <li><a href="../" accesskey="U">QXML</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sqlite/">SQLite</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../">DB scripts</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../valmon/">Value Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sqlite3/">SQLite3</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../">QXML</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pycuda/">pycuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../geant4/">geant4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hg/">hg</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../../_sources/db/bdbxml/qxml/examples.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../exist2qxml/"
                        title="previous chapter">Exist to QXML migration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../../../../qxml/"
                        title="next chapter">QXML</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="qxml-examples">
<h1>QXML Examples<a class="headerlink" href="#qxml-examples" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#stdin-query-piping-and-shebang-line-running" id="id1">STDIN query piping and shebang line running</a></li>
<li><a class="reference internal" href="#mapping-element-nodes-in-larger-docs-eg-svg" id="id2">Mapping element nodes in larger docs, eg SVG</a></li>
<li><a class="reference internal" href="#issues-enhancements-ideas" id="id3">Issues/Enhancements/Ideas</a><ul>
<li><a class="reference internal" href="#done" id="id4">Done</a></li>
<li><a class="reference internal" href="#configurable-loading-of-indices-and-generic-access" id="id5">Configurable loading of indices and generic access</a></li>
<li><a class="reference internal" href="#keeping-qxml-generic" id="id6">Keeping qxml generic</a></li>
</ul>
</li>
<li><a class="reference internal" href="#steps-to-add-a-c-extension-function" id="id7">Steps to add a C++ extension function</a></li>
<li><a class="reference internal" href="#steps-to-make-c-extension-available-from-python-main-xqueries" id="id8">Steps to make C++ extension available from python main XQueries</a></li>
<li><a class="reference internal" href="#using-the-python-api" id="id9">Using the python API</a></li>
<li><a class="reference internal" href="#using-c-api" id="id10">Using C++ API</a></li>
<li><a class="reference internal" href="#using-dbxml-shell" id="id11">Using dbxml shell</a></li>
<li><a class="reference internal" href="#dbxml-shell-as-debugging-tool" id="id12">dbxml shell as debugging tool</a></li>
<li><a class="reference internal" href="#environment" id="id13">environment</a></li>
<li><a class="reference internal" href="#examples" id="id14">Examples</a></li>
<li><a class="reference internal" href="#hmm-hfagc-system-container-empty" id="id15">Hmm, hfagc system container empty</a></li>
<li><a class="reference internal" href="#observations-on-berkeley-db-xml-xquerying" id="id16">Observations on Berkeley DB XML XQuerying</a></li>
</ul>
</div>
<div class="section" id="stdin-query-piping-and-shebang-line-running">
<h2><a class="toc-backref" href="#id1">STDIN query piping and shebang line running</a><a class="headerlink" href="#stdin-query-piping-and-shebang-line-running" title="Permalink to this headline">¶</a></h2>
<p>Usage examples assuming bash shell.
Piping from echo (must escape some chars from shell, handy for one-liners):</p>
<div class="highlight-python"><pre>echo collection\(\)[1]               | qxml -
echo "collection()[1]//rez:quote[1]" | qxml -   # first quote of first item
echo "count(collection())"           | qxml -   # number of items
echo "count(collection()/rez:rez)"   | qxml -   #</pre>
</div>
<p>NB use of configured default container avoids:</p>
<div class="highlight-python"><pre>echo "collection('dbxml:/hfc')[1]"   | qxml -
echo "collection('dbxml:/tmp')[1]"   | qxml -
      ## containers identified by configured aliases or tags</pre>
</div>
<p>Three queries that are the same:</p>
<div class="highlight-python"><pre>echo "collection('dbxml:////tmp/hfagc/hfagc.dbxml')/dbxml:metadata('dbxml:name')" | qxml -  ## explicit file path to the container
echo "collection('hfc')/dbxml:metadata('dbxml:name')" | qxml -     # using the tag name
echo "collection()/dbxml:metadata('dbxml:name')" | qxml -          # using the default container</pre>
</div>
<p>Useful for quick syntax checking:</p>
<div class="highlight-python"><pre>echo "let \$a := (1,2,3,4,5) return \$a[last()] " | qxml -
echo 'let  $a := (1,2,3,4,5) return  $a[last()] ' | qxml -
echo 'let $a := (1,2,3,4,5) return $a[position() &lt;= 3] ' | qxml -</pre>
</div>
<p>Grabbing a resource by name:</p>
<div class="highlight-python"><pre>echo "collection()/*[dbxml:metadata('dbxml:name')='/cdf/cjl/cdf_summer2007_BsDsK.xml']" | qxml -
echo "collection()/*[dbxml:metadata('dbxml:name')='/cdf/cjl/cdf_summer2007_BsDsK.xml']" | qxml - &gt; out.xml
     # redirect stdout to file,
     # meta output goes to stderr allowing queries to yield valid XML

echo "collection()/*[dbxml:metadata('dbxml:name')='/cdf/cjl/cdf_summer2007_BsDsK.xml']" | qxml - -o cdf.xml
     # writing into configured container with DB</pre>
</div>
<p>Here strings (again must escape):</p>
<div class="highlight-python"><pre>qxml - &lt;&lt;&lt; collection\(\)[1]
qxml - &lt;&lt;&lt; "collection()[1]"</pre>
</div>
<p>Here documents, must <strong>not</strong> do any escaping (also handy for few-liners):</p>
<div class="highlight-python"><pre>qxml - &lt;&lt; EOQ
&gt; collection()[1]
&gt; EOQ</pre>
</div>
<p>From a bash function (uses another function to format arguments as an XQuery sequence):</p>
<div class="highlight-python"><pre>rezlatex-code2latex-(){ qxml - &lt;&lt; EOQ
import module namespace my="http://my" at "my.xqm" ;
my:code2latex($(rezlatex-xqseq $*))
EOQ
}</pre>
</div>
<p>Start turning command into script:</p>
<div class="highlight-python"><pre>cat - &lt;&lt; EOQ &gt; demo.xq
&gt; collection()[1]
&gt; EOQ
cat demo.xq | qxml -</pre>
</div>
<p>Shebang line running:</p>
<div class="highlight-python"><pre>cat - &lt;&lt; EOQ &gt; script.xq
#!/usr/bin/env qxml
collection()[1]
EOQ

chmod ugo+x script.xq
./script.xq</pre>
</div>
<p>Quick module import and invoke:</p>
<div class="highlight-python"><pre>echo 'import module namespace my="http://my" at "my.xqm" ; my:metadata(collection()[100]) ' | qxml -
echo 'import module namespace my="http://my" at "my.xqm" ; my:code2latex("211") ' | qxml -
#
# CONSIDERING configurable xquery module import prolog invoked via module command line option
#
#              echo 'my:code2latex("211")' | qxml - -m my -m rz
#
#  Simple way of doing this would offset error line numbers, but can pony up imports on 1st line,
#  register module library tags such as "my" in the config.
#</pre>
</div>
</div>
<div class="section" id="mapping-element-nodes-in-larger-docs-eg-svg">
<h2><a class="toc-backref" href="#id2">Mapping element nodes in larger docs, eg SVG</a><a class="headerlink" href="#mapping-element-nodes-in-larger-docs-eg-svg" title="Permalink to this headline">¶</a></h2>
<p>Element handle do not encode the container and will become invalid if document changed. Usable from XQuery:</p>
<div class="highlight-python"><pre>echo 'let $nod := doc("tmp/qtag2latex.xml")//qtag[10] let $hdl := $nod/dbxml:node-to-handle() return ($nod,$hdl,dbxml:handle-to-node("tmp",$hdl))' | qxml -</pre>
</div>
<p>And in C++:</p>
<div class="highlight-python"><pre>string hdl = val.getNodeHandle(); // from XmlValue ...
cont.getNode(hdl);</pre>
</div>
</div>
<div class="section" id="issues-enhancements-ideas">
<h2><a class="toc-backref" href="#id3">Issues/Enhancements/Ideas</a><a class="headerlink" href="#issues-enhancements-ideas" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">install more python into $ENV_PREFIX/lib/ to allow use from anywhere</p>
</li>
<li><p class="first">ensure qxml return codes are appropriate when xquery or other errors occur</p>
</li>
<li><p class="first">make configured maps to load command line controllable, check error handling when maps are missing</p>
</li>
<li><dl class="first docutils">
<dt>avoid absolute paths in config file</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>maybe allow envvar interpolation for a list of named envvars, eg HEPREZ_HOME QXML_TMP</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>use python style eg  %(HEPREZ_HOME)s/some/path</dt>
<dd><ul class="first last simple">
<li>makes python implementation easy</li>
<li>cpp easier than shell style $HEPREZ_HOME/some/path</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">documentation mentions that container resolution defaults be being relative to the environment dir
currently have not used this, instead have been specifying absolute paths in config and using them via aliases.
Potentially moving to relative addressing could cut down the number of absolute paths in the config.</p>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">dbxml</span></tt> shell like capabilities for <tt class="docutils literal"><span class="pre">qxml</span></tt> that hook into the qxml configuration</dt>
<dd><p class="first last">/usr/local/env/db/dbxml-2.5.16/dbxml/src/utils/shell/dbxmlsh.cpp</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>resolver rationalization <span class="classifier-delimiter">:</span> <span class="classifier">THIS IS TIED TO DYLIB LOADING</span></dt>
<dd><ul class="first last simple">
<li>python resolver / C++ resolver / swigged C++ resolver</li>
<li>python resolver palm off to swigged C++ resolver ?</li>
<li>separate ns for python and swigged C++ for implementation comparisons</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">configuration of dbxml indices</p>
</li>
<li><dl class="first docutils">
<dt>logging/verbosity control</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>boost.log</dt>
<dd><ul class="first last simple">
<li>unfortunately not yet in distros</li>
<li>was provisionally approved but v1 looked difficult to use, TODO: check v2</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>command line parsing when have duplicated options (like -o)</dt>
<dd><dl class="first last docutils">
<dt>gives &#8220;multiple occurrences&#8221;, change handling to</dt>
<dd><ul class="first last simple">
<li>last one wins</li>
<li>OR immediate exit if it makes no sense for the option</li>
</ul>
</dd>
</dl>
</dd>
</dl>
</li>
<li><p class="first">re-arrange python extension build to avoid littering wc with swig artifacts</p>
</li>
</ul>
<div class="section" id="done">
<h3><a class="toc-backref" href="#id4">Done</a><a class="headerlink" href="#done" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>on writing xml into dbxml containers fill in created/modified/owner metadata</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="configurable-loading-of-indices-and-generic-access">
<h3><a class="toc-backref" href="#id5">Configurable loading of indices and generic access</a><a class="headerlink" href="#configurable-loading-of-indices-and-generic-access" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">std::map</span> <span class="pre">&lt;string,string&gt;</span></tt> simple starting point implemented in r3436</p>
<p>Enable generic app indices by configuring queries providing (key,val) lists
which are loaded into <tt class="docutils literal"><span class="pre">std::map&lt;string,XmlValue&gt;</span></tt>:</p>
<div class="highlight-python"><pre>[map.name]
name = code2latex
[map.query]
query = for $glyph in collection('dbxml:/sys')/*[dbxml:metadata('dbxml:name')='pdgs.xml' or dbxml:metadata('dbxml:name')='extras.xml' ]//glyph return (data($glyph/@code), data($glyph/@latex))</pre>
</div>
<p>Such maps are accessible by generic extension function my:map(&#8216;code2latex&#8217;,$key )</p>
</div>
<div class="section" id="keeping-qxml-generic">
<h3><a class="toc-backref" href="#id6">Keeping qxml generic</a><a class="headerlink" href="#keeping-qxml-generic" title="Permalink to this headline">¶</a></h3>
<p>dlopen/dlsym (or C++ equivalent) handling for resolver and
extension functions to prevent project specifics from creeping into qxml.
Such specifics should be being developed elsewhere (in heprez repository for example).</p>
<p>Some generic extfun will be needed however, so probably best to have an umbrella
resolver that handles</p>
<ul class="simple">
<li>dynamic resolver loading</li>
<li>hands out resolve requests based on namespace uri.</li>
</ul>
<p>See ~/env/dlfcn for tutorial of dlopen technique, the proxy registration
approach described could be used to register per-library namespace keyed resolvers
which the umbrella resolver which lives in global main manages in a map.</p>
<ul class="simple">
<li><a class="reference external" href="http://www.faqs.org/docs/Linux-mini/C++-dlopen.html">http://www.faqs.org/docs/Linux-mini/C++-dlopen.html</a></li>
</ul>
</div>
</div>
<div class="section" id="steps-to-add-a-c-extension-function">
<h2><a class="toc-backref" href="#id7">Steps to add a C++ extension function</a><a class="headerlink" href="#steps-to-add-a-c-extension-function" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>implement in <tt class="docutils literal"><span class="pre">extfun.{cc,hh}</span></tt></li>
<li>add argument signature to <tt class="docutils literal"><span class="pre">extresolve.cc</span></tt></li>
<li>build C++ qxml with <tt class="docutils literal"><span class="pre">make</span></tt></li>
<li>add test calls to <tt class="docutils literal"><span class="pre">test/ext.xq</span></tt> that exercise the extension</li>
</ol>
</div>
<div class="section" id="steps-to-make-c-extension-available-from-python-main-xqueries">
<h2><a class="toc-backref" href="#id8">Steps to make C++ extension available from python main XQueries</a><a class="headerlink" href="#steps-to-make-c-extension-available-from-python-main-xqueries" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>setup swig wrapping in <tt class="docutils literal"><span class="pre">extfun.i</span></tt></li>
</ol>
</div>
<div class="section" id="using-the-python-api">
<h2><a class="toc-backref" href="#id9">Using the python API</a><a class="headerlink" href="#using-the-python-api" title="Permalink to this headline">¶</a></h2>
<p>Very close to C++, but not the same need to examine:</p>
<div class="highlight-python"><pre>vi /opt/local/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/dbxml.py
or dbxml-py</pre>
</div>
</div>
<div class="section" id="using-c-api">
<h2><a class="toc-backref" href="#id10">Using C++ API</a><a class="headerlink" href="#using-c-api" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">DB XML docs have mismatches to header signatures, <strong>trust headers above documentation</strong></p>
</div>
<p>Get there quick with dbxml-cpp</p>
</div>
<div class="section" id="using-dbxml-shell">
<h2><a class="toc-backref" href="#id11">Using dbxml shell</a><a class="headerlink" href="#using-dbxml-shell" title="Permalink to this headline">¶</a></h2>
<p>A script containg dbxml commands can save some typing:</p>
<div class="highlight-python"><pre>cat  hfagc.dbxml

openContainer /tmp/hfagc/hfagc_system.dbxml
addAlias sys
openContainer /tmp/hfagc/hfagc.dbxml
addAlias hfc</pre>
</div>
<div class="highlight-python"><pre>simon:qxml blyth$ dbxml -h /tmp/dbxml -s hfagc.dbxml
Joined existing environment

dbxml&gt; query 'collection("dbxml:/sys")'
stdin:1: query failed, Error: Cannot resolve container: sys.  Container not open and auto-open is not enabled.  Container may not exist.

dbxml&gt;  query 'collection("dbxml:/hfc")'
226 objects returned for eager expression 'collection("dbxml:/hfc")'</pre>
</div>
</div>
<div class="section" id="dbxml-shell-as-debugging-tool">
<h2><a class="toc-backref" href="#id12">dbxml shell as debugging tool</a><a class="headerlink" href="#dbxml-shell-as-debugging-tool" title="Permalink to this headline">¶</a></h2>
<p>It can be very useful to use the dbxml shell for debugging without all the conveniences of qxml
getting in the way. For example whilst debugging a single resource transfer script found that
it seemed to transfer OK but created invisible docs from the point of view of qxml queries like:</p>
<div class="highlight-python"><pre>echo 'for $a in collection("sys") return $a/dbxml:metadata("dbxml:name")' | qxml -
echo 'for $a in collection("sys") return $a/dbxml:metadata("exist:name")' | qxml -</pre>
</div>
</div>
<div class="section" id="environment">
<h2><a class="toc-backref" href="#id13">environment</a><a class="headerlink" href="#environment" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>simon:dayabay blyth$ dbxml -h /tmp/dbxml
-bash: dbxml: command not found
simon:dayabay blyth$ db-
simon:dayabay blyth$ bdbxml-
simon:dayabay blyth$ dbxml -h /tmp/dbxml
Joined existing environment

dbxml&gt;</pre>
</div>
</div>
<div class="section" id="examples">
<h2><a class="toc-backref" href="#id14">Examples</a><a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Checking with dbxml shell (<strong>have observed inconsistencies when not using the same envdir as qxml</strong>):</p>
<div class="highlight-python"><pre>dbxml -h /tmp/dbxml
Joined existing environment

dbxml&gt; openContainer /tmp/hfagc/hfagc_system.dbxml
dbxml&gt; query 'for $a in collection() return $a/dbxml:metadata("dbxml:name")'
16 objects returned for eager expression 'for $a in collection() return $a/dbxml:metadata("dbxml:name")'

dbxml&gt; print
pdgs.xml
pdg.xml
...

dbxml&gt; getDocument lhcb_winter2011_BcX.xml
1 documents found

dbxml&gt; print
&lt;rez:rez xmlns:rez="http://hfag.phys.ntu.edu.tw/hfagc/rez" xmlns:exist="http://exist.sourceforge.net/NS/exist" exist:id="1" exist:source="/db/test/lhcb_winter2011_BcX.xml"&gt;
         &lt;rez:header mode="pro" time="2012-04-08T00:36:44.088+0800" stamp="1333816604088" stamp_hash="ixml:content-hash:lhcb_winter2011_BcX.xml/db/hfagc/lhcb/yasmine/lhcb_winter2011_BcX.xmlyasminelhcb2012-04-08T00:21:26.978+08:001.0-dev/data/heprez/install/exist/eXist-snapshot-20051026/unpack/4" stamp_id="2" stamp_source="/db/hfagc/lhcb/yasmine/lhcb_winter2011_BcX.xml"&gt;
             &lt;rez:origin&gt;
             ...</pre>
</div>
</div>
<div class="section" id="hmm-hfagc-system-container-empty">
<h2><a class="toc-backref" href="#id15">Hmm, hfagc system container empty</a><a class="headerlink" href="#hmm-hfagc-system-container-empty" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>simon:dayabay blyth$ dbxml -h /tmp/dbxml
Joined existing environment

dbxml&gt;  openContainer /tmp/hfagc/hfagc_system.dbxml

dbxml&gt; query 'for $a in collection() return $a/dbxml:metadata("dbxml:name")'
0 objects returned for eager expression 'for $a in collection() return $a/dbxml:metadata("dbxml:name")'

dbxml&gt; print

dbxml&gt; openContainer /tmp/hfagc/hfagc.dbxml

dbxml&gt;  query 'for $a in collection() return $a/dbxml:metadata("dbxml:name")'
256 objects returned for eager expression 'for $a in collection() return $a/dbxml:metadata("dbxml:name")'

dbxml&gt; print
/babar/cecilia/b0d0kpi.xml
/babar/cecilia/b0dsa02.xml
/babar/cecilia/b0dspi.xml
/babar/cecilia/b0dsstardstar.xml
...</pre>
</div>
</div>
<div class="section" id="observations-on-berkeley-db-xml-xquerying">
<h2><a class="toc-backref" href="#id16">Observations on Berkeley DB XML XQuerying</a><a class="headerlink" href="#observations-on-berkeley-db-xml-xquerying" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">document-uri(root($smth))</span></tt>  fails to provide the originating uri in more involved querying</dt>
<dd><ul class="first last simple">
<li>suspect a steps removed effect (fragments of fragments loose touch with their roots)</li>
<li>dbxml:metadata(&#8220;dbxml:name&#8221;,$smth)  seems to work OK without need to <tt class="docutils literal"><span class="pre">root</span></tt> up to the doc.</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">does not auto-coerce xs:string into xs:integer</p>
</li>
<li><p class="first">using baseuri setting in hfagc.ini <tt class="docutils literal"><span class="pre">dbxml.baseuri</span> <span class="pre">=</span> <span class="pre">dbxml:/</span></tt> (this is the default without qxml) affords collection specification by alias alone:</p>
<div class="highlight-python"><pre>echo 'for $a in tokenize("tmp hfc sys"," ") return count(collection($a)) ' | qxml -
echo 'doc("tmp/qtag2latex.xml")' | qxml -
echo 'for $q in doc("tmp/qtag2latex.xml")//qtag return (data($q/@value),data($q/latex))' | qxml -
echo 'for $q in doc("tmp/qtag2latex.xml")//qtag return ($q/@value/string(),$q/latex/string())' | qxml -

## CAUTION WITH SHELL ESCAPING</pre>
</div>
</li>
</ol>
<div class="sidebar">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../../qxml/" title="QXML"
             >next</a> |</li>
        <li class="right" >
          <a href="../exist2qxml/" title="Exist to QXML migration"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../" >DB scripts</a> &raquo;</li>
          <li><a href="../" >QXML</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>