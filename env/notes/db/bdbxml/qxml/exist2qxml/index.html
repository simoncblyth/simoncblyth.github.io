<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Exist to QXML migration &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../../../" />
    <link rel="up" title="QXML" href="../" />
    <link rel="next" title="QXML Examples" href="../examples/" />
    <link rel="prev" title="QXML" href="../" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../examples/" title="QXML Examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../" title="QXML"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../" >DB scripts</a> &raquo;</li>
          <li><a href="../" accesskey="U">QXML</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sqlite/">SQLite</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../">DB scripts</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../valmon/">Value Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sqlite3/">SQLite3</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../">QXML</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pycuda/">pycuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../geant4/">geant4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hg/">hg</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../../_sources/db/bdbxml/qxml/exist2qxml.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../"
                        title="previous chapter">QXML</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../examples/"
                        title="next chapter">QXML Examples</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="module-env.db.bdbxml.qxml.exist2qxml"></span><div class="section" id="exist-to-qxml-migration">
<h1>Exist to QXML migration<a class="headerlink" href="#exist-to-qxml-migration" title="Permalink to this headline">Â¶</a></h1>
<p>QXML is a lightweight XML querying python script and equivalent 
C tool built on top of Berkely DB XML (BDBXML).  QXML is hosted in 
the <strong>env</strong> repository to reflect the intention to keep it a general
tool for XML querying.</p>
<p>This <em>exist2qxml.py</em> script migrates eXist backup dumps OR 
the contents of live eXist servers into BDBXML containers.  
While QXML is currently ancillary to the main workflow 
of the heprez machinery, due to speed of querying 
the BDBXML compared to eXist they are very useful for rapid 
querying the content of large numbers of XML files.</p>
<p>Usage for full ingests:</p>
<div class="highlight-python"><pre>./exist2qxml.py</pre>
</div>
<p>The required <span class="target" id="index-0"></span><tt class="xref std std-envvar docutils literal"><span class="pre">QXML_CONFIG</span></tt> points to the config file:</p>
<div class="highlight-python"><pre>simon:qxml blyth$ echo $QXML_CONFIG
/Users/blyth/env/db/bdbxml/qxml/hfagc.cfg</pre>
</div>
<p>For selective ingests, eg into container with tag &#8216;sys&#8217;:</p>
<div class="highlight-python"><pre>EXIST2QXML_SELECT=sys@@http://localhost/servlet/db/hfagc_system/v2qtags.xml ./exist2qxml.py
EXIST2QXML_SELECT=sys@@http://localhost/servlet/db/hfagc_system/qtag2latex.xml ./exist2qxml.py</pre>
</div>
<div class="section" id="qxml-config">
<h2>QXML Config<a class="headerlink" href="#qxml-config" title="Permalink to this headline">Â¶</a></h2>
<p>Configured by the file pointed to by QXML_CONFIG.</p>
<div class="section" id="general-config">
<h3>General Config<a class="headerlink" href="#general-config" title="Permalink to this headline">Â¶</a></h3>
<p>Crucial settings include the default collection that querying addresses and the 
search path for XQuery modules that can be included into queries.</p>
<div class="highlight-python"><pre>[dbxml]
environment_dir = /tmp/dbxml
default_collection = dbxml:////tmp/hfagc/hfagc.dbxml
baseuri = dbxml:/
xqmpath = /Users/blyth/heprez/qxml/lib:/Users/blyth/env/db/bdbxml/xq</pre>
</div>
</div>
<div class="section" id="container-config">
<h3>Container Config<a class="headerlink" href="#container-config" title="Permalink to this headline">Â¶</a></h3>
<p>The container config defines the locations for the Berkely DB containers and the 
source of the XML for them, which can be local directories OR exist instances:</p>
<div class="highlight-python"><pre>[container.source]
source = 
source = http://localhost/servlet/db/hfagc_system/
source = /data/heprez/data/backup/part/localhost/last/db/hfagc
source = http://cms01.phys.ntu.edu.tw/servlet/db/hfagc/

[container.path]
path = /tmp/hfagc/scratch.dbxml
path = /tmp/hfagc/hfagc_system.dbxml
path = /tmp/hfagc/hfagc.dbxml
path = /tmp/hfagc/remote.dbxml

[container.tag]
tag = tmp
tag = sys
tag = hfc
tag = rem</pre>
</div>
<p>To suppress the leading slash in db names, supply a trailing slash in the source.
This is useful for the sys container as it contains no sub-collections and not
having slashes in names affords shortcut doc access.</p>
<p>All non-metadata xml files beneath the <cite>srcdir</cite> are ingested into container dbxml 
at the path specified which is subsequently referred to with qxml via the 
configured tag or alias eg with:</p>
<div class="highlight-python"><pre>collection('avg')/dbxml:metadata('dbxml:name')</pre>
</div>
</div>
<div class="section" id="namespace-config">
<h3>Namespace Config<a class="headerlink" href="#namespace-config" title="Permalink to this headline">Â¶</a></h3>
<p>Shorthand strings for namespace uri used when querying:</p>
<div class="highlight-python"><pre>[namespace.name]
name = rez 
name = exist
name = qxml

[namespace.uri]
uri = http://hfag.phys.ntu.edu.tw/hfagc/rez
uri = http://exist.sourceforge.net/NS/exist
uri = http://dayabay.phys.ntu.edu.tw/qxml</pre>
</div>
</div>
<div class="section" id="map-config">
<h3>Map Config<a class="headerlink" href="#map-config" title="Permalink to this headline">Â¶</a></h3>
<p>Often some snippets of XML need to be very frequently accessed, eg the latex string corresponding to a particle code
or the latex corresponding to a decay quantity tag. In order to optimize access to these snippets 
a map is created at QXML startup which can be very rapidly accesses subsequently:</p>
<div class="highlight-python"><pre>[map.name]
name = code2latex
name = qtag2latex

[map.query]      
query = for $glyph in collection('sys')/*[dbxml:metadata('dbxml:name')='pdgs.xml' or dbxml:metadata('dbxml:name')='extras.xml' ]//glyph return (data($glyph/@code), data($glyph/@latex)) 
query = for $qtag in doc("sys/qtag2latex.xml")//qtag return ($qtag/@value/string(),$qtag/latex/string())</pre>
</div>
</div>
</div>
<div class="section" id="issues">
<h2>Issues<a class="headerlink" href="#issues" title="Permalink to this headline">Â¶</a></h2>
<p>When attempting to read from a non-running eXist server, such as below, the
error is not informative and an empty container is created that requires manual
deletion before rerunning:</p>
<div class="highlight-python"><pre>simon:~ blyth$ rm /tmp/hfagc/hfagc_system.dbxml 
simon:~ blyth$ heprez-exist2qxml
INFO:__main__:using srcpfx_ None 
INFO:__main__:ingest sys creating /tmp/hfagc/hfagc_system.dbxml from xml files from http://localhost/servlet/db/hfagc_system/ 
XmlException ( 4 ):  Error: XML Indexer: Fatal Parse error in document at line 1, char 50. Parser message: whitespace expected
WARNING:__main__:tag hfc dbxml "/tmp/hfagc/hfagc.dbxml" exists already : delete it and rerun to update from src "/data/heprez/data/backup/part/localhost/last/db/hfagc"  
WARNING:__main__:tag rem dbxml "/tmp/hfagc/remote.dbxml" exists already : delete it and rerun to update from src "http://cms01.phys.ntu.edu.tw/servlet/db/hfagc/"  
simon:~ blyth$ </pre>
</div>
</div>
</div>
<div class="sidebar">
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../examples/" title="QXML Examples"
             >next</a> |</li>
        <li class="right" >
          <a href="../" title="QXML"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../" >DB scripts</a> &raquo;</li>
          <li><a href="../" >QXML</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>