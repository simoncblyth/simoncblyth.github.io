<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Meshlab Navigation &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../../" />
    <link rel="up" title="meshlab" href="../" />
    <link rel="next" title="MeshLab Distribution" href="../meshlab_distribution/" />
    <link rel="prev" title="MeshLab Collada Materials" href="../meshlab_collada_materials/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../meshlab_distribution/" title="MeshLab Distribution"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../meshlab_collada_materials/" title="MeshLab Collada Materials"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../" >Graphics</a> &raquo;</li>
          <li><a href="../" accesskey="U">meshlab</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pycuda/">pycuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../geant4/">geant4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../llvm/">llvm</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../">Graphics</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../">meshlab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collada/">collada</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cgal/">CGAL Computational Geometry Algorithms Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mesh/">mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../vrml/">vrml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../opengl/">opengl</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../transformations/">transformations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../panda3d/">panda3d</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pipeline/">pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../math/">math</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../glumpy/">glumpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../scenekit/">scenekit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pyopengl/">pyopengl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hg/">hg</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../_sources/graphics/meshlab/meshlab_navigation.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../meshlab_collada_materials/"
                        title="previous chapter">MeshLab Collada Materials</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../meshlab_distribution/"
                        title="next chapter">MeshLab Distribution</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="meshlab-navigation">
<h1>Meshlab Navigation<a class="headerlink" href="#meshlab-navigation" title="Permalink to this headline">¶</a></h1>
<p>From examination of the collada importer, it seems that
all shapes are getting appended into a single mesh. With
a single bbox.</p>
<p>So no way to navigate to a subnode, unless:</p>
<ol class="arabic simple">
<li>calculate bbox during import</li>
<li>transform the bbox min max with the appropriate transform,</li>
<li>keep all the boxes in a structure keyed by node id</li>
<li>this will allow the camera to be steered to look at particular nodes</li>
</ol>
<ul class="simple">
<li>/usr/local/env/graphics/meshlab/vcglib/vcg/space/box.h</li>
</ul>
<div class="section" id="where-to-tack-the-structure">
<h2>Where to tack the structure ?<a class="headerlink" href="#where-to-tack-the-structure" title="Permalink to this headline">¶</a></h2>
<p>Needs to go on MeshModel ?</p>
</div>
<div class="section" id="gui">
<h2>GUI<a class="headerlink" href="#gui" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>simon:src blyth$ find . -name '*.cpp' -exec grep -H MeshDecorateInterface {} \;
./common/pluginmanager.cpp:        MeshDecorateInterface *iDecorator = qobject_cast&lt;MeshDecorateInterface *&gt;(plugin);
./meshlab/glarea.cpp:                   MeshDecorateInterface * decorInterface = qobject_cast&lt;MeshDecorateInterface *&gt;(p-&gt;parent());
./meshlab/glarea.cpp:           MeshDecorateInterface * decorInterface = qobject_cast&lt;MeshDecorateInterface *&gt;(p-&gt;parent());
./meshlab/layerDialog.cpp:              MeshDecorateInterface* decPlug =  qobject_cast&lt;MeshDecorateInterface *&gt;(decList[ii]-&gt;parent());
./meshlab/layerDialog.cpp:      MeshDecorateInterface* decPlug =  qobject_cast&lt;MeshDecorateInterface *&gt;(act-&gt;parent());
./meshlab/mainwindow_Init.cpp:  foreach(MeshDecorateInterface *iDecorate,PM.meshDecoratePlugins())
./meshlab/mainwindow_RunTime.cpp:       MeshDecorateInterface *iDecorateTemp = qobject_cast&lt;MeshDecorateInterface *&gt;(action-&gt;parent());
./meshlab/plugindialog.cpp:                MeshDecorateInterface *iDecorate = qobject_cast&lt;MeshDecorateInterface *&gt;(plugin);
./meshlab/plugindialog.cpp:             MeshDecorateInterface *iDecorate = qobject_cast&lt;MeshDecorateInterface *&gt;(plugin);
simon:src blyth$</pre>
</div>
</div>
<div class="section" id="controlling-the-camera">
<h2>Controlling the camera<a class="headerlink" href="#controlling-the-camera" title="Permalink to this headline">¶</a></h2>
<p>/usr/local/env/graphics/meshlab/meshlab/src/meshlabplugins/decorate_background/decorate_background.cpp:</p>
<div class="highlight-python"><pre>85 bool SampleMeshDecoratePlugin::startDecorate( QAction * action, MeshDocument &amp;/*m*/, RichParameterSet * parset, GLArea * gla)
86 {
87   switch(ID(action)){
88     case DP_SHOW_CUBEMAPPED_ENV :
89     if(parset-&gt;findParameter(CubeMapPathParam())== NULL) qDebug("CubeMapPath was not setted!!!");
90       cubemapFileName = parset-&gt;getString(CubeMapPathParam());
91     break;
92   case DP_SHOW_GRID:
93     connect(gla,SIGNAL(transmitShot(QString,vcg::Shotf)),this,SLOT(setValue(QString,vcg::Shotf)));
94     connect(this,SIGNAL(askViewerShot(QString)),gla,SLOT(sendViewerShot(QString)));
95   break;
96   }
97     return true;
98 }</pre>
</div>
<div class="highlight-python"><pre>100 void SampleMeshDecoratePlugin::decorate(QAction *a, MeshDocument &amp;m, RichParameterSet * parset,GLArea *gla, QPainter * )
101 {
102   static QString lastname("unitialized");
103     switch(ID(a))
...
139   case DP_SHOW_GRID :
140     {
141       emit this-&gt;askViewerShot("me");
142       Box3f bb=m.bbox();</pre>
</div>
<p>header:</p>
<div class="highlight-python"><pre>96
97 signals:
98   void askViewerShot(QString);
99
100 public slots:
101   void  setValue(QString name, vcg::Shotf val);
102
103 };</pre>
</div>
<p>The implementation for the signal is generated by the moc meta-object-compiler. It just looks for connections
and calls the slots presumably.</p>
<ul class="simple">
<li><a class="reference external" href="http://stackoverflow.com/questions/1406940/how-signal-and-slots-are-implemented-under-the-hood">http://stackoverflow.com/questions/1406940/how-signal-and-slots-are-implemented-under-the-hood</a></li>
</ul>
<p>Lotsa interesting emits from glarea /usr/local/env/graphics/meshlab/meshlab/src/meshlab/glarea.cpp:</p>
<div class="highlight-python"><pre>1235 void GLArea::sendViewPos(QString name)
1236 {
1237 #ifndef VCG_USE_EIGEN
1238     Point3f pos=  trackball.track.InverseMatrix() *Inverse(trackball.camera.model) *Point3f(0,0,0);
1239 #else
1240     Point3f pos=  Eigen::Transform3f(trackball.track.InverseMatrix()) * Eigen::Transform3f(Inverse(trackball.camera.model)).translation();
1241 #endif
1242     emit transmitViewPos(name, pos);
1243 }
1244
1245 void GLArea::sendSurfacePos(QString name)
1246 {
1247     qDebug("sendSurfacePos %s",qPrintable(name));
1248     nameToGetPickPos = name;
1249     hasToGetPickPos=true;
1250 }
1251
1252 void GLArea::sendViewDir(QString name)
1253 {
1254     Point3f dir= getViewDir();
1255     emit transmitViewDir(name,dir);
1256 }
1257
1258 void GLArea::sendMeshShot(QString name)
1259 {
1260     Shotf curShot=this-&gt;md()-&gt;mm()-&gt;cm.shot;
1261     emit transmitShot(name, curShot);
1262 }
1263
1264 void GLArea::sendMeshMatrix(QString name)
1265 {
1266     Matrix44f mat=this-&gt;md()-&gt;mm()-&gt;cm.Tr;
1267     emit transmitMatrix(name, mat);
1268 }
1269
1270 void GLArea::sendViewerShot(QString name)
1271 {
1272     Shotf curShot=shotFromTrackball().first;
1273     emit transmitShot(name, curShot);
1274 }
1275 void GLArea::sendRasterShot(QString name)
1276 {
1277     Shotf curShot = vcg::Shotf();
1278     if (this-&gt;md()-&gt;rm() != NULL)
1279         curShot = this-&gt;md()-&gt;rm()-&gt;shot;
1280     emit transmitShot(name, curShot);
1281 }
1282
1283 void GLArea::sendCameraPos( QString name )
1284 {
1285     Point3f dir= trackball.camera.ViewPoint();
1286     emit transmitCameraPos(name,dir);
1287 }</pre>
</div>
<p>Meshlab <tt class="docutils literal"><span class="pre">Windows</span> <span class="pre">&gt;</span> <span class="pre">Copy</span> <span class="pre">Shot</span>&nbsp; <span class="pre">(cmd-C)</span></tt> puts the below XML onto clipboard:</p>
<div class="highlight-python"><pre>&lt;!DOCTYPE ViewState&gt;
&lt;project&gt;
             &lt;VCGCamera
                           TranslationVector="2047.35 397.133 2045.83 1"
                           LensDistortion="0 0"
                           ViewportPx="1678 906"
                           PixelSizeMm="0.0369161 0.0369161"
                           CenterPx="839 453"
                           FocalMm="28.9651"
                           RotationMatrix="-0.60671 -0.719133 -0.338749 0 -0.435627 0.657238 -0.615034 0 0.66493 -0.225579 -0.712027 0 0 0 0 1 "
                        /&gt;

            &lt;ViewSettings
                          NearPlane="1.03109"
                          TrackScale="0.00729556"
                          FarPlane="13.0311"
                        /&gt;

            &lt;Render
                          Lighting="1"
                          DoubleSideLighting="0"
                          SelectedVert="0"
                          ColorMode="0"
                          SelectedFace="0"
                          BackFaceCull="0"
                          FancyLighting="0"
                          DrawMode="5"
                          TextureMode="0"
                        /&gt;
&lt;/project&gt;</pre>
</div>
<p>Then after navigating elsewhere <tt class="docutils literal"><span class="pre">Windows</span> <span class="pre">&gt;</span> <span class="pre">Paste</span> <span class="pre">Shot</span> <span class="pre">(cmd-V)</span></tt> will return to the copy shot viewpoint
and camera parameters.</p>
<p>/usr/local/env/graphics/meshlab/meshlab/src/meshlab/mainwindow_Init.cpp:</p>
<div class="highlight-python"><pre>366     copyShotToClipboardAct = new QAction (tr("Copy shot"), this);
367     copyShotToClipboardAct-&gt;setShortcut(QKeySequence::Copy);
368     connect(copyShotToClipboardAct, SIGNAL(triggered()), this, SLOT(copyViewToClipBoard()));
369
370     pasteShotFromClipboardAct = new QAction (tr("Paste shot"), this);
371     pasteShotFromClipboardAct-&gt;setShortcut(QKeySequence::Paste);
372     connect(pasteShotFromClipboardAct, SIGNAL(triggered()), this, SLOT(pasteViewFromClipboard()));</pre>
</div>
<p>The paste is very close to what I want, but with control via a simple string (like a http bookmark)
identifying the node, camera position and lookat direction in units of the bbox of the node.</p>
<p>/usr/local/env/graphics/meshlab/meshlab/src/meshlab/mainwindow_RunTime.cpp:</p>
<div class="highlight-python"><pre>623 void MainWindow::viewFrom(QAction *qa)
624 {
625  if(GLA()) GLA()-&gt;createOrthoView(qa-&gt;text());
626 }
627
628 void MainWindow::readViewFromFile()
629 {
630   if(GLA()) GLA()-&gt;viewFromFile();
631     updateMenus();
632 }
633
634
635 void MainWindow::viewFromCurrentMeshShot()
636 {
637   if(GLA()) GLA()-&gt;viewFromCurrentShot("Mesh");
638   updateMenus();
639 }
640
641 void MainWindow::viewFromCurrentRasterShot()
642 {
643   if(GLA()) GLA()-&gt;viewFromCurrentShot("Raster");
644   updateMenus();
645 }
646
647 void MainWindow::copyViewToClipBoard()
648 {
649   if(GLA()) GLA()-&gt;viewToClipboard();
650 }
//
//   TRIGGERING THE PASTE ACTION RESULTS IN THIS BEING SIGNALLED
//
652 void MainWindow::pasteViewFromClipboard()
653 {
654   if(GLA()) GLA()-&gt;viewFromClipboard();
655     updateMenus();
656 }</pre>
</div>
<p>glarea.cpp:</p>
<div class="highlight-python"><pre>1681 void GLArea::viewFromClipboard()
1682 {
1683     QClipboard *clipboard = QApplication::clipboard();
1684     QString shotString = clipboard-&gt;text();
1685     QDomDocument doc("StringDoc");
1686     doc.setContent(shotString);
1687     loadViewFromViewStateFile(doc);
1688 }</pre>
</div>
<div class="highlight-python"><pre>1597 /*
1598 ViewState file is an xml file format created by Meshlab with the action "copyToClipboard"
1599 */
1600 void GLArea::loadViewFromViewStateFile(const QDomDocument &amp;doc)
1601 {
1602     Shotf shot;
1603     QDomElement root = doc.documentElement();
1604     QDomNode node = root.firstChild();
1605
1606     while(!node.isNull())
1607     {
1608         if (QString::compare(node.nodeName(),"VCGCamera")==0)
1609             ReadShotFromQDomNode&lt;Shotf&gt;(shot,node);
1610         else if (QString::compare(node.nodeName(),"CamParam")==0)
1611             ReadShotFromOLDXML&lt;Shotf&gt;(shot,node);
1612
1613         else if (QString::compare(node.nodeName(),"ViewSettings")==0)
1614         {
1615             QDomNamedNodeMap attr = node.attributes();
1616             trackball.track.sca = attr.namedItem("TrackScale").nodeValue().section(' ',0,0).toFloat();
1617             nearPlane = attr.namedItem("NearPlane").nodeValue().section(' ',0,0).toFloat();
1618             farPlane = attr.namedItem("FarPlane").nodeValue().section(' ',0,0).toFloat();
1619             fov = shot.GetFovFromFocal();
1620             clipRatioNear = (getCameraDistance()-nearPlane)/2.0f ;
1621             clipRatioFar = (farPlane-getCameraDistance())/10.0f ;
1622
1623         }
1624         else if (QString::compare(node.nodeName(),"Render")==0)
1625         {
1626             QDomNamedNodeMap attr = node.attributes();
1627             rm.drawMode = (vcg::GLW::DrawMode) (attr.namedItem("DrawMode").nodeValue().section(' ',0,0).toInt());
1628             rm.colorMode = (vcg::GLW::ColorMode) (attr.namedItem("ColorMode").nodeValue().section(' ',0,0).toInt());
1629             rm.textureMode = (vcg::GLW::TextureMode) (attr.namedItem("TextureMode").nodeValue().section(' ',0,0).toInt());
1630             rm.lighting = (attr.namedItem("Lighting").nodeValue().section(' ',0,0).toInt() != 0);
1631             rm.backFaceCull = (attr.namedItem("BackFaceCull").nodeValue().section(' ',0,0).toInt() != 0);
1632             rm.doubleSideLighting = (attr.namedItem("DoubleSideLighting").nodeValue().section(' ',0,0).toInt() != 0);
1633             rm.fancyLighting = (attr.namedItem("FancyLighting").nodeValue().section(' ',0,0).toInt() != 0);
1634             rm.selectedFace = (attr.namedItem("SelectedFace").nodeValue().section(' ',0,0).toInt() != 0);
1635             rm.selectedVert = (attr.namedItem("SelectedVert").nodeValue().section(' ',0,0).toInt() != 0);
1636         }
1637         node = node.nextSibling();
1638     }
1639
1640     loadShot(QPair&lt;Shotf, float&gt; (shot,trackball.track.sca));
1641 }
....
1726 void GLArea::loadShot(const QPair&lt;vcg::Shotf,float&gt; &amp;shotAndScale){
1727
1728     Shotf shot = shotAndScale.first;
1729
1730     fov = shot.GetFovFromFocal();
1731
1732     float cameraDist = getCameraDistance();
1733
1734     //reset trackball. The point of view must be set only by the shot
1735     trackball.Reset();
1736     trackball.track.sca = shotAndScale.second;
1737
1738     /*Point3f point = this-&gt;md()-&gt;bbox().Center();
1739     Point3f p1 = ((trackball.track.Matrix()*(point-trackball.center))- Point3f(0,0,cameraDist));*/
1740     shot2Track(shot, cameraDist,trackball);
1741
....     just comments here
....
1768     update();
1769 }</pre>
</div>
<p>/usr/local/env/graphics/meshlab/meshlab/src/meshlab/glarea.h:</p>
<div class="highlight-python"><pre>479     /*
480     Given a shot "from" and a trackball "track", updates "track" with "from" extrinsics.
481     A traslation involving cameraDistance is included. This is necessary to compensate a trasformation that OpenGL performs
482     at the end of the graphic pipeline.
483     */
484     template &lt;class T&gt;
485     void shot2Track(const vcg::Shot&lt;T&gt; &amp;from, const float cameraDist, vcg::Trackball &amp;tb){
486
487         vcg::Quaternion&lt;T&gt; qfrom; qfrom.FromMatrix(from.Extrinsics.Rot());
488
489         tb.track.rot = vcg::Quaternionf::Construct(qfrom);
490         tb.track.tra =  (vcg::Point3f::Construct(-from.Extrinsics.Tra()));
491         tb.track.tra += vcg::Point3f::Construct(tb.track.rot.Inverse().Rotate(vcg::Point3f(0,0,cameraDist)))*(1/tb.track.sca);
492     }</pre>
</div>
<p>/usr/local/env/graphics/meshlab/vcglib/wrap/qt/shot_qt.h:</p>
<div class="highlight-python"><pre>09 template &lt;class ShotType&gt;
10     bool ReadShotFromQDomNode(
11         ShotType &amp;shot, /// the shot that will contain the read node
12         const QDomNode &amp;node) /// The XML node to be read
13 {
14   typedef typename ShotType::ScalarType ScalarType;
15   typedef vcg::Point3&lt;typename ShotType::ScalarType&gt; Point3x;
16   if(QString::compare(node.nodeName(),"VCGCamera")==0)
17   {
18     QDomNamedNodeMap attr = node.attributes();
19     Point3x tra;
20     tra[0] = attr.namedItem("TranslationVector").nodeValue().section(' ',0,0).toDouble();
21     tra[1] = attr.namedItem("TranslationVector").nodeValue().section(' ',1,1).toDouble();
22     tra[2] = attr.namedItem("TranslationVector").nodeValue().section(' ',2,2).toDouble();
23     shot.Extrinsics.SetTra(-tra);
24
25     vcg::Matrix44&lt;ScalarType&gt; rot;
26     QStringList values =  attr.namedItem("RotationMatrix").nodeValue().split(" ", QString::SkipEmptyParts);
27     for(int y = 0; y &lt; 4; y++)
28       for(int x = 0; x &lt; 4; x++)
29         rot[y][x] = values[x + 4*y].toDouble();
30     shot.Extrinsics.SetRot(rot);
31
32     vcg::Camera&lt;ScalarType&gt; &amp;cam = shot.Intrinsics;
33     cam.FocalMm = attr.namedItem("FocalMm").nodeValue().toDouble();
34     cam.ViewportPx.X() = attr.namedItem("ViewportPx").nodeValue().section(' ',0,0).toInt();
35     cam.ViewportPx.Y() = attr.namedItem("ViewportPx").nodeValue().section(' ',1,1).toInt();
36     cam.CenterPx[0] = attr.namedItem("CenterPx").nodeValue().section(' ',0,0).toInt();
37     cam.CenterPx[1] = attr.namedItem("CenterPx").nodeValue().section(' ',1,1).toInt();
38     cam.PixelSizeMm[0] = attr.namedItem("PixelSizeMm").nodeValue().section(' ',0,0).toDouble();
39     cam.PixelSizeMm[1] = attr.namedItem("PixelSizeMm").nodeValue().section(' ',1,1).toDouble();
40     cam.k[0] = attr.namedItem("LensDistortion").nodeValue().section(' ',0,0).toDouble();
41     cam.k[1] = attr.namedItem("LensDistortion").nodeValue().section(' ',1,1).toDouble();
42
43     // scale correction should no more exist !!!
44     //    float scorr = attr.namedItem("ScaleCorr").nodeValue().toDouble();
45     //    if(scorr != 0.0) {
46     //      cam.PixelSizeMm[0] *= scorr;
47     //      cam.PixelSizeMm[1] *= scorr;
48     //    }
49     return true;
50   }
51   return false;
52 }</pre>
</div>
<p>Hmm need some bbox based shot calculations, /usr/local/env/graphics/meshlab/vcglib/wrap/gl/shot.h:</p>
<div class="highlight-python"><pre>172 /// given a shot and the mesh bounding box, return near and far plane (exact)
173 static void GetNearFarPlanes(vcg::Shot&lt;ScalarType&gt; &amp; shot, vcg::Box3&lt;ScalarType&gt; bbox, ScalarType &amp;nr, ScalarType &amp;fr)
174 {


210 /**********************************
211 DEFINE SHOT FROM TRACKBALL
212 Adds to a given shot the trackball transformations.
213 After this operation the trackball should be resetted, to avoid
214 multiple apply of the same transformation.
215 ***********************************/
216 static void FromTrackball(const vcg::Trackball &amp; tr,
217                           vcg::Shot&lt;ScalarType&gt; &amp; sShot,
218                           vcg::Shot&lt;ScalarType&gt; &amp; shot )
219 {
220     vcg::Point3&lt;ScalarType&gt;     cen; cen.Import(tr.center);
221     vcg::Point3&lt;ScalarType&gt;     tra; tra.Import(tr.track.tra);
222     vcg::Matrix44&lt;ScalarType&gt;   trM; trM.FromMatrix(tr.track.Matrix());
223
224     vcg::Point3&lt;ScalarType&gt;     vp = Inverse(trM)*(sShot.GetViewPoint()-cen) +cen;// +tra;
225
226     shot.SetViewPoint(vp);
227     shot.Extrinsics.SetRot(sShot.Extrinsics.Rot()*trM);
228 //  shot.Extrinsics.sca =   sShot.Extrinsics.sca*(ScalarType)tr.track.sca;
229 }
230 };</pre>
</div>
<p>/usr/local/env/graphics/meshlab/vcglib/vcg/math/shot.h:</p>
<div class="highlight-python"><pre>185   /// look at (point+up)
186   void LookAt(const vcg::Point3&lt;S&gt; &amp; point,const vcg::Point3&lt;S&gt; &amp; up);
187
188   /// look at (opengl-like)
189   void LookAt(const S &amp; eye_x,const S &amp; eye_y,const S &amp; eye_z,
190         const S &amp; at_x,const S &amp; at_y,const S &amp; at_z,
191         const S &amp; up_x,const S &amp; up_y,const S &amp; up_z);
192
193   /// look towards (dir+up)
194   void LookTowards(const vcg::Point3&lt;S&gt; &amp; z_dir,const vcg::Point3&lt;S&gt; &amp; up);
...
330 /// look at (point+up)
331 template &lt;class S, class RotationType&gt;
332 void Shot&lt;S,RotationType&gt;::LookAt(const vcg::Point3&lt;S&gt; &amp; z_dir,const vcg::Point3&lt;S&gt; &amp; up)
333 {
334     LookTowards(z_dir-GetViewPoint(),up);
335 }
336
337 /// look at (opengl-like)
338 template &lt;class S, class RotationType&gt;
339 void Shot&lt;S,RotationType&gt;::LookAt(const S &amp; eye_x, const S &amp; eye_y, const S &amp; eye_z,
340            const S &amp; at_x, const S &amp; at_y, const S &amp; at_z,
341            const S &amp; up_x,const S &amp; up_y,const S &amp; up_z)
342 {
343   SetViewPoint(Point3&lt;S&gt;(eye_x,eye_y,eye_z));
344   LookAt(Point3&lt;S&gt;(at_x,at_y,at_z),Point3&lt;S&gt;(up_x,up_y,up_z));
345 }
346
347 /// look towards
348 template &lt;class S, class RotationType&gt;
349 void Shot&lt;S,RotationType&gt;::LookTowards(const vcg::Point3&lt;S&gt; &amp; z_dir,const vcg::Point3&lt;S&gt; &amp; up)
350 {
351   vcg::Point3&lt;S&gt; x_dir = up ^-z_dir;
352   vcg::Point3&lt;S&gt; y_dir = -z_dir ^x_dir;
353
354   Matrix44&lt;S&gt; m;
355   m.SetIdentity();
356   *(vcg::Point3&lt;S&gt; *)&amp;m[0][0] =  x_dir/x_dir.Norm();
357   *(vcg::Point3&lt;S&gt; *)&amp;m[1][0] =  y_dir/y_dir.Norm();
358   *(vcg::Point3&lt;S&gt; *)&amp;m[2][0] = -z_dir/z_dir.Norm();
359
360   Extrinsics.rot.FromMatrix(m);
361 }</pre>
</div>
</div>
<div class="section" id="succeeded-to-deliver-string-to-glarea-via-dbus-and-signal-slot">
<h2>Succeeded to deliver string to GLArea via DBus and signal/slot<a class="headerlink" href="#succeeded-to-deliver-string-to-glarea-via-dbus-and-signal-slot" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>simon:src blyth$ t meshlab-v
meshlab-v is a function
meshlab-v ()
{
    qdbus com.meshlab.navigator / SayHelloThere ${1:-simon}
}
simon:src blyth$ meshlab-v yo</pre>
</div>
<div class="highlight-python"><pre>Processing Visual Scene child 1 - of type 'extra'
LOG: 0 Opened mesh /usr/local/env/geant4/geometry/gdml/3199.dae in 197 msec
LOG: 0 All files opened in 3126 msec
MyNav::SayHelloThere [ "simon" ]
GLArea::handleNavigateViewer [ "simon" ]
MyNav::SayHelloThere [ "yo" ]
GLArea::handleNavigateViewer [ "yo" ]</pre>
</div>
<div class="highlight-python"><pre>&lt;!DOCTYPE ViewState&gt;
&lt;project&gt;
 &lt;VCGCamera TranslationVector="2323.61 303.412 1334.53 1" LensDistortion="0 0" ViewportPx="1678 906" PixelSizeMm="0.0369161 0.0369161" CenterPx="839 453" FocalMm="28.9651" RotationMatrix="1 0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 "/&gt;
 &lt;ViewSettings NearPlane="1.03109" TrackScale="0.00729556" FarPlane="13.0311"/&gt;
 &lt;Render Lighting="1" DoubleSideLighting="0" SelectedVert="0" ColorMode="0" SelectedFace="0" BackFaceCull="0" FancyLighting="0" DrawMode="5" TextureMode="0"/&gt;
&lt;/project&gt;</pre>
</div>
<div class="highlight-python"><pre>ColladaIOPlugin::open pass the bbox_cache to the MeshModel
LOG: 0 Opened mesh /usr/local/env/geant4/geometry/gdml/3199.dae in 468 msec
LOG: 0 All files opened in 3100 msec
MyNav::SayHelloThere [ "simon" ]
GLArea::handleNavigateViewer [ "simon" ]
**    bbox 0    min -2473.613037 -402.842834 -1849.429443   max -2173.610107 -203.982086 -1650.569336</pre>
</div>
</div>
<div class="section" id="trackball">
<h2>Trackball<a class="headerlink" href="#trackball" title="Permalink to this headline">¶</a></h2>
<p>/usr/local/env/graphics/meshlab/vcglib/wrap/gui/trackball.h:</p>
<div class="highlight-python"><pre>099 class Transform {
100 public:
101   /*!
102     @brief The constructor.
103
104     Initialize:
105     - track to the identity transform.
106     - center to origin 0,0,0.
107     - radius to unit size.
108   */
109   Transform();
110   /// A trackball stores a transformation called 'track' that effectively rototranslate the object.
111   Similarityf track;
112   /// track position in model space.
113   Point3f center;
114   /// size of the widget in model space.
115   float radius;
116 };
...
167 class Trackball: public Transform {
168 public:
...
279   // T(c) S R T(t) T(-c) =&gt; S R T(S^(-1) R^(-1)(c) + t - c)
280   Matrix44f Matrix() const;
281   Matrix44f InverseMatrix() const;
...</pre>
</div>
<p>/usr/local/env/graphics/meshlab/vcglib/vcg/math/similarity.h:</p>
<div class="highlight-python"><pre>103 template &lt;class S,class RotationType = Quaternion&lt;S&gt; &gt; class Similarity {
104 public:
105   Similarity() {}
106   Similarity(const RotationType &amp;q) { SetRotate(q); }
107   Similarity(const Point3&lt;S&gt; &amp;p) { SetTranslate(p); }
108   Similarity(S s) { SetScale(s); }
109     Similarity(S alpha, S beta, S gamma)
110     {
111         rot.FromEulerAngles(alpha, beta, gamma);
112         tra = Point3&lt;S&gt;(0, 0, 0);
113         sca = 1;
114     }
115
116   Similarity operator*(const Similarity &amp;affine) const;
117   Similarity &amp;operator*=(const Similarity &amp;affine);
118   //Point3&lt;S&gt; operator*(const Point3&lt;S&gt; &amp;p) const;
119
120
121   Similarity &amp;SetIdentity();
122   Similarity &amp;SetScale(const S s);
123     Similarity &amp;SetTranslate(const Point3&lt;S&gt; &amp;t);
124   ///use radiants for angle.
125   Similarity &amp;SetRotate(S angle, const Point3&lt;S&gt; &amp; axis);
126   Similarity &amp;SetRotate(const RotationType &amp;q);
127
128   Matrix44&lt;S&gt; Matrix() const;
129   Matrix44&lt;S&gt; InverseMatrix() const;
130   void FromMatrix(const Matrix44&lt;S&gt; &amp;m);
131
132   RotationType rot;
133   Point3&lt;S&gt; tra;
134   S sca;
135 };</pre>
</div>
<p>/usr/local/env/graphics/meshlab/vcglib/wrap/gui/trackball.cpp:</p>
<div class="highlight-python"><pre>33 Transform::Transform() {
34   track.SetIdentity();
35   radius=1.0f;
36   center=Point3f(0,0,0);
37 }
...
109 void Trackball::Apply () {
110   glTranslate (center);
111   glMultMatrix (track.Matrix());
112   glTranslate (-center);
113 }
...
129 // T(c) S R T(t) T(-c) =&gt; S R T(S^(-1) R^(-1)(c) + t - c)
130 Matrix44f Trackball::Matrix() const{
131   #ifndef VCG_USE_EIGEN
132   Matrix44f r; track.rot.ToMatrix(r);
133   Matrix44f sr    = Matrix44f().SetScale(track.sca, track.sca, track.sca) * r;
134   Matrix44f s_inv = Matrix44f().SetScale(1/track.sca, 1/track.sca, 1/track.sca);
135   Matrix44f t     = Matrix44f().SetTranslate(s_inv*r.transpose()*center + track.tra - center);
136
137   return Matrix44f(sr*t);
138   #else
139   Eigen::Quaternionf rot(track.rot);
140   Eigen::Translation3f tr( (1/track.sca) * (rot.inverse() * center) + track.tra - center );
141   return ( Eigen::Scaling3f(track.sca) * (rot * tr) ).matrix();
142   #endif
143 }
144</pre>
</div>
<div class="sidebar">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../meshlab_distribution/" title="MeshLab Distribution"
             >next</a> |</li>
        <li class="right" >
          <a href="../meshlab_collada_materials/" title="MeshLab Collada Materials"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../" >Graphics</a> &raquo;</li>
          <li><a href="../" >meshlab</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>