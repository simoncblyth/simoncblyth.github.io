<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>cms01 DNS HTTP 10 seconds delay &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../" />
    <link rel="up" title="Sys Admin Docs" href="../" />
    <link rel="next" title="Network Troubleshooting" href="../network_troubleshooting/" />
    <link rel="prev" title="CMS02" href="../cms02/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../network_troubleshooting/" title="Network Troubleshooting"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../cms02/" title="CMS02"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>

          <li><a href="../" accesskey="U">Sys Admin Docs</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TODO/">TODO</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Sys Admin</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../monitoring/">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mars/">Mars</a></li>
<li class="toctree-l2"><a class="reference internal" href="../migration/">Migration from Trac/SVN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../SOP/">SOP : for servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cms01/">cms01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cms02/">CMS02</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">cms01 DNS HTTP 10 seconds delay</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network_troubleshooting/">Network Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pycuda/">pycuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../geant4/">geant4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hg/">hg</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/sysadmin/dns.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../cms02/"
                        title="previous chapter">CMS02</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../network_troubleshooting/"
                        title="next chapter">Network Troubleshooting</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="cms01-dns-http-10-seconds-delay">
<h1>cms01 DNS HTTP 10 seconds delay<a class="headerlink" href="#cms01-dns-http-10-seconds-delay" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#cms01-access-monitoring-is-failing" id="id1">cms01 access monitoring is failing</a></li>
<li><a class="reference internal" href="#other-observations" id="id2">Other Observations</a></li>
<li><a class="reference internal" href="#dns-etc-resolv-conf" id="id3">DNS /etc/resolv.conf</a></li>
<li><a class="reference internal" href="#fixed-with-dns-edit" id="id4">Fixed with <tt class="docutils literal"><span class="pre">dns-edit</span></tt></a></li>
</ul>
</div>
<div class="section" id="cms01-access-monitoring-is-failing">
<h2><a class="toc-backref" href="#id1">cms01 access monitoring is failing</a><a class="headerlink" href="#cms01-access-monitoring-is-failing" title="Permalink to this headline">¶</a></h2>
<p>My hourly access/speed test on cms01 began failing about 24hrs ago, sending mails like the below every hour:</p>
<div class="highlight-python"><pre>cms01.phys.ntu.edu.tw : valmon.py -s envmon : 2013-11-20T09:42:02 :    val == 1 : False

  val == 1                                 : False

  summary                                  : all:1 True:0 False:1
  context                                  : {'val': 0.0}


% ~/.env.cnf blyth@cms01.phys.ntu.edu.tw
[envmon]
tn = envmon
instruction = require a single trunk to be found, verifying that the apache interface to SVN is working
return = int
dbpath = ~/.env/envmon.sqlite
cmd = curl -s --connect-timeout 3 http://dayabay.phys.ntu.edu.tw/repos/env/ | grep trunk | wc -l
note = check C2 server from cron on other nodes
email = blyth@hep1.phys.ntu.edu.tw
constraints = ( val == 1, )

date                 val
-------------------  ----------
2013-11-20T09:42:02  0.0
2013-11-20T08:42:01  0.0
2013-11-20T07:42:01  0.0
2013-11-20T06:42:01  0.0
2013-11-20T05:42:01  0.0
2013-11-20T04:42:01  0.0
2013-11-20T03:42:01  0.0
2013-11-20T02:42:02  0.0
2013-11-20T01:42:01  0.0
2013-11-20T00:42:01  0.0
2013-11-19T23:42:01  0.0
2013-11-19T22:42:01  0.0
2013-11-19T21:42:01  0.0
2013-11-19T20:42:01  0.0
2013-11-19T19:42:01  0.0
2013-11-19T18:42:01  0.0
2013-11-19T17:42:03  0.0
2013-11-19T16:42:02  0.0
2013-11-19T15:42:01  0.0
2013-11-19T14:42:01  0.0
2013-11-19T13:42:02  0.0
2013-11-19T12:42:01  0.0
2013-11-19T11:42:01  0.0
2013-11-19T10:42:01  1.0</pre>
</div>
<p>Avoiding DNS lookup avoids the delay:</p>
<div class="highlight-python"><pre>[blyth@cms01 ~]$ time curl http://140.112.101.191/repos/env/ | grep trunk
  &lt;li&gt;&lt;a href="trunk/"&gt;trunk/&lt;/a&gt;&lt;/li&gt;
real    0m0.011s
user    0m0.005s
sys     0m0.002s</pre>
</div>
<p>A reproducible DNS delay of 10 seconds for http GET from cms01 is apparent:</p>
<div class="highlight-python"><pre>[blyth@cms01 ~]$ time curl  http://dayabay.phys.ntu.edu.tw/repos/env/ | grep trunk
  &lt;li&gt;&lt;a href="trunk/"&gt;trunk/&lt;/a&gt;&lt;/li&gt;
real    0m10.012s
user    0m0.005s
sys     0m0.004s

[blyth@cms01 ~]$ time curl  http://dayabay.phys.ntu.edu.tw/repos/env/  | grep trunk
  &lt;li&gt;&lt;a href="trunk/"&gt;trunk/&lt;/a&gt;&lt;/li&gt;
real    0m10.012s
user    0m0.005s
sys     0m0.004s
[blyth@cms01 ~]$</pre>
</div>
<p>Not just from cms02:</p>
<div class="highlight-python"><pre>[blyth@cms01 ~]$ time curl http://www.google.com
&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv="content-type" content="text/html;charset=utf-8"&gt;
&lt;TITLE&gt;302 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;
&lt;H1&gt;302 Moved&lt;/H1&gt;
The document has moved
&lt;A HREF="http://www.google.com.tw/?gws_rd=cr&amp;amp;ei=DCuMUu-rL62RiQe4yYGIBA"&gt;here&lt;/A&gt;.
&lt;/BODY&gt;&lt;/HTML&gt;

real    0m10.125s
user    0m0.005s
sys     0m0.003s
[blyth@cms01 ~]$</pre>
</div>
<p>John sent a mail about DNS recently:</p>
<div class="highlight-python"><pre>One old DNS server 140.112.101.1 was decommissioned by our dept. system
manager, Debbie. If you are still using this DNS in your machine, you will
encounter some problems. Please change to 140.112.254.4 or 140.112.2.2 or other
DNS servers, ex 168.95.1.1 or 8.8.8.8.</pre>
</div>
</div>
<div class="section" id="other-observations">
<h2><a class="toc-backref" href="#id2">Other Observations</a><a class="headerlink" href="#other-observations" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>ssh logins to cms01,cms02,hfag have been slow for the past day, several minutes in some cases</li>
</ol>
</div>
<div class="section" id="dns-etc-resolv-conf">
<h2><a class="toc-backref" href="#id3">DNS /etc/resolv.conf</a><a class="headerlink" href="#dns-etc-resolv-conf" title="Permalink to this headline">¶</a></h2>
<p>How to change DNS ?</p>
<ul class="simple">
<li><a class="reference external" href="http://www.google.com/search?q=linux change DNS server">google:linux change DNS server</a></li>
<li><a class="reference external" href="http://www.rackspace.com/knowledge_center/article/changing-dns-settings-on-linux">http://www.rackspace.com/knowledge_center/article/changing-dns-settings-on-linux</a></li>
<li>add function <tt class="docutils literal"><span class="pre">dns-edit</span></tt> to do this</li>
</ul>
<div class="highlight-python"><pre>[blyth@cms01 ~]$ cat /etc/resolv.conf
search heplocal
search phys.ntu.edu.tw
nameserver 140.112.101.1
nameserver 140.112.2.2
nameserver 168.95.1.1</pre>
</div>
<div class="highlight-python"><pre>[blyth@cms02 ~]$ cat /etc/resolv.conf
nameserver 140.112.101.1

[blyth@cms02 ~]$ curl http://www.google.com
curl: (6) Couldn't resolve host 'www.google.com'</pre>
</div>
<div class="highlight-python"><pre>[blyth@hfag blyth]$ cat /etc/resolv.conf
nameserver 140.112.101.1
search phys.ntu.edu.tw</pre>
</div>
</div>
<div class="section" id="fixed-with-dns-edit">
<h2><a class="toc-backref" href="#id4">Fixed with <tt class="docutils literal"><span class="pre">dns-edit</span></tt></a><a class="headerlink" href="#fixed-with-dns-edit" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>also note that SSH logins are back to normal, that must be doing some DNS lookups</li>
</ol>
<div class="highlight-python"><pre>[blyth@cms01 e]$ dns-
[blyth@cms01 e]$ dns-edit
=== dns-edit : sudo vi /etc/resolv.conf
Password:
[blyth@cms01 e]$
[blyth@cms01 e]$
[blyth@cms01 e]$ time curl -s http://www.google.com
&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv="content-type" content="text/html;charset=utf-8"&gt;
&lt;TITLE&gt;302 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;
&lt;H1&gt;302 Moved&lt;/H1&gt;
The document has moved
&lt;A HREF="http://www.google.com.tw/?gws_rd=cr&amp;amp;ei=-y-MUoPPN-6ZiAfH3oDQBQ"&gt;here&lt;/A&gt;.
&lt;/BODY&gt;&lt;/HTML&gt;

real    0m0.051s
user    0m0.003s
sys     0m0.006s
[blyth@cms01 e]$</pre>
</div>
<div class="sidebar">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../network_troubleshooting/" title="Network Troubleshooting"
             >next</a> |</li>
        <li class="right" >
          <a href="../cms02/" title="CMS02"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>

          <li><a href="../" >Sys Admin Docs</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>