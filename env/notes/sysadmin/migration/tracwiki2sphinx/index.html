<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Conversion of Trac wiki to Sphinx rst &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../../" />
    <link rel="up" title="Migration from Trac/SVN" href="../" />
    <link rel="next" title="Trac2Github" href="../trac2github/" />
    <link rel="prev" title="Migration from Trac/SVN" href="../" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../trac2github/" title="Trac2Github"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../" title="Migration from Trac/SVN"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../" >Sys Admin Docs</a> &raquo;</li>
          <li><a href="../" accesskey="U">Migration from Trac/SVN</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../TODO/">TODO</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../">Sys Admin</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../monitoring/">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mars/">Mars</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../">Migration from Trac/SVN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../SOP/">SOP : for servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cms01/">cms01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cms02/">CMS02</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dns/">cms01 DNS HTTP 10 seconds delay</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network_troubleshooting/">Network Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pycuda/">pycuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../geant4/">geant4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hg/">hg</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../_sources/sysadmin/migration/tracwiki2sphinx.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../"
                        title="previous chapter">Migration from Trac/SVN</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../trac2github/"
                        title="next chapter">Trac2Github</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="conversion-of-trac-wiki-to-sphinx-rst">
<h1>Conversion of Trac wiki to Sphinx rst<a class="headerlink" href="#conversion-of-trac-wiki-to-sphinx-rst" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#status-of-tracwiki2sphinx" id="id1">Status of TracWiki2Sphinx</a><ul>
<li><a class="reference internal" href="#establish-development-cycle-without-the-webserver" id="id2">establish development cycle without the webserver</a></li>
</ul>
</li>
<li><a class="reference internal" href="#strategy" id="id3">Strategy</a></li>
<li><a class="reference internal" href="#trac-formatter-based" id="id4">Trac Formatter based</a></li>
<li><a class="reference internal" href="#metadata-preservation" id="id5">Metadata preservation</a></li>
<li><a class="reference internal" href="#sphinx-access-to-docinfo-metadata" id="id6">Sphinx access to docinfo metadata</a></li>
<li><a class="reference internal" href="#trac-macros-that-i-use" id="id7">Trac Macros that I use</a><ul>
<li><a class="reference internal" href="#tracnav-reponamenav-sidebar-navigation-panel" id="id8">TracNav(ReponameNav) : sidebar navigation panel</a></li>
<li><a class="reference internal" href="#pageoutline" id="id9">PageOutline</a></li>
<li><a class="reference internal" href="#tagcloud" id="id10">TagCloud</a></li>
<li><a class="reference internal" href="#taglist-per-page-tag-listing" id="id11">TagList + per-page tag listing</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="status-of-tracwiki2sphinx">
<h2><a class="toc-backref" href="#id1">Status of TracWiki2Sphinx</a><a class="headerlink" href="#status-of-tracwiki2sphinx" title="Permalink to this headline">¶</a></h2>
<p>Made start (copy of the Trac2MediaWiki) plugin:</p>
<ul class="simple">
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/tracdev/browser/tracwiki2sphinx/trunk/tracwiki2sphinx/converter.py">http://dayabay.phys.ntu.edu.tw/tracs/tracdev/browser/tracwiki2sphinx/trunk/tracwiki2sphinx/converter.py</a></li>
<li><a class="reference external" href="http://localhost/tracs/workflow/wiki/TracWiki2Sphinx">http://localhost/tracs/workflow/wiki/TracWiki2Sphinx</a></li>
</ul>
<div class="highlight-python"><pre>trac-
tracwiki2sphinx-
tracwiki2sphinx-vi</pre>
</div>
<div class="section" id="establish-development-cycle-without-the-webserver">
<h3><a class="toc-backref" href="#id2">establish development cycle without the webserver</a><a class="headerlink" href="#establish-development-cycle-without-the-webserver" title="Permalink to this headline">¶</a></h3>
<p>DONE with standalone MediaWiki converter</p>
<ul class="simple">
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/tracdev/changeset/126">http://dayabay.phys.ntu.edu.tw/tracs/tracdev/changeset/126</a></li>
</ul>
</div>
</div>
<div class="section" id="strategy">
<h2><a class="toc-backref" href="#id3">Strategy</a><a class="headerlink" href="#strategy" title="Permalink to this headline">¶</a></h2>
<p>Approaches:</p>
<blockquote>
<div><ul>
<li><p class="first"><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/tracdev/browser/trac2mediawiki/trunk/0.11/plugins/trac2mediawiki/converter.py">http://dayabay.phys.ntu.edu.tw/tracs/tracdev/browser/trac2mediawiki/trunk/0.11/plugins/trac2mediawiki/converter.py</a></p>
<blockquote>
<div><ul class="simple">
<li>adapt something like this to generate rst, it deals in trac APIs for converters and formatters
so offers some higher lever wins over bare regexp handling, at expense of getting intimate with Trac API</li>
<li>the dependence on trac makes for more complicated development and testing : knocked this for six with standalone converter</li>
<li>XMLRPC access not so useful here, depends on impinging on the Trac conversion machinery that normally creats
html from wikitext, and instead creates rst</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><a class="reference external" href="http://pypi.python.org/pypi/trac2rst">http://pypi.python.org/pypi/trac2rst</a></p>
<blockquote>
<div><ul class="simple">
<li>quick and dirty regexp based</li>
<li>this nicely fits with XMLRPC access to the wikitext</li>
<li><a class="reference external" href="https://bitbucket.org/pcaro/trac2rst/src/9d1b605ac030/src/trac2rst/core.py">https://bitbucket.org/pcaro/trac2rst/src/9d1b605ac030/src/trac2rst/core.py</a></li>
<li>would need to add support for my common trac wiki usage patterns</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="trac-formatter-based">
<h2><a class="toc-backref" href="#id4">Trac Formatter based</a><a class="headerlink" href="#trac-formatter-based" title="Permalink to this headline">¶</a></h2>
<p>Checkout the trac source</p>
<dl class="docutils">
<dt>::</dt>
<dd>trac-
tractrac-
tractrac-cd</dd>
</dl>
<p>Formatters such as Trac2MediaWiki work by extending the trac.wiki.formatter.Formatter
with a large-ish number of specialization formatter methods.
Crucial part of <cite>trac.wiki.formatter.Formatter</cite> subclasses, are the internal handlers with method signature convention <cite>_&lt;type&gt;_formatter(match, fullmatch)</cite>.
The formatter methods as invoked by the <cite>handle_match</cite> method.</p>
<div class="highlight-python"><pre># -- Wiki engine

 def handle_match(self, fullmatch):
     for itype, match in fullmatch.groupdict().items():
         if match and not itype in self.wikiparser.helper_patterns:
             # Check for preceding escape character '!'
             if match[0] == '!':
                 return escape(match[1:])
             if itype in self.wikiparser.external_handlers:
                 external_handler = self.wikiparser.external_handlers[itype]
                 return external_handler(self, match, fullmatch)
             else:
                 internal_handler = getattr(self, '_%s_formatter' % itype)
                 return internal_handler(match, fullmatch)</pre>
</div>
<p>The formatter is plugged into trac component system via:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Trac2MediaWikiPlugin</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="n">implements</span><span class="p">(</span><span class="n">IContentConverter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="metadata-preservation">
<h2><a class="toc-backref" href="#id5">Metadata preservation</a><a class="headerlink" href="#metadata-preservation" title="Permalink to this headline">¶</a></h2>
<p>Need to find Sphinx/RST equivalent representation of Trac metadata, and preserve this in migration:</p>
<ol class="arabic simple">
<li>modification time stamps<ol class="arabic">
<li>migration issue only?</li>
</ol>
</li>
<li>trac tags</li>
<li>tag lists (not really like toctree)</li>
</ol>
</div>
<div class="section" id="sphinx-access-to-docinfo-metadata">
<h2><a class="toc-backref" href="#id6">Sphinx access to docinfo metadata</a><a class="headerlink" href="#sphinx-access-to-docinfo-metadata" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://groups.google.com/forum/?fromgroups#!topic/sphinx-dev/Hszmw8clhrM">https://groups.google.com/forum/?fromgroups#!topic/sphinx-dev/Hszmw8clhrM</a></p>
<p>Investigate in <tt class="docutils literal"><span class="pre">env.sphinxext.taglist</span></tt> looks like only specific metadata keys are read</p>
</div>
<div class="section" id="trac-macros-that-i-use">
<h2><a class="toc-backref" href="#id7">Trac Macros that I use</a><a class="headerlink" href="#trac-macros-that-i-use" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tracnav-reponamenav-sidebar-navigation-panel">
<h3><a class="toc-backref" href="#id8">TracNav(ReponameNav) : sidebar navigation panel</a><a class="headerlink" href="#tracnav-reponamenav-sidebar-navigation-panel" title="Permalink to this headline">¶</a></h3>
<p>Not really equivalent to the Sphinx toctree:</p>
<blockquote>
<div><ul class="simple">
<li>multi document index, not needed at single doc level with Sphinx</li>
<li>will need manual organization as Trac is effectively flat and Sphinx uses a tree</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="pageoutline">
<h3><a class="toc-backref" href="#id9">PageOutline</a><a class="headerlink" href="#pageoutline" title="Permalink to this headline">¶</a></h3>
<p>Inpage content list, translate to:</p>
<div class="highlight-python"><pre>.. contents:: :local:</pre>
</div>
</div>
<div class="section" id="tagcloud">
<h3><a class="toc-backref" href="#id10">TagCloud</a><a class="headerlink" href="#tagcloud" title="Permalink to this headline">¶</a></h3>
<p>Only a few of these</p>
</div>
<div class="section" id="taglist-per-page-tag-listing">
<h3><a class="toc-backref" href="#id11">TagList + per-page tag listing</a><a class="headerlink" href="#taglist-per-page-tag-listing" title="Permalink to this headline">¶</a></h3>
<p>Need a Sphinx extension to handle this, maybe use standard top of doc fieldlist:</p>
<div class="highlight-python"><pre>:tags: Red, Green, Blue</pre>
</div>
<p>And/or extension (assuming can grab the page context and get the metadats tags on that page with local)</p>
<div class="highlight-python"><pre>   .. taglist:: :local:


* http://sphinx.pocoo.org/markup/misc.html</pre>
</div>
<p>Trac taglists are dynamic and provide links to pages featuring those tags,</p>
<blockquote>
<div><ul class="simple">
<li>how to do that possible in Sphinx ?</li>
</ul>
</div></blockquote>
<div class="sidebar">
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../trac2github/" title="Trac2Github"
             >next</a> |</li>
        <li class="right" >
          <a href="../" title="Migration from Trac/SVN"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../" >Sys Admin Docs</a> &raquo;</li>
          <li><a href="../" >Migration from Trac/SVN</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>