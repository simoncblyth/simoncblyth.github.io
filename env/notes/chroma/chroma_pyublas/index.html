<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Chroma Use of PyUblas &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../" />
    <link rel="up" title="chroma" href="../" />
    <link rel="next" title="Chroma Geometry Source Overview" href="../chroma_geometry/" />
    <link rel="prev" title="Getting to know how Chroma uses PyCUDA" href="../chroma_pycuda/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../chroma_geometry/" title="Chroma Geometry Source Overview"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../chroma_pycuda/" title="Getting to know how Chroma uses PyCUDA"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>

          <li><a href="../" accesskey="U">chroma</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pycuda/">pycuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../geant4/">geant4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">chroma</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../G4DAEChroma/">G4DAEChroma</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_issues/">Chroma Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_intersection/">Chroma Intersection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma/">CHROMA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how_chroma_works/">How Chroma Works ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/">Chroma Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../refs/">Chroma Refs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_prerequisites/">Chroma Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_geant4_integration/">Chroma Geant4 Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_nuwa_geant4_integration/">Chroma/NuWa/Geant4 Integration with ZeroMQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_nuwa_integration/">Chroma NuWa Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_cuda_photon/">Chroma CUDA Photon handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_collada/">Chroma COLLADA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_pycuda/">Getting to know how Chroma uses PyCUDA</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Chroma Use of PyUblas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_geometry/">Chroma Geometry Source Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_materials/">Chroma Materials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_propagate/">Photon Propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_physics/">Chroma Physics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_detector/">Chroma Modeling of Sensitive Detectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_server/">Chroma Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_zeromq/">Chroma ZeroMQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_camera/">chroma_camera</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_sim/">chroma_sim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_cuda_freeze/">Chroma CUDA Freeze</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_cuda/">Chroma CUDA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_visualisation/">Chroma Visualisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../photon_mapping/">Photon Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geant4_background/">Geant4 Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cuda_background/">Cuda Threads and Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bvh_background/">Bounding Volume Hierarchy (BVH)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware/">Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_install/">install issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_tests/">tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChromaZMQRootTest/">ChromaZMQRootTest</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_curand/">Chroma Use Of CURand</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_reemission/">Chroma Reemission</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hg/">hg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../simoncblyth.bitbucket.org/">simoncblyth.bitbucket.org</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../numpy/">numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/">Muon Simulation Presentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../optix/">optix</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/chroma/chroma_pyublas.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../chroma_pycuda/"
                        title="previous chapter">Getting to know how Chroma uses PyCUDA</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../chroma_geometry/"
                        title="next chapter">Chroma Geometry Source Overview</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="chroma-use-of-pyublas">
<h1>Chroma Use of PyUblas<a class="headerlink" href="#chroma-use-of-pyublas" title="Permalink to this headline">¶</a></h1>
<p>Chroma uses a Python extension that via pyublas/boost-python/numpy magic
succeeds to pull numpy arrays out of a C++ class member objects
such as  <cite>std::vector&lt;G4ThreeVector&gt; pos</cite></p>
<p>The <cite>pyublas::numpy_vector&lt;double&gt;</cite> templated type is <strong>cool</strong>,
it is usable from C++ with <cite>std::</cite> techniques and yet
also can be passed to python as a numpy array</p>
<ul class="simple">
<li><a class="reference external" href="http://documen.tician.de/pyublas/cpptypes.html">http://documen.tician.de/pyublas/cpptypes.html</a></li>
</ul>
<div class="section" id="using-extension-from-ipython">
<h2>using extension from ipython<a class="headerlink" href="#using-extension-from-ipython" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>In [6]: import chroma.generator._g4chroma as _g4chroma

In [7]: _g4chroma.
_g4chroma.ChromaPhysicsList     _g4chroma.PhotonTrackingAction

In [7]: _g4chroma.PhotonTrackingAction.GetDirX?
Type:       instancemethod
String Form:&lt;unbound method PhotonTrackingAction.GetDirX&gt;
Docstring:
GetDirX( (PhotonTrackingAction)arg1) -&gt; object :

    C++ signature :
        pyublas::numpy_vector&lt;double&gt; GetDirX(PhotonTrackingAction const*)

In [8]: pta = _g4chroma.PhotonTrackingAction()
*** G4Exception : Tracking0001
      issued by : G4UserTrackingAction::G4UserTrackingAction()
 You are instantiating G4UserTrackingAction BEFORE your
G4VUserPhysicsList is instantiated and assigned to G4RunManager.
 Such an instantiation is prohibited since Geant4 version 8.0. To fix this problem,
please make sure that your main() instantiates G4VUserPhysicsList AND
set it to G4RunManager before instantiating other user action classes
such as G4UserTrackingAction.

---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
AssertionError: *** Fatal Exception ***
Severity :


In [9]: import Geant4

In [10]: import g4py

In [11]: g4py.__file__
Out[11]: '/usr/local/env/chroma_env/lib/python2.7/site-packages/g4py/__init__.pyc'

In [12]: g4py??
Type:       module
String Form:&lt;module 'g4py' from '/usr/local/env/chroma_env/lib/python2.7/site-packages/g4py/__init__.pyc'&gt;
File:       /usr/local/env/chroma_env/lib/python2.7/site-packages/g4py/__init__.py
Source:
# $Id: __init__.py,v 1.1 2008-12-01 07:02:47 kmura Exp $
# Geant4Py site-modules

In [14]: Geant4.gRunManager
Out[14]: &lt;Geant4.G4run.G4RunManager at 0x10a591e68&gt;

In [15]: physics_list = _g4chroma.ChromaPhysicsList()

In [17]: Geant4.gRunManager.SetUserInitialization(physics_list)

In [18]: tracking_action = _g4chroma.PhotonTrackingAction()

In [19]: tracking_action.GetNumPhotons()
Out[19]: 0</pre>
</div>
</div>
<div class="section" id="test-setters">
<h2>test setters<a class="headerlink" href="#test-setters" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>In [1]: import chroma.generator._g4chroma as _g4chroma

In [2]: _g4chroma.PhotonTrackingAction.SetX?
Type:       instancemethod
String Form:&lt;unbound method PhotonTrackingAction.SetX&gt;
Docstring:
SetX( (PhotonTrackingAction)arg1, (numpy.ndarray)arg2) -&gt; None :

    C++ signature :
        void SetX(PhotonTrackingAction*,pyublas::numpy_vector&lt;double&gt;)

In [3]: from Geant4 import gRunManager

In [4]: physics_list = _g4chroma.ChromaPhysicsList()

In [5]: gRunManager.SetUserInitialization(physics_list)

In [6]: pta = _g4chroma.PhotonTrackingAction()

In [7]: pta.GetNumPhotons()
Out[7]: 0

In [8]: pta.AssignNumPhotons(1000)

In [9]: pta.GetNumPhotons()
Out[9]: 1000


In [11]: import numpy as np

In [27]: x = 10*np.ones(1000,np.float32)

In [28]: pta.SetX(x)
---------------------------------------------------------------------------
ArgumentError                             Traceback (most recent call last)
&lt;ipython-input-28-d38581056cf9&gt; in &lt;module&gt;()
----&gt; 1 pta.SetX(x)

ArgumentError: Python argument types in
    PhotonTrackingAction.SetX(PhotonTrackingAction, numpy.ndarray)
did not match C++ signature:
    SetX(PhotonTrackingAction*, pyublas::numpy_vector&lt;double&gt;)

In [29]: x = 10*np.ones(1000,np.float64)

In [33]: x[10] = 123

In [34]: pta.SetX(x)

In [38]: xx2 = pta.GetX()

In [39]: xx2
Out[39]:
array([  10.,   10.,   10.,   10.,   10.,   10.,   10.,   10.,   10.,
         10.,  123.,   10.,   10.,   10.,   10.,   10.,   10.,   10.,</pre>
</div>
</div>
<div class="section" id="extension-setup">
<h2>extension setup<a class="headerlink" href="#extension-setup" title="Permalink to this headline">¶</a></h2>
<p><cite>chroma/setup.py</cite>:</p>
<div class="highlight-python"><pre>//   config to find libs and headers skipped
//
59 setup(
60     name = 'Chroma',
61     version = '0.5',
62     packages = find_packages(),
63     include_package_data=True,
64
65     scripts = ['bin/chroma-sim', 'bin/chroma-cam',
66                'bin/chroma-geo', 'bin/chroma-bvh',
67                'bin/chroma-server'],
68     ext_modules = [
69         Extension('chroma.generator._g4chroma',
70                   ['src/G4chroma.cc'],
71                   include_dirs=include_dirs,
72                   extra_compile_args=geant4_cflags,
73                   extra_link_args=geant4_libs+clhep_libs,
74                   extra_objects=extra_objects,
75                   libraries=libraries,
76                   ),
77         Extension('chroma.generator.mute',
78                   ['src/mute.cc'],
79                   include_dirs=include_dirs,
80                   extra_compile_args=geant4_cflags,
81                   extra_link_args=geant4_libs+clhep_libs,
82                   extra_objects=extra_objects,
83                   libraries=libraries),
84         ],
85
86     setup_requires = ['pyublas'],</pre>
</div>
</div>
<div class="section" id="build-extension-with-setters-added">
<h2>build extension with setters added<a class="headerlink" href="#build-extension-with-setters-added" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>(chroma_env)delta:chroma blyth$ python setup.py build_ext
running build_ext
building 'chroma.generator._g4chroma' extension
C compiler: /usr/bin/clang -fno-strict-aliasing -fno-common -dynamic -pipe -Os -fwrapv -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes

compile options: '-Isrc -I/usr/local/env/chroma_env/lib/python2.7/site-packages/pyublas/include -I/usr/local/env/chroma_env/include -I/opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/numpy/core/include -I/opt/local/Library/Frameworks/Python.framework/Versions/2.7/include/python2.7 -c'
extra options: '-DG4INTY_USE_XT -I/usr/X11R6/include -I/opt/local/include -DG4UI_USE_TCSH -DG4VIS_USE_RAYTRACERX -I/usr/local/env/chroma_env/bin/../include/Geant4'
clang: src/G4chroma.cc
In file included from src/G4chroma.cc:136:
In file included from /usr/local/env/chroma_env/lib/python2.7/site-packages/pyublas/include/pyublas/numpy.hpp:40:
In file included from /opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/numpy/core/include/numpy/arrayobject.h:4:
In file included from /opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/numpy/core/include/numpy/ndarrayobject.h:17:
In file included from /opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/numpy/core/include/numpy/ndarraytypes.h:1760:
/opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:15:2: warning: "Using deprecated NumPy API, disable it by "          "#defining NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION" [-W#warnings]
#warning "Using deprecated NumPy API, disable it by " \
 ^
1 warning generated.
/usr/bin/clang++ -bundle -undefined dynamic_lookup -L/opt/local/lib -Wl,-headerpad_max_install_names -L/opt/local/lib/db46 build/temp.macosx-10.9-x86_64-2.7/src/G4chroma.o -lboost_python -o build/lib.macosx-10.9-x86_64-2.7/chroma/generator/_g4chroma.so -L/usr/local/env/chroma_env/bin/../lib -lG4Tree -lG4FR -lG4GMocren -lG4visHepRep -lG4RayTracer -lG4VRML -lG4vis_management -lG4modeling -lG4interfaces -lG4persistency -lG4analysis -lG4error_propagation -lG4readout -lG4physicslists -lG4run -lG4event -lG4tracking -lG4parmodels -lG4processes -lG4digits_hits -lG4track -lG4particles -lG4geometry -lG4materials -lG4graphics_reps -lG4intercoms -lG4global -lG4clhep
(chroma_env)delta:chroma blyth$</pre>
</div>
</div>
<div class="section" id="usage-of-g4chroma-extension">
<h2>Usage of G4chroma extension<a class="headerlink" href="#usage-of-g4chroma-extension" title="Permalink to this headline">¶</a></h2>
<p><cite>chroma/chroma/generator/g4gen.py</cite>:</p>
<div class="highlight-python"><pre>003 import pyublas
 ..
 14 from chroma.generator import _g4chroma
 ..
 19 class G4Generator(object):
 20     def __init__(self, material, seed=None):
 ..
 50         self.tracking_action = _g4chroma.PhotonTrackingAction()
 51         gRunManager.SetUserAction(self.tracking_action)
 ..
 79     def _extract_photons_from_tracking_action(self, sort=True):
 80         n = self.tracking_action.GetNumPhotons()
 81         pos = np.zeros(shape=(n,3), dtype=np.float32)
 82         pos[:,0] = self.tracking_action.GetX()
 83         pos[:,1] = self.tracking_action.GetY()
 84         pos[:,2] = self.tracking_action.GetZ()
 ..
 96         wavelengths = self.tracking_action.GetWavelength().astype(np.float32)
 97
 98         t0 = self.tracking_action.GetT0().astype(np.float32)
 ..
108         return Photons(pos, dir, pol, wavelengths, t0)</pre>
</div>
</div>
<div class="section" id="g4chroma-extension">
<h2>G4chroma extension<a class="headerlink" href="#g4chroma-extension" title="Permalink to this headline">¶</a></h2>
<p><cite>chroma/src/G4chroma.hh</cite>:</p>
<div class="highlight-python"><pre>17 class PhotonTrackingAction : public G4UserTrackingAction
18 {
19 public:
20   PhotonTrackingAction();
21   virtual ~PhotonTrackingAction();
22
23   int GetNumPhotons() const;
24   void Clear();
25
26   void GetX(double *x) const;
27   void GetY(double *y) const;
28   void GetZ(double *z) const;
29   void GetDirX(double *dir_x) const;
30   void GetDirY(double *dir_y) const;
31   void GetDirZ(double *dir_z) const;
32   void GetPolX(double *pol_x) const;
33   void GetPolY(double *pol_y) const;
34   void GetPolZ(double *pol_z) const;
35
36   void GetWavelength(double *wl) const;
37   void GetT0(double *t) const;
38
39   virtual void PreUserTrackingAction(const G4Track *);
40
41 protected:
42   std::vector&lt;G4ThreeVector&gt; pos;
43   std::vector&lt;G4ThreeVector&gt; dir;
44   std::vector&lt;G4ThreeVector&gt; pol;
45   std::vector&lt;double&gt; wavelength;
46   std::vector&lt;double&gt; t0;
47 };</pre>
</div>
<p><cite>chroma/src/G4chroma.cc</cite>:</p>
<div class="highlight-python"><pre>///
/// fills array passed from contained vector
///
050 void PhotonTrackingAction::GetX(double *x) const
 51 {
 52   for (unsigned i=0; i &lt; pos.size(); i++) x[i] = pos[i].x();
 53 }
...
118 #include &lt;boost/python.hpp&gt;
119 #include &lt;pyublas/numpy.hpp&gt;
120
121 using namespace boost::python;
122
///
///   becomes the `pta.GetX()` python member func returning numpy arrays
///
123 pyublas::numpy_vector&lt;double&gt; PTA_GetX(const PhotonTrackingAction *pta)
124 {
125   pyublas::numpy_vector&lt;double&gt; r(pta-&gt;GetNumPhotons());
126   pta-&gt;GetX(&amp;r[0]);
127   return r;
128 }
...
201 void export_Chroma()
202 {
203   class_&lt;ChromaPhysicsList, ChromaPhysicsList*, bases&lt;G4VModularPhysicsList&gt;, boost::noncopyable &gt; ("ChromaPhysicsList", "EM+Optics physics list")
204     .def(init&lt;&gt;())
205     ;
206
207   class_&lt;PhotonTrackingAction, PhotonTrackingAction*, bases&lt;G4UserTrackingAction&gt;,
208      boost::noncopyable &gt; ("PhotonTrackingAction", "Tracking action that saves photons")
209     .def(init&lt;&gt;())
210     .def("GetNumPhotons", &amp;PhotonTrackingAction::GetNumPhotons)
211     .def("Clear", &amp;PhotonTrackingAction::Clear)
212     .def("GetX", PTA_GetX)
213     .def("GetY", PTA_GetY)
214     .def("GetZ", PTA_GetZ)
215     .def("GetDirX", PTA_GetDirX)
216     .def("GetDirY", PTA_GetDirY)
217     .def("GetDirZ", PTA_GetDirZ)
218     .def("GetPolX", PTA_GetPolX)
219     .def("GetPolY", PTA_GetPolY)
220     .def("GetPolZ", PTA_GetPolZ)
221     .def("GetWavelength", PTA_GetWave)
222     .def("GetT0", PTA_GetT0)
223     ;
224 }
225
226 BOOST_PYTHON_MODULE(_g4chroma)
227 {
228   export_Chroma();
229 }</pre>
</div>
</div>
<div class="section" id="pyublas">
<h2>PyUblas<a class="headerlink" href="#pyublas" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://mathema.tician.de/software/pyublas/">http://mathema.tician.de/software/pyublas/</a></li>
</ul>
<p>PyUblas provides a seamless glue layer between Numpy and Boost.Ublas for use with Boost.Python.</p>
<ul class="simple">
<li><a class="reference external" href="http://documen.tician.de/pyublas/">http://documen.tician.de/pyublas/</a></li>
<li><a class="reference external" href="http://www.boost.org/libs/numeric/ublas">http://www.boost.org/libs/numeric/ublas</a></li>
<li><a class="reference external" href="http://documen.tician.de/pyublas/cpptypes.html">http://documen.tician.de/pyublas/cpptypes.html</a></li>
</ul>
<div class="sidebar">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../chroma_geometry/" title="Chroma Geometry Source Overview"
             >next</a> |</li>
        <li class="right" >
          <a href="../chroma_pycuda/" title="Getting to know how Chroma uses PyCUDA"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>

          <li><a href="../" >chroma</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>