<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Chroma Modeling of Sensitive Detectors &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../" />
    <link rel="up" title="chroma" href="../" />
    <link rel="next" title="Chroma Server" href="../chroma_server/" />
    <link rel="prev" title="Chroma Physics" href="../chroma_physics/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../chroma_server/" title="Chroma Server"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../chroma_physics/" title="Chroma Physics"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>

          <li><a href="../" accesskey="U">chroma</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pycuda/">pycuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../geant4/">geant4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">chroma</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../chroma_issues/">Chroma Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma/">CHROMA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how_chroma_works/">How Chroma Works ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/">Chroma Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../refs/">Chroma Refs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_prerequisites/">Chroma Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_geant4_integration/">Chroma Geant4 Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_nuwa_geant4_integration/">Chroma/NuWa/Geant4 Integration with ZeroMQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_nuwa_integration/">Chroma NuWa Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_cuda_photon/">Chroma CUDA Photon handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_collada/">Chroma COLLADA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_pycuda/">Getting to know how Chroma uses PyCUDA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_geometry/">Chroma Geometry Source Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_materials/">Chroma Materials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_propagate/">Photon Propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_physics/">Chroma Physics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Chroma Modeling of Sensitive Detectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_server/">Chroma Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_zeromq/">Chroma ZeroMQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_camera/">chroma_camera</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_sim/">chroma_sim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_cuda_freeze/">Chroma CUDA Freeze</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_cuda/">Chroma CUDA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_visualisation/">Chroma Visualisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geant4_background/">Geant4 Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cuda_background/">Cuda Threads and Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bvh_background/">Bounding Volume Hierarchy (BVH)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware/">Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_install/">install issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chroma_tests/">tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChromaZMQRootTest/">ChromaZMQRootTest</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hg/">hg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../simoncblyth.bitbucket.org/">simoncblyth.bitbucket.org</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/chroma/chroma_detector.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../chroma_physics/"
                        title="previous chapter">Chroma Physics</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../chroma_server/"
                        title="next chapter">Chroma Server</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="chroma-modeling-of-sensitive-detectors">
<h1>Chroma Modeling of Sensitive Detectors<a class="headerlink" href="#chroma-modeling-of-sensitive-detectors" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#questions" id="id1">Questions</a></li>
<li><a class="reference internal" href="#chroma-geometry-py" id="id2">chroma/geometry.py</a></li>
<li><a class="reference internal" href="#chroma-detector-py" id="id3">chroma/detector.py</a></li>
<li><a class="reference internal" href="#chroma-gpu-detector-py" id="id4">chroma/gpu/detector.py</a></li>
<li><a class="reference internal" href="#chroma-gpu-daq-py" id="id5">chroma/gpu/daq.py</a></li>
<li><a class="reference internal" href="#chroma-cuda-photon-h" id="id6">chroma/cuda/photon.h</a></li>
<li><a class="reference internal" href="#chroma-cuda-daq-cu" id="id7">chroma/cuda/daq.cu</a></li>
</ul>
</div>
<div class="section" id="questions">
<h2><a class="toc-backref" href="#id1">Questions</a><a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>How hits are handled in Chroma ?</li>
</ol>
</div>
<div class="section" id="chroma-geometry-py">
<h2><a class="toc-backref" href="#id2">chroma/geometry.py</a><a class="headerlink" href="#chroma-geometry-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>103 class Solid(object):
104     """Solid object attaches materials, surfaces, and colors to each triangle
105     in a Mesh object."""
106     def __init__(self, mesh, material1=None, material2=None, surface=None, color=0x33ffffff):
107         self.mesh = mesh


/// collection of solids, maybe with a material flagged as a detector_material

261 class Geometry(object):
262     "Geometry object."
263     def __init__(self, detector_material=None):
264         self.detector_material = detector_material
265         self.solids = []
266         self.solid_rotations = []
267         self.solid_displacements = []
268         self.bvh = None</pre>
</div>
</div>
<div class="section" id="chroma-detector-py">
<h2><a class="toc-backref" href="#id3">chroma/detector.py</a><a class="headerlink" href="#chroma-detector-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>05 class Detector(Geometry):
06     '''A Detector is a subclass of Geometry that allows some Solids
07     to be marked as photon detectors, which we will suggestively call
08     "PMTs."  Each detector is imagined to be connected to an electronics
09     channel that records a hit time and charge.
10
11     Each PMT has two integers identifying it: a channel index and a
12     channel ID.  When all of the channels in the detector are stored
13     in a Numpy array, they will be stored in index order.  Channel
14     indices star from zero and have no gaps.  Channel ID numbers are
15     arbitrary integers that identify a PMT uniquely in a stable way.
16     They are written out to disk when using the Chroma ROOT format,
17     and are used when reading events back in to map channels back
18     into the correct array index.
19
20     For now, all the PMTs share a single set of time and charge
21     distributions.  In the future, this will be generalized to
22     allow per-channel distributions.
23     '''
24
25     def __init__(self, detector_material=None):
26         Geometry.__init__(self, detector_material=detector_material)
27
28         # Using numpy arrays here to allow for fancy indexing
29         self.solid_id_to_channel_index = np.zeros(0, dtype=np.int32)
30         self.channel_index_to_solid_id = np.zeros(0, dtype=np.int32)
31
32         self.channel_index_to_channel_id = np.zeros(0, dtype=np.int32)
33
34         # If the ID numbers are arbitrary, we can't treat them
35         # as array indices, so have to use a dictionary
36         self.channel_id_to_channel_index = {}
37
38         # zero time and unit charge distributions
39         self.time_cdf = (np.array([-0.01, 0.01]), np.array([0.0, 1.0]))
40         self.charge_cdf = (np.array([0.99, 1.00]), np.array([0.0, 1.0]))</pre>
</div>
</div>
<div class="section" id="chroma-gpu-detector-py">
<h2><a class="toc-backref" href="#id4">chroma/gpu/detector.py</a><a class="headerlink" href="#chroma-gpu-detector-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>14 class GPUDetector(GPUGeometry):
15     def __init__(self, detector, wavelengths=None, print_usage=False):
16         GPUGeometry.__init__(self, detector, wavelengths=wavelengths, print_usage=False)
17         self.solid_id_to_channel_index_gpu = \
18             ga.to_gpu(detector.solid_id_to_channel_index.astype(np.int32))
19         self.nchannels = detector.num_channels()
20
21
22         self.time_cdf_x_gpu = ga.to_gpu(detector.time_cdf[0].astype(np.float32))
23         self.time_cdf_y_gpu = ga.to_gpu(detector.time_cdf[1].astype(np.float32))
24
25         self.charge_cdf_x_gpu = ga.to_gpu(detector.charge_cdf[0].astype(np.float32))
26         self.charge_cdf_y_gpu = ga.to_gpu(detector.charge_cdf[1].astype(np.float32))
27
28         detector_source = get_cu_source('detector.h')
29         detector_struct_size = characterize.sizeof('Detector', detector_source)
30         self.detector_gpu = make_gpu_struct(detector_struct_size,
31                                             [self.solid_id_to_channel_index_gpu,
32                                              self.time_cdf_x_gpu,
33                                              self.time_cdf_y_gpu,
34                                              self.charge_cdf_x_gpu,
35                                              self.charge_cdf_y_gpu,
36                                              np.int32(self.nchannels),
37                                              np.int32(len(detector.time_cdf[0])),
38                                              np.int32(len(detector.charge_cdf[0])),
39                                              np.float32(detector.charge_cdf[0][-1] / 2**16)])</pre>
</div>
<p>Crucial connection between solids and channels, handled in <strong>solid_id_to_channel_index[solid_id]</strong>.
This distinquishes sensitive solids (PMTs).:</p>
<div class="highlight-python"><pre>simon:chroma blyth$ find . -name '*.*' -exec grep -H solid_id_to_channel_index {} \;
./cuda/daq.cu:      int channel_index = detector-&gt;solid_id_to_channel_index[solid_id];
./cuda/daq.cu:      channel_index = detector-&gt;solid_id_to_channel_index[solid_id];
./cuda/detector.h:    int *solid_id_to_channel_index;
./detector.py:        self.solid_id_to_channel_index = np.zeros(0, dtype=np.int32)
./detector.py:        self.solid_id_to_channel_index.resize(solid_id+1)
./detector.py:        self.solid_id_to_channel_index[solid_id] = -1 # solid maps to no channel
./detector.py:        self.solid_id_to_channel_index[solid_id] = channel_index
./gpu/daq.py:        self.solid_id_to_channel_index_gpu = gpu_detector.solid_id_to_channel_index_gpu
./gpu/detector.py:        self.solid_id_to_channel_index_gpu = \
./gpu/detector.py:            ga.to_gpu(detector.solid_id_to_channel_index.astype(np.int32))
./gpu/detector.py:                                            [self.solid_id_to_channel_index_gpu,</pre>
</div>
</div>
<div class="section" id="chroma-gpu-daq-py">
<h2><a class="toc-backref" href="#id5">chroma/gpu/daq.py</a><a class="headerlink" href="#chroma-gpu-daq-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>60     def acquire(self, gpuphotons, rng_states, nthreads_per_block=64, max_blocks=1024, start_photon=None, nphotons=None, weight=1.0):
61         if start_photon is None:
62             start_photon = 0
63         if nphotons is None:
64             nphotons = len(gpuphotons.pos) - start_photon
65
66         if self.ndaq == 1:
67             for first_photon, photons_this_round, blocks in \
68                     chunk_iterator(nphotons, nthreads_per_block, max_blocks):
69                 self.gpu_funcs.run_daq(rng_states, np.uint32(0x1 &lt;&lt; 2),
70                                        np.int32(start_photon+first_photon), np.int32(photons_this_round), gpuphotons.t,
71                                        gpuphotons.flags, gpuphotons.last_hit_triangles, gpuphotons.weights,
72                                        self.solid_id_map_gpu,
73                                        self.detector_gpu,
74                                        self.earliest_time_int_gpu,
75                                        self.channel_q_int_gpu, self.channel_history_gpu,
76                                        np.float32(weight),
77                                        block=(nthreads_per_block,1,1), grid=(blocks,1))</pre>
</div>
</div>
<div class="section" id="chroma-cuda-photon-h">
<h2><a class="toc-backref" href="#id6">chroma/cuda/photon.h</a><a class="headerlink" href="#chroma-cuda-photon-h" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>47 enum
48 {
49     NO_HIT           = 0x1 &lt;&lt; 0,
50     BULK_ABSORB      = 0x1 &lt;&lt; 1,
51     SURFACE_DETECT   = 0x1 &lt;&lt; 2,
52     SURFACE_ABSORB   = 0x1 &lt;&lt; 3,
53     RAYLEIGH_SCATTER = 0x1 &lt;&lt; 4,
54     REFLECT_DIFFUSE  = 0x1 &lt;&lt; 5,
55     REFLECT_SPECULAR = 0x1 &lt;&lt; 6,
56     SURFACE_REEMIT   = 0x1 &lt;&lt; 7,
57     SURFACE_TRANSMIT = 0x1 &lt;&lt; 8,
58     BULK_REEMIT      = 0x1 &lt;&lt; 9,
59     NAN_ABORT        = 0x1 &lt;&lt; 31
60 }; // processes</pre>
</div>
<div class="highlight-python"><pre>In [16]: np.uint32(0x1 &lt;&lt; 2)
Out[16]: 4</pre>
</div>
</div>
<div class="section" id="chroma-cuda-daq-cu">
<h2><a class="toc-backref" href="#id7">chroma/cuda/daq.cu</a><a class="headerlink" href="#chroma-cuda-daq-cu" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>how do the <em>sample_cdf</em> compare with those from Geant4 ?</li>
</ul>
<p>Sequence:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">photon_id</span> <span class="o">&gt;</span> <span class="n">triangle_id</span> <span class="o">&gt;</span> <span class="n">solid_id</span> <span class="o">&gt;</span> <span class="n">channel_index</span>
</pre></div>
</div>
<div class="highlight-python"><pre>35 __global__ void
36 run_daq(curandState *s, unsigned int detection_state,
37     int first_photon, int nphotons, float *photon_times,
38     unsigned int *photon_histories, int *last_hit_triangles,
39     float *weights,
40     int *solid_map,
41     Detector *detector,
42     unsigned int *earliest_time_int,
43     unsigned int *channel_q_int, unsigned int *channel_histories,
44     float global_weight)
45 {
46
47     int id = threadIdx.x + blockDim.x * blockIdx.x;
48
49     if (id &lt; nphotons) {
50     curandState rng = s[id];
51     int photon_id = id + first_photon;
52     int triangle_id = last_hit_triangles[photon_id];
53
54     if (triangle_id &gt; -1) {
55         int solid_id = solid_map[triangle_id];
56         unsigned int history = photon_histories[photon_id];
57         int channel_index = detector-&gt;solid_id_to_channel_index[solid_id];
58
59         if (channel_index &gt;= 0 &amp;&amp; (history &amp; detection_state)) {                  // SURFACE_DETECT flagged in history
60
61         float weight = weights[photon_id] * global_weight;
62         if (curand_uniform(&amp;rng) &lt; weight) {
63             float time = photon_times[photon_id] +
64             sample_cdf(&amp;rng, detector-&gt;time_cdf_len,
65                    detector-&gt;time_cdf_x, detector-&gt;time_cdf_y);
66             unsigned int time_int = float_to_sortable_int(time);
67
68             float charge = sample_cdf(&amp;rng, detector-&gt;charge_cdf_len,
69                       detector-&gt;charge_cdf_x,
70                       detector-&gt;charge_cdf_y);
71             unsigned int charge_int = roundf(charge / detector-&gt;charge_unit);
72
73             atomicMin(earliest_time_int + channel_index, time_int);
74             atomicAdd(channel_q_int + channel_index, charge_int);
75             atomicOr(channel_histories + channel_index, history);
76         } // if weighted photon contributes
77
78         } // if photon detected by a channel
79
80     } // if photon terminated on surface
81
82     s[id] = rng;
83
84     }
85
86 }</pre>
</div>
<div class="sidebar">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../chroma_server/" title="Chroma Server"
             >next</a> |</li>
        <li class="right" >
          <a href="../chroma_physics/" title="Chroma Physics"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>

          <li><a href="../" >chroma</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>