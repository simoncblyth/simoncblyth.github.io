<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>HG Convert of env repo from SVN to HG &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../" />
    <link rel="up" title="hg" href="../" />
    <link rel="prev" title="hg convert" href="../hg_convert/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../hg_convert/" title="hg convert"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>

          <li><a href="../" accesskey="U">hg</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pycuda/">pycuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../geant4/">geant4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../osx/">osx</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">hg</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../hg_convert/">hg convert</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">HG Convert of env repo from SVN to HG</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/hg/hg_convert_env.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../hg_convert/"
                        title="previous chapter">hg convert</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="hg-convert-of-env-repo-from-svn-to-hg">
<h1>HG Convert of env repo from SVN to HG<a class="headerlink" href="#hg-convert-of-env-repo-from-svn-to-hg" title="Permalink to this headline">Â¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#svn-env-r1599-causing-grief" id="id1">SVN env r1599 causing grief</a></li>
<li><a class="reference internal" href="#svn-tree-conflict" id="id2">SVN Tree Conflict</a></li>
<li><a class="reference internal" href="#resolved-degeneracy-back-again" id="id3">[RESOLVED] Degeneracy Back again</a></li>
<li><a class="reference internal" href="#and-this-directory-link" id="id4">And this directory link ?</a></li>
<li><a class="reference internal" href="#resolved-credentials-callback-from-r731" id="id5">[RESOLVED] Credentials callback from r731</a></li>
<li><a class="reference internal" href="#resolved-what-is-special-about-this-stretch-of-svn-history" id="id6">[RESOLVED] What is special about this stretch of SVN history ?</a></li>
<li><a class="reference internal" href="#maybe-resolved-too" id="id7">Maybe resolved too ?</a></li>
<li><a class="reference internal" href="#directory-symbolic-links-need-separate-handling" id="id8">Directory symbolic links need separate handling</a></li>
<li><a class="reference internal" href="#resolved-comparison-needs-to-apply-the-filemap" id="id9">[RESOLVED] Comparison needs to apply the filemap</a></li>
<li><a class="reference internal" href="#dud-svn-rev-10" id="id10">Dud svn rev 10</a></li>
<li><a class="reference internal" href="#other-issues" id="id11">Other issues</a></li>
<li><a class="reference internal" href="#resolved-case-folding-collision" id="id12">[RESOLVED] Case folding collision</a></li>
<li><a class="reference internal" href="#hg-only" id="id13">hg only</a></li>
<li><a class="reference internal" href="#svn-only" id="id14">svn only</a></li>
</ul>
</div>
<div class="section" id="svn-env-r1599-causing-grief">
<h2><a class="toc-backref" href="#id1">SVN env r1599 causing grief</a><a class="headerlink" href="#svn-env-r1599-causing-grief" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python"><pre>INFO:env.scm.migration.compare_hg_svn:compare_contents paths 499 svn_digest 499 hg_digest 499 mismatch 0  svn_only 0 hg_only 0
INFO:env.scm.migration.compare_hg_svn:hgrev 1586 svnrev 1599 hgrev-svnrev -13
INFO:env.svn.bindings.svnclient:checkout file:///var/scm/subversion/env/trunk rev 1599 to /tmp/subversion/env/ clean True
INFO:env.svn.bindings.svnclient:rmtree /tmp/subversion/env/
Traceback (most recent call last):
File "/Users/blyth/env/bin/compare_hg_svn.py", line 4, in &lt;module&gt;
    main()
File "/usr/local/env/adm_env/lib/python2.7/site-packages/env/scm/migration/compare_hg_svn.py", line 353, in main
    cf.compare(hgrev, svnrev)
File "/usr/local/env/adm_env/lib/python2.7/site-packages/env/scm/migration/compare_hg_svn.py", line 244, in compare
    self.recurse(*hs)
File "/usr/local/env/adm_env/lib/python2.7/site-packages/env/scm/migration/compare_hg_svn.py", line 164, in recurse
    self.svn.recurse(svnrev)
File "/usr/local/env/adm_env/lib/python2.7/site-packages/env/svn/bindings/svnclient.py", line 146, in recurse
    self.checkout(rev, clean=clean)
File "/usr/local/env/adm_env/lib/python2.7/site-packages/env/svn/bindings/svnclient.py", line 135, in checkout
    self.client.checkout(self.url, self.path, revision=rev_(rev), ignore_externals=self.ignore_externals)
pysvn._pysvn_2_7.ClientError: Revision 1599 doesn't match existing revision 1598 in '/tmp/subversion/env'
(adm_env)delta:~ blyth$</pre>
</div>
</div>
<div class="section" id="svn-tree-conflict">
<h2><a class="toc-backref" href="#id2">SVN Tree Conflict</a><a class="headerlink" href="#svn-tree-conflict" title="Permalink to this headline">Â¶</a></h2>
<p>Cannot navigate through this slice of history, get tree conflicts.
This means that the comparisons with the hg convert fail.</p>
<ul class="simple">
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1599">http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1599</a> 1586  thho modifies trunk/thho/NuWa/python/histogram/pyhist.py</li>
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1600">http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1600</a> 1587  thho copies trunk/thho/NuWa/python/histogram/pyhist.py to trunk/thho/NuWa/python/histogram/PyHist.py</li>
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1601">http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1601</a> 1588  thho removes trunk/thho/NuWa/python/histogram/pyhist.py</li>
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1715">http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1715</a>       thho removes trunk/thho/NuWa/python</li>
<li><a class="reference external" href="http://blogs.collab.net/subversion/subversion-160-and-tree-conflicts#.U9oGC1YWe2w">http://blogs.collab.net/subversion/subversion-160-and-tree-conflicts#.U9oGC1YWe2w</a></li>
</ul>
<p>Recall that Subversion performs renames as a combination of a copy and a delete.</p>
<p>Stepping through the HG converted history doesnt go into conflict state:</p>
<div class="highlight-python"><pre>delta:histogram blyth$ hg update -r1586
0 files updated, 0 files merged, 1 files removed, 0 files unresolved
delta:histogram blyth$ l
total 16
-rw-r--r--  1 blyth  wheel  5258 Jul 31 16:32 pyhist_rename_to_avoid_degeneracy.py

delta:histogram blyth$ hg update -r1587
1 files updated, 0 files merged, 0 files removed, 0 files unresolved
delta:histogram blyth$ l
total 32
-rw-r--r--  1 blyth  wheel  5258 Jul 31 16:49 PyHist.py
-rw-r--r--  1 blyth  wheel  5258 Jul 31 16:32 pyhist_rename_to_avoid_degeneracy.py

delta:histogram blyth$ hg update -r1588
0 files updated, 0 files merged, 1 files removed, 0 files unresolved
delta:histogram blyth$ l
total 16
-rw-r--r--  1 blyth  wheel  5258 Jul 31 16:49 PyHist.py</pre>
</div>
<p>Despite the apparent clean svnclient.py run tree conflicts are lurking:</p>
<div class="highlight-python"><pre>delta:subversion blyth$ svnclient.py -r1599,1600,1601
INFO:env.svn.bindings.svnclient:checkout file:///var/scm/subversion/env/trunk/ rev 1599 to /tmp/subversion/env/
INFO:env.svn.bindings.svnclient:checkout file:///var/scm/subversion/env/trunk/ rev 1600 to /tmp/subversion/env/
INFO:env.svn.bindings.svnclient:checkout file:///var/scm/subversion/env/trunk/ rev 1601 to /tmp/subversion/env/
delta:subversion blyth$

Despite the above there is lurking tree conflict

delta:env blyth$ svn st
D     C thho/NuWa/python/histogram/PyHist.py
      &gt;   local file unversioned, incoming file add upon update
Summary of conflicts:
  Tree conflicts: 1
delta:env blyth$</pre>
</div>
<p>Workaround this pain, by doing clean checkouts for these revisions:</p>
<div class="highlight-python"><pre>(adm_env)delta:~ blyth$ svnclient.py -r1599 --clean-checkout-revs 1599,1600,1601
INFO:env.svn.bindings.svnclient:checkout file:///var/scm/subversion/env/trunk/ rev 1599 to /tmp/subversion/env/ clean True
INFO:env.svn.bindings.svnclient:rmtree /tmp/subversion/env/
(adm_env)delta:~ blyth$ l /tmp/subversion/env/thho/NuWa/python/histogram/
total 16
-rw-r--r--  1 blyth  wheel  5258 Jul 31 18:11 pyhist.py
(adm_env)delta:~ blyth$
(adm_env)delta:~ blyth$ svnclient.py -r1600 --clean-checkout-revs 1599,1600,1601
INFO:env.svn.bindings.svnclient:checkout file:///var/scm/subversion/env/trunk/ rev 1600 to /tmp/subversion/env/ clean True
INFO:env.svn.bindings.svnclient:rmtree /tmp/subversion/env/
{'repos_lock': None, 'text_status': &lt;wc_status_kind.missing&gt;, 'repos_text_status': &lt;wc_status_kind.none&gt;, 'is_locked': 0, 'is_copied': 0, 'is_switched': 0, 'is_versioned': 1, 'prop_status': &lt;wc_status_kind.none&gt;, 'entry': &lt;PysvnEntry u'PyHist.py'&gt;, 'path': u'/tmp/subversion/env/thho/NuWa/python/histogram/PyHist.py', 'repos_prop_status': &lt;wc_status_kind.none&gt;}
(adm_env)delta:~ blyth$ l /tmp/subversion/env/thho/NuWa/python/histogram/
total 16
-rw-r--r--  1 blyth  wheel  5258 Jul 31 18:12 pyhist.py
(adm_env)delta:~ blyth$ svn status  /tmp/subversion/env
!       /tmp/subversion/env/thho/NuWa/python/histogram/PyHist.py
(adm_env)delta:~ blyth$
(adm_env)delta:~ blyth$
(adm_env)delta:~ blyth$ svnclient.py -r1601 --clean-checkout-revs 1599,1600,1601
INFO:env.svn.bindings.svnclient:checkout file:///var/scm/subversion/env/trunk/ rev 1601 to /tmp/subversion/env/ clean True
INFO:env.svn.bindings.svnclient:rmtree /tmp/subversion/env/
(adm_env)delta:~ blyth$ l /tmp/subversion/env/thho/NuWa/python/histogram/
total 16
-rw-r--r--  1 blyth  wheel  5258 Jul 31 18:13 PyHist.py
(adm_env)delta:~ blyth$</pre>
</div>
<div class="highlight-python"><pre>delta:env blyth$ st
!     C thho/NuWa/python/histogram/PyHist.py
      &gt;   local file delete, incoming file delete upon update
Summary of conflicts:
  Tree conflicts: 1
delta:env blyth$ svn resolve --accept base thho/NuWa/python/histogram/PyHist.py
svn: warning: W155027: Tree conflict can only be resolved to 'working' or 'mine-conflict' state; '/private/tmp/subversion/env/thho/NuWa/python/histogram/PyHist.py' not resolved
svn: E205011: Failure occurred resolving one or more conflicts
delta:env blyth$

delta:env blyth$ svn resolve --accept mine-conflict thho/NuWa/python/histogram/PyHist.py</pre>
</div>
<div class="highlight-python"><pre>delta:histogram blyth$ svn update -r1599
Updating '.':
Skipped 'PyHist.py' -- Node remains in conflict
At revision 1599.
Summary of conflicts:
  Skipped paths: 1

delta:histogram blyth$ svn st
D     C PyHist.py
      &gt;   local file unversioned, incoming file add upon update
Summary of conflicts:
  Tree conflicts: 1


delta:histogram blyth$ svn update -r1600
Updating '.':
At revision 1600.
delta:histogram blyth$
delta:histogram blyth$ ll
total 16
drwxr-xr-x  10 blyth  wheel   340 Jul 31 16:05 ..
-rw-r--r--   1 blyth  wheel  5258 Jul 31 16:32 pyhist.py
drwxr-xr-x   3 blyth  wheel   102 Jul 31 16:32 .
delta:histogram blyth$
delta:histogram blyth$ svn update -r1601
Updating '.':
D    pyhist.py
Updated to revision 1601.
delta:histogram blyth$ ll
total 0
drwxr-xr-x  10 blyth  wheel  340 Jul 31 16:05 ..
drwxr-xr-x   2 blyth  wheel   68 Jul 31 16:56 .
delta:histogram blyth$ svn update -r1602
Updating '.':
At revision 1602.
delta:histogram blyth$ l
delta:histogram blyth$ st
D     C PyHist.py
      &gt;   local file unversioned, incoming file add upon update
Summary of conflicts:
  Tree conflicts: 1
delta:histogram blyth$</pre>
</div>
<div class="highlight-python"><pre>INFO:env.scm.migration.compare_hg_svn:hgrev 1587 svnrev 1600 hgrev-svnrev -13
INFO:env.svn.bindings.svnclient:checkout file:///var/scm/subversion/env/trunk rev 1600 to /tmp/subversion/env/
INFO:env.scm.migration.compare_hg_svn:1 ['hg_only_paths'] issues encountered in compare_paths
lines_dirs

lines_paths
 [l ] thho/NuWa/python/histogram/PyHist.py
Python 2.7.8 (default, Jul 13 2014, 17:11:32)
Type "copyright", "credits" or "license" for more information.

IPython 2.1.0 -- An enhanced Interactive Python.
?         -&gt; Introduction and overview of IPython's features.
%quickref -&gt; Quick reference.
help      -&gt; Python's own help system.
object?   -&gt; Details about 'object', use 'object??' for extra details.

In [1]: hg_only_paths
Out[1]: ['thho/NuWa/python/histogram/PyHist.py']</pre>
</div>
<div class="highlight-python"><pre>delta:histogram blyth$ ll /tmp/{mercurial,subversion}/env/thho/NuWa/python/histogram
/tmp/subversion/env/thho/NuWa/python/histogram:
total 16
drwxr-xr-x  10 blyth  wheel   340 Jul 31 16:05 ..
-rw-r--r--   1 blyth  wheel  5258 Jul 31 16:32 pyhist.py
drwxr-xr-x   3 blyth  wheel   102 Jul 31 16:32 .

/tmp/mercurial/env/thho/NuWa/python/histogram:
total 32
drwxr-xr-x  10 blyth  wheel   340 Jul 31 15:33 ..
-rw-r--r--   1 blyth  wheel  5258 Jul 31 16:32 pyhist_rename_to_avoid_degeneracy.py
-rw-r--r--   1 blyth  wheel  5258 Jul 31 16:32 PyHist.py
drwxr-xr-x   4 blyth  wheel   136 Jul 31 16:32 .
delta:histogram blyth$</pre>
</div>
</div>
<div class="section" id="resolved-degeneracy-back-again">
<h2><a class="toc-backref" href="#id3">[RESOLVED] Degeneracy Back again</a><a class="headerlink" href="#resolved-degeneracy-back-again" title="Permalink to this headline">Â¶</a></h2>
<p>Leading slash in paths prevent the filemap renames being applied. Resolved by
ensuring recursion roots have a trailing slash, hence ensuring root relatives
to not have a leading slash.</p>
<div class="highlight-python"><pre>INFO:env.scm.migration.compare_hg_svn:hgrev 1583 svnrev 1596 hgrev-svnrev -13
INFO:env.svn.bindings.svnclient:checkout http://dayabay.phys.ntu.edu.tw/repos/env/trunk rev 1596 to /tmp/subversion/env
INFO:env.scm.migration.compare_hg_svn:1 ['hg_only_paths'] issues encountered in compare_paths
lines_dirs

lines_paths
 [ r] /thho/NuWa/python/histogram/pyhist.py
 [l ] /thho/NuWa/python/histogram/pyhist_rename_to_avoid_degeneracy.py
INFO:env.scm.migration.compare_hg_svn:compare_contents paths 499 svn_digest 500 hg_digest 500 mismatch 0  svn_only 1 hg_only 1
INFO:env.scm.migration.compare_hg_svn:issues encountered in compare_contents : [('hg_keys', False), ('svn_only', False), ('hg_only', False)]
Python 2.7.8 (default, Jul 13 2014, 17:11:32)
Type "copyright", "credits" or "license" for more information.

IPython 2.1.0 -- An enhanced Interactive Python.
?         -&gt; Introduction and overview of IPython's features.
%quickref -&gt; Quick reference.
help      -&gt; Python's own help system.
object?   -&gt; Details about 'object', use 'object??' for extra details.

In [1]:</pre>
</div>
</div>
<div class="section" id="and-this-directory-link">
<h2><a class="toc-backref" href="#id4">And this directory link ?</a><a class="headerlink" href="#and-this-directory-link" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python"><pre>http://dayabay.phys.ntu.edu.tw/tracs/env/browser/trunk/qxml
link db/bdbxml/qxml

http://dayabay.phys.ntu.edu.tw/tracs/env/browser/trunk/db/bdbxml/qxml/</pre>
</div>
</div>
<div class="section" id="resolved-credentials-callback-from-r731">
<h2><a class="toc-backref" href="#id5">[RESOLVED] Credentials callback from r731</a><a class="headerlink" href="#resolved-credentials-callback-from-r731" title="Permalink to this headline">Â¶</a></h2>
<p>Attempts to checkout revisions from 731 need credentials.
Resolved by ignoring externals in the pysvn checkout</p>
<ul class="simple">
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/env/browser/trunk/dyb/NuWa?rev=731">http://dayabay.phys.ntu.edu.tw/tracs/env/browser/trunk/dyb/NuWa?rev=731</a>  svn:externals testing</li>
</ul>
<div class="highlight-python"><pre>(adm_env)delta:~ blyth$ svnclient.py -r732
INFO:env.svn.bindings.svnclient:checkout http://dayabay.phys.ntu.edu.tw/repos/env/trunk/ rev 732 to /tmp/subversion/env
INFO:env.svn.bindings.svnclient:get_login realm &lt;http://dayabay.ihep.ac.cn:80&gt; svn-repos username blyth may_save 1
ValueError: invalid literal for int() with base 10: ''
Traceback (most recent call last):
  File "/Users/blyth/env/bin/svnclient.py", line 4, in &lt;module&gt;
    main()
  File "/usr/local/env/adm_env/lib/python2.7/site-packages/env/svn/bindings/svnclient.py", line 259, in main
    sc.recurse(rev)
  File "/usr/local/env/adm_env/lib/python2.7/site-packages/env/svn/bindings/svnclient.py", line 121, in recurse
    self.checkout(rev)
  File "/usr/local/env/adm_env/lib/python2.7/site-packages/env/svn/bindings/svnclient.py", line 117, in checkout
    self.client.checkout(self.url, self.path, revision=rev_(rev))
pysvn._pysvn_2_7.ClientError: unhandled exception in callback_get_login
(adm_env)delta:~ blyth$</pre>
</div>
<div class="highlight-python"><pre>delta:NuWa blyth$ svn pg svn:externals
dybgaudi -r1863 http://dayabay.ihep.ac.cn/svn/dybsvn/dybgaudi/branches/releases/0.2.0
gaudi -r1864 http://dayabay.ihep.ac.cn/svn/dybsvn/gaudi/branches/releases/0.2.0
lcgcmt -r1867 http://dayabay.ihep.ac.cn/svn/dybsvn/lcgcmt/branches/releases/0.2.0
ldm -r1868 http://dayabay.ihep.ac.cn/svn/dybsvn/ldm/branches/releases/0.0.3
tut_anal1 -r1869 http://dayabay.ihep.ac.cn/svn/dybsvn/tut_anal1/branches/releases/0.0.1
installation http://dayabay.ihep.ac.cn/svn/dybsvn/installation/branches/inst-NuWa-0.0.4/dybinst</pre>
</div>
</div>
<div class="section" id="resolved-what-is-special-about-this-stretch-of-svn-history">
<h2><a class="toc-backref" href="#id6">[RESOLVED] What is special about this stretch of SVN history ?</a><a class="headerlink" href="#resolved-what-is-special-about-this-stretch-of-svn-history" title="Permalink to this headline">Â¶</a></h2>
<p>Creation of a folder than contains nothing but other empties was not
skipped by  <cite>&#8211;skipempty</cite> in SVNCrawler.  Resolved by judging emptiness at the
tail rather than head of the recursion based on the total leaves beneath a node.</p>
<p>Discrepant folder <cite>/thho/NuWa</cite> despite <cite>&#8211;skipempty</cite> enables for the SVN crawl:</p>
<div class="highlight-python"><pre>INFO:env.scm.migration.compare_hg_svn:hgrev 1433 svnrev 1445
INFO:env.scm.migration.compare_hg_svn:hgrev 1434 svnrev 1447
INFO:env.scm.migration.compare_hg_svn:1 ['svn_only_dirs'] issues encountered in compare_paths
lines_dirs
 [ r] /thho/NuWa
lines_paths

INFO:env.scm.migration.compare_hg_svn:hgrev 1435 svnrev 1448
INFO:env.scm.migration.compare_hg_svn:1 ['svn_only_dirs'] issues encountered in compare_paths
lines_dirs
 [ r] /thho/NuWa
lines_paths

INFO:env.scm.migration.compare_hg_svn:hgrev 1436 svnrev 1449
INFO:env.scm.migration.compare_hg_svn:hgrev 1437 svnrev 1450
INFO:env.scm.migration.compare_hg_svn:hgrev 1438 svnrev 1451</pre>
</div>
<ul class="simple">
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1446">http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1446</a>  creation of &#8220;NuWa&#8221; directory than contains only an empty &#8220;python&#8221; directory <cite>trunk/thho/NuWa/python</cite></li>
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1447">http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1447</a>  unrelated</li>
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1448">http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1448</a>  unrelated</li>
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1449">http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1449</a>  thho populates 2 levels of emptyness, by creating <cite>trunk/thho/NuWa/python/gentools.py</cite></li>
</ul>
</div>
<div class="section" id="maybe-resolved-too">
<h2><a class="toc-backref" href="#id7">Maybe resolved too ?</a><a class="headerlink" href="#maybe-resolved-too" title="Permalink to this headline">Â¶</a></h2>
<p>Even with skipempty, this is still tripping up:</p>
<div class="highlight-python"><pre>INFO:env.scm.migration.compare_hg_svn:hgrev 644 svnrev 646
lines_dirs
 [ r] /thho
lines_paths</pre>
</div>
</div>
<div class="section" id="directory-symbolic-links-need-separate-handling">
<h2><a class="toc-backref" href="#id8">Directory symbolic links need separate handling</a><a class="headerlink" href="#directory-symbolic-links-need-separate-handling" title="Permalink to this headline">Â¶</a></h2>
<p>This is a problem with the comparison, the conversion succeeds to
translate the SVN directory link into a Mercurial one.</p>
<div class="highlight-python"><pre>delta:env blyth$ pwd
/tmp/mercurial/env
delta:env blyth$ l qxml*
lrwxr-xr-x  1 blyth  wheel  14 Jul 30 16:28 qxml -&gt; db/bdbxml/qxml

delta:e blyth$ pwd
/Users/blyth/e
delta:e blyth$ l qxml
lrwxr-xr-x  1 blyth  staff  14 Jan 14  2014 qxml -&gt; db/bdbxml/qxml</pre>
</div>
<div class="highlight-python"><pre>In [3]: svn_only_paths
Out[3]: ['/qxml']</pre>
</div>
<div class="highlight-python"><pre>INFO:env.scm.migration.compare_hg_svn:hgrev 3470 svnrev 3493
INFO:env.scm.migration.compare_hg_svn:2 ['hg_only_paths', 'hg_only_dirs'] issues encountered in compare_paths
lines_dirs
 [l ] /qxml/test
 [l ] /qxml
lines_paths
 [l ] /qxml/common.cc
 [l ] /qxml/config.hh
 [l ] /qxml/existmeta.py
 [l ] /qxml/extresolve.hh
 [l ] /qxml/extfun.py
 [l ] /qxml/common.py
 [l ] /qxml/potools.cc
 [l ] /qxml/extfun.cc
 [l ] /qxml/qxmlcfg.cc
 [l ] /qxml/test/tpy.xq
 [l ] /qxml/makeXmlException.inc
 [l ] /qxml/config.py
 [l ] /qxml/element.cc
 [l ] /qxml/extfun.hh
 [l ] /qxml/Makefile
 [l ] /qxml/extresolve.cc
 [l ] /qxml/extfun.i
 [l ] /qxml/qxml.py
 [l ] /qxml/monolith.py
 [l ] /qxml/potools.hh
 [l ] /qxml/model.hh
 [l ] /qxml/qxml.cc
 [l ] /qxml/hfagc.cfg
 [l ] /qxml/exist2qxml.py
 [l ] /qxml/test_pyextfun.py
 [l ] /qxml/quote.py
 [l ] /qxml/element.hh
 [l ] /qxml/transfer.py
 [l ] /qxml/hfagc.dbxml
 [ r] /qxml
 [l ] /qxml/throwPyUserException.inc
 [l ] /qxml/glyph.py
 [l ] /qxml/README.txt
 [l ] /qxml/test/extmixed.xq
 [l ] /qxml/notes.txt
 [l ] /qxml/config.cc
 [l ] /qxml/test/ext.xq
 [l ] /qxml/setup.py
 [l ] /qxml/common.hh
 [l ] /qxml/test/tpydump.xq
 [l ] /qxml/test/ls.xq
 [l ] /qxml/model.cc
INFO:env.scm.migration.compare_hg_svn:issues encountered in compare_contents
Python 2.7.6 (default, Nov 18 2013, 15:12:51)
Type "copyright", "credits" or "license" for more information.</pre>
</div>
</div>
<div class="section" id="resolved-comparison-needs-to-apply-the-filemap">
<h2><a class="toc-backref" href="#id9">[RESOLVED] Comparison needs to apply the filemap</a><a class="headerlink" href="#resolved-comparison-needs-to-apply-the-filemap" title="Permalink to this headline">Â¶</a></h2>
<p>Resolved by application of <cite>hg convert</cite> filemap renames
to SVN paths before comparison with the HG paths. The renames
were needed in the first place to avoid case folding problem.</p>
<div class="highlight-python"><pre>INFO:env.scm.migration.compare_hg_svn:hgrev 1583 svnrev 1596
INFO:env.scm.migration.compare_hg_svn:2 ['hg_only_paths', 'svn_only_paths'] issues encountered in compare_paths
lines_dirs

lines_paths
 [ r] /thho/NuWa/python/histogram/pyhist.py
 [l ] /thho/NuWa/python/histogram/pyhist_rename_to_avoid_degeneracy.py
INFO:env.scm.migration.compare_hg_svn:issues encountered in compare_contents
Python 2.7.6 (default, Nov 18 2013, 15:12:51)
Type "copyright", "credits" or "license" for more information.</pre>
</div>
</div>
<div class="section" id="dud-svn-rev-10">
<h2><a class="toc-backref" href="#id10">Dud svn rev 10</a><a class="headerlink" href="#dud-svn-rev-10" title="Permalink to this headline">Â¶</a></h2>
<p>While restructing to trunk the following offsets are seen.  Observing early offsets of 3 when doing fullrepo.</p>
<div class="highlight-python"><pre>(adm_env)delta:~ blyth$ compare_hg_svn.py /tmp/mercurial/env /var/scm/backup/cms02/repos/env/2014/07/20/173006/env-4637 --svnrev 1:10 --hgrev 0:9
INFO:env.scm.migration.compare_hg_svn:hgrev 0 svnrev 1
INFO:env.scm.migration.compare_hg_svn:hgrev 1 svnrev 2
INFO:env.scm.migration.compare_hg_svn:hgrev 2 svnrev 3
INFO:env.scm.migration.compare_hg_svn:hgrev 3 svnrev 4
INFO:env.scm.migration.compare_hg_svn:hgrev 4 svnrev 5
INFO:env.scm.migration.compare_hg_svn:hgrev 5 svnrev 6
INFO:env.scm.migration.compare_hg_svn:hgrev 6 svnrev 7
INFO:env.scm.migration.compare_hg_svn:hgrev 7 svnrev 8
INFO:env.scm.migration.compare_hg_svn:hgrev 8 svnrev 9       ## offset of 1 due to trunk restriction, up to dud svn rev 10

compare_hg_svn.py /tmp/mercurial/env /var/scm/backup/cms02/repos/env/2014/07/20/173006/env-4637 --svnrev 10 --hgrev 9

(adm_env)delta:~ blyth$ compare_hg_svn.py /tmp/mercurial/env /var/scm/backup/cms02/repos/env/2014/07/20/173006/env-4637 --svnrev 10:19 --hgrev 8:17
INFO:env.scm.migration.compare_hg_svn:hgrev 8 svnrev 10
INFO:env.scm.migration.compare_hg_svn:hgrev 9 svnrev 11
INFO:env.scm.migration.compare_hg_svn:hgrev 10 svnrev 12
INFO:env.scm.migration.compare_hg_svn:hgrev 11 svnrev 13
INFO:env.scm.migration.compare_hg_svn:hgrev 12 svnrev 14
INFO:env.scm.migration.compare_hg_svn:hgrev 13 svnrev 15
INFO:env.scm.migration.compare_hg_svn:hgrev 14 svnrev 16
INFO:env.scm.migration.compare_hg_svn:hgrev 15 svnrev 17
INFO:env.scm.migration.compare_hg_svn:hgrev 16 svnrev 18       ## beyond the dud, need offset of 2 to match

compare_hg_svn.py /tmp/mercurial/env /var/scm/backup/cms02/repos/env/2014/07/20/173006/env-4637 --svnrev 10 --hgrev 8 -A

INFO:env.scm.migration.compare_hg_svn:hgrev 388 svnrev 390
lines_dirs
 [ r] /seed
lines_paths</pre>
</div>
</div>
<div class="section" id="other-issues">
<h2><a class="toc-backref" href="#id11">Other issues</a><a class="headerlink" href="#other-issues" title="Permalink to this headline">Â¶</a></h2>
<ol class="arabic simple">
<li>empty folders</li>
<li>symbolic links</li>
</ol>
</div>
<div class="section" id="resolved-case-folding-collision">
<h2><a class="toc-backref" href="#id12">[RESOLVED] Case folding collision</a><a class="headerlink" href="#resolved-case-folding-collision" title="Permalink to this headline">Â¶</a></h2>
<p>SVN permits case degenerate paths to have distinct entries in its DB, but Mercurial doesnt.
Resolved, by filemap rename within the hg convert to avoid the degeneracy ever happening.</p>
<p>Problematic bits of history:</p>
<ul class="simple">
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1599">http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1599</a>   thho modifies trunk/thho/NuWa/python/histogram/pyhist.py</li>
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1600">http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1600</a>   thho copies trunk/thho/NuWa/python/histogram/pyhist.py to trunk/thho/NuWa/python/histogram/PyHist.py</li>
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1601">http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1601</a>   thho removes trunk/thho/NuWa/python/histogram/pyhist.py</li>
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1715">http://dayabay.phys.ntu.edu.tw/tracs/env/changeset/1715</a>   thho removes trunk/thho/NuWa/python</li>
<li><a class="reference external" href="http://dayabay.phys.ntu.edu.tw/tracs/env/log/trunk/thho/NuWa/python/histogram?rev=1714">http://dayabay.phys.ntu.edu.tw/tracs/env/log/trunk/thho/NuWa/python/histogram?rev=1714</a></li>
</ul>
<p>The update to (hgrev 1587 svnrev 1600) gives case-folding collision still (filemap rename not working?):</p>
<div class="highlight-python"><pre>INFO:env.scm.migration.compare_hg_svn:hgrev 1586 svnrev 1599
INFO:env.scm.migration.compare_hg_svn:hgrev 1587 svnrev 1600
Traceback (most recent call last):
  File "/Users/blyth/env/bin/compare_hg_svn.py", line 4, in &lt;module&gt;
    main()
  File "/usr/local/env/adm_env/lib/python2.7/site-packages/env/scm/migration/compare_hg_svn.py", line 318, in main
    hg.recurse(hgrev)   # updates hg working copy to this revision
  File "/usr/local/env/adm_env/lib/python2.7/site-packages/env/hg/bindings/hgcrawl.py", line 216, in recurse
    self.hg.hg_update(hgrev)
  File "/usr/local/env/adm_env/lib/python2.7/site-packages/hgapi/hgapi.py", line 173, in hg_update
    self.hg_command(*cmd)
  File "/usr/local/env/adm_env/lib/python2.7/site-packages/hgapi/hgapi.py", line 113, in hg_command
    return Repo.command(self.path, self._env, *args)
  File "/usr/local/env/adm_env/lib/python2.7/site-packages/hgapi/hgapi.py", line 95, in command
    exit_code=proc.returncode)
hgapi.hgapi.HgException: Error running hg --cwd /tmp/mercurial/env update 1587:
" + tErr: abort: case-folding collision between thho/NuWa/python/histogram/pyhist.py and thho/NuWa/python/histogram/PyHist.py

    Out:
    Exit: 255</pre>
</div>
<div class="highlight-python"><pre>(adm_env)delta:env blyth$ hg update -r1586
251 files updated, 0 files merged, 2641 files removed, 0 files unresolved</pre>
</div>
<p>filemap not working without the trunk:</p>
<div class="highlight-python"><pre>(adm_env)delta:env blyth$ hg update -r1586
251 files updated, 0 files merged, 2641 files removed, 0 files unresolved
(adm_env)delta:env blyth$
(adm_env)delta:env blyth$
(adm_env)delta:env blyth$ cd thho/NuWa/python/histogram/
(adm_env)delta:histogram blyth$ l
total 16
-rw-r--r--  1 blyth  wheel  5258 Jul 29 20:44 pyhist.py
(adm_env)delta:histogram blyth$ pwd
/tmp/mercurial/env/thho/NuWa/python/histogram
(adm_env)delta:histogram blyth$

(adm_env)delta:histogram blyth$ hg update -r1587
abort: case-folding collision between thho/NuWa/python/histogram/pyhist.py and thho/NuWa/python/histogram/PyHist.py</pre>
</div>
<p>Argh case degenerate entries at SVN rev 1600:</p>
<div class="highlight-python"><pre>delta:~ blyth$ svncrawl.py /var/scm/backup/cms02/repos/env/2014/07/20/173006/env-4637 --revision 1599 -v | grep -i PyHist
/trunk/thho/NuWa/python/histogram/pyhist.py

delta:~ blyth$ svncrawl.py /var/scm/backup/cms02/repos/env/2014/07/20/173006/env-4637 --revision 1600 -v | grep -i PyHist
/trunk/thho/NuWa/python/histogram/PyHist.py
/trunk/thho/NuWa/python/histogram/pyhist.py

delta:~ blyth$ svncrawl.py /var/scm/backup/cms02/repos/env/2014/07/20/173006/env-4637 --revision 1601 -v | grep -i PyHist
/trunk/thho/NuWa/python/histogram/PyHist.py

delta:~ blyth$ svncrawl.py /var/scm/backup/cms02/repos/env/2014/07/20/173006/env-4637 --revision 1602 -v | grep -i PyHist
/trunk/thho/NuWa/python/histogram/PyHist.py</pre>
</div>
</div>
<div class="section" id="hg-only">
<h2><a class="toc-backref" href="#id13">hg only</a><a class="headerlink" href="#hg-only" title="Permalink to this headline">Â¶</a></h2>
<p>The hg repo is created from original SVN repo via network. The snapshot of SVN repo
comes from a backup. This explains these contiguous recent commits being only in hg.</p>
<div class="highlight-python"><pre>In [22]: for _ in sorted(ho):print "%(hrev)s %(log)s " % hh[_]

4608 looking into trac migration into mercurial, comparing checkout from hg converted repo to original svn working copy
4609 eliminating empty directories by deletion or adding empty README.txt as cause problems for comparison with mercurial migrated repo checkouts
4610 a few more empty dirs, now with README
4611 hg convert testing, so need to keep getting SVN to clean revisions
4612 more svn/hg diffs
4613 env working copy between svn and hg converted almost perfect match now
4614 mercurial notes
4615 comparing env hg/svn history, find dud revision 10
4616 machinery for new virtualenv adm- python, for sysadmin tasks like migarted to mercurial vs svn history comparisons
4617 generalize tracmigrate into scmmigrate, investigate hgapi and svn bindings
4618 svn and hg crawlers now check directory correspondence between revisions, not yet content
4619 extend hg and svn crawlers to compare file content at all revisions, fix issues with symbolic links, problem of case degeneracy remains</pre>
</div>
</div>
<div class="section" id="svn-only">
<h2><a class="toc-backref" href="#id14">svn only</a><a class="headerlink" href="#svn-only" title="Permalink to this headline">Â¶</a></h2>
<p>Manual log check doing:</p>
<div class="highlight-python"><pre>delta:e blyth$ svn log -r4000 -v
------------------------------------------------------------------------
r4000 | lint | 2013-10-22 13:24:09 +0800 (Tue, 22 Oct 2013) | 1 line
Changed paths:
   M /trunk/lintao/archive

add the latest directory.</pre>
</div>
<p>Indicates SVN onlys are caused by</p>
<ol class="arabic simple">
<li>creations/deletions of empty directories</li>
<li>dud revision 10</li>
<li>svn property changes</li>
</ol>
<div class="highlight-python"><pre>In [24]: for _ in sorted(so):print "%(srev)s %(log)s " % ss[_]
1 initial import from dummy
10
delete swp

390 for random seed, hostid checking

646 thho work area
729 tidy up unused folders
730 tidy
731 svn:externals testing
738 avoid slow NuWa update on every env-u !
1264 acrylic sample study
1443 try to move some if the bitten setup into the server rather than the checkout scripts with svn:externals
1444 switch order to workaround ... ''SSL is not supported'' in the bitten checkout
1446 NuWa tips
...</pre>
</div>
<div class="sidebar">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../hg_convert/" title="hg convert"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>

          <li><a href="../" >hg</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>