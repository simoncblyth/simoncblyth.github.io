<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DetSim G4Scintillation &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../../" />
    <link rel="up" title="detsim" href="../" />
    <link rel="next" title="DetSim DsG4Scintillation" href="../detsim_dsg4scintillation/" />
    <link rel="prev" title="DetSim ChromaStackAction" href="../detsim_dschromastackaction/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../detsim_dsg4scintillation/" title="DetSim DsG4Scintillation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../detsim_dschromastackaction/" title="DetSim ChromaStackAction"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../" >nuwa</a> &raquo;</li>
          <li><a href="../" accesskey="U">detsim</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pycuda/">pycuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../geant4/">geant4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../javascript/">javascript</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../">nuwa</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../dybinst_mavericks/">NuWa on Mavericks</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../">detsim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nuwa_cmt_debugging/">NuWa CMT Debugging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hg/">hg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../simoncblyth.bitbucket.org/">simoncblyth.bitbucket.org</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../_sources/nuwa/detsim/detsim_g4scintillation.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../detsim_dschromastackaction/"
                        title="previous chapter">DetSim ChromaStackAction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../detsim_dsg4scintillation/"
                        title="next chapter">DetSim DsG4Scintillation</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="detsim-g4scintillation">
<h1>DetSim G4Scintillation<a class="headerlink" href="#detsim-g4scintillation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="observations">
<h2>Observations<a class="headerlink" href="#observations" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>not-applicable to optical photons<ul>
<li>what about REEMISSION ?</li>
</ul>
</li>
<li>g4ten includes Birks Saturation handling</li>
</ol>
<p>Basis properties:</p>
<ol class="arabic simple">
<li>FASTCOMPONENT</li>
<li>SLOWCOMPONENT</li>
<li>SCINTILLATIONYIELD   (scintillation photons/MeV)</li>
</ol>
<p>Optical Photon production handles by setting secondaries:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">aParticleChange</span><span class="o">.</span><span class="n">SetNumberOfSecondaries</span><span class="p">(</span><span class="n">NumPhotons</span><span class="p">);</span>
</pre></div>
</div>
<p>Then creating secondary <cite>G4Track</cite> with parameters based on boatload of properties and then <cite>AddSecondary</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">aParticleChange</span><span class="o">.</span><span class="n">AddSecondary</span><span class="p">(</span><span class="n">aSecondaryTrack</span><span class="p">);</span>
</pre></div>
</div>
<p>Boatload:</p>
<ol class="arabic simple">
<li>FASTTIMECONSTANT</li>
<li>FASTSCINTILLATIONRISETIME</li>
<li>SLOWTIMECONSTANT</li>
<li>SLOWSCINTILLATIONRISETIME</li>
<li>YIELDRATIO</li>
</ol>
</div>
<div class="section" id="latest-geant4-10-00-p01-g4scintillation">
<h2>Latest geant4.10.00.p01 G4Scintillation<a class="headerlink" href="#latest-geant4-10-00-p01-g4scintillation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://geant4.web.cern.ch/geant4/G4UsersDocuments/UsersGuides/ForApplicationDeveloper/html/TrackingAndPhysics/physicsProcess.html">http://geant4.web.cern.ch/geant4/G4UsersDocuments/UsersGuides/ForApplicationDeveloper/html/TrackingAndPhysics/physicsProcess.html</a></li>
</ul>
<p><cite>geant4.10.00.p01/source/processes/electromagnetic/xrays/include/G4Scintillation.hh</cite>:</p>
<div class="highlight-python"><pre>088 class G4Scintillation : public G4VRestDiscreteProcess
089 {
...
192         static void AddSaturation(G4EmSaturation* );
193         // Adds Birks Saturation to the process.
194
195         static void RemoveSaturation();
196         // Removes the Birks Saturation from the process.
197
198         G4EmSaturation* GetSaturation() const { return fEmSaturation; }
199         // Returns the Birks Saturation.
///
///   new addition ?
///
255 inline
256 G4bool G4Scintillation::IsApplicable(const G4ParticleDefinition&amp; aParticleType)
257 {
258        if (aParticleType.GetParticleName() == "opticalphoton") return false;
259        if (aParticleType.IsShortLived()) return false;
260
261        return true;
262 }</pre>
</div>
<p><cite>geant4.10.00.p01/source/processes/electromagnetic/xrays/src/G4Scintillation.cc</cite>:</p>
<div class="highlight-python"><pre>089 G4bool G4Scintillation::fTrackSecondariesFirst = false;
090 G4bool G4Scintillation::fFiniteRiseTime = false;
091 G4double G4Scintillation::fYieldFactor = 1.0;
092 G4double G4Scintillation::fExcitationRatio = 1.0;
093 G4bool G4Scintillation::fScintillationByParticleType = false;
094 G4EmSaturation* G4Scintillation::fEmSaturation = NULL;
...
...
169 G4VParticleChange*
170 G4Scintillation::PostStepDoIt(const G4Track&amp; aTrack, const G4Step&amp; aStep)
171
172 // This routine is called for each tracking step of a charged particle
173 // in a scintillator. A Poisson/Gauss-distributed number of photons is
174 // generated according to the scintillation yield formula, distributed
175 // evenly along the track segment and uniformly into 4pi.
176
177 {
...
197         G4MaterialPropertyVector* Fast_Intensity =
198                 aMaterialPropertiesTable-&gt;GetProperty("FASTCOMPONENT");
199         G4MaterialPropertyVector* Slow_Intensity =
200                 aMaterialPropertiesTable-&gt;GetProperty("SLOWCOMPONENT");
201
202         if (!Fast_Intensity &amp;&amp; !Slow_Intensity )
203              return G4VRestDiscreteProcess::PostStepDoIt(aTrack, aStep);
///
///      requires a bunch of property tables to be defined
///
204
205         G4int nscnt = 1;
206         if (Fast_Intensity &amp;&amp; Slow_Intensity) nscnt = 2;
207
208         G4double ScintillationYield = 0.;
209
210     // Scintillation depends on particle type, energy deposited
211         if (fScintillationByParticleType) {
212
213            ScintillationYield =
214                           GetScintillationYieldByParticleType(aTrack, aStep);
215
216            // The default linear scintillation process
217         } else {
218
219            ScintillationYield = aMaterialPropertiesTable-&gt;
220                                       GetConstProperty("SCINTILLATIONYIELD");
221
222            // Units: [# scintillation photons / MeV]
223            ScintillationYield *= fYieldFactor;
224         }
225
226         G4double ResolutionScale    = aMaterialPropertiesTable-&gt;
227                                       GetConstProperty("RESOLUTIONSCALE");
228
///
///
///
235         G4double MeanNumberOfPhotons;
236
237         // Birk's correction via fEmSaturation and specifying scintillation by
238         // by particle type are physically mutually exclusive
239
240         if (fScintillationByParticleType)
241            MeanNumberOfPhotons = ScintillationYield;
242         else if (fEmSaturation)
243            MeanNumberOfPhotons = ScintillationYield*
244                               (fEmSaturation-&gt;VisibleEnergyDeposition(&amp;aStep));
245         else
246            MeanNumberOfPhotons = ScintillationYield*TotalEnergyDeposit;
247
248         G4int NumPhotons;
249
250         if (MeanNumberOfPhotons &gt; 10.)
251         {
252           G4double sigma = ResolutionScale * std::sqrt(MeanNumberOfPhotons);
253           NumPhotons = G4int(G4RandGauss::shoot(MeanNumberOfPhotons,sigma)+0.5);
254         }
255         else
256         {
257           NumPhotons = G4int(G4Poisson(MeanNumberOfPhotons));
258         }
259
260         if (NumPhotons &lt;= 0)
261         {
262            // return unchanged particle and no secondaries
263
264            aParticleChange.SetNumberOfSecondaries(0);
265
266            return G4VRestDiscreteProcess::PostStepDoIt(aTrack, aStep);
267         }
268
269         ////////////////////////////////////////////////////////////////
270
271         aParticleChange.SetNumberOfSecondaries(NumPhotons);
272
273         if (fTrackSecondariesFirst) {
274            if (aTrack.GetTrackStatus() == fAlive )
275                   aParticleChange.ProposeTrackStatus(fSuspend);
276         }
...
...
...
441                 G4double aSecondaryTime = t0 + deltaTime;
442
443                 G4ThreeVector aSecondaryPosition =
444                                     x0 + rand * aStep.GetDeltaPosition();
445
446                 G4Track* aSecondaryTrack = new G4Track(aScintillationPhoton,
447                                                        aSecondaryTime,
448                                                        aSecondaryPosition);
449
450                 aSecondaryTrack-&gt;SetTouchableHandle(
451                                  aStep.GetPreStepPoint()-&gt;GetTouchableHandle());
452                 // aSecondaryTrack-&gt;SetTouchableHandle((G4VTouchable*)0);
453
454                 aSecondaryTrack-&gt;SetParentID(aTrack.GetTrackID());
455
456                 aParticleChange.AddSecondary(aSecondaryTrack);</pre>
</div>
<div class="sidebar">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../detsim_dsg4scintillation/" title="DetSim DsG4Scintillation"
             >next</a> |</li>
        <li class="right" >
          <a href="../detsim_dschromastackaction/" title="DetSim ChromaStackAction"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../" >nuwa</a> &raquo;</li>
          <li><a href="../" >detsim</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>