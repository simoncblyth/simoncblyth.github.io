<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>LOG &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../" />
    <link rel="next" title="TODO" href="../../TODO/" />
    <link rel="prev" title="MULTIPLE gcc/g++ HANDLING" href="../../base/gcc/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../TODO/" title="TODO"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../../base/gcc/" title="MULTIPLE gcc/g++ HANDLING"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>
 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../base/">Base Tools</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">LOG</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#review-lessons-from-recovery">Review Lessons from recovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cms01-as-stand-in-server">cms01 as stand-in server ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#belle1-as-stand-in-balked-at-trac-downgrade-0-11-to-0-10-5">belle1 as stand-in : balked at trac downgrade 0.11 to 0.10.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cms02-source-build">cms02 source build</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cms02-tarball-recovery">cms02 : tarball recovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cms02-apache-hookup">cms02 : apache hookup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cms02-backups-rsync-chkconfig">cms02 : backups + rsync + chkconfig</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pycuda/">pycuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../geant4/">geant4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hg/">hg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../simoncblyth.bitbucket.org/">simoncblyth.bitbucket.org</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/log/May2012.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../../base/gcc/"
                        title="previous chapter">MULTIPLE gcc/g++ HANDLING</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../../TODO/"
                        title="next chapter">TODO</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="log">
<h1>LOG<a class="headerlink" href="#log" title="Permalink to this headline">¶</a></h1>
<div class="section" id="review-lessons-from-recovery">
<h2>Review Lessons from recovery<a class="headerlink" href="#review-lessons-from-recovery" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>not having an operational repo + trac + docs : serious hit on ability to recover and build these</li>
</ol>
<blockquote>
<div><ol class="arabic simple">
<li>benefit of plain text sphinx docs (compared to wiki docmentation : hidden away in sqlite DB)</li>
</ol>
</div></blockquote>
<ol class="arabic simple">
<li>self-hosting env (the scripts for building) not a good idea</li>
</ol>
<blockquote>
<div><ol class="arabic simple">
<li>move at least <strong>env</strong> to github / google code ?</li>
<li>move important documentation to Sphinx</li>
</ol>
</div></blockquote>
<ol class="arabic simple">
<li>use of older machines generally means source builds for usable versions as distros are behind</li>
</ol>
<div class="section" id="failed-to-find-viable-interim-server">
<h3>Failed to find viable interim server<a class="headerlink" href="#failed-to-find-viable-interim-server" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">cms01, system apache config for heprez too sensitive to touch as currently in use</p>
<blockquote>
<div><ol class="arabic simple">
<li>a front to tomcat + exist and static presenter</li>
</ol>
</div></blockquote>
</li>
<li><p class="first">belle7, in use for OUM + dybslv</p>
<blockquote>
<div><ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">yum</span> <span class="pre">--enablerepo=epel</span> <span class="pre">info</span> <span class="pre">trac</span></tt> at 0.10.5 <strong>MAYBE NEW ENOUGH : USING BELLE1</strong></li>
</ol>
</div></blockquote>
</li>
<li><p class="first">belle1, made some progress but balked at having to downgrade 0.11 to 0.10.5 (and expectation that this would entail lots of trac config effort)</p>
</li>
</ol>
</div>
</div>
<div class="section" id="cms01-as-stand-in-server">
<h2>cms01 as stand-in server ?<a class="headerlink" href="#cms01-as-stand-in-server" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>try to apache-edit to use existing trac+svn install on cms01<ul>
<li>cms01 config has been changed for heprez</li>
</ul>
</li>
</ol>
<div class="highlight-python"><pre>[blyth@cms01 ~]$ sudo apachectl stop
Syntax error on line 17 of /etc/httpd/conf/svnsetup/repos.conf:
Unknown DAV provider: svn

[blyth@cms01 ~]$ sudo apachectl start
Syntax error on line 17 of /etc/httpd/conf/svnsetup/repos.conf:
Unknown DAV provider: svn

[blyth@cms01 conf.d]$ ll /usr/lib/httpd/modules/*dav*
-rwxr-xr-x  1 root root  39324 Oct 25  2011 /usr/lib/httpd/modules/mod_dav_fs.so
-rwxr-xr-x  1 root root  80316 Oct 25  2011 /usr/lib/httpd/modules/mod_dav.so
-rwxr-xr-x  1 root root 426545 Dec 31  2007 /usr/lib/httpd/modules/mod_dav_svn.so

[blyth@cms01 ~]$ ll /usr/lib/httpd/modules/*svn*
-rwxr-xr-x  1 root root  29087 Dec 31  2007 /usr/lib/httpd/modules/mod_authz_svn.so
-rwxr-xr-x  1 root root 426545 Dec 31  2007 /usr/lib/httpd/modules/mod_dav_svn.so</pre>
</div>
<p>Key precursor for apache config is <tt class="docutils literal"><span class="pre">svnsetup-</span></tt>, mismatch:</p>
<div class="highlight-python"><pre>[Wed May 02 17:36:03 2012] [notice] Apache/2.0.52 (Scientific Linux) configured -- resuming normal operations
[Wed May 02 17:36:19 2012] [error] sys:1: RuntimeWarning: Python C API version mismatch for module _apache: This Python has API version 1013, module _apache has version 1012.
[Wed May 02 17:36:19 2012] [error] make_obcallback: could not import mod_python.apache.\n</pre>
</div>
</div>
<div class="section" id="belle1-as-stand-in-balked-at-trac-downgrade-0-11-to-0-10-5">
<h2>belle1 as stand-in : balked at trac downgrade 0.11 to 0.10.5<a class="headerlink" href="#belle1-as-stand-in-balked-at-trac-downgrade-0-11-to-0-10-5" title="Permalink to this headline">¶</a></h2>
<div class="section" id="epel-distro-trac-0-10-5">
<h3>EPEL distro trac 0.10.5<a class="headerlink" href="#epel-distro-trac-0-10-5" title="Permalink to this headline">¶</a></h3>
<p>Yum epel based installation on belle1 : lighttpd/fastcgi/trac + apache/mod_dav_svn + ...</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://trac.edgewall.org/wiki/0.11/TracUpgrade">http://trac.edgewall.org/wiki/0.11/TracUpgrade</a>  claims downgrade from 0.11 to 0.10.5 &#8220;is easy&#8221;</li>
</ul>
</div></blockquote>
<div class="highlight-python"><pre>[blyth@belle1 ~]$ sudo yum --enablerepo=epel deplist trac</pre>
</div>
<div class="highlight-python"><pre>sqlite3 db/trac.db "update system set value=20 where name='database_version'"</pre>
</div>
<p>EPEL distro config is not very smooth:</p>
<div class="highlight-python"><pre>[blyth@belle1 trac-0.10.5]$ cat  /etc/httpd/conf.d/trac.conf
# Replace all occurrences of /srv/trac with your trac root below
# and uncomment the respective SetEnv and PythonOption directives.
&lt;LocationMatch /cgi-bin/trac\.f?cgi&gt;
    #SetEnv TRAC_ENV /srv/trac
&lt;/LocationMatch&gt;
&lt;IfModule mod_python.c&gt;
&lt;Location /cgi-bin/trac.cgi&gt;
    SetHandler mod_python
    PythonHandler trac.web.modpython_frontend
    #PythonOption TracEnv /srv/trac
&lt;/Location&gt;
&lt;/IfModule&gt;
[blyth@belle1 trac-0.10.5]$</pre>
</div>
</div>
<div class="section" id="lighttpd-fastcgi">
<h3>lighttpd fastcgi<a class="headerlink" href="#lighttpd-fastcgi" title="Permalink to this headline">¶</a></h3>
<p>Maybe can avoid apache with lighttpd:</p>
<div class="highlight-python"><pre>[blyth@belle1 httpd]$ sudo yum --enablerepo=epel install lighttpd
[blyth@belle1 httpd]$ sudo yum --enablerepo=epel install lighttpd-fastcgi


[blyth@belle1 ~]$ rpm -ql trac | grep trac.fcgi
/var/www/cgi-bin/trac.fcgi</pre>
</div>
<p>moving trac fast cgi into fastcgi avoids error,</p>
<blockquote>
<div>2012-05-02 19:49:23: (server.c.1512) server stopped by UID = 0 PID = 17722
2012-05-02 19:49:26: (log.c.166) server started</div></blockquote>
<p>but no show, nope need to</p>
<div class="highlight-python"><pre>include "conf.d/fastcgi.conf"</pre>
</div>
<p>gets to <a class="reference external" href="http://belle1.nuu.edu.tw/trac/">http://belle1.nuu.edu.tw/trac/</a> with:</p>
<div class="highlight-python"><pre>Internal Error

The user root requires read _and_ write permission to the database file
/var/scm/tracs/test/db/trac.db and the directory it is located in.</pre>
</div>
<p>Dealing with that:</p>
<div class="highlight-python"><pre>[blyth@belle1 httpd]$ lighttpd-chown /var/scm/tracs/test
=== lighttpd-chown : sudo chown lighttpd:lighttpd -R /var/scm/tracs/test</pre>
</div>
<p>gets to raw trac : using lighttpd + fastcgi on the test instance at</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://belle1.nuu.edu.tw/trac/">http://belle1.nuu.edu.tw/trac/</a></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="apache-mod-dav-svn">
<h3>apache mod_dav_svn<a class="headerlink" href="#apache-mod-dav-svn" title="Permalink to this headline">¶</a></h3>
<p>unfortunately cannot do away with apache, as need http access to repo with <strong>mod_dav_svn</strong>
distinct possibility this will mess up the trac install from epel ? Comparing deplist
yields hope it will work:</p>
<div class="highlight-python"><pre>[blyth@belle1 ~]$ sudo yum deplist mod_dav_svn
[blyth@belle1 ~]$ sudo yum deplist trac</pre>
</div>
<p>Both <strong>.so</strong> from <strong>mod_dav_svn</strong>:</p>
<div class="highlight-python"><pre>[blyth@belle1 ~]$ rpm -ql mod_dav_svn
/etc/httpd/conf.d/subversion.conf
/usr/lib/httpd/modules/mod_authz_svn.so
/usr/lib/httpd/modules/mod_dav_svn.so</pre>
</div>
<p>Problem with using lighttpd/fastcgi/trac + apache/mod_dav_svn is port clash
change the port for apache : as main use if via SVN when ugly URLs are not as glaring as with trac:</p>
<div class="highlight-python"><pre>[blyth@belle1 ~]$ sudo /sbin/service httpd start
Starting httpd: (98)Address already in use: make_sock: could not bind to address [::]:80
(98)Address already in use: make_sock: could not bind to address 0.0.0.0:80
no listening sockets available, shutting down
Unable to open logs
                                                           [FAILED]</pre>
</div>
<p>Open the port for me:</p>
<div class="highlight-python"><pre>IPTABLES_PORT=8080 iptables-webopen-ip 140.112.102.77</pre>
</div>
<p>Succeeds to make revision 0 of test repo visible</p>
<ul class="simple">
<li><a class="reference external" href="http://belle1.nuu.edu.tw:8080/repos/test/">http://belle1.nuu.edu.tw:8080/repos/test/</a></li>
</ul>
<p>Can checkout:</p>
<div class="highlight-python"><pre>g4pb-2:~ blyth$ svn co http://belle1.nuu.edu.tw:8080/repos/test
Checked out revision 0.
g4pb-2:~ blyth$
g4pb-2:~ blyth$ cd test
g4pb-2:test blyth$ svn st
g4pb-2:test blyth$ svn info
Path: .
Working Copy Root Path: /Users/blyth/test
URL: http://belle1.nuu.edu.tw:8080/repos/test
Repository Root: http://belle1.nuu.edu.tw:8080/repos/test
Repository UUID: 99398d55-88de-4a62-90a3-7cc4ad44927c
Revision: 0
Node Kind: directory
Schedule: normal
Last Changed Rev: 0
Last Changed Date: 2012-05-02 19:31:08 +0800 (Wed, 02 May 2012)</pre>
</div>
<p>But checkin fails:</p>
<div class="highlight-python"><pre>g4pb-2:test blyth$ svn add check.txt
A         check.txt
g4pb-2:test blyth$ svn ci -m "test mod_dav_svn on belle1 "
svn: E000013: Commit failed (details follow):
svn: E000013: Can't create directory '/var/scm/repos/test/db/transactions/0-1.txn': Permission denied</pre>
</div>
<p>Fixing apache ownership allows checkin to work:</p>
<div class="highlight-python"><pre>[blyth@belle1 conf.d]$ apache-chown /var/scm/repos -R
=== apache-chown : sudo chown -R apache:apache /var/scm/repos


g4pb-2:test blyth$ svn ci -m "test mod_dav_svn on belle1 "
Adding         check.txt
Transmitting file data .
Committed revision 1.</pre>
</div>
<p>Visible via mod_dav_svn and trac:</p>
<ul class="simple">
<li><a class="reference external" href="http://belle1.nuu.edu.tw:8080/repos/test/check.txt">http://belle1.nuu.edu.tw:8080/repos/test/check.txt</a></li>
<li><a class="reference external" href="http://belle1.nuu.edu.tw/trac/browser/check.txt">http://belle1.nuu.edu.tw/trac/browser/check.txt</a></li>
</ul>
</div>
<div class="section" id="belle1-next">
<h3>belle1 next<a class="headerlink" href="#belle1-next" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>multi &#8220;tracs&#8221; and &#8220;repos&#8221;</li>
<li>authentication + authorization</li>
<li>trac plugins : which extensions are really needed ? 0.10.4 probably means some difficulties</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://trac.edgewall.org/wiki/TracFastCgi#SimpleLighttpdConfiguration">http://trac.edgewall.org/wiki/TracFastCgi#SimpleLighttpdConfiguration</a></li>
</ul>
</div></blockquote>
<p>change to TRAC_ENV_PARENT_DIR in /etc/lighttpd/conf.d/fastcgi.conf succeeds to list projects and serve them in extensible manner</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://belle1.nuu.edu.tw/tracs/">http://belle1.nuu.edu.tw/tracs/</a>  &#8220;Available Projects&#8221;</li>
<li><a class="reference external" href="http://belle1.nuu.edu.tw/tracs/test/timeline">http://belle1.nuu.edu.tw/tracs/test/timeline</a></li>
</ul>
</div></blockquote>
<p>~/env/trac/tracdep.bash I have played with trac fastcgi previously it seems : with trac 0.11</p>
<p>generalize svnsetup- to the lighttpd/fastcgi/trac + apache/mod_dav_svn
and get working with epel yum trac 10.4 + corresponding AccountManager plugin</p>
<div class="highlight-python"><pre>svnsetup-repos- anon-or-real repos YES</pre>
</div>
</div>
<div class="section" id="trac-version-issues">
<h3>trac version issues<a class="headerlink" href="#trac-version-issues" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl class="docutils">
<dt><a class="reference external" href="http://trac-hacks.org/wiki/AccountManagerPlugin">http://trac-hacks.org/wiki/AccountManagerPlugin</a></dt>
<dd>(before Trac 0.11 this has been a separate trac:WebAdmin plugin)</dd>
</dl>
</div></blockquote>
<p>need users and authz files to proceed, so transfer the backups:</p>
<div class="highlight-python"><pre>[blyth@cms01 scm]$ rsync -e ssh -razvt /data/var/scm/backup/cms02 belle1.nuu.edu.tw:/var/scm/backup/</pre>
</div>
<p>furnish these from backup with:</p>
<div class="highlight-python"><pre>svnsetup-; svnsetup-from-backup-bootstrap</pre>
</div>
<p>now get permission denied for <a class="reference external" href="http://belle1.nuu.edu.tw:8080/repos/test/">http://belle1.nuu.edu.tw:8080/repos/test/</a></p>
</div>
</div>
<div class="section" id="cms02-source-build">
<h2>cms02 source build<a class="headerlink" href="#cms02-source-build" title="Permalink to this headline">¶</a></h2>
<div class="section" id="replacement-cms02-evaluation">
<h3>replacement cms02 evaluation<a class="headerlink" href="#replacement-cms02-evaluation" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">replacement cms02 network accessible + setup sudoer user account</p>
</li>
<li><p class="first">setup ssh keys, affording single keystoke login:</p>
<div class="highlight-python"><pre>g4pb-2:~ blyth$ ssh--putkey cms02.phys.ntu.edu.tw</pre>
</div>
</li>
<li><p class="first">check what we have, hmm older than cms01 ... means a source build of trac for a reasonable version:</p>
<div class="highlight-python"><pre>[blyth@hfag blyth]$ cat /etc/redhat-release
Scientific Linux SL release 3.0.9 (SL)

[blyth@cms02 ~]$ cat /etc/redhat-release
Scientific Linux SL release 4.5 (Beryllium)

[blyth@cms01 ~]$ cat /etc/redhat-release
Scientific Linux CERN SLC release 4.8 (Beryllium)

[blyth@belle7 repos]$ cat /etc/redhat-release
Scientific Linux SL release 5.1 (Boron)</pre>
</div>
</li>
<li><p class="first">check distro versions</p>
</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>trac version from EPEL for SL4 is 0.9.3 <tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">yum</span> <span class="pre">--enablerepo=epel</span> <span class="pre">info</span> <span class="pre">trac</span></tt> : too old for compatibility</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="basic-yum-installs">
<h3>basic yum installs<a class="headerlink" href="#basic-yum-installs" title="Permalink to this headline">¶</a></h3>
<p>The former <strong>hep6</strong> has nowt:</p>
<div class="highlight-python"><pre>sudo yum install gcc
sudo yum install gcc-c++
sudo yum install curl
sudo yum install zlib-devel</pre>
</div>
</div>
<div class="section" id="tracpreq-again-source-one-by-one">
<h3>tracpreq-again-source one-by-one<a class="headerlink" href="#tracpreq-again-source-one-by-one" title="Permalink to this headline">¶</a></h3>
<p>doing the <strong>tracpreq-again-source</strong> one-by-one:</p>
<div class="highlight-python"><pre>t tracpreq-again-source
tracpreq-again-source is a function
tracpreq-again-source ()
{
    local msg="=== $FUNCNAME :";
    [ "$(tracpreq-mode)" != "source" ] &amp;&amp; echo $msg ABORT this is for tracpreq-mode:source only &amp;&amp; return 1;
    local ans;
    read -p "$msg ENTER YES TO PROCEED" ans;
    [ "$ans" != "YES" ] &amp;&amp; echo $msg skipping &amp;&amp; return 1;
    log-;
    log-init $FUNCNAME;
    python-;
    pythonbuild-;
    pythonbuild-again | log-- $FUNCNAME pythonbuild-again;
    configobj-;
    configobj-get | log-- $FUNCNAME configobj-get;
    swig-;
    swigbuild-;
    swigbuild-again | log-- $FUNCNAME swigbuild-again;
    apache-;
    apache-again | log-- $FUNCNAME apache-again;
    svn-;
    svnbuild-;
    svnbuild-again | log-- $FUNCNAME svnbuild-again;
    sqlite-;
    sqlite-again | log-- $FUNCNAME sqlite-again
}</pre>
</div>
</div>
<div class="section" id="mis-ordering-in-the-build">
<h3>Mis-ordering in the build<a class="headerlink" href="#mis-ordering-in-the-build" title="Permalink to this headline">¶</a></h3>
<p>Hmm ordering seems wrong,</p>
<ol class="arabic simple">
<li>configobj-get requires svn</li>
<li>swigbuild-get requires svn</li>
</ol>
</div>
<div class="section" id="subversion-configure-failures">
<h3>subversion : configure failures<a class="headerlink" href="#subversion-configure-failures" title="Permalink to this headline">¶</a></h3>
<p>configuring svn:</p>
<div class="highlight-python"><pre>checking zlib.h presence... no
checking for zlib.h... no
configure: error: subversion requires zlib
make: *** No targets specified and no makefile found.  Stop.
make: *** No rule to make target `install'.  Stop.
Can't open Makefile: No such file or directory.
Can't open Makefile: No such file or directory.
diff: Makefile.orig: No such file or directory
diff: Makefile: No such file or directory
make: *** No rule to make target `swig-py'.  Stop.
make: *** No rule to make target `install-swig-py'.  Stop.
Traceback (most recent call last):
  File "&lt;string&gt;", line 1, in &lt;module&gt;
ImportError: No module named svn
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
ImportError: No module named svn</pre>
</div>
<p>Need the <tt class="docutils literal"><span class="pre">zlib-devel</span></tt>:</p>
<div class="highlight-python"><pre>[blyth@cms02 subversion-1.4.6]$ rpm -ql zlib
/usr/lib64/libz.so.1
/usr/lib64/libz.so.1.2.1.2
/usr/share/doc/zlib-1.2.1.2
/usr/share/doc/zlib-1.2.1.2/README
/usr/lib/libz.so.1
/usr/lib/libz.so.1.2.1.2
/usr/share/doc/zlib-1.2.1.2
/usr/share/doc/zlib-1.2.1.2/README
[blyth@cms02 subversion-1.4.6]$</pre>
</div>
<p>Missing a <tt class="docutils literal"><span class="pre">--shared</span></tt> in subversion config:</p>
<div class="highlight-python"><pre>       cd subversion/libsvn_ra_dav &amp;&amp; /bin/sh /data/env/system/svn/build/subversion-1.4.6/libtool --tag=CC --silent --mode=link gcc  -g -O2  -g -O2 -pthread   -L/data/env/system/svn/build/subversion-1.4.6/apr-util/xml/expat/lib  -rpath /data/env/system/svn/subversion-1.4.6/lib -o libsvn_ra_dav-1.la  commit.lo fetch.lo file_revs.lo log.lo merge.lo options.lo props.lo replay.lo session.lo util.lo ../../subversion/libsvn_delta/libsvn_delta-1.la ../../subversion/libsvn_subr/libsvn_subr-1.la /data/env/system/svn/build/subversion-1.4.6/apr-util/libaprutil-0.la /data/env/system/svn/build/subversion-1.4.6/apr-util/xml/expat/lib/libexpat.la /data/env/system/svn/build/subversion-1.4.6/apr/libapr-0.la -lrt -lm -lcrypt -lnsl  -lpthread -ldl /data/env/system/svn/build/subversion-1.4.6/neon/src/libneon.la -lz
       /usr/bin/ld: /data/env/system/svn/build/subversion-1.4.6/neon/src/.libs/libneon.a(ne_request.o): relocation R_X86_64_32 against `a local symbol' can not be used when making a shared object; recompile with -fPIC
       /data/env/system/svn/build/subversion-1.4.6/neon/src/.libs/libneon.a: could not read symbols: Bad value
       collect2: ld returned 1 exit status
       make: *** [subversion/libsvn_ra_dav/libsvn_ra_dav-1.la] Error 1



* http://svn.apache.org/repos/asf/subversion/site/publish/faq.html#relocation-against-local-symbol</pre>
</div>
</div>
<div class="section" id="subversion-link-fails">
<h3>subversion : Link fails<a class="headerlink" href="#subversion-link-fails" title="Permalink to this headline">¶</a></h3>
<p>Ye olde <tt class="docutils literal"><span class="pre">gssapi_krb5</span></tt> kludge strikes again:</p>
<div class="highlight-python"><pre>-0.la /data/env/system/svn/build/subversion-1.4.6/apr-util/xml/expat/lib/libexpat.la /data/env/system/svn/build/subversion-1.4.6/apr/libapr-0.la -lrt -lm -lcrypt -lnsl  -lpthread -ldl -L/usr/lib -lgssapi_krb5 -L/usr/lib -lgssapi_krb5 -lz
/usr/bin/ld: cannot find -lgssapi_krb5
collect2: ld returned 1 exit status</pre>
</div>
</div>
<div class="section" id="backup-transfer">
<h3>Backup Transfer<a class="headerlink" href="#backup-transfer" title="Permalink to this headline">¶</a></h3>
<p>Transfer the cms01 backups to the new cms02:</p>
<div class="highlight-python"><pre>[blyth@cms01 ~]$ rsync -av /data/var/scm/backup/cms02 cms02.phys.ntu.edu.tw:/var/scm/backup/
blyth@cms02.phys.ntu.edu.tw's password:</pre>
</div>
</div>
<div class="section" id="pysqlite-later-handled-by-fixing-python-build">
<h3>pysqlite : later handled by fixing python build<a class="headerlink" href="#pysqlite-later-handled-by-fixing-python-build" title="Permalink to this headline">¶</a></h3>
<p>pysqlite failing... is it really needed?:</p>
<div class="highlight-python"><pre>building 'pysqlite2._sqlite' extension
creating build/temp.linux-x86_64-2.5
creating build/temp.linux-x86_64-2.5/src
gcc -pthread -fno-strict-aliasing -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -fPIC -DMODULE_NAME="pysqlite2.dbapi2" -DSQLITE_OMIT_LOAD_EXTENSION=1 -I/data/env/system/python/Python-2.5.6/include/python2.5 -c src/module.c -o build/temp.linux-x86_64-2.5/src/module.o
In file included from src/module.c:24:
src/connection.h:33:21: sqlite3.h: No such file or directory
In file included from src/module.c:24:
src/connection.h:38: error: syntax error before "sqlite3"
src/connection.h:38: warning: no semicolon at end of struct or union</pre>
</div>
<p>from <a class="reference external" href="http://trac.edgewall.org/wiki/0.11/TracInstall">http://trac.edgewall.org/wiki/0.11/TracInstall</a> maybe not:</p>
<div class="highlight-python"><pre>If you're using Python 2.3 or 2.4 and need pysqlite,</pre>
</div>
</div>
<div class="section" id="tracbuild-auto">
<h3>tracbuild-auto<a class="headerlink" href="#tracbuild-auto" title="Permalink to this headline">¶</a></h3>
<p>Launch tracbuild-auto, abort as find no easy_install or setuptools:</p>
<div class="highlight-python"><pre>Checked out revision 4117.
Traceback (most recent call last):
  File "setup.py", line 9, in &lt;module&gt;
    from setuptools import setup
ImportError: No module named setuptools
=== package-look-version : version in the setup trunk/setup.py</pre>
</div>
<p>Try <tt class="docutils literal"><span class="pre">setuptools-get</span></tt> but meet zlib issue, the zlib-devel was not available when building python:</p>
<div class="highlight-python"><pre>[blyth@cms02 bitextra]$ setuptools-get
python ez_setup.py ... from /tmp/env/setuptools
Downloading http://pypi.python.org/packages/2.5/s/setuptools/setuptools-0.6c11-py2.5.egg
Traceback (most recent call last):
  File "ez_setup.py", line 278, in &lt;module&gt;
    main(sys.argv[1:])
  File "ez_setup.py", line 212, in main
    from setuptools.command.easy_install import main
zipimport.ZipImportError: can't decompress data; zlib not available
[blyth@cms02 bitextra]$</pre>
</div>
</div>
<div class="section" id="pythonbuild">
<h3>pythonbuild<a class="headerlink" href="#pythonbuild" title="Permalink to this headline">¶</a></h3>
<p>back to pythonbuild-configure then make, but think this was not needed... should have just done make : the zlib handling is done in setup.py after interpreter created not at config level ?
many curses errors from python make:</p>
<div class="highlight-python"><pre>running build_ext
INFO: Can't locate Tcl/Tk libs and/or headers
building '_curses' extension
gcc -pthread -fPIC -fno-strict-aliasing -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -I. -I/data/env/system/python/build/Python-2.5.6/./Include -I/data/env/system/python/Python-2.5.6/include -I. -IInclude -I./Include -I/usr/local/include -I/data/env/system/python/build/Python-2.5.6/Include -I/data/env/system/python/build/Python-2.5.6 -c /data/env/system/python/build/Python-2.5.6/Modules/_cursesmodule.c -o build/temp.linux-x86_64-2.5/data/env/system/python/build/Python-2.5.6/Modules/_cursesmodule.o
In file included from /data/env/system/python/build/Python-2.5.6/Modules/_cursesmodule.c:113:
/data/env/system/python/build/Python-2.5.6/./Include/py_curses.h:45:20: curses.h: No such file or directory
In file included from /data/env/system/python/build/Python-2.5.6/Modules/_cursesmodule.c:113:
/data/env/system/python/build/Python-2.5.6/./Include/py_curses.h:73: error: syntax error before "WINDOW"
/data/env/system/python/build/Python-2.5.6/./Include/py_curses.h:73: warning: no semicolon at end of struct or union</pre>
</div>
<p>eliminated after:</p>
<div class="highlight-python"><pre>sudo yum install ncurses
sudo yum install ncurses-devel</pre>
</div>
<p>still one complaint from make:</p>
<div class="highlight-python"><pre>running build_ext
INFO: Can't locate Tcl/Tk libs and/or headers
running build_scripts</pre>
</div>
<p>aftre python <tt class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></tt> <tt class="docutils literal"><span class="pre">setuptools-get</span></tt> succeeds</p>
<p>back to <tt class="docutils literal"><span class="pre">tracbuild-auto</span></tt> run into lack of tracdev (duh the server is dead ... need to skip bitextra):</p>
<div class="highlight-python"><pre>=== package-get : brn:trunk bnm:trunk pkt:svn tba:trunk url:http://dayabay.phys.ntu.edu.tw/repos/tracdev/annobit/trunk
=== package-get : svn checkout http://dayabay.phys.ntu.edu.tw/repos/tracdev/annobit/trunk rev 123 into /data/env/local/env/trac/package/bitextra with basename trunk
svn: PROPFIND request failed on '/repos/tracdev/annobit/trunk'
svn: PROPFIND of '/repos/tracdev/annobit/trunk': could not connect to server (http://dayabay.phys.ntu.edu.tw)
=== package-get : ABORT failed to checkout ...</pre>
</div>
<p>skip packages requireing tracdev via temporary hiding:</p>
<div class="highlight-python"><pre>[blyth@cms02 package]$ mv bitextra.bash.tmp-hide tmp-hide/bitextra.bash
[blyth@cms02 package]$ mv trac2latex.bash tmp-hide/
[blyth@cms02 package]$ mv trac2mediawiki.bash tmp-hide/
[blyth@cms02 package]$ l tmp-hide/
total 24
-rw-r--r--  1 blyth blyth 2681 Jan 10 09:30 bitextra.bash
-rw-r--r--  1 blyth blyth 3624 Jan 10 09:30 trac2latex.bash
-rw-r--r--  1 blyth blyth 3090 Jan 10 09:30 trac2mediawiki.bash</pre>
</div>
<p>issue with docutils, move it out of way also, install it ordinarily env/python/docutils.bash rather than as a trac package</p>
</div>
</div>
<div class="section" id="cms02-tarball-recovery">
<h2>cms02 : tarball recovery<a class="headerlink" href="#cms02-tarball-recovery" title="Permalink to this headline">¶</a></h2>
<p>Try <tt class="docutils literal"><span class="pre">scm-backup-;</span> <span class="pre">scm-recover-all</span> <span class="pre">cms02</span></tt>:</p>
<div class="highlight-python"><pre>=== scm-backup-synctrac : resyncing the instance with the repository ... as repository_dir has changed ... avoiding the yellow banner
=== trac-admin- : trac-admin : /data/env/system/python/Python-2.5.6/bin/trac-admin
=== trac-admin- : python : /data/env/system/python/Python-2.5.6/bin/python
=== trac-admin-
 LLP
 /data/env/system/sqlite/sqlite-3.3.16/lib
/data/env/system/svn/subversion-1.4.0/lib/svn-python/libsvn
/data/env/system/svn/subversion-1.4.0/lib/svn-python/svn

python: error while loading shared libraries: libpython2.5.so.1.0: cannot open shared object file: No such file or directory
=== trac-admin- : ABORT non-supported sqlite/pysqlite version ... see http://dayabay.phys.ntu.edu.tw/tracs/env/wiki/TracSQLiteMemoryExhaustion
env-abort
=== env-abort : ABORT ... sleeping forever</pre>
</div>
<p>Reproducible:</p>
<div class="highlight-python"><pre>[blyth@cms02 ~]$ trac-
[blyth@cms02 ~]$ TRAC_INSTANCE=data trac-admin-- resync
Password:
=== trac-admin- : trac-admin : /data/env/system/python/Python-2.5.6/bin/trac-admin
=== trac-admin- : python : /data/env/system/python/Python-2.5.6/bin/python
=== trac-admin-
 LLP
 /data/env/system/sqlite/sqlite-3.3.16/lib
/data/env/system/svn/subversion-1.4.0/lib/svn-python/libsvn
/data/env/system/svn/subversion-1.4.0/lib/svn-python/svn

python: error while loading shared libraries: libpython2.5.so.1.0: cannot open shared object file: No such file or directory
=== trac-admin- : ABORT non-supported sqlite/pysqlite version ... see http://dayabay.phys.ntu.edu.tw/tracs/env/wiki/TracSQLiteMemoryExhaustion
env-abort
=== env-abort : ABORT ... sleeping forever</pre>
</div>
<div class="section" id="python-sqlite-issue">
<h3>python sqlite issue<a class="headerlink" href="#python-sqlite-issue" title="Permalink to this headline">¶</a></h3>
<p>Seems the pythonbuild did not find the sqlite, both an order problem and fact that the python setup.py looks only in hardcoded locations for
sqlite headers.  Kludge the <tt class="docutils literal"><span class="pre">setup.py</span></tt> of the python build with added path:</p>
<div class="highlight-python"><pre>sqlite_inc_paths = [ '/usr/include',
                           '/usr/include/sqlite',
                           '/usr/include/sqlite3',
                           '/usr/local/include',
                           '/usr/local/include/sqlite',
                           '/usr/local/include/sqlite3',
                           '/data/env/system/sqlite/sqlite-3.3.16/include',
                         ]
   pythonbuild-cd
   make
   make install</pre>
</div>
<p>This enables the version check to work:</p>
<div class="highlight-python"><pre>trac-admin-sqlite-check-
sqlite_version_string:3.3.16 have_pysqlite:2</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">bash</span></tt> environment has the wrong <strong>SVN_HOME</strong>:</p>
<div class="highlight-python"><pre>[blyth@cms02 Python-2.5.6]$ sudo bash -c "export ENV_HOME=$ENV_HOME ; . $ENV_HOME/env.bash ; env- ; echo \$SVN_HOME "
/data/env/system/svn/subversion-1.4.0
[blyth@cms02 Python-2.5.6]$ echo $SVN_HOME
/data/env/system/svn/subversion-1.4.6</pre>
</div>
<p>Needed to set versions for NODE_TAG C2R to get correct paths, looked like bug with <tt class="docutils literal"><span class="pre">python-path</span></tt> but was not, just the C2R issue.</p>
<p>recover-all has some fails in <strong>Resyncing repository history...</strong> namely:</p>
<div class="highlight-python"><pre>Command failed: /var/scm/svn/dybaux does not appear to be a Subversion repository.
Command failed: /var/scm/svn/dybsvn does not appear to be a Subversion repository.
Command failed: /var/scm/svn/toysvn does not appear to be a Subversion repository.</pre>
</div>
<p>which correspond to traconlyies(how come?) in backup:</p>
<div class="highlight-python"><pre>[blyth@cms02 scm]$ l backup/cms02/repos/
total 48
drwxr-xr-x  6 blyth blyth 4096 May  1 13:02 aberdeen
drwxr-xr-x  6 blyth blyth 4096 May  1 13:02 data
drwxr-xr-x  6 blyth blyth 4096 May  1 13:02 env
drwxr-xr-x  6 blyth blyth 4096 May  1 13:02 heprez
drwxr-xr-x  6 blyth blyth 4096 May  1 13:02 newtest
drwxr-xr-x  6 blyth blyth 4096 May  1 13:02 tracdev

[blyth@cms02 scm]$ l backup/cms02/tracs/
total 72
drwxr-xr-x  6 blyth blyth 4096 May  1 13:03 aberdeen
drwxr-xr-x  6 blyth blyth 4096 May  1 13:03 data
drwxr-xr-x  6 blyth blyth 4096 May  1 13:03 env
drwxr-xr-x  6 blyth blyth 4096 May  1 13:04 heprez
drwxr-xr-x  6 blyth blyth 4096 May  1 13:04 newtest
drwxr-xr-x  6 blyth blyth 4096 May  1 13:04 tracdev

drwxr-xr-x  4 blyth blyth 4096 May  1 13:04 toysvn
drwxr-xr-x  6 blyth blyth 4096 May  1 13:03 dybaux
drwxr-xr-x  3 blyth blyth 4096 Oct 17  2011 dybsvn</pre>
</div>
<p>Also some broken link in htdocs issues:</p>
<div class="highlight-python"><pre>=== apache-chown : sudo chown -R nobody:nobody heprez
/bin/chown: cannot dereference `heprez/htdocs/docs': No such file or directory
/bin/chown: cannot dereference `tracdev/htdocs/docs': No such file or directory


[blyth@cms02 scm]$ l tracs/*/htdocs/docs
lrwxrwxrwx  1 root root 48 May  4 20:12 tracs/heprez/htdocs/docs -&gt; /data/usr/local/heprez/src/hfag/mods/webapp/docs
lrwxrwxrwx  1 root root 48 May  4 20:13 tracs/tracdev/htdocs/docs -&gt; /data/usr/local/heprez/src/hfag/mods/webapp/docs</pre>
</div>
</div>
</div>
<div class="section" id="cms02-apache-hookup">
<h2>cms02 : apache hookup<a class="headerlink" href="#cms02-apache-hookup" title="Permalink to this headline">¶</a></h2>
<p>Next, getting SVN+trac hooked up to source apache with svnsetup-apache</p>
<p>SVN and Trac access working:</p>
<div class="highlight-python"><pre>http://dayabay.phys.ntu.edu.tw/repos/env/trunk/</pre>
</div>
<p>Service hookup with <tt class="docutils literal"><span class="pre">apache-initd</span></tt> symbolic linking to apachectl</p>
<p>Post commit failure:</p>
<div class="highlight-python"><pre>g4pb-2:env blyth$ ci -m "bring belle1 N1 into the sshconf fold "
...
Transmitting file data .....
Committed revision 3444.

Warning: 'post-commit' hook failed with error output:
/var/scm/repos/env/hooks/post-commit: line 8: /data/env/system/python/Python-2.5.1/bin/python: No such file or directory</pre>
</div>
</div>
<div class="section" id="cms02-backups-rsync-chkconfig">
<h2>cms02 : backups + rsync + chkconfig<a class="headerlink" href="#cms02-backups-rsync-chkconfig" title="Permalink to this headline">¶</a></h2>
<div class="section" id="c2r-env-hookup">
<h3>C2R env hookup<a class="headerlink" href="#c2r-env-hookup" title="Permalink to this headline">¶</a></h3>
<p>Hookup <strong>root&#64;cms02</strong> <tt class="docutils literal"><span class="pre">ssh</span> <span class="pre">C2R</span></tt> to env to do backups, in <tt class="docutils literal"><span class="pre">.bash_profile</span></tt>:</p>
<div class="highlight-python"><pre>export ENV_HOME=/home/blyth/env  ; env-(){      [ -r $ENV_HOME/env.bash ]           &amp;&amp; . $ENV_HOME/env.bash            &amp;&amp; env-env $* ; }
#env-</pre>
</div>
</div>
<div class="section" id="scm-backup-all-misses-svnlook">
<h3>scm-backup-all misses svnlook<a class="headerlink" href="#scm-backup-all-misses-svnlook" title="Permalink to this headline">¶</a></h3>
<p>Wrong svn version dumped:</p>
<div class="highlight-python"><pre>[root@cms02 ~]# scm-backup-all
=== scm-backup-all : starting from pwd /root
=== scm-backup-lock : /var/scm/LOCKED/scm-backup-all-started-2012-05-07@18:25:42
/data/env/system/python/Python-2.5.6/bin/python
/data/env/system/sqlite/sqlite-3.3.16/lib
/data/env/system/python/Python-2.5.6/lib
/data/env/system/svn/subversion-1.4.0/lib/svn-python/libsvn
/data/env/system/svn/subversion-1.4.0/lib/svn-python/svn

=== scm-backup-all : svn === skip non-folder /var/scm/svn/*
=== scm-backup-repo : name aberdeen path /var/scm/repos/aberdeen base /var/scm/backup/cms02 stamp 2012/05/07/182542 site ntu ===
=== scm-backup-repo : mkdir -p /var/scm/backup/cms02/repos/aberdeen/2012/05/07/182542 &amp;&amp; /data/env/system/svn/build/subversion-1.4.6/tools/backup/hot-backup.py --archive-type=gz /var/scm/repos/aberdeen /var/scm/backup/cms02/repos/aberdeen/2012/05/07/182542 &amp;&amp; cd /var/scm/backup/cms02/repos/aberdeen &amp;&amp; rm -f last &amp;&amp; ln -s 2012/05/07/182542 last
Beginning hot backup of '/var/scm/repos/aberdeen'.
Youngest revision is 1599
Backing up repository to '/var/scm/backup/cms02/repos/aberdeen/2012/05/07/182542/aberdeen-1599'...
Done.
Archiving backup to '/var/scm/backup/cms02/repos/aberdeen/2012/05/07/182542/aberdeen-1599.tar.gz'...
Archive created, removing backup '/var/scm/backup/cms02/repos/aberdeen/2012/05/07/182542/aberdeen-1599'...
-bash: svnlook: command not found
tar: /var/scm/backup/cms02/repos/aberdeen/2012/05/07/182542/aberdeen-.tar.gz: Cannot open: No such file or directory
tar: Error is not recoverable: exiting now
tar: Child returned status 2
tar: Error exit delayed from previous errors
=== scm-tgzcheck-ztvf : tgz /var/scm/backup/cms02/repos/aberdeen/2012/05/07/182542/aberdeen-.tar.gz integrity check FAILURE 2
=== scm-backup-repo : tgz /var/scm/backup/cms02/repos/aberdeen/2012/05/07/182542/aberdeen-.tar.gz rev integrity check failure 2
[root@cms02 aberdeen]#
[root@cms02 aberdeen]#</pre>
</div>
</div>
<div class="section" id="scm-backup-rsync">
<h3>scm-backup-rsync<a class="headerlink" href="#scm-backup-rsync" title="Permalink to this headline">¶</a></h3>
<p>Generate ssh config and setup keys for auto rsync:</p>
<div class="highlight-python"><pre>[root@cms02 ~]# sshconf-
[root@cms02 ~]# local-tags                        ## corresponds to backup nodes
C N H1
[root@cms02 ~]# sshconf-gen                       ## generate .ssh/config with sections for the local-tags

[root@cms02 .ssh]# mv id_rsa id_rsa.pub former/   ## move aside old keys that I do not has passphrases for
[root@cms02 .ssh]# ssh--keygen
[root@cms02 ~]# ssh--putkeys                      ## mammoth session of password and passphrase entry to all backup nodes

[root@cms02 ~]# ssh--agent-start
[root@cms02 ~]# scm-backup-rsync                  ## manual test of backup</pre>
</div>
<div class="section" id="bogged-down-by-big-dybsvn-tarballs">
<h4>Bogged down by big dybsvn tarballs<a class="headerlink" href="#bogged-down-by-big-dybsvn-tarballs" title="Permalink to this headline">¶</a></h4>
<p>Move big fat foreigners into dedicated folder:</p>
<div class="highlight-python"><pre>[blyth@cms02 scm]$ mkdir -p foreign/cms02/tracs
[blyth@cms02 scm]$ mv backup/cms02/tracs/toysvn foreign/cms02/tracs/
[blyth@cms02 scm]$ mv backup/cms02/tracs/dybsvn foreign/cms02/tracs/
[blyth@cms02 scm]$ mv backup/cms02/tracs/dybaux foreign/cms02/tracs/</pre>
</div>
</div>
<div class="section" id="also-remote-dna-checking">
<h4>Also remote DNA checking<a class="headerlink" href="#also-remote-dna-checking" title="Permalink to this headline">¶</a></h4>
<p>Restrict remote DNA check to the source <tt class="docutils literal"><span class="pre">LOCAL_NODE</span></tt> to avoid slow irrelevant DNA checks</p>
</div>
<div class="section" id="add-belle1-to-backup-nodes">
<h4>Add belle1 to backup nodes<a class="headerlink" href="#add-belle1-to-backup-nodes" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>add to <tt class="docutils literal"><span class="pre">local-tags</span></tt> , <tt class="docutils literal"><span class="pre">sshconf-gen</span></tt> adding to ssh config and <tt class="docutils literal"><span class="pre">ssh--putkey</span> <span class="pre">N1</span></tt> from <strong>C2R</strong></li>
</ol>
</div>
<div class="section" id="dna-check-failures-from-a-disappearing-l-python-version-difference">
<h4>DNA check failures from a disappearing L (python version difference?)<a class="headerlink" href="#dna-check-failures-from-a-disappearing-l-python-version-difference" title="Permalink to this headline">¶</a></h4>
<p>Digest matches but the size has lost an <em>L</em>:</p>
<div class="highlight-python"><pre>=== scm-backup-dnachecktgzs : OK /var/scm/backup/cms02/tracs/env/2012/05/01/130104/env.tar.gz
1c1
&lt; {'dig': '9e1a36c02cdb837c55404d38b33def8b', 'size': 53648743}
---
&gt; {'dig': '9e1a36c02cdb837c55404d38b33def8b', 'size': 53648743L}</pre>
</div>
<p>Reproduce:</p>
<div class="highlight-python"><pre>[root@cms02 ~]# scm-backup-dnachecktgzs /var/scm/backup/cms02/repos/heprez
1c1
&lt; {'dig': 'df6aa49ac8917b8d4144de5abb1a02cc', 'size': 4215148L}
---
&gt; {'dig': 'df6aa49ac8917b8d4144de5abb1a02cc', 'size': 4215148}
=== scm-backup-dnachecktgzs : FAIL /var/scm/backup/cms02/repos/heprez/2012/05/01/130104/heprez-764.tar.gz
=== scm-backup-dnachecktgzs : OK /var/scm/backup/cms02/repos/heprez/2012/05/07/183131/heprez-764.tar.gz
1c1
&lt; {'dig': '6a1024a2b03e128bfd65aad168ff3c90', 'size': 4214891L}
---
&gt; {'dig': '6a1024a2b03e128bfd65aad168ff3c90', 'size': 4214891}
=== scm-backup-dnachecktgzs : FAIL /var/scm/backup/cms02/repos/heprez/2012/04/29/130108/heprez-764.tar.gz
1c1
&lt; {'dig': '2f02f6b5e844ac07c665ebf82850e561', 'size': 4214780L}
---
&gt; {'dig': '2f02f6b5e844ac07c665ebf82850e561', 'size': 4214780}
=== scm-backup-dnachecktgzs : FAIL /var/scm/backup/cms02/repos/heprez/2012/04/30/130103/heprez-764.tar.gz
[root@cms02 ~]#
[root@cms02 ~]#
[root@cms02 ~]#
[root@cms02 ~]# ll /var/scm/backup/cms02/repos/heprez/2012/05/07/183131/heprez-764.tar.gz.dna
-rw-r--r--  1 root root 61 May  7 18:33 /var/scm/backup/cms02/repos/heprez/2012/05/07/183131/heprez-764.tar.gz.dna
[root@cms02 ~]# cat  /var/scm/backup/cms02/repos/heprez/2012/05/07/183131/heprez-764.tar.gz.dna
{'dig': 'f3e450f405704c1cabb3f32f4196af96', 'size': 4226393}
[root@cms02 ~]#</pre>
</div>
<p>Seems harmless, will go away once have all new <tt class="docutils literal"><span class="pre">.tar.gz.dna</span></tt></p>
</div>
</div>
<div class="section" id="chkconfig-setup-allowing-auto-revival-on-reboot">
<h3>chkconfig setup : allowing auto-revival on reboot<a class="headerlink" href="#chkconfig-setup-allowing-auto-revival-on-reboot" title="Permalink to this headline">¶</a></h3>
<p>Add chkconfig lines to:</p>
<div class="highlight-python"><pre>[blyth@cms02 init.d]$ ls -l httpd
lrwxrwxrwx  1 root root 50 May  7 15:34 httpd -&gt; /data/env/system/apache/httpd-2.0.64/bin/apachectl</pre>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># chkconfig: 345 95 05</span>
<span class="c"># description: source apache serving Trac + SVN repositories via mod python and mod_dav_svn</span>
</pre></div>
</div>
<div class="section" id="cms02-chkconfig-for-auto-restart">
<h4>cms02 chkconfig for auto-restart<a class="headerlink" href="#cms02-chkconfig-for-auto-restart" title="Permalink to this headline">¶</a></h4>
<p>June 20 2012, OOM killer httpd issue forced restart of C2, symptom: C2 is ping-able but not ssh-able.
Restart failed to auto-restart httpd.   <strong>Need to remember to chkconfig add</strong></p>
<div class="highlight-python"><pre>[blyth@cms02 ~]$ sudo /sbin/chkconfig --list httpd
service httpd supports chkconfig, but is not referenced in any runlevel (run 'chkconfig --add httpd')
[blyth@cms02 ~]$
[blyth@cms02 ~]$ sudo /sbin/chkconfig --add httpd
[blyth@cms02 ~]$
[blyth@cms02 ~]$
[blyth@cms02 ~]$ sudo /sbin/chkconfig --list httpd
httpd           0:off   1:off   2:off   3:on    4:on    5:on    6:off
[blyth@cms02 ~]$
[blyth@cms02 ~]$ sudo /sbin/service httpd start
[blyth@cms02 ~]$</pre>
</div>
</div>
</div>
<div class="section" id="cron-hookup-notification-mail">
<h3>cron hookup + notification mail<a class="headerlink" href="#cron-hookup-notification-mail" title="Permalink to this headline">¶</a></h3>
<p>Adapt root and blyth cronlines from G:</p>
<div class="highlight-python"><pre>SHELL = /bin/bash
59 13 * * *  ( export HOME=/root ; export NODE=cms02 ; export MAILTO=blyth@hep1.phys.ntu.edu.tw ; export ENV_HOME=/home/blyth/env ; . /home/blyth/env/env.bash ; env-  ; scm-backup- ; scm-backup-nightly ) &gt;  /var/scm/log/scm-backup-nightly.log 2&gt;&amp;1</pre>
</div>
<div class="section" id="hfag-chkconfig-starts-undesired-services">
<h4>hfag chkconfig : starts undesired services<a class="headerlink" href="#hfag-chkconfig-starts-undesired-services" title="Permalink to this headline">¶</a></h4>
<p>Tidied up the extraneous apache links in /etc/init.d/</p>
</div>
<div class="section" id="recovering-from-yet-another-ntu-powercut-thu-10-may-2012-13-30">
<h4>Recovering from Yet Another NTU Powercut,  Thu 10 May 2012 ~13:30<a class="headerlink" href="#recovering-from-yet-another-ntu-powercut-thu-10-may-2012-13-30" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">cms01 : cannot access cms01, no ping:</p>
<div class="highlight-python"><pre>   simon:env blyth$ date
   Thu 10 May 2012 14:17:36 CST
   simon:env blyth$ ping cms01.phys.ntu.edu.tw
   PING cms01.phys.ntu.edu.tw (140.112.101.190): 56 data bytes

#. from console, twas stuck at BIOS initialization ... powercycling regained access

#. usual manual mount::

      [blyth@cms01 ~]$ sudo mount /data

#. do a manual ``exist-start`` as improper shutdown, this hangs ... but doing a exist-service-start succeeds
   and the XMLDB is operational, succeeded to to a heprez-propagate to G for backup</pre>
</div>
</li>
<li><p class="first">hfag : again started too much, manually stop tomcat and exist, httpd OK:</p>
<div class="highlight-python"><pre>[blyth@hfag blyth]$ sudo /sbin/service tomcat stop
[blyth@hfag blyth]$ sudo /sbin/service exist stop</pre>
</div>
</li>
</ol>
<div class="sidebar">
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../TODO/" title="TODO"
             >next</a> |</li>
        <li class="right" >
          <a href="../../base/gcc/" title="MULTIPLE gcc/g++ HANDLING"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>