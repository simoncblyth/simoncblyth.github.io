<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>stepping &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../../../" />
    <link rel="up" title="base" href="../" />
    <link rel="next" title="chroma" href="../../../../chroma/" />
    <link rel="prev" title="Profiling Analysis" href="../analysis/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../../chroma/" title="chroma"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../analysis/" title="Profiling Analysis"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../" >muon_simulation</a> &raquo;</li>
          <li><a href="../../" >profiling</a> &raquo;</li>
          <li><a href="../" accesskey="U">base</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pycuda/">pycuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../geant4/">geant4</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../">muon_simulation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../presentation/">Muon Simulation Presentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tasks/">Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/">Muon Simulation Optimization Tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../techniques/">Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../optical_photon_weighting/">weighted_optical_photon</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../">profiling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hg/">hg</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../../_sources/muon_simulation/profiling/base/stepping.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../analysis/"
                        title="previous chapter">Profiling Analysis</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../../../../chroma/"
                        title="next chapter">chroma</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="stepping">
<h1>stepping<a class="headerlink" href="#stepping" title="Permalink to this headline">Â¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#g4eventmanager-doprocessing" id="id1">G4EventManager::DoProcessing</a></li>
<li><a class="reference internal" href="#g4trackingmanager-processonetrack" id="id2">G4TrackingManager::ProcessOneTrack</a></li>
<li><a class="reference internal" href="#g4steppingmanager-stepping" id="id3">G4SteppingManager::Stepping</a></li>
<li><a class="reference internal" href="#g4steppingmanager-invokepoststepdoitprocs" id="id4">G4SteppingManager::InvokePostStepDoItProcs</a></li>
<li><a class="reference internal" href="#g4steppingmanager-invokepsdip" id="id5">G4SteppingManager::InvokePSDIP</a></li>
</ul>
</div>
<div class="section" id="g4eventmanager-doprocessing">
<h2><a class="toc-backref" href="#id1">G4EventManager::DoProcessing</a><a class="headerlink" href="#g4eventmanager-doprocessing" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python"><pre>(gdb) b 'G4EventManager::DoProcessing(G4Event*)'
Breakpoint 1 at 0xb7b9fd94: file src/G4EventManager.cc, line 100.
(gdb) p verboseLevel = 1
$2 = 1
(gdb) p verboseLevel
$3 = 1
(gdb) c
Continuing.
=====================================
  G4EventManager::ProcessOneEvent()
=====================================
1 primaries are passed from G4EventTransformer.
!!!!!!! Now start processing an event !!!!!!!
Track (trackID 1, parentID 0) is processed with stopping code 4
Track (trackID 57, parentID 1) is processed with stopping code 2
...</pre>
</div>
<div class="highlight-python"><pre>[blyth@belle7 20130820-1318]$ pprof --list=G4EventManager::DoProcessing $(which python) base.prof
Using local file /data1/env/local/dyb/external/Python/2.7/i686-slc5-gcc41-dbg/bin/python.
Using local file base.prof.
Removing _init from all stack traces.
ROUTINE ====================== G4EventManager::DoProcessing in /data1/env/local/dyb/external/build/LCG/geant4.9.2.p01/source/event/src/G4EventManager.cc
   355 705977 Total samples (flat / cumulative)
     .      .   93: G4int G4EventManager::operator!=(const G4EventManager &amp;right) const { }
     .      .   94: */
     .      .   95:
     .      .   96:
     .      .   97:
---
     .      .   98: void G4EventManager::DoProcessing(G4Event* anEvent)
     .      .   99: {
     .      .  100:   G4StateManager* stateManager = G4StateManager::GetStateManager();
     .      .  101:   G4ApplicationState currentState = stateManager-&gt;GetCurrentState();
     .      .  102:   if(currentState!=G4State_GeomClosed)
     .      .  103:   {
     .      .  104:     G4Exception("G4EventManager::ProcessOneEvent",
     .      .  105:                 "IllegalApplicationState",
     .      .  106:                 JustWarning,
     .      .  107:                 "Geometry is not closed : cannot process an event.");
     .      .  108:     return;
     .      .  109:   }
     .      .  110:   currentEvent = anEvent;
     .      .  111:   stateManager-&gt;SetNewState(G4State_EventProc);
     .      .  112:   if(storetRandomNumberStatusToG4Event&gt;1)
     .      .  113:   {
     .      .  114:     std::ostringstream oss;
     .      .  115:     CLHEP::HepRandom::saveFullState(oss);
     .      .  116:     randomNumberStatusToG4Event = oss.str();
     .      .  117:     currentEvent-&gt;SetRandomNumberStatusForProcessing(randomNumberStatusToG4Event);
     .      .  118:   }
     .      .  119:
     .      .  120:   // Reseting Navigator has been moved to G4Eventmanager, so that resetting
     .      .  121:   // is now done for every event.
     .      .  122:   G4ThreeVector center(0,0,0);
     .      .  123:   G4Navigator* navigator =
     .      1  124:       G4TransportationManager::GetTransportationManager()-&gt;GetNavigatorForTracking();
     .      .  125:   navigator-&gt;LocateGlobalPointAndSetup(center,0,false);
     .      .  126:
     .      .  127:   G4Track * track;
     .      .  128:   G4TrackStatus istop;
     .      .  129:
     .      .  130: #ifdef G4VERBOSE
     .      .  131:   if ( verboseLevel &gt; 0 )
     .      .  132:   {
     .      .  133:     G4cout &lt;&lt; "=====================================" &lt;&lt; G4endl;
     .      .  134:     G4cout &lt;&lt; "  G4EventManager::ProcessOneEvent()  " &lt;&lt; G4endl;
     .      .  135:     G4cout &lt;&lt; "=====================================" &lt;&lt; G4endl;
     .      .  136:   }
     .      .  137: #endif
     .      .  138:
     .      .  139:   trackContainer-&gt;PrepareNewEvent();
     .      .  140:
     .      .  141: #ifdef G4_STORE_TRAJECTORY
     .      .  142:   trajectoryContainer = 0;
     .      .  143: #endif
     .      .  144:
     .      .  145:   sdManager = G4SDManager::GetSDMpointerIfExist();
     .      .  146:   if(sdManager)
     .      .  147:   { currentEvent-&gt;SetHCofThisEvent(sdManager-&gt;PrepareNewEvent()); }
     .      .  148:
     .      .  149:   if(userEventAction) userEventAction-&gt;BeginOfEventAction(currentEvent);
     .      .  150:
     .      .  151: #ifdef G4VERBOSE
     .      .  152:   if ( verboseLevel &gt; 1 )
     .      .  153:   {
     .      .  154:     G4cout &lt;&lt; currentEvent-&gt;GetNumberOfPrimaryVertex()
     .      .  155:          &lt;&lt; " vertices passed from G4Event." &lt;&lt; G4endl;
     .      .  156:   }
     .      .  157: #endif
     .      .  158:
     .      .  159:   if(!abortRequested)
     .      .  160:   { StackTracks( transformer-&gt;GimmePrimaries( currentEvent, trackIDCounter ),true ); }
     .      .  161:
     .      .  162: #ifdef G4VERBOSE
     .      .  163:   if ( verboseLevel &gt; 0 )
     .      .  164:   {
     .      .  165:     G4cout &lt;&lt; trackContainer-&gt;GetNTotalTrack() &lt;&lt; " primaries "
     .      .  166:          &lt;&lt; "are passed from G4EventTransformer." &lt;&lt; G4endl;
     .      .  167:     G4cout &lt;&lt; "!!!!!!! Now start processing an event !!!!!!!" &lt;&lt; G4endl;
     .      .  168:   }
     .      .  169: #endif
     .      .  170:
     .      .  171:   G4VTrajectory* previousTrajectory;
     .      .  172:   while( ( track = trackContainer-&gt;PopNextTrack(&amp;previousTrajectory) ) != 0 )
     .      .  173:   {
     .      .  174:
     .      .  175: #ifdef G4VERBOSE
    12     12  176:     if ( verboseLevel &gt; 1 )
     .      .  177:     {
     .      .  178:       G4cout &lt;&lt; "Track " &lt;&lt; track &lt;&lt; " (trackID " &lt;&lt; track-&gt;GetTrackID()
     .      .  179:      &lt;&lt; ", parentID " &lt;&lt; track-&gt;GetParentID()
     .      .  180:      &lt;&lt; ") is passed to G4TrackingManager." &lt;&lt; G4endl;
     .      .  181:     }
     .      .  182: #endif
     .      .  183:
    16     16  184:     tracking = true;
     5 705523  185:     trackManager-&gt;ProcessOneTrack( track );
   144    148  186:     istop = track-&gt;GetTrackStatus();
     .      .  187:     tracking = false;
     .      .  188:
     .      .  189: #ifdef G4VERBOSE
    20     20  190:     if ( verboseLevel &gt; 0 )
     .      .  191:     {
     .      .  192:       G4cout &lt;&lt; "Track (trackID " &lt;&lt; track-&gt;GetTrackID()
     .      .  193:      &lt;&lt; ", parentID " &lt;&lt; track-&gt;GetParentID()
     .      .  194:          &lt;&lt; ") is processed with stopping code " &lt;&lt; istop &lt;&lt; G4endl;
     .      .  195:     }
     .      .  196: #endif
     .      .  197:
     .      .  198:     G4VTrajectory * aTrajectory = 0;
     .      .  199: #ifdef G4_STORE_TRAJECTORY
    66     67  200:     aTrajectory = trackManager-&gt;GimmeTrajectory();
     .      .  201:
    10     10  202:     if(previousTrajectory)
     .      .  203:     {
     .      .  204:       previousTrajectory-&gt;MergeTrajectory(aTrajectory);
     .      .  205:       delete aTrajectory;
     .      .  206:       aTrajectory = previousTrajectory;
     .      .  207:     }
     .      .  208:     if(aTrajectory&amp;&amp;(istop!=fStopButAlive)&amp;&amp;(istop!=fSuspend))
     .      .  209:     {
     .      .  210:       if(!trajectoryContainer)
     .      .  211:       { trajectoryContainer = new G4TrajectoryContainer;
     .      .  212:         currentEvent-&gt;SetTrajectoryContainer(trajectoryContainer); }
     .      .  213:       trajectoryContainer-&gt;insert(aTrajectory);
     .      .  214:     }
     .      .  215: #endif
     .      .  216:
    61    159  217:     G4TrackVector * secondaries = trackManager-&gt;GimmeSecondaries();
    21     21  218:     switch (istop)
---
     .      .  219:     {
     .      .  220:       case fStopButAlive:
     .      .  221:       case fSuspend:
     .      .  222:         trackContainer-&gt;PushOneTrack( track, aTrajectory );
     .      .  223:         StackTracks( secondaries );


                224         break;
                225
                226       case fPostponeToNextEvent:
                227         trackContainer-&gt;PushOneTrack( track );
                228         StackTracks( secondaries );
                229         break;
                230
                231       case fStopAndKill:
                232         StackTracks( secondaries );
                233         delete track;
                234         break;
                235
                236       case fAlive:
                237         G4cout &lt;&lt; "Illeagal TrackStatus returned from G4TrackingManager!"
                238              &lt;&lt; G4endl;
                239       case fKillTrackAndSecondaries:
                240         //if( secondaries ) secondaries-&gt;clearAndDestroy();
                241         if( secondaries )
                242         {
                243           for(size_t i=0;i&lt;secondaries-&gt;size();i++)
                244           { delete (*secondaries)[i]; }
                245           secondaries-&gt;clear();
                246         }
                247         delete track;
                248         break;
                249     }
                250   }
                251
                252 #ifdef G4VERBOSE
                253   if ( verboseLevel &gt; 0 )
                254   {
                255     G4cout &lt;&lt; "NULL returned from G4StackManager." &lt;&lt; G4endl;
                256     G4cout &lt;&lt; "Terminate current event processing." &lt;&lt; G4endl;
                257   }
                258 #endif
                259
                260   if(sdManager)
                261   { sdManager-&gt;TerminateCurrentEvent(currentEvent-&gt;GetHCofThisEvent()); }
                262
                263   if(userEventAction) userEventAction-&gt;EndOfEventAction(currentEvent);
                264
                265   stateManager-&gt;SetNewState(G4State_GeomClosed);
                266   currentEvent = 0;
                267   abortRequested = false;
                268 }</pre>
</div>
</div>
<div class="section" id="g4trackingmanager-processonetrack">
<h2><a class="toc-backref" href="#id2">G4TrackingManager::ProcessOneTrack</a><a class="headerlink" href="#g4trackingmanager-processonetrack" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python"><pre>[blyth@belle7 20130820-1318]$ pprof --list=G4TrackingManager::ProcessOneTrack $(which python) base.prof
Using local file /data1/env/local/dyb/external/Python/2.7/i686-slc5-gcc41-dbg/bin/python.
Using local file base.prof.
Removing _init from all stack traces.
ROUTINE ====================== G4TrackingManager::ProcessOneTrack in /data1/env/local/dyb/external/build/LCG/geant4.9.2.p01/source/tracking/src/G4TrackingManager.cc
  1607 705402 Total samples (flat / cumulative)
     .      .   63:   delete fpSteppingManager;
     .      .   64:   if (fpUserTrackingAction) delete fpUserTrackingAction;
     .      .   65: }
     .      .   66:
     .      .   67: ////////////////////////////////////////////////////////////////
---
    16     16   68: void G4TrackingManager::ProcessOneTrack(G4Track* apValueG4Track)
     .      .   69: ////////////////////////////////////////////////////////////////
     .      .   70: {
     .      .   71:
     .      .   72:   // Receiving a G4Track from the EventManager, this funciton has the
     .      .   73:   // responsibility to trace the track till it stops.
     1      1   74:   fpTrack = apValueG4Track;
     .      .   75:   EventIsAborted = false;
     .      .   76:
     .      .   77:   // Clear 2ndary particle vector
     .      .   78:   //  GimmeSecondaries()-&gt;clearAndDestroy();
     .      .   79:   //  std::vector&lt;G4Track*&gt;::iterator itr;
     .      .   80:   size_t itr;
     .      .   81:   //  for(itr=GimmeSecondaries()-&gt;begin();itr=GimmeSecondaries()-&gt;end();itr++){
    79    148   82:   for(itr=0;itr&lt;GimmeSecondaries()-&gt;size();itr++){
     .      .   83:      delete (*GimmeSecondaries())[itr];
     .      .   84:   }
     3    282   85:   GimmeSecondaries()-&gt;clear();
     .      .   86:
    50     50   87:   if(verboseLevel&gt;0 &amp;&amp; (G4VSteppingVerbose::GetSilent()!=1) ) TrackBanner();
     .      .   88:
     .      .   89:   // Give SteppingManger the pointer to the track which will be tracked
     7  15623   90:   fpSteppingManager-&gt;SetInitialStep(fpTrack);
     .      .   91:
     .      .   92:   // Pre tracking user intervention process.
    70     70   93:   fpTrajectory = 0;
    10     10   94:   if( fpUserTrackingAction != NULL ) {
    10    223   95:      fpUserTrackingAction-&gt;PreUserTrackingAction(fpTrack);
     .      .   96:   }
     .      .   97: #ifdef G4_STORE_TRAJECTORY
     .      .   98:   // Construct a trajectory if it is requested
    29     29   99:   if(StoreTrajectory&amp;&amp;(!fpTrajectory)) {
     .      .  100:     // default trajectory concrete class object
     .      .  101:     switch (StoreTrajectory) {
     .      .  102:     default:
     .      .  103:     case 1: fpTrajectory = new G4Trajectory(fpTrack); break;
     .      .  104:     case 2: fpTrajectory = new G4SmoothTrajectory(fpTrack); break;
     .      .  105:     case 3: fpTrajectory = new G4RichTrajectory(fpTrack); break;
     .      .  106:     }
     .      .  107:   }
     .      .  108: #endif
     .      .  109:
     .      .  110:   // Give SteppingManger the maxmimum number of processes
     1    625  111:   fpSteppingManager-&gt;GetProcessNumber();
     .      .  112:
     .      .  113:   // Give track the pointer to the Step
    88     91  114:   fpTrack-&gt;SetStep(fpSteppingManager-&gt;GetStep());
     .      .  115:
     .      .  116:   // Inform beginning of tracking to physics processes
    49   5085  117:   fpTrack-&gt;GetDefinition()-&gt;GetProcessManager()-&gt;StartTracking(fpTrack);
     .      .  118:
     .      .  119:   // Track the particle Step-by-Step while it is alive
     .      .  120:   G4StepStatus stepStatus;
     .      .  121:
   367    381  122:   while( (fpTrack-&gt;GetTrackStatus() == fAlive) ||
     .      .  123:          (fpTrack-&gt;GetTrackStatus() == fStopButAlive) ){
     .      .  124:
    54     79  125:     fpTrack-&gt;IncrementCurrentStepNumber();
   364 679688  126:     stepStatus = fpSteppingManager-&gt;Stepping();
     .      .  127: #ifdef G4_STORE_TRAJECTORY
   183    183  128:     if(StoreTrajectory) fpTrajectory-&gt;
     .      .  129:                         AppendStep(fpSteppingManager-&gt;GetStep());
     .      .  130: #endif
    29     29  131:     if(EventIsAborted) {
     .      .  132:       fpTrack-&gt;SetTrackStatus( fKillTrackAndSecondaries );
     .      .  133:     }
     .      .  134:   }
     .      .  135:   // Inform end of tracking to physics processes
    70   2439  136:   fpTrack-&gt;GetDefinition()-&gt;GetProcessManager()-&gt;EndTracking();
     .      .  137:
     .      .  138:   // Post tracking user intervention process.
    54     54  139:   if( fpUserTrackingAction != NULL ) {
    41    264  140:      fpUserTrackingAction-&gt;PostUserTrackingAction(fpTrack);
     .      .  141:   }
     .      .  142:
     .      .  143:   // Destruct the trajectory if it was created
     .      .  144: #ifdef G4VERBOSE
    31     31  145:   if(StoreTrajectory&amp;&amp;verboseLevel&gt;10) fpTrajectory-&gt;ShowTrajectory();
     .      .  146: #endif
     .      .  147:   if( (!StoreTrajectory)&amp;&amp;fpTrajectory ) {
     .      .  148:       delete fpTrajectory;
     .      .  149:       fpTrajectory = 0;
     .      .  150:   }
     1      1  151: }
---
     .      .  152:
     .      .  153: void G4TrackingManager::SetTrajectory(G4VTrajectory* aTrajectory)
     .      .  154: {
     .      .  155: #ifndef G4_STORE_TRAJECTORY
     .      .  156:   G4Exception("G4TrackingManager::SetTrajectory is invoked without G4_STORE_TRAJECTORY compilor option");
[blyth@belle7 20130820-1318]$</pre>
</div>
</div>
<div class="section" id="g4steppingmanager-stepping">
<h2><a class="toc-backref" href="#id3">G4SteppingManager::Stepping</a><a class="headerlink" href="#g4steppingmanager-stepping" title="Permalink to this headline">Â¶</a></h2>
<p>94% of CPU samples within <cite>G4SteppingManager::Stepping</cite>, for <em>base</em> muon simulation:</p>
<div class="highlight-python"><pre>[blyth@belle7 20130820-1318]$  pprof --list=G4SteppingManager::Stepping $(which python) base.prof
Using local file /data1/env/local/dyb/external/Python/2.7/i686-slc5-gcc41-dbg/bin/python.
Using local file base.prof.
Removing _init from all stack traces.

ROUTINE ====================== G4SteppingManager::Stepping in /data1/env/local/dyb/external/build/LCG/geant4.9.2.p01/source/tracking/src/G4SteppingManager.cc
  5959 678848 Total samples (flat / cumulative)
     .      .  112: #endif
     .      .  113: }
     .      .  114:
     .      .  115:
     .      .  116: //////////////////////////////////////////
---
    42     42  117: G4StepStatus G4SteppingManager::Stepping()
     .      .  118: //////////////////////////////////////////
     .      .  119: {
     .      .  120:
     .      .  121: //--------
     .      .  122: // Prelude
     .      .  123: //--------
     .      .  124: #ifdef G4VERBOSE
     .      .  125:             // !!!!! Verbose
    10     10  126:              if(verboseLevel&gt;0) fVerbose-&gt;NewStep();
     .      .  127:          else
    13     13  128:              if(verboseLevel==-1) {
     .      .  129:              G4VSteppingVerbose::SetSilent(1);
     .      .  130:          }
     .      .  131:          else
     9    246  132:              G4VSteppingVerbose::SetSilent(0);
     .      .  133: #endif
     .      .  134:
     .      .  135: // Store last PostStepPoint to PreStepPoint, and swap current and nex
     .      .  136: // volume information of G4Track. Reset total energy deposit in one Step.
   169   1759  137:    fStep-&gt;CopyPostToPreStepPoint();
   265    317  138:    fStep-&gt;ResetTotalEnergyDeposit();
     .      .  139:
     .      .  140: // Switch next touchable in track to current one
   390   9025  141:    fTrack-&gt;SetTouchableHandle(fTrack-&gt;GetNextTouchableHandle());
     .      .  142:
     .      .  143: // Reset the secondary particles
   317    317  144:    fN2ndariesAtRestDoIt = 0;
    13     13  145:    fN2ndariesAlongStepDoIt = 0;
    28     28  146:    fN2ndariesPostStepDoIt = 0;
     .      .  147:
     .      .  148: //JA Set the volume before it is used (in DefineStepLength() for User Limit)
   122    810  149:    fCurrentVolume = fStep-&gt;GetPreStepPoint()-&gt;GetPhysicalVolume();
     .      .  150:
     .      .  151: // Reset the step's auxiliary points vector pointer
    14     30  152:    fStep-&gt;SetPointerToVectorOfAuxiliaryPoints(0);
     .      .  153:
     .      .  154: //-----------------
     .      .  155: // AtRest Processes
     .      .  156: //-----------------
     .      .  157:
   146    157  158:    if( fTrack-&gt;GetTrackStatus() == fStopButAlive ){
     .      .  159:      if( MAXofAtRestLoops&gt;0 ){
     .      .  160:         InvokeAtRestDoItProcs();
     .      .  161:         fStepStatus = fAtRestDoItProc;
     .      .  162:         fStep-&gt;GetPostStepPoint()-&gt;SetStepStatus( fStepStatus );
     .      .  163:
     .      .  164: #ifdef G4VERBOSE
     .      .  165:             // !!!!! Verbose
     .      .  166:              if(verboseLevel&gt;0) fVerbose-&gt;AtRestDoItInvoked();
     .      .  167: #endif
     .      .  168:
     .      .  169:      }
     .      .  170:      // Make sure the track is killed
     .      .  171:      fTrack-&gt;SetTrackStatus( fStopAndKill );
     .      .  172:    }
     .      .  173:
     .      .  174: //---------------------------------
     .      .  175: // AlongStep and PostStep Processes
     .      .  176: //---------------------------------
     .      .  177:
     .      .  178:
     .      .  179:    else{
     .      .  180:      // Find minimum Step length demanded by active disc./cont. processes
    41 197978  181:      DefinePhysicalStepLength();
     .      .  182:
     .      .  183:      // Store the Step length (geometrical length) to G4Step and G4Track
   402    437  184:      fStep-&gt;SetStepLength( PhysicalStep );
   198    251  185:      fTrack-&gt;SetStepLength( PhysicalStep );
   104    104  186:      G4double GeomStepLength = PhysicalStep;
     .      .  187:
     .      .  188:      // Store StepStatus to PostStepPoint
    33     59  189:      fStep-&gt;GetPostStepPoint()-&gt;SetStepStatus( fStepStatus );
     .      .  190:
     .      .  191:      // Invoke AlongStepDoIt
   136  31657  192:      InvokeAlongStepDoItProcs();
     .      .  193:
     .      .  194:      // Update track by taking into account all changes by AlongStepDoIt
   247   2898  195:      fStep-&gt;UpdateTrack();
     .      .  196:
     .      .  197:      // Update safety after invocation of all AlongStepDoIts
    63     87  198:      endpointSafOrigin= fPostStepPoint-&gt;GetPosition();
     .      .  199: //     endpointSafety=  std::max( proposedSafety - GeomStepLength, 0.);
   120    167  200:      endpointSafety=  std::max( proposedSafety - GeomStepLength, kCarTolerance);
     .      .  201:
    69    116  202:      fStep-&gt;GetPostStepPoint()-&gt;SetSafety( endpointSafety );
     .      .  203:
     .      .  204: #ifdef G4VERBOSE
     .      .  205:                          // !!!!! Verbose
    79     79  206:            if(verboseLevel&gt;0) fVerbose-&gt;AlongStepDoItAllDone();
     .      .  207: #endif
     .      .  208:
     .      .  209:      // Invoke PostStepDoIt
     8 214657  210:      InvokePostStepDoItProcs();
     .      .  211:
     .      .  212: #ifdef G4VERBOSE
     .      .  213:                  // !!!!! Verbose
   345    345  214:      if(verboseLevel&gt;0) fVerbose-&gt;PostStepDoItAllDone();
     .      .  215: #endif
     .      .  216:    }
     .      .  217:
     .      .  218: //-------
     .      .  219: // Finale
     .      .  220: //-------
     .      .  221:
     .      .  222: // Update 'TrackLength' and remeber the Step length of the current Step
    69    144  223:    fTrack-&gt;AddTrackLength(fStep-&gt;GetStepLength());
    85     91  224:    fPreviousStepSize = fStep-&gt;GetStepLength();
    21     36  225:    fStep-&gt;SetTrack(fTrack);
     .      .  226: #ifdef G4VERBOSE
     .      .  227:                          // !!!!! Verbose
     .      .  228:
   108    108  229:            if(verboseLevel&gt;0) fVerbose-&gt;StepInfo();
     .      .  230: #endif
     .      .  231: // Send G4Step information to Hit/Dig if the volume is sensitive
   270   2794  232:    fCurrentVolume = fStep-&gt;GetPreStepPoint()-&gt;GetPhysicalVolume();
   288    296  233:    StepControlFlag =  fStep-&gt;GetControlFlag();
    29     29  234:    if( fCurrentVolume != 0 &amp;&amp; StepControlFlag != AvoidHitInvocation) {
     .      .  235:       fSensitive = fStep-&gt;GetPreStepPoint()-&gt;
   258    278  236:                                    GetSensitiveDetector();
    26     26  237:       if( fSensitive != 0 ) {
     1   4325  238:         fSensitive-&gt;Hit(fStep);
     .      .  239:       }
     .      .  240:    }
     .      .  241:
     .      .  242: // User intervention process.
    39     39  243:    if( fUserSteppingAction != NULL ) {
   167 206152  244:       fUserSteppingAction-&gt;UserSteppingAction(fStep);
     .      .  245:    }
     .      .  246:    G4UserSteppingAction* regionalAction
     .      .  247:     = fStep-&gt;GetPreStepPoint()-&gt;GetPhysicalVolume()-&gt;GetLogicalVolume()-&gt;GetRegion()
  1188   2901  248:       -&gt;GetRegionalSteppingAction();
    18     18  249:    if( regionalAction ) regionalAction-&gt;UserSteppingAction(fStep);
     .      .  250:
     .      .  251: // Stepping process finish. Return the value of the StepStatus.
     2      2  252:    return fStepStatus;
     .      .  253:
     7      7  254: }
---
     .      .  255:
     .      .  256: ///////////////////////////////////////////////////////////
     .      .  257: void G4SteppingManager::SetInitialStep(G4Track* valueTrack)
     .      .  258: ///////////////////////////////////////////////////////////
     .      .  259: {</pre>
</div>
</div>
<div class="section" id="g4steppingmanager-invokepoststepdoitprocs">
<h2><a class="toc-backref" href="#id4">G4SteppingManager::InvokePostStepDoItProcs</a><a class="headerlink" href="#g4steppingmanager-invokepoststepdoitprocs" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python"><pre>[blyth@belle7 20130820-1318]$  pprof --list=G4SteppingManager::InvokePostStepDoItProcs $(which python) base.prof
Using local file /data1/env/local/dyb/external/Python/2.7/i686-slc5-gcc41-dbg/bin/python.
Using local file base.prof.
Removing _init from all stack traces.
ROUTINE ====================== G4SteppingManager::InvokePostStepDoItProcs in /data1/env/local/dyb/external/build/LCG/geant4.9.2.p01/source/tracking/src/G4SteppingManager2.cc
  2027 214554 Total samples (flat / cumulative)
     .      .  469:    }
     .      .  470:
     .      .  471: }
     .      .  472:
     .      .  473: ////////////////////////////////////////////////////////
---
    19     19  474: void G4SteppingManager::InvokePostStepDoItProcs()
     .      .  475: ////////////////////////////////////////////////////////
     .      .  476: {
     .      .  477:
     .      .  478: // Invoke the specified discrete processes
   151    151  479:    for(size_t np=0; np &lt; MAXofPostStepLoops; np++){
     .      .  480:    //
     .      .  481:    // Note: DoItVector has inverse order against GetPhysIntVector
     .      .  482:    //       and SelectedPostStepDoItVector.
     .      .  483:    //
   606   3267  484:      G4int Cond = (*fSelectedPostStepDoItVector)[MAXofPostStepLoops-np-1];
    80     80  485:      if(Cond != InActivated){
   206    206  486:        if( ((Cond == NotForced) &amp;&amp; (fStepStatus == fPostStepDoItProc)) ||
     .      .  487:        ((Cond == Forced) &amp;&amp; (fStepStatus != fExclusivelyForcedProc)) ||
     .      .  488:        ((Cond == Conditionally) &amp;&amp; (fStepStatus == fAlongStepDoItProc)) ||
     .      .  489:        ((Cond == ExclusivelyForced) &amp;&amp; (fStepStatus == fExclusivelyForcedProc)) ||
     .      .  490:        ((Cond == StronglyForced) )
     .      .  491:       ) {
     .      .  492:
    97 195545  493:      InvokePSDIP(np);
     .      .  494:        }
     .      .  495:      } //if(*fSelectedPostStepDoItVector(np)........
     .      .  496:
     .      .  497:      // Exit from PostStepLoop if the track has been killed,
     .      .  498:      // but extra treatment for processes with Strongly Forced flag
   743    832  499:      if(fTrack-&gt;GetTrackStatus() == fStopAndKill) {
    54     54  500:        for(size_t np1=np+1; np1 &lt; MAXofPostStepLoops; np1++){
    37    191  501:      G4int Cond2 = (*fSelectedPostStepDoItVector)[MAXofPostStepLoops-np1-1];
     4      4  502:      if (Cond2 == StronglyForced) {
     4  14179  503:        InvokePSDIP(np1);
     .      .  504:          }
     .      .  505:        }
     5      5  506:        break;
     .      .  507:      }
     .      .  508:    } //for(size_t np=0; np &lt; MAXofPostStepLoops; np++){
    21     21  509: }
---
     .      .  510:
     .      .  511:
     .      .  512:
     .      .  513: void G4SteppingManager::InvokePSDIP(size_t np)
     .      .  514: {
[blyth@belle7 20130820-1318]$</pre>
</div>
</div>
<div class="section" id="g4steppingmanager-invokepsdip">
<h2><a class="toc-backref" href="#id5">G4SteppingManager::InvokePSDIP</a><a class="headerlink" href="#g4steppingmanager-invokepsdip" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python"><pre>[blyth@belle7 20130820-1318]$  pprof --list=G4SteppingManager::InvokePSDIP $(which python) base.prof
Using local file /data1/env/local/dyb/external/Python/2.7/i686-slc5-gcc41-dbg/bin/python.
Using local file base.prof.
Removing _init from all stack traces.
ROUTINE ====================== G4SteppingManager::InvokePSDIP in /data1/env/local/dyb/external/build/LCG/geant4.9.2.p01/source/tracking/src/G4SteppingManager2.cc
  4888 209391 Total samples (flat / cumulative)
     .      .  508:    } //for(size_t np=0; np &lt; MAXofPostStepLoops; np++){
     .      .  509: }
     .      .  510:
     .      .  511:
     .      .  512:
---
   105    105  513: void G4SteppingManager::InvokePSDIP(size_t np)
     .      .  514: {
   408   2005  515:          fCurrentProcess = (*fPostStepDoItVector)[np];
     .      .  516:          fParticleChange
   917 168266  517:             = fCurrentProcess-&gt;PostStepDoIt( *fTrack, *fStep);
     .      .  518:
     .      .  519:          // Update PostStepPoint of Step according to ParticleChange
   238  14920  520:      fParticleChange-&gt;UpdateStepForPostStep(fStep);
     .      .  521: #ifdef G4VERBOSE
     .      .  522:                  // !!!!! Verbose
   549    549  523:            if(verboseLevel&gt;0) fVerbose-&gt;PostStepDoItOneByOne();
     .      .  524: #endif
     .      .  525:          // Update G4Track according to ParticleChange after each PostStepDoIt
    31  17005  526:          fStep-&gt;UpdateTrack();
     .      .  527:
     .      .  528:          // Update safety after each invocation of PostStepDoIts
   890   4360  529:          fStep-&gt;GetPostStepPoint()-&gt;SetSafety( CalculateSafety() );
     .      .  530:
     .      .  531:          // Now Store the secondaries from ParticleChange to SecondaryList
     .      .  532:          G4Track* tempSecondaryTrack;
     .      .  533:          G4int    num2ndaries;
     .      .  534:
   448    499  535:          num2ndaries = fParticleChange-&gt;GetNumberOfSecondaries();
     .      .  536:
   231    231  537:          for(G4int DSecLoop=0 ; DSecLoop&lt; num2ndaries; DSecLoop++){
    28     70  538:             tempSecondaryTrack = fParticleChange-&gt;GetSecondary(DSecLoop);
     .      .  539:
    15     37  540:             if(tempSecondaryTrack-&gt;GetDefinition()-&gt;GetApplyCutsFlag())
     .      .  541:             { ApplyProductionCut(tempSecondaryTrack); }
     .      .  542:
     .      .  543:             // Set parentID
    22     24  544:             tempSecondaryTrack-&gt;SetParentID( fTrack-&gt;GetTrackID() );
     .      .  545:
     .      .  546:         // Set the process pointer which created this track
    10     14  547:         tempSecondaryTrack-&gt;SetCreatorProcess( fCurrentProcess );
     .      .  548:
     .      .  549:             // If this 2ndry particle has 'zero' kinetic energy, make sure
     .      .  550:             // it invokes a rest process at the beginning of the tracking
    40     62  551:         if(tempSecondaryTrack-&gt;GetKineticEnergy() &lt;= DBL_MIN){
     .      .  552:           G4ProcessManager* pm = tempSecondaryTrack-&gt;GetDefinition()-&gt;GetProcessManager();
     .      .  553:           if (pm-&gt;GetAtRestProcessVector()-&gt;entries()&gt;0){
     .      .  554:             tempSecondaryTrack-&gt;SetTrackStatus( fStopButAlive );
     .      .  555:             fSecondary-&gt;push_back( tempSecondaryTrack );
     .      .  556:                 fN2ndariesPostStepDoIt++;
     .      .  557:           } else {
     .      .  558:             delete tempSecondaryTrack;
     .      .  559:           }
     .      .  560:         } else {
     3     90  561:           fSecondary-&gt;push_back( tempSecondaryTrack );
    18     18  562:               fN2ndariesPostStepDoIt++;
     .      .  563:         }
     .      .  564:          } //end of loop on secondary
     .      .  565:
     .      .  566:          // Set the track status according to what the process defined
   310    366  567:          fTrack-&gt;SetTrackStatus( fParticleChange-&gt;GetTrackStatus() );
     .      .  568:
     .      .  569:          // clear ParticleChange
   221    366  570:          fParticleChange-&gt;Clear();
   404    404  571: }
---
     .      .  572:
     .      .  573: #include "G4EnergyLossTables.hh"
     .      .  574: #include "G4ProductionCuts.hh"
     .      .  575: #include "G4ProductionCutsTable.hh"
     .      .  576:</pre>
</div>
<div class="sidebar">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../../chroma/" title="chroma"
             >next</a> |</li>
        <li class="right" >
          <a href="../analysis/" title="Profiling Analysis"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../" >muon_simulation</a> &raquo;</li>
          <li><a href="../../" >profiling</a> &raquo;</li>
          <li><a href="../" >base</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>