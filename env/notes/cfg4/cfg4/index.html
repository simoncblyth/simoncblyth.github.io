<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Comparing Opticks with G4 for test geometry and light sources &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>
 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pycuda/">pycuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../geant4/">geant4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hg/">hg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../simoncblyth.bitbucket.org/">simoncblyth.bitbucket.org</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../numpy/">numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/">Muon Simulation Presentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../optix/">optix</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/cfg4/cfg4.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="comparing-opticks-with-g4-for-test-geometry-and-light-sources">
<h1>Comparing Opticks with G4 for test geometry and light sources<a class="headerlink" href="#comparing-opticks-with-g4-for-test-geometry-and-light-sources" title="Permalink to this headline">¶</a></h1>
<div class="section" id="summary">
<h2>summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>P polarized matches well (with polvec in initial direction of the photon)</li>
<li>S polarized are way off, looks to be due to Op playing Russian Roulette with S/P Polarization choice<ul>
<li>TODO: implement the G4 way of doing things in Op</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="todo">
<h2>TODO<a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>check with simple box-in-box geometry with planar reflection</li>
</ul>
<div class="highlight-python"><pre>---- P -----
Evt(6,"torch","rainbow","P Op")
                8ccd     943087 :                           TORCH BT BT SA
                 8bd      30954 :                              TORCH BR SA
               8cbcd      19554 :                        TORCH BT BR BT SA
              8cbbcd       2540 :                     TORCH BT BR BR BT SA
               86ccd       1239 :                        TORCH BT BT BS SA
             8cbbbcd        756 :                  TORCH BT BR BR BR BT SA
                 86d        530 :                              TORCH BS SA
            8cbbbbcd        310 :               TORCH BT BR BR BR BR BT SA
                 4cd        172 :                              TORCH BT AB
           8cbbbbbcd        146 :            TORCH BT BR BR BR BR BR BT SA
                4ccd        135 :                           TORCH BT BT AB
               8c6cd        132 :                        TORCH BT BS BT SA
          bbbbbbbbcd         96 :         TORCH BT BR BR BR BR BR BR BR BR
          8cbbbbbbcd         76 :         TORCH BT BR BR BR BR BR BR BT SA
                  4d         51 :                                 TORCH AB
tot: 1000000
Evt(-6,"torch","rainbow","P G4")
                8ccd     943093 :                           TORCH BT BT SA
                 8bd      31029 :                              TORCH BR SA
               8cbcd      19431 :                        TORCH BT BR BT SA
              8cbbcd       2601 :                     TORCH BT BR BR BT SA
               86ccd       1212 :                        TORCH BT BT BS SA
             8cbbbcd        757 :                  TORCH BT BR BR BR BT SA
                 86d        517 :                              TORCH BS SA
            8cbbbbcd        316 :               TORCH BT BR BR BR BR BT SA
                 4cd        202 :                              TORCH BT AB
           8cbbbbbcd        144 :            TORCH BT BR BR BR BR BR BT SA
               8c6cd        144 :                        TORCH BT BS BT SA
          8bbbbbbbcd        127 :         TORCH BT BR BR BR BR BR BR BR SA
                4ccd        105 :                           TORCH BT BT AB
          8cbbbbbbcd         77 :         TORCH BT BR BR BR BR BR BR BT SA
                  4d         54 :                                 TORCH AB
tot: 1000000
---- S -----
Evt(5,"torch","rainbow","S Op")
                8ccd     819264 :                           TORCH BT BT SA
                 8bd     101941 :                              TORCH BR SA
               8cbcd      61864 :                        TORCH BT BR BT SA
              8cbbcd       9691 :                     TORCH BT BR BR BT SA
             8cbbbcd       2557 :                  TORCH BT BR BR BR BT SA
            8cbbbbcd       1049 :               TORCH BT BR BR BR BR BT SA
               86ccd       1047 :                        TORCH BT BT BS SA
                 86d        507 :                              TORCH BS SA
           8cbbbbbcd        485 :            TORCH BT BR BR BR BR BR BT SA
          bbbbbbbbcd        311 :         TORCH BT BR BR BR BR BR BR BR BR
          8cbbbbbbcd        262 :         TORCH BT BR BR BR BR BR BR BT SA
                 4cd        162 :                              TORCH BT AB
                86bd        140 :                           TORCH BR BS SA
          cbbbbbbbcd        136 :         TORCH BT BR BR BR BR BR BR BR BT
               8c6cd        128 :                        TORCH BT BS BT SA
tot: 1000000
Evt(-5,"torch","rainbow","S G4")
                8ccd     881262 :                           TORCH BT BT SA
                 8bd      66471 :                              TORCH BR SA
               8cbcd      40644 :                        TORCH BT BR BT SA
              8cbbcd       6131 :                     TORCH BT BR BR BT SA
             8cbbbcd       1706 :                  TORCH BT BR BR BR BT SA
               86ccd       1065 :                        TORCH BT BT BS SA
            8cbbbbcd        708 :               TORCH BT BR BR BR BR BT SA
                 86d        484 :                              TORCH BS SA
           8cbbbbbcd        319 :            TORCH BT BR BR BR BR BR BT SA
          8bbbbbbbcd        297 :         TORCH BT BR BR BR BR BR BR BR SA
                 4cd        170 :                              TORCH BT AB
          8cbbbbbbcd        160 :         TORCH BT BR BR BR BR BR BR BT SA
               8c6cd        115 :                        TORCH BT BS BT SA
                4ccd         99 :                           TORCH BT BT AB
                86bd         69 :                           TORCH BR BS SA
tot: 1000000</pre>
</div>
</div>
<div class="section" id="ggv-rainbow-p-pol">
<h2>ggv-rainbow P pol<a class="headerlink" href="#ggv-rainbow-p-pol" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>In [8]: evt_op.p.rpol_(0)
Out[8]:
array([[ 1.,  0.,  0.],
       [ 1.,  0.,  0.],
       [ 1.,  0.,  0.],
       ...,
       [ 1.,  0.,  0.],
       [ 1.,  0.,  0.],
       [ 1.,  0.,  0.]])

In [9]: evt_g4.p.rpol_(0)
Out[9]:
array([[ 1.,  0.,  0.],
       [ 1.,  0.,  0.],
       [ 1.,  0.,  0.],
       ...,
       [ 1.,  0.,  0.],
       [ 1.,  0.,  0.],
       [ 1.,  0.,  0.]])</pre>
</div>
</div>
<div class="section" id="ggv-rainbow-s-pol">
<h2>ggv-rainbow S pol<a class="headerlink" href="#ggv-rainbow-s-pol" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>In [4]: evt_g4.s.rpol_(0)
Out[4]:
array([[ 0.    , -0.0709,  1.    ],
       [ 0.    ,  0.1496,  0.9921],
       [ 0.    , -0.1024,  0.9921],
       ...,
       [ 0.    ,  0.0866,  1.    ],
       [ 0.    , -0.0551,  1.    ],
       [ 0.    ,  0.0236,  1.    ]])

In [5]: evt_op.s.rpol_(0)
Out[5]:
array([[ 0.    , -0.9291,  0.378 ],
       [ 0.    , -0.9685,  0.2441],
       [ 0.    ,  0.    ,  1.    ],
       ...,
       [ 0.    , -0.937 , -0.3465],
       [ 0.    ,  0.4016,  0.9134],
       [ 0.    ,  1.    , -0.0551]])</pre>
</div>
<div class="highlight-python"><pre>In [32]: evt_g4.s.rpost_(0)
Out[32]:
array([[-600.0183,  -42.7747,  -26.7342,    0.    ],
       [-600.0183,   88.5891,  -44.203 ,    0.    ],
       [-600.0183,  -63.3198,  -62.6606,    0.    ],
       ...,
       [-600.0183,   52.4064,  -78.1518,    0.    ],
       [-600.0183,  -32.5938,  -64.8213,    0.    ],
       [-600.0183,   15.9673,   20.9845,    0.    ]])

In [34]: pos_g4 = evt_g4.s.rpost_(0)[:,:3]

In [35]: phi_g4 = np.arctan2(pos_g4[:,2], pos_g4[:,1])    # flat -pi:pi



In [38]: pos_op = evt_op.s.rpost_(0)[:,:3]

In [39]: pos_op
Out[39]:
array([[-599.9817,   32.4473,   79.6899],
       [-599.9817,   23.6579,   93.0204],
       [-599.9817,   19.7394,    0.0366],
       ...,
       [-599.9817,  -33.9488,   91.4823],
       [-599.9817,   20.5817,   -9.0091],
       [-599.9817,   -0.9888,  -18.9703]])

In [40]: phi_op = np.arctan2(pos_op[:,1], pos_op[:,2])     # flat -pi:pi</pre>
</div>
<div class="highlight-python"><pre>In [44]: opx = np.zeros((len(phi_op),3), dtype=np.float32)

In [49]: opx[:,1] = -np.sin(phi_op)

In [50]: opx[:,2] = np.cos(phi_op)

In [51]: opx
Out[51]:
array([[ 0.    , -0.9262,  0.3771],
       [ 0.    , -0.9691,  0.2465],
       [ 0.    , -0.0019,  1.    ],
       ...,
       [ 0.    , -0.9375, -0.3479],
       [ 0.    ,  0.401 ,  0.9161],
       [ 0.    ,  0.9986, -0.0521]], dtype=float32)


In [52]: evt_op.s.rpol_(0)
Out[52]:
array([[ 0.    , -0.9291,  0.378 ],
       [ 0.    , -0.9685,  0.2441],
       [ 0.    ,  0.    ,  1.    ],
       ...,
       [ 0.    , -0.937 , -0.3465],
       [ 0.    ,  0.4016,  0.9134],
       [ 0.    ,  1.    , -0.0551]])</pre>
</div>
</div>
<div class="section" id="polarization-progression">
<h2>Polarization Progression<a class="headerlink" href="#polarization-progression" title="Permalink to this headline">¶</a></h2>
<p>S Op pol vector stays alive modulo sign flips, never leaking into X:</p>
<div class="highlight-python"><pre>In [6]: evt_op.s.rpol_(0)
Out[6]:
array([[ 0.    , -0.9291,  0.378 ],
       [ 0.    , -0.9685,  0.2441],
       [ 0.    ,  0.    ,  1.    ],
       ...,
       [ 0.    , -0.937 , -0.3465],
       [ 0.    ,  0.4016,  0.9134],
       [ 0.    ,  1.    , -0.0551]])

In [7]: evt_op.s.rpol_(1)
Out[7]:
array([[ 0.    , -0.9291,  0.378 ],
       [ 0.    , -0.9685,  0.2441],
       [ 0.    ,  0.    ,  1.    ],
       ...,
       [ 0.    , -0.937 , -0.3465],
       [ 0.    ,  0.4016,  0.9134],
       [ 0.    ,  1.    , -0.0551]])

In [8]: evt_op.s.rpol_(2)
Out[8]:
array([[ 0.    ,  0.9291, -0.378 ],
       [ 0.    ,  0.9685, -0.2441],
       [ 0.    ,  0.    , -1.    ],
       ...,
       [ 0.    ,  0.937 ,  0.3465],
       [ 0.    , -0.4016, -0.9134],
       [ 0.    , -1.    ,  0.0551]])

In [9]: evt_op.s.rpol_(3)
Out[9]:
array([[ 0.    ,  0.9291, -0.378 ],
       [ 0.    ,  0.9685, -0.2441],
       [ 0.    ,  0.    , -1.    ],
       ...,
       [ 0.    ,  0.937 ,  0.3465],
       [ 0.    , -0.4016, -0.9134],
       [ 0.    , -1.    ,  0.0551]])

In [10]: evt_op.s.rpol_(4)
Out[10]:
array([[-1.    , -1.    , -1.    ],
       [ 0.    ,  0.9685, -0.2441],
       [-1.    , -1.    , -1.    ],
       ...,
       [-1.    , -1.    , -1.    ],
       [-1.    , -1.    , -1.    ],
       [-1.    , -1.    , -1.    ]])

In [11]:</pre>
</div>
<p>G4 pol different approach:</p>
<div class="highlight-python"><pre>In [11]: evt_g4.s.rpol_(0)
Out[11]:
array([[ 0.    ,  0.8504, -0.5276],
       [ 0.    , -0.8976, -0.4488],
       [ 0.    ,  0.7087, -0.7008],
       ...,
       [ 0.    ,  0.0787,  1.    ],
       [ 0.    ,  0.2283, -0.9764],
       [ 0.    ,  0.2835,  0.9606]])

In [12]: evt_g4.s.rpol_(1)
Out[12]:
array([[-0.063 ,  0.8425, -0.5276],
       [-0.1417,  0.8189,  0.5591],
       [-0.0079,  0.7087, -0.7008],
       ...,
       [-0.3307,  0.2283, -0.9134],
       [-0.1811,  0.6299,  0.7559],
       [-0.1102,  0.7638, -0.6378]])

In [13]: evt_g4.s.rpol_(2)
Out[13]:
array([[ 0.126 ,  0.1102, -0.9843],
       [-0.1417,  0.8189,  0.5591],
       [ 0.0079,  0.7008, -0.7165],
       ...,
       [ 0.622 ,  0.0787,  0.7717],
       [ 0.3622,  0.2283, -0.9055],
       [ 0.2126,  0.2835,  0.937 ]])

In [14]: evt_g4.s.rpol_(3)
Out[14]:
array([[ 0.126 ,  0.1102, -0.9843],
       [-1.    , -1.    , -1.    ],
       [ 0.0079,  0.7008, -0.7165],
       ...,
       [ 0.622 ,  0.0787,  0.7717],
       [ 0.3622,  0.2283, -0.9055],
       [ 0.2126,  0.2835,  0.937 ]])

In [15]:</pre>
</div>
<div class="sidebar">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>