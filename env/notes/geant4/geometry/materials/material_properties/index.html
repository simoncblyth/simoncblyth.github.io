<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Material Properties &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../../../" />
    <link rel="up" title="materials" href="../" />
    <link rel="next" title="surfaces" href="../../surfaces/" />
    <link rel="prev" title="materials" href="../" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../surfaces/" title="surfaces"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../" title="materials"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../" >geant4</a> &raquo;</li>
          <li><a href="../../" >Geant4 Geometry Export</a> &raquo;</li>
          <li><a href="../" accesskey="U">materials</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pycuda/">pycuda</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../">geant4</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../release_notes/">Geant4 Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../geant4_gpu/">Geant4 GPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../geant4_profiling/">Geant4 Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../release_notes/">Geant4 Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../verbosity/">Verbosity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../docs/">Geant4 Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../giga/">GiGa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/">Geant4 API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../opticalphoton/">Geant4 Optical Photon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../processes/">Geant4 Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../medical/">Medical Communities Using Geant4 (esp. optical photon)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../">Geant4 Geometry Export</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../g4py/">g4py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../nuwa/">nuwa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../event/">Geant4 Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../geant4_future_doe/">Geant4</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hg/">hg</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../../_sources/geant4/geometry/materials/material_properties.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../"
                        title="previous chapter">materials</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../../surfaces/"
                        title="next chapter">surfaces</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="material-properties">
<h1>Material Properties<a class="headerlink" href="#material-properties" title="Permalink to this headline">¶</a></h1>
<div class="section" id="objective">
<h2>Objective<a class="headerlink" href="#objective" title="Permalink to this headline">¶</a></h2>
<p>Persist material optical properties (some of which are wavelength dependent)
into G4DAE COLLADA XML using extra tags, thus allowing access from pycollada
and thence into Chroma.</p>
</div>
<div class="section" id="to-checkout">
<h2>To Checkout<a class="headerlink" href="#to-checkout" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://wiki.opengatecollaboration.org/Users_Guide_V6.2:Generating_and_tracking_optical_photons">http://wiki.opengatecollaboration.org/Users_Guide_V6.2:Generating_and_tracking_optical_photons</a></li>
</ul>
</div>
<div class="section" id="g4-docs">
<h2>G4 Docs<a class="headerlink" href="#g4-docs" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://geant4.web.cern.ch/geant4/UserDocumentation/UsersGuides/ForApplicationDeveloper/html/ch05s02.html#sect.PhysProc.Photo">http://geant4.web.cern.ch/geant4/UserDocumentation/UsersGuides/ForApplicationDeveloper/html/ch05s02.html#sect.PhysProc.Photo</a></li>
</ul>
<div class="highlight-python"><pre>Example 5.4.  Optical properties added to a G4MaterialPropertiesTable and linked to a G4Material

const G4int NUMENTRIES = 32;

G4double ppckov[NUMENTRIES] = {2.034*eV, ......, 4.136*eV};
G4double rindex[NUMENTRIES] = {1.3435, ......, 1.3608};
G4double absorption[NUMENTRIES] = {344.8*cm, ......, 1450.0*cm];

G4MaterialPropertiesTable *MPT = new G4MaterialPropertiesTable();

MPT -&gt; AddConstProperty("SCINTILLATIONYIELD",100./MeV);

MPT -&gt; AddProperty("RINDEX",ppckov,rindex,NUMENTRIES}-&gt;SetSpline(true);
MPT -&gt; AddProperty("ABSLENGTH",ppckov,absorption,NUMENTRIES}-&gt;SetSpline(true);

scintillator -&gt; SetMaterialPropertiesTable(MPT);</pre>
</div>
</div>
<div class="section" id="interfacing-to-chroma">
<h2>Interfacing to Chroma<a class="headerlink" href="#interfacing-to-chroma" title="Permalink to this headline">¶</a></h2>
<p>Many NuWa properties are defined for wavelengths 200-800nm
but the chroma standard wavelengths start from 60nm,
this leads to flat properties from 60-200nm
using the 200nm value.</p>
<p>That might cause problems ?
Perhaps should adjust standard wavelengths to 200:800 nm ?
to match the range where NuWa properties are defined.</p>
<div class="highlight-python"><pre>g4pb:materials blyth$ ./material_properties.py g4_00.dae.6
...
__dd__Materials__OwsWater0xabb2118.ABSLENGTH : (314)
[[ 196.00020975  273.208     ]
 [ 197.00020287  369.628     ]
 [ 198.00001706  491.566     ]
 ...,
 [ 788.00206356  482.415     ]
 [ 790.00041213  486.647     ]
 [ 800.00157879  486.681     ]]
[[  60.          273.20800781]
 [  80.          273.20800781]
 [ 100.          273.20800781]
 ...,
 [ 760.          371.97369385]
 [ 780.          425.70596313]
 [ 800.          486.68099976]]</pre>
</div>
<div class="section" id="check-length-units-for-abslength-etc-in-g4-and-chroma">
<h3>Check Length units for ABSLENGTH etc.. in G4 and Chroma<a class="headerlink" href="#check-length-units-for-abslength-etc-in-g4-and-chroma" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://www.researchgate.net/publication/223664774_Water_absorption_length_measurement_with_the_ANTARES_optical_beacon_system">http://www.researchgate.net/publication/223664774_Water_absorption_length_measurement_with_the_ANTARES_optical_beacon_system</a><ul>
<li>50m in sea water</li>
</ul>
</li>
</ul>
<div class="highlight-python"><pre>g4pb:materials blyth$ ./material_properties.py g4_00.dae.6 __dd__Materials__Water ABSLENGTH
    __dd__Materials__Water0xae9c3c0.ABSLENGTH : (314)
[[   196.00020975    273.208     ]
 [   197.00020287    369.628     ]
 [   198.00001706    491.566     ]
 [   199.0001295     602.2       ]
 [   200.00007207    691.563     ]
 [   201.00001245    772.754     ]
 [   202.00012819    831.749     ]
 [   202.99994217    907.747     ]
 [   203.99996821    967.594     ]
 [   205.00006561   1006.68      ]
 [   206.00009085   1033.76      ]
 [   207.00024322   1072.49      ]
 [   208.00003469   1102.7       ]
 [   209.000018     1143.13      ]
 [   210.00005874   1154.75      ]
 [   211.00001988   1198.39      ]
 [   212.00012428   1224.04      ]
 [   213.00023997   1254.03      ]
 [   214.00023246   1285.14      ]
 [   214.99996476   1321.42      ]
 [   216.00004997   1347.67      ]
 [   216.99998719   1383.31      ]
 [   218.00002581   1407.86      ]
 [   219.00004006   1432.05      ]
 [   220.00029221   1507.14      ]
 [   221.00026859   1537.25      ]
 ...
 [   395.0001809   18471.45      ]
 [   397.50017779  19007.41      ]
 [   400.00016996  19849.15      ]
 [   402.5001836   20634.24      ]
 [   405.00015542  21308.7       ]
 [   407.50018103  21907.26      ]
 [   410.00017189  22540.12      ]
 [   412.50015905  23146.44      ]
 [   415.00016127  23696.99      ]
 [   417.50016973  24222.97      ]
 [   420.00016016  24671.11      ]
 [   422.5001635   25069.66      ]
 [   425.00016687  25569.5       ]
 [   427.50019897  26073.52      ]
 [   430.00019796  26518.15      ]
 [   432.50017173  26991.2       ]
 [   435.00017115  27337.65      ]
 [   437.50019957  27494.64      ]
 [   440.00019405  27600.03      ]
 [   442.50021077  27645.51      ]
 [   445.00017598  27722.87      ]
 [   447.50018518  27602.66      ]
 [   450.00020209  27372.58      ]
 [   452.50019947  27469.29      ]
 [   455.00020947  27970.48      ]
 [   457.50019162  28461.27      ]
 [   460.00021623  28732.16      ]
 [   462.50017693  28962.23      ]
 [   465.00018182  29355.16      ]
 [   467.50017715  29720.12      ]
 [   470.00018757  29804.19      ]
 [   472.50019419  29966.68      ]         ## almost 30m
 [   475.0002047   29939.17      ]
 [   477.50019942  29723.06      ]
 [   480.00020395  29587.05      ]
 [   482.50019742  29616.74      ]
 [   485.00022368  29549.18      ]
 [   487.50018354  29214.26      ]
 [   490.00021452  29045.91      ]
 [   492.50019417  28379.45      ]
 [   495.00020074  27812.48      ]
 [   497.50020396  26750.18      ]
 [   500.00020035  26096.03      ]
 [   502.50021442  24773.3       ]
 [   505.00021763  23353.15      ]
 [   507.50022935  22279.68      ]
 [   510.00019325  20385.15      ]
 [   512.50020639  18714.45      ]
 [   515.00022713  18010.98      ]
 [   517.50024086  18012.75      ]
 [   520.00021759  17787.87      ]
 [   522.50024318  17659.41      ]
 [   525.00021354  17717.04      ]
 [   527.50022924  17462.57      ]
 [   530.00019741  17362.82      ]
 [   532.50021112  17056.22      ]
 [   535.00023487  16986.27      ]
 ...
 [   774.00175221    404.675     ]
 [   776.00248277    415.612     ]
 [   777.99893752    420.511     ]
 [   780.00078438    425.708     ]
 [   781.99816258    458.717     ]
 [   784.00083899    476.198     ]
 [   785.99885052    475.074     ]
 [   788.00206356    482.415     ]
 [   790.00041213    486.647     ]
 [   800.00157879    486.681     ]]</pre>
</div>
</div>
<div class="section" id="chroma-units">
<h3>Chroma Units<a class="headerlink" href="#chroma-units" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>g4pb:cuda blyth$ grep SPEED_OF_LIGHT *.*
photon.h:            p.time += absorption_distance/(SPEED_OF_LIGHT/s.refractive_index1);
photon.h:           p.time += scattering_distance/(SPEED_OF_LIGHT/s.refractive_index1);
photon.h:    p.time += s.distance_to_boundary/(SPEED_OF_LIGHT/s.refractive_index1);
physical_constants.h:#define SPEED_OF_LIGHT 299.792458f
g4pb:cuda blyth$
g4pb:cuda blyth$
g4pb:cuda blyth$ vi physical_constants.h

4 // mm/ns
5 #define SPEED_OF_LIGHT 299.792458f

g4pb:cuda blyth$ pwd
/usr/local/env/chroma/chroma/cuda</pre>
</div>
</div>
</div>
<div class="section" id="g4-examples">
<h2>G4 Examples<a class="headerlink" href="#g4-examples" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>[blyth@cms01 examples]$ find . -name '*.cc'  -exec grep -H MaterialProperty {} \;
./advanced/air_shower/src/UltraDetectorConstruction.cc:  MPT_Acrylic-&gt;AddProperty("ABSLENGTH", new G4MaterialPropertyVector()) ;
./advanced/human_phantom/src/G4HumanPhantomMaterial.cc:#include "G4MaterialPropertyVector.hh"
./advanced/brachytherapy/src/BrachyDetectorConstruction.cc:#include "G4MaterialPropertyVector.hh"
./advanced/brachytherapy/src/BrachyDetectorConstructionI.cc:#include "G4MaterialPropertyVector.hh"
./advanced/brachytherapy/src/BrachyMaterial.cc:#include "G4MaterialPropertyVector.hh"
./advanced/medical_linac/src/MedLinacHead.cc:#include "G4MaterialPropertyVector.hh"
./advanced/medical_linac/src/MedLinacTargetAndFilterDecorator.cc:#include "G4MaterialPropertyVector.hh"
./advanced/medical_linac/src/MedLinacDetectorConstruction.cc:#include "G4MaterialPropertyVector.hh"
./advanced/medical_linac/src/MedLinacMLCDecorator.cc:#include "G4MaterialPropertyVector.hh"
./advanced/Rich/src/RichTbMaterial.cc:#include "G4MaterialPropertyVector.hh"
./advanced/radioprotection/src/RemSimMaterial.cc:#include "G4MaterialPropertyVector.hh"
./extended/parallel/ExDiane/src/BrachyDetectorConstruction.cc:#include "G4MaterialPropertyVector.hh"
./extended/parallel/ExDiane/src/BrachyDetectorConstructionI.cc:#include "G4MaterialPropertyVector.hh"
./extended/parallel/ExDiane/src/BrachyDetectorConstructionIr.cc:#include "G4MaterialPropertyVector.hh"
./extended/parallel/ExDiane/src/BrachyDetectorConstructionLeipzig.cc:#include "G4MaterialPropertyVector.hh"
./extended/parallel/ExDiane/src/BrachyMaterial.cc:#include "G4MaterialPropertyVector.hh"
[blyth@cms01 examples]$ pwd
/data/env/local/dyb/trunk/external/build/LCG/geant4.9.2.p01/examples</pre>
</div>
</div>
<div class="section" id="units">
<h2>Units<a class="headerlink" href="#units" title="Permalink to this headline">¶</a></h2>
<p>As I am using internal Geant4 numbers outside of CLHEP/Geant4 so I need to peep behind
the curtain of the units and understand the raw numbers being persisted:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">eV</span> <span class="o">=</span> <span class="n">electronvolt</span>
<span class="n">electronvolt</span> <span class="o">=</span> <span class="mf">1.e-6</span><span class="o">*</span><span class="n">megaelectronvolt</span>
<span class="n">megaelectronvolt</span> <span class="o">=</span> <span class="mf">1.</span>

<span class="n">eV</span> <span class="o">=</span> <span class="mf">1.e-6</span>
</pre></div>
</div>
<p>So the units of the photon energies in G4MaterialPropertyVector are <strong>MeV</strong>
and the length values are in <strong>mm</strong>.</p>
<p>Chroma optical props are expresses in wavelengths in  <strong>nm</strong>, so</p>
<div class="highlight-python"><pre>[blyth@cms01 include]$ grep h_Plan *.hh
G4PhysicalConstants.hh:using CLHEP::h_Planck;
[blyth@cms01 include]$ vi G4PhysicalConstants.hh

 27 #include &lt;CLHEP/Units/PhysicalConstants.h&gt;
 ..
 34 using CLHEP::c_light;</pre>
</div>
<p><cite>/data/env/local/dyb/trunk/external/clhep/2.0.4.2/i686-slc4-gcc34-dbg/include/CLHEP/Units/PhysicalConstants.h</cite>:</p>
<div class="highlight-python"><pre>60 //
61 // c   = 299.792458 mm/ns
62 // c^2 = 898.7404 (mm/ns)^2
63 //
64 static const double c_light   = 2.99792458e+8 * m/s;
65 static const double c_squared = c_light * c_light;
66
67 //
68 // h     = 4.13566e-12 MeV*ns
69 // hbar  = 6.58212e-13 MeV*ns
70 // hbarc = 197.32705e-12 MeV*mm
71 //
72 static const double h_Planck      = 6.62606896e-34 * joule*s;</pre>
</div>
<p><cite>/data/env/local/dyb/trunk/external/clhep/2.0.4.2/i686-slc4-gcc34-dbg/include/CLHEP/Units/SystemOfUnits.h</cite>:</p>
<div class="highlight-python"><pre>  054   static const double millimeter  = 1.;
  062   static const double meter  = 1000.*millimeter;
  095   static const double m  = meter;
  123   static const double nanosecond  = 1.;
  124   static const double second      = 1.e+9 *nanosecond;
  ...
  139   // Electric charge [Q]
  140   //
  141   static const double eplus = 1. ;// positron charge
  142   static const double e_SI  = 1.602176487e-19;// positron charge in coulomb
  143   static const double coulomb = eplus/e_SI;// coulomb = 6.24150 e+18 * eplus
  144
  145   //
  146   // Energy [E]
  147   //
  148   static const double megaelectronvolt = 1. ;
  149   static const double     electronvolt = 1.e-6*megaelectronvolt;
  150   static const double kiloelectronvolt = 1.e-3*megaelectronvolt;
  151   static const double gigaelectronvolt = 1.e+3*megaelectronvolt;
  152   static const double teraelectronvolt = 1.e+6*megaelectronvolt;
  153   static const double petaelectronvolt = 1.e+9*megaelectronvolt;
  154
  155   static const double joule = electronvolt/e_SI;// joule = 6.24150 e+12 * MeV
  156
  157   // symbols
  158   static const double MeV = megaelectronvolt;
  159   static const double  eV = electronvolt;
  160   static const double keV = kiloelectronvolt;
  161   static const double GeV = gigaelectronvolt;
  162   static const double TeV = teraelectronvolt;
  163   static const double PeV = petaelectronvolt;

* g4_mpv_x * 1.e6</pre>
</div>
<ul class="simple">
<li><a class="reference external" href="http://dayabay.bnl.gov/dox/DetSim/html/classDsG4OpRayleigh.html">http://dayabay.bnl.gov/dox/DetSim/html/classDsG4OpRayleigh.html</a><ul>
<li>suggests convention for photon energies in G4MaterialPropertyVector is MeV</li>
<li><a class="reference external" href="http://www.google.com/search?q=&quot;G4MaterialPropertyVector&quot; photon energy unit">google:&#8221;G4MaterialPropertyVector&#8221; photon energy unit</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="g4-optical-processes">
<h2>G4 Optical processes<a class="headerlink" href="#g4-optical-processes" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>bulk absorption</li>
<li>Rayleigh scattering (inverse 4th power of wavelength: sky blue, sun yellow : as viewed thru atmosphere)</li>
<li>reflection/refraction at material boundaries</li>
</ol>
<div class="section" id="definitions-from-peter-gumplinger">
<h3>Definitions from Peter Gumplinger<a class="headerlink" href="#definitions-from-peter-gumplinger" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://hypernews.slac.stanford.edu/HyperNews/geant4/get/opticalphotons/488.html">http://hypernews.slac.stanford.edu/HyperNews/geant4/get/opticalphotons/488.html</a></li>
</ul>
<ol class="arabic simple">
<li>The attenuation length is the length before any interaction happens to a photon, be it scattering or absorption.</li>
<li>In Geant4, you can have absoption that simply removes the photon (G4OpAbsorption),
or you can have &#8216;wavelength shifting&#8217; where the original photon is removed with the subsequent emission of a WLS photon.
The absorption length for the two processes may be different. The WLS process is called G4OpWLS.</li>
</ol>
</div>
</div>
<div class="section" id="g4-material-properties-in-nuwa">
<h2>G4 Material Properties in NuWa<a class="headerlink" href="#g4-material-properties-in-nuwa" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>[blyth@cms01 dybgaudi]$ find . -name '*.cc' -exec grep -l G4Material {} \;
./Simulation/Historian/src/QueriableStepAction.cc
./Simulation/Historian/src/UnObserverStepAction.cc
./Simulation/Historian/src/HistorianStepAction.cc
./Simulation/DetSim/src/DsG4Scintillation.cc
./Simulation/DetSim/src/DsG4NeutronHPThermalScattering.cc
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc
./Simulation/DetSim/src/DsG4MuNuclearInteraction.cc
./Simulation/DetSim/src/DsPmtSensDet.cc
./Simulation/DetSim/src/DsG4Cerenkov.cc
./Simulation/DetSim/src/DsG4OpRayleigh.cc
./Simulation/DetSim/src/DsG4NeutronHPCapture.cc
[blyth@cms01 dybgaudi]$ pwd
/data/env/local/dyb/trunk/NuWa-trunk/dybgaudi</pre>
</div>
<div class="section" id="property-key-usage">
<h3>property key usage<a class="headerlink" href="#property-key-usage" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>[blyth@cms01 dybgaudi]$ find . -name '*.cc' -exec grep -H GetProperty {} \;
./Simulation/Historian/src/QueriableStepAction.cc:          aMaterialPropertiesTable-&gt;GetProperty("FASTCOMPONENT");
./Simulation/Historian/src/QueriableStepAction.cc:          aMaterialPropertiesTable-&gt;GetProperty("SLOWCOMPONENT");

./Simulation/DetSim/src/DsG4Scintillation.cc:        aMaterialPropertiesTable-&gt;GetProperty("FASTCOMPONENT");
./Simulation/DetSim/src/DsG4Scintillation.cc:        aMaterialPropertiesTable-&gt;GetProperty("SLOWCOMPONENT");
./Simulation/DetSim/src/DsG4Scintillation.cc:        aMaterialPropertiesTable-&gt;GetProperty("REEMISSIONPROB");
./Simulation/DetSim/src/DsG4Scintillation.cc:            Reemission_Prob-&gt;GetProperty(aTrack.GetKineticEnergy());
./Simulation/DetSim/src/DsG4Scintillation.cc:                aMaterialPropertiesTable-&gt;GetProperty("SCINTILLATIONYIELD");
./Simulation/DetSim/src/DsG4Scintillation.cc:            ScintillationYield = ptable-&gt;GetProperty(0);
./Simulation/DetSim/src/DsG4Scintillation.cc:                aMaterialPropertiesTable-&gt;GetProperty("RESOLUTIONSCALE");
./Simulation/DetSim/src/DsG4Scintillation.cc:                ResolutionScale = ptable-&gt;GetProperty(0);
./Simulation/DetSim/src/DsG4Scintillation.cc:        aMaterialPropertiesTable-&gt;GetProperty(FastTimeConstant.c_str());
./Simulation/DetSim/src/DsG4Scintillation.cc:        if (!ptable) ptable = aMaterialPropertiesTable-&gt;GetProperty("FASTTIMECONSTANT");
./Simulation/DetSim/src/DsG4Scintillation.cc:            fastTimeConstant = ptable-&gt;GetProperty(0);
./Simulation/DetSim/src/DsG4Scintillation.cc:        aMaterialPropertiesTable-&gt;GetProperty(SlowTimeConstant.c_str());
./Simulation/DetSim/src/DsG4Scintillation.cc:        if(!ptable) ptable = aMaterialPropertiesTable-&gt;GetProperty("SLOWTIMECONSTANT");
./Simulation/DetSim/src/DsG4Scintillation.cc:          slowTimeConstant = ptable-&gt;GetProperty(0);
./Simulation/DetSim/src/DsG4Scintillation.cc:            aMaterialPropertiesTable-&gt;GetProperty(strYieldRatio.c_str());
./Simulation/DetSim/src/DsG4Scintillation.cc:        if(!ptable) ptable = aMaterialPropertiesTable-&gt;GetProperty("YIELDRATIO");
./Simulation/DetSim/src/DsG4Scintillation.cc:            YieldRatio = ptable-&gt;GetProperty(0);
./Simulation/DetSim/src/DsG4Scintillation.cc:                aMaterialPropertiesTable-&gt;GetProperty("FASTCOMPONENT");
./Simulation/DetSim/src/DsG4Scintillation.cc:                    GetProperty();
./Simulation/DetSim/src/DsG4Scintillation.cc:                            GetProperty();
./Simulation/DetSim/src/DsG4Scintillation.cc:                aMaterialPropertiesTable-&gt;GetProperty("SLOWCOMPONENT");
./Simulation/DetSim/src/DsG4Scintillation.cc:                    GetProperty();
./Simulation/DetSim/src/DsG4Scintillation.cc:                            GetProperty();
./Simulation/DetSim/src/DsG4Scintillation.cc:                aMaterialPropertiesTable-&gt;GetProperty("REEMISSIONPROB");
./Simulation/DetSim/src/DsG4Scintillation.cc:                    GetProperty();
./Simulation/DetSim/src/DsG4Scintillation.cc:                            GetProperty();

./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:               Rindex = aMaterialPropertiesTable-&gt;GetProperty("RINDEX");
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:               Rindex1 = Rindex-&gt;GetProperty(thePhotonMomentum);
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                  Rindex = aMaterialPropertiesTable-&gt;GetProperty("RINDEX");
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                     Rindex2 = Rindex-&gt;GetProperty(thePhotonMomentum);
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                      aMaterialPropertiesTable-&gt;GetProperty("REFLECTIVITY");
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                      aMaterialPropertiesTable-&gt;GetProperty("REALRINDEX");
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                      aMaterialPropertiesTable-&gt;GetProperty("IMAGINARYRINDEX");
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                          PropertyPointer-&gt;GetProperty(thePhotonMomentum);
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                          PropertyPointer1-&gt;GetProperty(thePhotonMomentum);
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                          PropertyPointer2-&gt;GetProperty(thePhotonMomentum);
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:              aMaterialPropertiesTable-&gt;GetProperty("EFFICIENCY");
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                      PropertyPointer-&gt;GetProperty(thePhotonMomentum);
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:               aMaterialPropertiesTable-&gt;GetProperty("SPECULARLOBECONSTANT");
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                        PropertyPointer-&gt;GetProperty(thePhotonMomentum);
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:               aMaterialPropertiesTable-&gt;GetProperty("SPECULARSPIKECONSTANT");
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                        PropertyPointer-&gt;GetProperty(thePhotonMomentum);
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:               aMaterialPropertiesTable-&gt;GetProperty("BACKSCATTERCONSTANT");
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                        PropertyPointer-&gt;GetProperty(thePhotonMomentum);
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                 Rindex = aMaterialPropertiesTable-&gt;GetProperty("RINDEX");
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                 Rindex2 = Rindex-&gt;GetProperty(thePhotonMomentum);

./Simulation/DetSim/src/DsPmtSensDet.cc:        G4MaterialPropertyVector* qevec = mattab-&gt;GetProperty(m_qeffParamName.c_str());
./Simulation/DetSim/src/DsPmtSensDet.cc:          return qevec-&gt;GetProperty(energy);

./Simulation/DetSim/src/DsG4Cerenkov.cc:                aMaterialPropertiesTable-&gt;GetProperty("RINDEX");
./Simulation/DetSim/src/DsG4Cerenkov.cc:            sampledRI = Rindex-&gt;GetProperty(sampledEnergy);
./Simulation/DetSim/src/DsG4Cerenkov.cc:                           aMaterialPropertiesTable-&gt;GetProperty("RINDEX");
./Simulation/DetSim/src/DsG4Cerenkov.cc:                                           GetProperty();
./Simulation/DetSim/src/DsG4Cerenkov.cc:                                                GetProperty();
./Simulation/DetSim/src/DsG4Cerenkov.cc:                     Rindex = aMaterialPropertiesTable-&gt;GetProperty("RINDEX");
./Simulation/DetSim/src/DsG4Cerenkov.cc:        // GetProperty() methods of the G4MaterialPropertiesTable and
./Simulation/DetSim/src/DsG4Cerenkov.cc:  G4MaterialPropertyVector* qevec = bialkali-&gt;GetMaterialPropertiesTable()-&gt;GetProperty("EFFICIENCY");
./Simulation/DetSim/src/DsG4Cerenkov.cc:  return qevec-&gt;GetProperty(energy);

./Simulation/DetSim/src/DsG4OpRayleigh.cc:                            aMaterialPropertiesTable-&gt;GetProperty("RAYLEIGH");
./Simulation/DetSim/src/DsG4OpRayleigh.cc:                   aMaterialPropertyTable-&gt;GetProperty("RAYLEIGH");
./Simulation/DetSim/src/DsG4OpRayleigh.cc:                                    GetProperty(thePhotonEnergy);
./Simulation/DetSim/src/DsG4OpRayleigh.cc:        G4MaterialPropertyVector* Rindex = aMPT-&gt;GetProperty("RINDEX");
./Simulation/DetSim/src/DsG4OpRayleigh.cc:                refraction_index = Rindex-&gt;GetProperty();
[blyth@cms01 dybgaudi]$</pre>
</div>
</div>
<div class="section" id="nuwa-surface-properties">
<h3>NuWa surface properties<a class="headerlink" href="#nuwa-surface-properties" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>[blyth@cms01 dybgaudi]$ find . -name '*.cc' -exec grep -H Surface {} \;
./Simulation/GenTools/src/components/GtPositionerTool.cc:    if ("Surface" == m_strategy) {
./Simulation/GenTools/src/components/GtPositionerTool.cc:        fatal() &lt;&lt; "Surface strategy not yet supported" &lt;&lt; endreq;
./Simulation/GenTools/src/components/GtRockGammaTool.cc:   m_totalSurfaceArea(0),
./Simulation/GenTools/src/components/GtRockGammaTool.cc:  m_totalSurfaceArea = 0;
./Simulation/GenTools/src/components/GtRockGammaTool.cc:    m_totalSurfaceArea += m_walls[wallIdx]-&gt;area();
./Simulation/GenTools/src/components/GtRockGammaTool.cc:  debug() &lt;&lt; "Total surface area: " &lt;&lt; m_totalSurfaceArea &lt;&lt; endreq;
./Simulation/GenTools/src/components/GtRockGammaTool.cc:  double randArea = rand*m_totalSurfaceArea;
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc://              1998-11-07 - NULL OpticalSurface pointer before use
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc://                           G4OpticalSurface class ( by Fan Lei)
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                        -&gt;GetSurfaceTolerance();
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:        G4SurfaceType type = dielectric_dielectric;
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:        OpticalSurface = NULL;
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:        G4LogicalSurface* Surface = NULL;
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:        Surface = G4LogicalBorderSurface::GetSurface
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:        if (Surface == NULL){
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:       Surface = G4LogicalSkinSurface::GetSurface
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:       if(Surface == NULL)
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:         Surface = G4LogicalSkinSurface::GetSurface
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:       Surface = G4LogicalSkinSurface::GetSurface
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:       if(Surface == NULL)
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:         Surface = G4LogicalSkinSurface::GetSurface
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:   if (Surface) OpticalSurface =
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:           dynamic_cast &lt;G4OpticalSurface*&gt; (Surface-&gt;GetSurfaceProperty());
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:   if (OpticalSurface) {
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:           type      = OpticalSurface-&gt;GetType();
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:      theModel  = OpticalSurface-&gt;GetModel();
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:      theFinish = OpticalSurface-&gt;GetFinish();
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:      aMaterialPropertiesTable = OpticalSurface-&gt;
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:                 if(OpticalSurface-&gt;GetName().contains("ESRAir")) {
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:      if (OpticalSurface) sigma_alpha = OpticalSurface-&gt;GetSigmaAlpha();
./Simulation/DetSim/src/DsG4OpBoundaryProcess.cc:      if (OpticalSurface) polish = OpticalSurface-&gt;GetPolish();
./Validation/GeometryVal/src/GeometryVal.cc:    if ("Surface" == m_strategy) {
./Validation/GeometryVal/src/GeometryVal.cc:        fatal() &lt;&lt; "Surface strategy not yet supported" &lt;&lt; endreq;
./Reconstruction/Likelihood/src/LikelihoodTool.cc:#include "DetDesc/Surface.h"
./Reconstruction/AdRec/src/components/ExpQCalcTool.cc:#include "DetDesc/Surface.h"
./Reconstruction/AdRec/src/components/ExpQCalcTool.cc:    std::string topESR_location = "/dd/Geometry/AdDetails/AdSurfacesAll/ESRAirSurfaceTop";
./Reconstruction/AdRec/src/components/ExpQCalcTool.cc:    std::string botESR_location = "/dd/Geometry/AdDetails/AdSurfacesAll/ESRAirSurfaceBot";
./Reconstruction/AdRec/src/components/ExpQCalcTool.cc:    Surface* esrtop = GaudiCommon&lt;AlgTool&gt;::get&lt;Surface&gt;(dds, topESR_location);
./Reconstruction/AdRec/src/components/ExpQCalcTool.cc:    Surface* esrbot = GaudiCommon&lt;AlgTool&gt;::get&lt;Surface&gt;(dds, botESR_location);
./Reconstruction/AdRec/src/components/ExpQCalcTool.cc:    Surface::Tables&amp; esrtop_tab = esrtop-&gt;tabulatedProperties();
./Reconstruction/AdRec/src/components/ExpQCalcTool.cc:    Surface::Tables&amp; esrbot_tab = esrbot-&gt;tabulatedProperties();
./Reconstruction/AdRec/src/components/ExpQCalcTool.cc:    Surface::Tables::const_iterator sfIter;
./Reconstruction/AdRec/src/components/QMLFTool.cc:#include "DetDesc/Surface.h"
./Reconstruction/AdRec/src/components/QMLFTool.cc:      m_opPara.m_topRef = meanOpticalPara&lt;Surface&gt;(
./Reconstruction/AdRec/src/components/QMLFTool.cc:          "/dd/Geometry/AdDetails/AdSurfacesAll/ESRAirSurfaceTop",
./Reconstruction/AdRec/src/components/QMLFTool.cc:      m_opPara.m_botRef = meanOpticalPara&lt;Surface&gt;(
./Reconstruction/AdRec/src/components/QMLFTool.cc:          "/dd/Geometry/AdDetails/AdSurfacesAll/ESRAirSurfaceBot",
./Reconstruction/PoolRec/MuonPoolEvtDsp/src/components/PointSurfacePosition.cc:#include "PointSurfacePosition.h"
./Reconstruction/PoolRec/MuonPoolEvtDsp/src/components/PointSurfacePosition.cc:void PointSurfacePosition::Set(double x, double y, double z, int wall )
./Reconstruction/PoolRec/MuonPoolEvtDsp/src/components/FarPoolEvtDsp.cc:#include "PointSurfacePosition.h"
./Reconstruction/PoolRec/MuonPoolEvtDsp/src/components/FarPoolEvtDsp.cc:   vector&lt;PointSurfacePosition&gt; prealv;
./Reconstruction/PoolRec/MuonPoolEvtDsp/src/components/FarPoolEvtDsp.cc:   vector&lt;PointSurfacePosition&gt;::const_iterator it_prealv;
[blyth@cms01 dybgaudi]$</pre>
</div>
</div>
<div class="section" id="optical-surface-modelling-in-g4">
<h3>Optical Surface modelling in G4<a class="headerlink" href="#optical-surface-modelling-in-g4" title="Permalink to this headline">¶</a></h3>
<p><cite>NuWa-trunk/dybgaudi/Simulation/DetSim/src/DsG4OpBoundaryProcess.cc</cite>:</p>
<div class="highlight-python"><pre>227         theModel = glisur;
228         theFinish = polished;
229
230         G4SurfaceType type = dielectric_dielectric;
231
232         Rindex = NULL;
233         OpticalSurface = NULL;
234
235         G4LogicalSurface* Surface = NULL;
236
237         Surface = G4LogicalBorderSurface::GetSurface
238               (pPreStepPoint -&gt;GetPhysicalVolume(),
239                pPostStepPoint-&gt;GetPhysicalVolume());
240
241         if (Surface == NULL){
242       G4bool enteredDaughter=(pPostStepPoint-&gt;GetPhysicalVolume()
243                   -&gt;GetMotherLogical() ==
244                   pPreStepPoint-&gt;GetPhysicalVolume()
245                   -&gt;GetLogicalVolume());
246       if(enteredDaughter){
247         Surface = G4LogicalSkinSurface::GetSurface
248           (pPostStepPoint-&gt;GetPhysicalVolume()-&gt;
249            GetLogicalVolume());
250         if(Surface == NULL)
251           Surface = G4LogicalSkinSurface::GetSurface
252           (pPreStepPoint-&gt;GetPhysicalVolume()-&gt;
253            GetLogicalVolume());
254       }
255       else {
256         Surface = G4LogicalSkinSurface::GetSurface
257           (pPreStepPoint-&gt;GetPhysicalVolume()-&gt;
258            GetLogicalVolume());
259         if(Surface == NULL)
260           Surface = G4LogicalSkinSurface::GetSurface
261           (pPostStepPoint-&gt;GetPhysicalVolume()-&gt;
262            GetLogicalVolume());
263       }
264     }
265
266     if (Surface) OpticalSurface =
267            dynamic_cast &lt;G4OpticalSurface*&gt; (Surface-&gt;GetSurfaceProperty());
268
269     if (OpticalSurface) {
270
271            type      = OpticalSurface-&gt;GetType();
272        theModel  = OpticalSurface-&gt;GetModel();
273        theFinish = OpticalSurface-&gt;GetFinish();
274
275        aMaterialPropertiesTable = OpticalSurface-&gt;
276                     GetMaterialPropertiesTable();</pre>
</div>
</div>
<div class="section" id="gdml-persisting-optical-surface-properties">
<h3>GDML persisting optical surface properties<a class="headerlink" href="#gdml-persisting-optical-surface-properties" title="Permalink to this headline">¶</a></h3>
<p>Old G4:</p>
<div class="highlight-python"><pre>[blyth@cms01 src]$ pwd
/data/env/local/dyb/trunk/external/build/LCG/geant4.9.2.p01/source/persistency/gdml/src

[blyth@cms01 src]$ grep G4Optical *.cc
G4GDMLReadSolids.cc:   G4OpticalSurfaceModel model;
G4GDMLReadSolids.cc:   G4OpticalSurfaceFinish finish;
G4GDMLReadSolids.cc:   new G4OpticalSurface(name,model,finish,type,value);
[blyth@cms01 src]$
[blyth@cms01 src]$ grep G4Optical ../include/*.hh
../include/G4GDMLReadSolids.hh:#include "G4OpticalSurface.hh"
[blyth@cms01 src]$</pre>
</div>
<p>New G4:</p>
<div class="highlight-python"><pre>g4pb:src blyth$ pwd
/usr/local/env/geant4/geant4.10.00.b01/source/persistency/gdml/src

g4pb:src blyth$ grep G4Optical *.cc
G4GDMLReadSolids.cc:#include "G4OpticalSurface.hh"
G4GDMLReadSolids.cc:   G4OpticalSurfaceModel model;
G4GDMLReadSolids.cc:   G4OpticalSurfaceFinish finish;
G4GDMLReadSolids.cc:   new G4OpticalSurface(name,model,finish,type,value);
G4GDMLWriteSolids.cc:#include "G4OpticalSurface.hh"
G4GDMLWriteSolids.cc:                    const G4OpticalSurface* const surf)
G4GDMLWriteSolids.cc:   G4OpticalSurfaceModel smodel = surf-&gt;GetModel();
G4GDMLWriteStructure.cc:#include "G4OpticalSurface.hh"
G4GDMLWriteStructure.cc:     const G4OpticalSurface* opsurf =
G4GDMLWriteStructure.cc:       dynamic_cast&lt;const G4OpticalSurface*&gt;(psurf);
G4GDMLWriteStructure.cc:     const G4OpticalSurface* opsurf =
G4GDMLWriteStructure.cc:       dynamic_cast&lt;const G4OpticalSurface*&gt;(psurf);
G4GDMLWriteStructure.cc:   const G4OpticalSurface* osurf = dynamic_cast&lt;const G4OpticalSurface*&gt;(psurf);
G4GDMLWriteStructure.cc:   std::vector&lt;const G4OpticalSurface*&gt;::const_iterator pos;
g4pb:src blyth$
g4pb:src blyth$ grep G4Optical ../include/*.hh
../include/G4GDMLWriteSolids.hh:class G4OpticalSurface;
../include/G4GDMLWriteSolids.hh:                    const G4OpticalSurface* const);
../include/G4GDMLWriteStructure.hh:class G4OpticalSurface;
../include/G4GDMLWriteStructure.hh:   std::vector&lt;const G4OpticalSurface*&gt; opt_vec;
g4pb:src blyth$</pre>
</div>
<p>Reading new GDML persisting code, it looks like the surface property tables are not persisted,
although the surface names are:</p>
<div class="highlight-python"><pre>g4pb:src blyth$ grep GetMaterialPropertiesTable *.cc
G4GDMLReadMaterials.cc:   G4MaterialPropertiesTable* matprop=material-&gt;GetMaterialPropertiesTable();
G4GDMLWriteMaterials.cc:   if (materialPtr-&gt;GetMaterialPropertiesTable())
G4GDMLWriteMaterials.cc:   G4MaterialPropertiesTable* ptable = mat-&gt;GetMaterialPropertiesTable();
g4pb:src blyth$</pre>
</div>
<p>From the GDML volume traverse <cite>G4GDMLWriteStructure.cc</cite>:</p>
<div class="highlight-python"><pre>359 G4Transform3D G4GDMLWriteStructure::
360 TraverseVolumeTree(const G4LogicalVolume* const volumePtr, const G4int depth)
361 {
...

480       else   // Is it a physvol?
481       {
482          G4RotationMatrix rot;
483
484          if (physvol-&gt;GetFrameRotation() != 0)
485          {
486            rot = *(physvol-&gt;GetFrameRotation());
487          }
488          G4Transform3D P(rot,physvol-&gt;GetObjectTranslation());
489          PhysvolWrite(volumeElement,physvol,invR*P*daughterR,ModuleName);
490       }
491       BorderSurfaceCache(GetBorderSurface(physvol));
492    }
493
494    structureElement-&gt;appendChild(volumeElement);
495      // Append the volume AFTER traversing the children so that
496      // the order of volumes will be correct!
497
498    VolumeMap()[volumePtr] = R;
499
500    AddExtension(volumeElement, volumePtr);
501      // Add any possible user defined extension attached to a volume
502
503    AddMaterial(volumePtr-&gt;GetMaterial());
504      // Add the involved materials and solids!
505
506    AddSolid(solidPtr);
507
508    SkinSurfaceCache(GetSkinSurface(volumePtr));
509
510    return R;
511 }
...
294 const G4LogicalSkinSurface*
295 G4GDMLWriteStructure::GetSkinSurface(const G4LogicalVolume* const lvol)
296 {
297   G4LogicalSkinSurface* surf = 0;
298   G4int nsurf = G4LogicalSkinSurface::GetNumberOfSkinSurfaces();
299   if (nsurf)
300   {
301     const G4LogicalSkinSurfaceTable* stable =
302           G4LogicalSkinSurface::GetSurfaceTable();
303     std::vector&lt;G4LogicalSkinSurface*&gt;::const_iterator pos;
304     for (pos = stable-&gt;begin(); pos != stable-&gt;end(); pos++)
305     {
306       if (lvol == (*pos)-&gt;GetLogicalVolume())
307       {
308         surf = *pos; break;
309       }
310     }
311   }
312   return surf;
313 }
314
315 const G4LogicalBorderSurface*
316 G4GDMLWriteStructure::GetBorderSurface(const G4VPhysicalVolume* const pvol)
317 {
318   G4LogicalBorderSurface* surf = 0;
319   G4int nsurf = G4LogicalBorderSurface::GetNumberOfBorderSurfaces();
320   if (nsurf)
321   {
322     const G4LogicalBorderSurfaceTable* btable =
323           G4LogicalBorderSurface::GetSurfaceTable();
324     std::vector&lt;G4LogicalBorderSurface*&gt;::const_iterator pos;
325     for (pos = btable-&gt;begin(); pos != btable-&gt;end(); pos++)
326     {
327       if (pvol == (*pos)-&gt;GetVolume1())  // just the first in the couple
328       {                                  // is enough
329         surf = *pos; break;
330       }
331     }
332   }
333   return surf;</pre>
</div>
<p>Same in g4ten:</p>
<div class="highlight-python"><pre>[blyth@belle7 src]$ grep GetMaterialPropertiesTable *.cc
G4GDMLReadMaterials.cc:   G4MaterialPropertiesTable* matprop=material-&gt;GetMaterialPropertiesTable();
G4GDMLWriteMaterials.cc:   if (materialPtr-&gt;GetMaterialPropertiesTable())
G4GDMLWriteMaterials.cc:   G4MaterialPropertiesTable* ptable = mat-&gt;GetMaterialPropertiesTable();
[blyth@belle7 src]$
[blyth@belle7 src]$ pwd
/data1/env/local/env/geant4/geant4.10.00/source/persistency/gdml/src</pre>
</div>
<p>Many diffs but not relevant to G4DAE:</p>
<div class="highlight-python"><pre>[blyth@belle7 src]$ diff -r --brief /data1/env/local/env/geant4/geant4.10.00.b01/source/persistency/gdml /data1/env/local/env/geant4/geant4.10.00/source/persistency/gdml
Files /data1/env/local/env/geant4/geant4.10.00.b01/source/persistency/gdml/History and /data1/env/local/env/geant4/geant4.10.00/source/persistency/gdml/History differ
Files /data1/env/local/env/geant4/geant4.10.00.b01/source/persistency/gdml/include/G4GDMLParameterisation.hh and /data1/env/local/env/geant4/geant4.10.00/source/persistency/gdml/include/G4GDMLParameterisation.hh differ
Files /data1/env/local/env/geant4/geant4.10.00.b01/source/persistency/gdml/include/G4GDMLReadParamvol.hh and /data1/env/local/env/geant4/geant4.10.00/source/persistency/gdml/include/G4GDMLReadParamvol.hh differ
Files /data1/env/local/env/geant4/geant4.10.00.b01/source/persistency/gdml/include/G4GDMLReadSolids.hh and /data1/env/local/env/geant4/geant4.10.00/source/persistency/gdml/include/G4GDMLReadSolids.hh differ
Files /data1/env/local/env/geant4/geant4.10.00.b01/source/persistency/gdml/include/G4GDMLWriteParamvol.hh and /data1/env/local/env/geant4/geant4.10.00/source/persistency/gdml/include/G4GDMLWriteParamvol.hh differ
Files /data1/env/local/env/geant4/geant4.10.00.b01/source/persistency/gdml/include/G4GDMLWriteSolids.hh and /data1/env/local/env/geant4/geant4.10.00/source/persistency/gdml/include/G4GDMLWriteSolids.hh differ
Files /data1/env/local/env/geant4/geant4.10.00.b01/source/persistency/gdml/schema/gdml_parameterised.xsd and /data1/env/local/env/geant4/geant4.10.00/source/persistency/gdml/schema/gdml_parameterised.xsd differ
Files /data1/env/local/env/geant4/geant4.10.00.b01/source/persistency/gdml/schema/gdml_solids.xsd and /data1/env/local/env/geant4/geant4.10.00/source/persistency/gdml/schema/gdml_solids.xsd differ
Files /data1/env/local/env/geant4/geant4.10.00.b01/source/persistency/gdml/src/G4GDMLParameterisation.cc and /data1/env/local/env/geant4/geant4.10.00/source/persistency/gdml/src/G4GDMLParameterisation.cc differ
Files /data1/env/local/env/geant4/geant4.10.00.b01/source/persistency/gdml/src/G4GDMLReadParamvol.cc and /data1/env/local/env/geant4/geant4.10.00/source/persistency/gdml/src/G4GDMLReadParamvol.cc differ
Files /data1/env/local/env/geant4/geant4.10.00.b01/source/persistency/gdml/src/G4GDMLReadSolids.cc and /data1/env/local/env/geant4/geant4.10.00/source/persistency/gdml/src/G4GDMLReadSolids.cc differ
Files /data1/env/local/env/geant4/geant4.10.00.b01/source/persistency/gdml/src/G4GDMLWriteParamvol.cc and /data1/env/local/env/geant4/geant4.10.00/source/persistency/gdml/src/G4GDMLWriteParamvol.cc differ
Files /data1/env/local/env/geant4/geant4.10.00.b01/source/persistency/gdml/src/G4GDMLWriteSolids.cc and /data1/env/local/env/geant4/geant4.10.00/source/persistency/gdml/src/G4GDMLWriteSolids.cc differ
[blyth@belle7 src]$</pre>
</div>
</div>
</div>
<div class="section" id="g4logicalskinsurface-and-g4logicalbordersurface">
<h2>G4LogicalSkinSurface and G4LogicalBorderSurface<a class="headerlink" href="#g4logicalskinsurface-and-g4logicalbordersurface" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>[blyth@cms01 source]$ find . -name G4LogicalSkinSurface.hh
./geometry/volumes/include/G4LogicalSkinSurface.hh
[blyth@cms01 source]$ vi geometry/volumes/include/G4LogicalSkinSurface.hh

34 // A Logical Surface class for the surface surrounding a single logical
35 // volume.


[blyth@cms01 source]$ find . -name G4LogicalBorderSurface.hh
./geometry/volumes/include/G4LogicalBorderSurface.hh
[blyth@cms01 source]$ vi geometry/volumes/include/G4LogicalBorderSurface.hh

34 // A Logical Surface class for surfaces defined by the boundary
35 // of two physical volumes.</pre>
</div>
<div class="section" id="some-hardcoded-reflectivity">
<h3>Some Hardcoded reflectivity<a class="headerlink" href="#some-hardcoded-reflectivity" title="Permalink to this headline">¶</a></h3>
<p>Hardcoded ESRAir reflectivity as function of incident angle. <strong>this needs to be duplicated Chroma side GPU</strong></p>
<div class="highlight-python"><pre>269     if (OpticalSurface) {
270
271            type      = OpticalSurface-&gt;GetType();
272        theModel  = OpticalSurface-&gt;GetModel();
273        theFinish = OpticalSurface-&gt;GetFinish();
274
275        aMaterialPropertiesTable = OpticalSurface-&gt;
276                     GetMaterialPropertiesTable();
277
278            if (aMaterialPropertiesTable) {
279
280               if (theFinish == polishedbackpainted ||
281                   theFinish == groundbackpainted ) {
282                   Rindex = aMaterialPropertiesTable-&gt;GetProperty("RINDEX");
283               if (Rindex) {
284                      Rindex2 = Rindex-&gt;GetProperty(thePhotonMomentum);
285                   }
286                   else {
287              theStatus = NoRINDEX;
288                      aParticleChange.ProposeTrackStatus(fStopAndKill);
289                      return G4VDiscreteProcess::PostStepDoIt(aTrack, aStep);
290                   }
291               }
292
293               G4MaterialPropertyVector* PropertyPointer;
294               G4MaterialPropertyVector* PropertyPointer1;
295               G4MaterialPropertyVector* PropertyPointer2;
296
297               PropertyPointer =
298                       aMaterialPropertiesTable-&gt;GetProperty("REFLECTIVITY");
299               PropertyPointer1 =
300                       aMaterialPropertiesTable-&gt;GetProperty("REALRINDEX");
301               PropertyPointer2 =
302                       aMaterialPropertiesTable-&gt;GetProperty("IMAGINARYRINDEX");
303
304               iTE = 1;
305               iTM = 1;
306
307               if (PropertyPointer) {
/// REFLECTIVITY provided
308
309                  theReflectivity =
310                           PropertyPointer-&gt;GetProperty(thePhotonMomentum);
311                  if(OpticalSurface-&gt;GetName().contains("ESRAir")) {
312                    G4double inciAngle = GetIncidentAngle();
313                    //ESR in air
314                    if(inciAngle*180./pi &gt; 40) {
315                      theReflectivity = (theReflectivity - 0.993) + 0.973572 + 9.53233e-04*(inciAngle*180./pi) - 1.22184e-05*((inciAngle*180./pi))*((inciAngle*180./pi));
316                    }
...
337
338               } else if (PropertyPointer1 &amp;&amp; PropertyPointer2) {
///      REALRINDEX and IMAGINARYRINDEX provided
339
340                  G4double RealRindex =
341                           PropertyPointer1-&gt;GetProperty(thePhotonMomentum);
342                  G4double ImaginaryRindex =
343                           PropertyPointer2-&gt;GetProperty(thePhotonMomentum);
344
345                  // calculate FacetNormal
346                  if ( theFinish == ground ) {
347                     theFacetNormal =
348                               GetFacetNormal(OldMomentum, theGlobalNormal);
349                  } else {
350                     theFacetNormal = theGlobalNormal;
351                  }
352</pre>
</div>
<p>/data/env/local/dyb/trunk/NuWa-trunk/dybgaudi/Detector/XmlDetDesc/DDDB/AdDetails/surfaces.xml:</p>
<div class="highlight-python"><pre>09   &lt;catalog name="AdSurfacesAll"&gt;
10     &lt;surfaceref href="#RSOilSurface"/&gt;  &lt;!--Radial Shield--&gt;
11     &lt;surfaceref href="#ESRAirSurfaceTop"/&gt;
12     &lt;surfaceref href="#ESRAirSurfaceBot"/&gt;
13     &lt;surfaceref href="#SSTOilSurface"/&gt;
14     &lt;surfaceref href="#AdCableTraySurface"/&gt;
15   &lt;/catalog&gt;
16   &lt;catalog name="AdSurfacesNear"&gt;
17     &lt;surfaceref href="#SSTWaterSurfaceNear1"/&gt;
18     &lt;surfaceref href="#SSTWaterSurfaceNear2"/&gt;
19   &lt;/catalog&gt;
20   &lt;catalog name="AdSurfacesFar"&gt;
21     &lt;surfaceref href="#SSTWaterSurfaceFar1"/&gt;
22     &lt;surfaceref href="#SSTWaterSurfaceFar2"/&gt;
23     &lt;surfaceref href="#SSTWaterSurfaceFar3"/&gt;
24     &lt;surfaceref href="#SSTWaterSurfaceFar4"/&gt;
25   &lt;/catalog&gt;
26
27   &lt;catalog name="AdTabProperties"&gt;
28     &lt;tabpropertyref href="properties.xml#RSOilReflectivity"/&gt; &lt;!--Radial Shield--&gt;
29     &lt;tabpropertyref href="properties.xml#RSOilSpecularLobe"/&gt; &lt;!--Radial Shield--&gt;
30     &lt;tabpropertyref href="properties.xml#RSOilSpecularSpike"/&gt; &lt;!--Radial Shield--&gt;
31     &lt;tabpropertyref href="properties.xml#RSOilBackScattering"/&gt; &lt;!--Radial Shield--&gt;
32     &lt;tabpropertyref href="properties.xml#ESRAirReflectivity"/&gt;
33     &lt;tabpropertyref href="properties.xml#ESRAirSpecularLobe"/&gt;
34     &lt;tabpropertyref href="properties.xml#ESRAirSpecularSpike"/&gt;
35     &lt;tabpropertyref href="properties.xml#ESRAirBackScattering"/&gt;
36     &lt;tabpropertyref href="properties.xml#SSTOilReflectivity"/&gt;
37     &lt;tabpropertyref href="properties.xml#SSTWaterReflectivity"/&gt;
38   &lt;/catalog&gt;
39
40
41
42   &lt;!-- Surfaces --&gt;
43
44   &lt;!-- Reflector top and bottom --&gt;
45
46   &lt;surface name="ESRAirSurfaceTop"
47        model="unified"
48        finish="polished"
49        type="dielectric_metal"
50        value="0.0"
51        volfirst="/dd/Geometry/AdDetails/lvTopReflector#pvTopRefGap"
52        volsecond="/dd/Geometry/AdDetails/lvTopRefGap#pvTopESR"&gt;
53     &lt;tabprops address="/dd/Geometry/AdDetails/AdTabProperties/ESRAirReflectivity"/&gt;
54   &lt;/surface&gt;</pre>
</div>
<p>/data/env/local/dyb/trunk/NuWa-trunk/dybgaudi/Detector/XmlDetDesc/DDDB/Parameters/surfaces.xml:</p>
<div class="highlight-python"><pre>09 &lt;!-- Geant4's G4OpticalSurface enums --&gt;
10 &lt;parameter name="polished" value="0"/&gt;
11 &lt;parameter name="polishedfrontpainted" value="1" /&gt;
12 &lt;parameter name="polishedbackpainted" value="2" /&gt;
13 &lt;parameter name="ground" value="3" /&gt;
14 &lt;parameter name="groundfrontpainted" value="4" /&gt;
15 &lt;parameter name="groundbackpainted" value="5" /&gt;
16
17 &lt;parameter name="dielectric_metal" value="0" /&gt;
18 &lt;parameter name="dielectric_dielectric" value="1" /&gt;
19
20 &lt;parameter name="glisur" value="0" /&gt;
21 &lt;parameter name="unified" value="1" /&gt;</pre>
</div>
<p>/data/env/local/dyb/trunk/NuWa-trunk/dybgaudi/Detector/XmlDetDesc/DDDB/AdDetails/properties.xml:</p>
<div class="highlight-python"><pre>08   &lt;tabproperty name="ESRAirReflectivity"
09                type="REFLECTIVITY"
10                xunit="eV"
11                yunit=""
12                xaxis="Energy"
13                yaxis="Reflectivity"&gt;
14     1.55      0.98505
15     1.63      0.98406
16     1.68      0.96723
17     1.72      0.9702
18     1.77      0.97119
19     1.82      0.96624
20     1.88      0.95139
21     1.94      0.98307
22     2.00      0.9801
23     2.07      0.98901
24     2.14      0.98505
25     2.21      0.96525
26     2.30      0.97614
27     2.38      0.97812
28     2.48      0.97515
29     2.58      0.96525
30     2.70      0.96624
31     2.82      0.96129
32     2.95      0.95832
33     3.10      0.95733
34     3.26      0.73656
35     3.44      0.11583
36     3.65      0.10395
37     3.88      0.11682
38     4.13      0.14256
39     4.43      0.1188
40     4.77      0.18018
41     4.96      0.21384
42     6.20      0.0099
43     10.33     0.0099
44     15.5      0.0099
45   &lt;/tabproperty&gt; &lt;!-- reflectivity --&gt;
46
47   &lt;tabproperty name="ESRAirSpecularLobe"
48                type="SPECULARLOBECONSTANT"
49                xunit="eV"
50                yunit=""
51                xaxis="Energy"
52                yaxis="Specularlobe"&gt;
53             1.55      1.
54             1.63      1.
55             1.68      1.
..</pre>
</div>
<p>/data/env/local/dyb/trunk/NuWa-trunk/dybgaudi/Detector/XmlDetDesc/DDDB/materials/water.xml:</p>
<div class="highlight-python"><pre>10
11
12     &lt;!-- This is taken from G4dyb's MaterialProperties.xml and massaged to fit --&gt;
13     &lt;tabproperty name="WaterAbsorptionLength"
14          type="ABSLENGTH"
15          xunit="eV"
16          yunit="cm"
17          xaxis="PhotonEnergy"
18          yaxis="AbsorptionLength"&gt;
19
20          1.5498024  48.66809
21          1.5694201  48.66475
22          1.5734035  48.24148
23          1.5774070  47.50742
24          1.5814310  47.61985
25          1.5854756  45.87167
..</pre>
</div>
</div>
</div>
<div class="section" id="key-discoverability">
<h2>Key discoverability<a class="headerlink" href="#key-discoverability" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://www-zeuthen.desy.de/geant4/geant4.9.3.b01/G4MaterialPropertiesTable_8hh-source.html">http://www-zeuthen.desy.de/geant4/geant4.9.3.b01/G4MaterialPropertiesTable_8hh-source.html</a></li>
</ul>
<p>4.9.3 has public map accessors:</p>
<div class="highlight-python"><pre>00119   public:  // without description
00120
00121     const std::map&lt; G4String, G4MaterialPropertyVector*, std::less&lt;G4String&gt; &gt;*
00122     GetPropertiesMap() const { return &amp;MPT; }
00123     const std::map&lt; G4String, G4double, std::less&lt;G4String&gt; &gt;*
00124     GetPropertiesCMap() const { return &amp;MPTC; }
00125     // Accessors required for persistency purposes</pre>
</div>
<p>Follow the persistency clue:</p>
<div class="highlight-python"><pre>(chroma_env)delta:geant4.9.5.p01 blyth$ find . -name '*.cc' -exec grep -H GetPropertiesMap {} \;
./source/persistency/gdml/src/G4GDMLWriteMaterials.cc:                 std::less&lt;G4String&gt; &gt;* pmap = ptable-&gt;GetPropertiesMap();
(chroma_env)delta:geant4.9.5.p01 blyth$
(chroma_env)delta:geant4.9.5.p01 blyth$ pwd
/usr/local/env/chroma_env/src/geant4.9.5.p01</pre>
</div>
<p>Map accessors not present in 4.9.2:</p>
<div class="highlight-python"><pre>[blyth@cms01 geant4.9.2.p01]$ vi source/materials/include/G4MaterialPropertiesTable.hh
[blyth@cms01 geant4.9.2.p01]$ find . -name G4MaterialPropertiesTable.hh
./source/materials/include/G4MaterialPropertiesTable.hh
./include/G4MaterialPropertiesTable.hh</pre>
</div>
<p>Maybe kludge by simply checking for existance of known hardcoded/configured keys:</p>
<div class="highlight-python"><pre>[blyth@cms01 dybgaudi]$ find . -name '*.cc' -exec grep -H GetProperty {} \; | perl -ne 'm,\"(\S*)\",&amp;&amp; print "$1\n" ' - | sort | uniq
BACKSCATTERCONSTANT
EFFICIENCY
FASTCOMPONENT
FASTTIMECONSTANT
IMAGINARYRINDEX
RAYLEIGH
REALRINDEX
REEMISSIONPROB
REFLECTIVITY
RESOLUTIONSCALE
RINDEX
SCINTILLATIONYIELD
SLOWCOMPONENT
SLOWTIMECONSTANT
SPECULARLOBECONSTANT
SPECULARSPIKECONSTANT
YIELDRATIO</pre>
</div>
</div>
<div class="section" id="gdml-persisting-properties">
<h2>GDML persisting properties<a class="headerlink" href="#gdml-persisting-properties" title="Permalink to this headline">¶</a></h2>
<p><strong>Patching seems more appropriate, as thats in the next G4 version anyhow.</strong></p>
<p>A G4DAE translation of the below with 4.9.2, will need to patch it to add public
accessors to the maps.:</p>
<div class="highlight-python"><pre>(chroma_env)delta:geant4.9.5.p01 blyth$ vi source/persistency/gdml/src/G4GDMLWriteMaterials.cc

208 void G4GDMLWriteMaterials::PropertyVectorWrite(const G4String&amp; key,
209                            const G4PhysicsOrderedFreeVector* const pvec)
210 {
211    const G4String matrixref = GenerateName(key, pvec);
212    xercesc::DOMElement* matrixElement = NewElement("matrix");
213    matrixElement-&gt;setAttributeNode(NewAttribute("name", matrixref));
214    matrixElement-&gt;setAttributeNode(NewAttribute("coldim", "2"));
215    std::ostringstream pvalues;
216    for (size_t i=0; i&lt;pvec-&gt;GetVectorLength(); i++)
217    {
218        if (i!=0)  { pvalues &lt;&lt; " "; }
219        pvalues &lt;&lt; pvec-&gt;Energy(i) &lt;&lt; " " &lt;&lt; (*pvec)[i];
220    }
221    matrixElement-&gt;setAttributeNode(NewAttribute("values", pvalues.str()));
222
223    defineElement-&gt;appendChild(matrixElement);
224 }

226 void G4GDMLWriteMaterials::PropertyWrite(xercesc::DOMElement* matElement,
227                                          const G4Material* const mat)
228 {
229    xercesc::DOMElement* propElement;
230    G4MaterialPropertiesTable* ptable = mat-&gt;GetMaterialPropertiesTable();
231    const std::map&lt; G4String, G4PhysicsOrderedFreeVector*,
232                  std::less&lt;G4String&gt; &gt;* pmap = ptable-&gt;GetPropertiesMap();
233    const std::map&lt; G4String, G4double,
234                  std::less&lt;G4String&gt; &gt;* cmap = ptable-&gt;GetPropertiesCMap();
235    std::map&lt; G4String, G4PhysicsOrderedFreeVector*,
236                  std::less&lt;G4String&gt; &gt;::const_iterator mpos;
237    std::map&lt; G4String, G4double,
238                  std::less&lt;G4String&gt; &gt;::const_iterator cpos;
239    for (mpos=pmap-&gt;begin(); mpos!=pmap-&gt;end(); mpos++)
240    {
241       propElement = NewElement("property");
242       propElement-&gt;setAttributeNode(NewAttribute("name", mpos-&gt;first));
243       propElement-&gt;setAttributeNode(NewAttribute("ref",
244                                     GenerateName(mpos-&gt;first, mpos-&gt;second)));
245       if (mpos-&gt;second)
246       {
247          PropertyVectorWrite(mpos-&gt;first, mpos-&gt;second);
248          matElement-&gt;appendChild(propElement);
249       }
250       else
251       {
252          G4String warn_message = "Null pointer for material property -"
253                   + mpos-&gt;first + "- of material -" + mat-&gt;GetName() + "- !";
254          G4Exception("G4GDMLWriteMaterials::PropertyWrite()", "NullPointer",
255                      JustWarning, warn_message);
256          continue;
257       }
258    }
259    for (cpos=cmap-&gt;begin(); cpos!=cmap-&gt;end(); cpos++)
260    {
261       propElement = NewElement("property");
262       propElement-&gt;setAttributeNode(NewAttribute("name", cpos-&gt;first));
263       propElement-&gt;setAttributeNode(NewAttribute("ref", cpos-&gt;first));
264       xercesc::DOMElement* constElement = NewElement("constant");
265       constElement-&gt;setAttributeNode(NewAttribute("name", cpos-&gt;first));
266       constElement-&gt;setAttributeNode(NewAttribute("value", cpos-&gt;second));
267       defineElement-&gt;appendChild(constElement);
268       matElement-&gt;appendChild(propElement);
269    }
270 }</pre>
</div>
</div>
<div class="section" id="checking-dae-properties">
<h2>Checking DAE Properties<a class="headerlink" href="#checking-dae-properties" title="Permalink to this headline">¶</a></h2>
<p>After <a class="reference internal" href="../../../nuwa/geant4_patch/"><em>Geant4 Patch</em></a> to expose the properties and the adoption of GDML property
writer into G4DAE succeed to includ properties in the DAE. But need some veracity checking:</p>
<div class="highlight-python"><pre>70373     &lt;material id="__dd__Materials__Acrylic0xa7b6b48"&gt;
70374       &lt;instance_effect url="#__dd__Materials__Acrylic_fx_0xa7b6b48"/&gt;
70375       &lt;extra&gt;
70376         &lt;matrix coldim="2" name="ABSLENGTH0xa7b4d78" values="1.55e-06 8000 1.61e-06 8000 2.07e-06 8000 2.48e-06 8000 3.76e-06 8000 4.13e-06 8000 6.2e-06 0.008 1.033e-05 0.008 1.55e-05 0.008"/&gt;
70377         &lt;property name="ABSLENGTH" ref="ABSLENGTH0xa7b4d78"/&gt;
70378         &lt;matrix coldim="2" name="RAYLEIGH0xa7b4da8" values="1.55e-06 500000 1.7714e-06 300000 2.102e-06 170000 2.255e-06 100000 2.531e-06 62000 2.884e-06 42000 3.024e-06 30000 4.133e-06 7600 6.2e-06 850        1.033e-05 850 1.55e-05 850"/&gt;
70379         &lt;property name="RAYLEIGH" ref="RAYLEIGH0xa7b4da8"/&gt;
70380         &lt;matrix coldim="2" name="RINDEX0xa504f20" values="1.55e-06 1.4878 1.79505e-06 1.4895 2.10499e-06 1.4925 2.27077e-06 1.4946 2.55111e-06 1.4986 2.84498e-06 1.5022 3.06361e-06 1.5065 4.13281e-06 1.       5358 6.2e-06 1.6279 6.526e-06 1.627 6.889e-06 1.5359 7.294e-06 1.5635 7.75e-06 1.793 8.267e-06 1.7199 8.857e-06"/&gt;
70381         &lt;property name="RINDEX" ref="RINDEX0xa504f20"/&gt;
70382       &lt;/extra&gt;
70383     &lt;/material&gt;</pre>
</div>
<p>Confirmed values truncation at 255 chars, maybe extend that buffer or move values to text content:</p>
<div class="highlight-python"><pre>70497     &lt;material id="__dd__Materials__ESR0xa56f4b0"&gt;
70498       &lt;instance_effect url="#__dd__Materials__ESR_fx_0xa56f4b0"/&gt;
70499       &lt;extra&gt;
70500         &lt;matrix coldim="2" name="ABSLENGTH0xa8080f8" values="1.55e-06 0.001 1.63e-06 0.001 1.68e-06 0.001 1.72e-06 0.001 1.77e-06 0.001 1.82e-06 0.001 1.88e-06 0.001 1.94e-06 0.001 2e-06 0.001 2.07e-06        0.001 2.14e-06 0.001 2.21e-06 0.001 2.3e-06 0.001 2.38e-06 0.001 2.48e-06 0.001 2.58e-06 0.001 2.7e-06 0.001 2.82e"/&gt;
70501         &lt;property name="ABSLENGTH" ref="ABSLENGTH0xa8080f8"/&gt;
70502       &lt;/extra&gt;
70503     &lt;/material&gt;</pre>
</div>
<div class="section" id="what-about-constant-properties">
<h3>What about constant properties ?<a class="headerlink" href="#what-about-constant-properties" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="need-to-propagate-surface-properties-too">
<h2>Need to propagate surface properties too<a class="headerlink" href="#need-to-propagate-surface-properties-too" title="Permalink to this headline">¶</a></h2>
<div class="section" id="recent-reflectivity-change">
<h3>Recent Reflectivity Change<a class="headerlink" href="#recent-reflectivity-change" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://dayabay.ihep.ac.cn/tracs/dybsvn/browser/dybgaudi/trunk/Detector/XmlDetDesc/DDDB/AdDetails/properties.xml">http://dayabay.ihep.ac.cn/tracs/dybsvn/browser/dybgaudi/trunk/Detector/XmlDetDesc/DDDB/AdDetails/properties.xml</a></li>
</ul>
<p>Change in surface properties has recently been discussed:</p>
<div class="highlight-python"><pre>This is caused by reflectivity of radial shield which was updated by Logan.
The number is changed from 0.07 to about 0.04.</pre>
</div>
<div class="highlight-python"><pre>g4pb:materials blyth$ grep opticalsurface g4_00.dae.2
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearPoolCoverSurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/AdDetails/AdSurfacesAll/RSOilSurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="0" model="1" name="/dd/Geometry/AdDetails/AdSurfacesAll/ESRAirSurfaceTop" type="0" value="0"/&gt;
    &lt;opticalsurface finish="0" model="1" name="/dd/Geometry/AdDetails/AdSurfacesAll/ESRAirSurfaceBot" type="0" value="0"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/AdDetails/AdSurfacesAll/SSTOilSurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/AdDetails/AdSurfacesAll/AdCableTraySurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/AdDetails/AdSurfacesNear/SSTWaterSurfaceNear1" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/AdDetails/AdSurfacesNear/SSTWaterSurfaceNear2" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/PmtMtTopRingSurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/PmtMtBaseRingSurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/PmtMtRib1Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/PmtMtRib2Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/PmtMtRib3Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/LegInIWSTubSurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/TablePanelSurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/SupportRib1Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/SupportRib5Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/SlopeRib1Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/SlopeRib5Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/ADVertiCableTraySurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/ShortParCableTraySurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearInnInPiperSurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearInnOutPiperSurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearIWSCurtainSurface" type="0" value="0.2"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/LegInOWSTubSurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/NearPoolSurfaces/UnistrutRib6Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/NearPoolSurfaces/UnistrutRib7Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/UnistrutRib3Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/UnistrutRib5Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/UnistrutRib4Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/UnistrutRib1Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/UnistrutRib2Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/UnistrutRib8Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/UnistrutRib9Surface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/NearPoolSurfaces/TopShortCableTraySurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/TopCornerCableTraySurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/VertiCableTraySurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearOutInPiperSurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearOutOutPiperSurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearOWSLinerSurface" type="0" value="0.2"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/PoolSurfacesAll/LegInDeadTubSurface" type="0" value="1"/&gt;
    &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearDeadLinerSurface" type="0" value="0.2"/&gt;
g4pb:materials blyth$</pre>
</div>
<p>Need to find new position inside extra, tacked under geometries is no good:</p>
<div class="highlight-python"><pre>1648         &lt;/extra&gt;
1649       &lt;/mesh&gt;
1650     &lt;/geometry&gt;
1651     &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearPoolCoverSurface" type="0" value="1"/&gt;
1652     &lt;geometry id="RPCStrip0xb62fda0" name="RPCStrip0xb62fda0"&gt;
1653       &lt;mesh&gt;
1654         &lt;source id="RPCStrip0xb62fda0-Pos"&gt;
1655           &lt;float_array count="24" id="RPCStrip0xb62fda0-Pos-array"&gt;
1656                 -1040 -130 -1</pre>
</div>
<div class="highlight-python"><pre>157517         &lt;instance_node url="#__dd__Geometry__Sites__lvNearSiteRock0xb6131d8"/&gt;
157518         &lt;extra&gt;
157519           &lt;meta id="/dd/Structure/Sites/db-rock0xbeebd90"&gt;
157520             &lt;copyNo&gt;1000&lt;/copyNo&gt;
157521             &lt;ModuleName&gt;&lt;/ModuleName&gt;
157522           &lt;/meta&gt;
157523         &lt;/extra&gt;
157524       &lt;/node&gt;
157525     &lt;/node&gt;
157526     &lt;skinsurface name="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearPoolCoverSurface" surfaceproperty="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearPoolCoverSurface"&gt;
157527       &lt;volumeref ref="/dd/Geometry/PoolDetails/lvNearTopCover0xb8a6408"/&gt;
157528     &lt;/skinsurface&gt;
157529     &lt;skinsurface name="/dd/Geometry/AdDetails/AdSurfacesAll/RSOilSurface" surfaceproperty="/dd/Geometry/AdDetails/AdSurfacesAll/RSOilSurface"&gt;
157530       &lt;volumeref ref="/dd/Geometry/AdDetails/lvRadialShieldUnit0xb9b5ef0"/&gt;
157531     &lt;/skinsurface&gt;
157532     &lt;skinsurface name="/dd/Geometry/AdDetails/AdSurfacesAll/AdCableTraySurface" surfaceproperty="/dd/Geometry/AdDetails/AdSurfacesAll/AdCableTraySurface"&gt;
157533       &lt;volumeref ref="/dd/Geometry/AdDetails/lvAdVertiCableTray0xba34d38"/&gt;
157534     &lt;/skinsurface&gt;
157535     &lt;skinsurface name="/dd/Geometry/PoolDetails/PoolSurfacesAll/PmtMtTopRingSurface" surfaceproperty="/dd/Geometry/PoolDetails/PoolSurfacesAll/PmtMtTopRingSurface"&gt;
157536       &lt;volumeref ref="/dd/Geometry/PMT/lvPmtTopRing0xba4f460"/&gt;
157537     &lt;/skinsurface&gt;



157622     &lt;skinsurface name="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearOutOutPiperSurface" surfaceproperty="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearOutOutPiperSurface"&gt;
157623       &lt;volumeref ref="/dd/Geometry/PoolDetails/lvOutOutWaterPipeNearTub0xbee65d0"/&gt;
157624     &lt;/skinsurface&gt;
157625     &lt;skinsurface name="/dd/Geometry/PoolDetails/PoolSurfacesAll/LegInDeadTubSurface" surfaceproperty="/dd/Geometry/PoolDetails/PoolSurfacesAll/LegInDeadTubSurface"&gt;
157626       &lt;volumeref ref="/dd/Geometry/PoolDetails/lvLegInDeadTub0xbee6630"/&gt;
157627     &lt;/skinsurface&gt;

157628     &lt;bordersurface name="/dd/Geometry/AdDetails/AdSurfacesAll/ESRAirSurfaceTop" surfaceproperty="/dd/Geometry/AdDetails/AdSurfacesAll/ESRAirSurfaceTop"&gt;
157629       &lt;physvolref ref="/dd/Geometry/AdDetails/lvTopReflector#pvTopRefGap0xb6d81c8"/&gt;
157630       &lt;physvolref ref="/dd/Geometry/AdDetails/lvTopRefGap#pvTopESR0xb657cf0"/&gt;
157631     &lt;/bordersurface&gt;
157632     &lt;bordersurface name="/dd/Geometry/AdDetails/AdSurfacesAll/ESRAirSurfaceBot" surfaceproperty="/dd/Geometry/AdDetails/AdSurfacesAll/ESRAirSurfaceBot"&gt;
157633       &lt;physvolref ref="/dd/Geometry/AdDetails/lvBotReflector#pvBotRefGap0xb57a378"/&gt;
157634       &lt;physvolref ref="/dd/Geometry/AdDetails/lvBotRefGap#pvBotESR0xb95ad38"/&gt;
157635     &lt;/bordersurface&gt;
157636     &lt;bordersurface name="/dd/Geometry/AdDetails/AdSurfacesAll/SSTOilSurface" surfaceproperty="/dd/Geometry/AdDetails/AdSurfacesAll/SSTOilSurface"&gt;
157637       &lt;physvolref ref="/dd/Geometry/AD/lvSST#pvOIL0xb579938"/&gt;
157638       &lt;physvolref ref="/dd/Geometry/AD/lvADE#pvSST0xb6aff00"/&gt;
157639     &lt;/bordersurface&gt;
157640     &lt;bordersurface name="/dd/Geometry/AdDetails/AdSurfacesNear/SSTWaterSurfaceNear1" surfaceproperty="/dd/Geometry/AdDetails/AdSurfacesNear/SSTWaterSurfaceNear1"&gt;
157641       &lt;physvolref ref="/dd/Geometry/Pool/lvNearPoolIWS#pvNearADE10xb5a95a8"/&gt;
157642       &lt;physvolref ref="/dd/Geometry/AD/lvADE#pvSST0xb6aff00"/&gt;
157643     &lt;/bordersurface&gt;
157644     &lt;bordersurface name="/dd/Geometry/AdDetails/AdSurfacesNear/SSTWaterSurfaceNear2" surfaceproperty="/dd/Geometry/AdDetails/AdSurfacesNear/SSTWaterSurfaceNear2"&gt;
157645       &lt;physvolref ref="/dd/Geometry/Pool/lvNearPoolIWS#pvNearADE20xb5ad858"/&gt;
157646       &lt;physvolref ref="/dd/Geometry/AD/lvADE#pvSST0xb6aff00"/&gt;
157647     &lt;/bordersurface&gt;
157648     &lt;bordersurface name="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearIWSCurtainSurface" surfaceproperty="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearIWSCurtainSurface"&gt;
157649       &lt;physvolref ref="/dd/Geometry/Pool/lvNearPoolCurtain#pvNearPoolIWS0xb914f38"/&gt;
157650       &lt;physvolref ref="/dd/Geometry/Pool/lvNearPoolOWS#pvNearPoolCurtain0xb9a79d0"/&gt;
157651     &lt;/bordersurface&gt;
157652     &lt;bordersurface name="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearOWSLinerSurface" surfaceproperty="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearOWSLinerSurface"&gt;
157653       &lt;physvolref ref="/dd/Geometry/Pool/lvNearPoolLiner#pvNearPoolOWS0xbe81770"/&gt;
157654       &lt;physvolref ref="/dd/Geometry/Pool/lvNearPoolDead#pvNearPoolLiner0xb6772a0"/&gt;
157655     &lt;/bordersurface&gt;
157656     &lt;bordersurface name="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearDeadLinerSurface" surfaceproperty="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearDeadLinerSurface"&gt;
157657       &lt;physvolref ref="/dd/Geometry/Sites/lvNearHallBot#pvNearPoolDead0xb56ff90"/&gt;
157658       &lt;physvolref ref="/dd/Geometry/Pool/lvNearPoolDead#pvNearPoolLiner0xb6772a0"/&gt;
157659     &lt;/bordersurface&gt;
157660   &lt;/library_nodes&gt;</pre>
</div>
</div>
<div class="section" id="properties-too">
<h3>properties too<a class="headerlink" href="#properties-too" title="Permalink to this headline">¶</a></h3>
<p>Added properties inside the opticalsurface element:</p>
<div class="highlight-python"><pre>1650     &lt;/geometry&gt;
1651     &lt;opticalsurface finish="3" model="1" name="/dd/Geometry/PoolDetails/NearPoolSurfaces/NearPoolCoverSurface" type="0" value="1"&gt;
1652       &lt;matrix coldim="2" name="REFLECTIVITY0xadabaa8" values="1.5e-06 0 6.5e-06 0"/&gt;
1653       &lt;property name="REFLECTIVITY" ref="REFLECTIVITY0xadabaa8"/&gt;
1654       &lt;matrix coldim="2" name="RINDEX0xadabc88" values="1.5e-06 0 6.5e-06 0"/&gt;
1655       &lt;property name="RINDEX" ref="RINDEX0xadabc88"/&gt;
1656     &lt;/opticalsurface&gt;
1657     &lt;geometry id="RPCStrip0xa4c5e20" name="RPCStrip0xa4c5e20"&gt;
1658       &lt;mesh&gt;
1659         &lt;source id="RPCStrip0xa4c5e20-Pos"&gt;
1660           &lt;float_array count="24" id="RPCStrip0xa4c5e20-Pos-array"&gt;
1661                 -1040 -130 -1
1662                 1040 -130 -1</pre>
</div>
</div>
<div class="section" id="how-to-position-the-elements-inside-dae-extra">
<h3>how to position the elements inside DAE extra<a class="headerlink" href="#how-to-position-the-elements-inside-dae-extra" title="Permalink to this headline">¶</a></h3>
<p>For material properties, its obvious what to do:</p>
<div class="highlight-python"><pre>70543   &lt;library_materials&gt;
70544     &lt;material id="__dd__Materials__PPE0xa543b68"&gt;
70545       &lt;instance_effect url="#__dd__Materials__PPE_fx_0xa543b68"/&gt;
70546       &lt;extra&gt;
70547         &lt;matrix coldim="2" name="ABSLENGTH0xa49fcb8" values="1.55e-06 0.001 6.2e-06 0.001 1.033e-05 0.001 1.55e-05 0.001"/&gt;
70548         &lt;property name="ABSLENGTH" ref="ABSLENGTH0xa49fcb8"/&gt;
70549       &lt;/extra&gt;
70550     &lt;/material&gt;</pre>
</div>
<p>Not so obvious for bordersurface or skinsurface, which reference one or two volumes and an opticalsurface element.</p>
</div>
</div>
<div class="section" id="completeness">
<h2>Completeness ?<a class="headerlink" href="#completeness" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>191   &lt;!-- Radial shield with Oil --&gt;
192   &lt;tabproperty name="RSOilReflectivity"
193                type="REFLECTIVITY"
194                xunit="eV"
195                yunit=""
196                xaxis="Energy"
197                yaxis="Reflectivity"&gt;
198     1.55 0.0393
199     1.771 0.0393
200     2.066 0.0394
201     2.480 0.03975
202     2.755 0.04045
203     3.010 0.04135
204     3.542 0.0432
205     4.133 0.04655
206     4.959 0.0538
207     6.20 0.067
208     10.33 0.114
209     15.5 0.173
210   &lt;/tabproperty&gt;
211</pre>
</div>
<div class="sidebar">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../surfaces/" title="surfaces"
             >next</a> |</li>
        <li class="right" >
          <a href="../" title="materials"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../" >geant4</a> &raquo;</li>
          <li><a href="../../" >Geant4 Geometry Export</a> &raquo;</li>
          <li><a href="../" >materials</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>