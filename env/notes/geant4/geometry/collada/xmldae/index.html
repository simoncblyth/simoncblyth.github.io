<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>XMLDAE : raw G4DAE node structure &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../../../" />
    <link rel="up" title="Geant4 Geometry in Collada" href="../" />
    <link rel="next" title="PyCOLLADA Internals" href="../pycollada_internals/" />
    <link rel="prev" title="Planning Geant4 Collada Exporter" href="../export/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../pycollada_internals/" title="PyCOLLADA Internals"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../export/" title="Planning Geant4 Collada Exporter"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../" >geant4</a> &raquo;</li>
          <li><a href="../../" >Geant4 Geometry Export</a> &raquo;</li>
          <li><a href="../" accesskey="U">Geant4 Geometry in Collada</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pycuda/">pycuda</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../">geant4</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../release_notes/">Geant4 Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../geant4_gpu/">Geant4 GPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../geant4_profiling/">Geant4 Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../release_notes/">Geant4 Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../verbosity/">Verbosity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../docs/">Geant4 Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../giga/">GiGa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/">Geant4 API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../opticalphoton/">Geant4 Optical Photon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../processes/">Geant4 Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../medical/">Medical Communities Using Geant4 (esp. optical photon)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../">Geant4 Geometry Export</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../g4py/">g4py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../nuwa/">nuwa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../event/">Geant4 Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../geant4_future_doe/">Geant4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../geant4_multi_threading/">Geant4 Multi Threading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hg/">hg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../simoncblyth.bitbucket.org/">simoncblyth.bitbucket.org</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../numpy/">numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../presentation/">Muon Simulation Presentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../optix/">optix</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../../_sources/geant4/geometry/collada/xmldae.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../export/"
                        title="previous chapter">Planning Geant4 Collada Exporter</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../pycollada_internals/"
                        title="next chapter">PyCOLLADA Internals</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="xmldae-raw-g4dae-node-structure">
<h1>XMLDAE : raw G4DAE node structure<a class="headerlink" href="#xmldae-raw-g4dae-node-structure" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#questions" id="id1">Questions</a><ul>
<li><a class="reference internal" href="#reversible-char-swaps" id="id2">Reversible Char Swaps</a></li>
</ul>
</li>
<li><a class="reference internal" href="#raw-node-tree" id="id3">Raw Node Tree</a></li>
<li><a class="reference internal" href="#compare-daenames-with-wrlnames-tracing-the-id" id="id4">Compare daenames with wrlnames : tracing the id</a></li>
</ul>
</div>
<div class="section" id="questions">
<h2><a class="toc-backref" href="#id1">Questions</a><a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Would the xml documument ids be unique without the pointers 0x.... ?<ul>
<li>checking the .gdml there are dupes in the subtraction/union solids and between element/material names
see ~/e/tools/checkxml.py</li>
<li>checking the GDML writing on which the DAE writing is based,  there is currently only a global addPointerToName
switch so cannot easily turn it off for volumes and not for solids as would break references to solids</li>
</ul>
</li>
<li>Can I reproduce VRML2 output from the DAE ? As a validation of all those transformations and everything else.<ul>
<li>PV count now matches</li>
<li>PV name matching, the NCName IDref XML restriction forced replacing 3 chars &#8221;:/#&#8221; with  &#8220;_&#8221;<ul>
<li>that is difficult to reverse, need some more unused acceptable chars (single chars would be best)</li>
<li>iterating on dae-edit;dae-validate find that &#8221;.&#8221; and &#8220;-&#8221; are acceptable on other than the first char</li>
<li><a class="reference external" href="http://www.schemacentral.com/sc/xsd/t-xsd_NCName.html">http://www.schemacentral.com/sc/xsd/t-xsd_NCName.html</a></li>
<li><a class="reference external" href="http://stackoverflow.com/questions/1631396/what-is-an-xsncname-type-and-when-should-it-be-used">http://stackoverflow.com/questions/1631396/what-is-an-xsncname-type-and-when-should-it-be-used</a></li>
<li><a class="reference external" href="http://docs.marklogic.com/xdmp:encode-for-NCName">http://docs.marklogic.com/xdmp:encode-for-NCName</a></li>
<li><a class="reference external" href="http://www.google.com/search?q=NCName encoding decoding">google:NCName encoding decoding</a></li>
<li><a class="reference external" href="https://nees.org/tools/vees/browser/xerces/src/xercesc/util/XMLString.cpp">https://nees.org/tools/vees/browser/xerces/src/xercesc/util/XMLString.cpp</a></li>
<li><a class="reference external" href="http://msdn.microsoft.com/en-us/library/system.xml.xmlconvert.aspx">http://msdn.microsoft.com/en-us/library/system.xml.xmlconvert.aspx</a></li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>TODO:<ul>
<li>add checkxml.py collection of all id characters to see if &#8221;.&#8221; is used</li>
</ul>
</li>
</ul>
</div></blockquote>
<div class="section" id="reversible-char-swaps">
<h3><a class="toc-backref" href="#id2">Reversible Char Swaps</a><a class="headerlink" href="#reversible-char-swaps" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>/  -&gt;   _
:  -&gt;   -      (colon always precedes digits eg :1 )
#  -&gt;   .</pre>
</div>
<p>The only &#8216;-&#8216; containg names that beings with &#8216;/&#8217;:</p>
<div class="highlight-python"><pre>/dd/Structure/Sites/db-rock0xc633af8
/dd/Structure/Sites/db-rock0xc633af8_pos
/dd/Structure/Sites/db-rock0xc633af8_rot</pre>
</div>
</div>
</div>
<div class="section" id="raw-node-tree">
<h2><a class="toc-backref" href="#id3">Raw Node Tree</a><a class="headerlink" href="#raw-node-tree" title="Permalink to this headline">¶</a></h2>
<p>Raw Node tree has the lv as well as pv, wherese VRML2 tree has only pv ?</p>
<ul class="simple">
<li>the raw collada node tree triples the Geant4 volume tree nodes into a regular PPV/LV/GEO per volume structure</li>
</ul>
<div class="highlight-python"><pre>simon:~ blyth$ xmldae.py -w -i 0,100 -z 9
2013-10-10 16:34:03,580 env.geant4.geometry.collada.xmldae INFO     /Users/blyth/env/bin/xmldae.py -w -i 0,100 -z 9
2013-10-10 16:34:03,583 env.geant4.geometry.collada.xmldae INFO     reading /usr/local/env/geant4/geometry/xdae/g4_01.dae
2013-10-10 16:34:03,840 env.geant4.geometry.collada.xmldae INFO     create_tree starting from root #World0xad7b048
2013-10-10 16:34:03,951 env.geant4.geometry.collada.xmldae INFO     collect_xmlcache found 5892 nodes
2013-10-10 16:34:34,411 env.geant4.geometry.collada.xmldae INFO     create_tree completed from root
registry 24459
xmlcache 5892
effect: 36
material: 36
geometry: 249
scene: 1
rooturl: #World0xad7b048
2013-10-10 16:34:34,415 env.geant4.geometry.collada.xmldae INFO     walk starting from root   0    World0xad7b048.0                                                                                      1    tgt:_dd_Materials_Vacuum0x8b746a0  ref:None matrix:None
0 0 World0xad7b048.0
1 1 _dd_Structure_Sites_db-rock0xad7b188.0
2 2 _dd_Geometry_Sites_lvNearSiteRock0xad7af08.0
3 3 _dd_Geometry_Sites_lvNearSiteRock_pvNearHallTop0xad7ad70.0
4 4 _dd_Geometry_Sites_lvNearHallTop0xabc3670.0
5 5 _dd_Geometry_Sites_lvNearHallTop_pvNearTopCover0xabc3390.0
6 6 _dd_Geometry_PoolDetails_lvNearTopCover0xabaffe8.0
5 7 _dd_Geometry_Sites_lvNearHallTop_pvNearTeleRpc_pvNearTeleRpc_10xabc36c8.0
6 8 _dd_Geometry_RPC_lvRPCMod0xabb1b80.0
7 9 _dd_Geometry_RPC_lvRPCMod_pvRPCFoam0xabb1b48.0
8 10 _dd_Geometry_RPC_lvRPCFoam0xabb1778.0
5 91 _dd_Geometry_Sites_lvNearHallTop_pvNearTeleRpc_pvNearTeleRpc_20xabc3800.0
6 92 _dd_Geometry_RPC_lvRPCMod0xabb1b80.1
7 93 _dd_Geometry_RPC_lvRPCMod_pvRPCFoam0xabb1b48.1
8 94 _dd_Geometry_RPC_lvRPCFoam0xabb1778.1


sqlite&gt; select count(*) from shape ;
count(*)
---------------------------------------------------------------------------------------------
12229</pre>
</div>
<div class="highlight-python"><pre>116851     &lt;node id="World0xad7b048"&gt;
116852       &lt;instance_geometry url="#WorldBox0xabaff60"&gt;
116853         &lt;bind_material&gt;
116854           &lt;technique_common&gt;
116855             &lt;instance_material symbol="WHITE" target="#_dd_Materials_Vacuum0x8b746a0"/&gt;
116856           &lt;/technique_common&gt;
116857         &lt;/bind_material&gt;
116858       &lt;/instance_geometry&gt;
116859       &lt;node id="_dd_Structure_Sites_db-rock0xad7b188"&gt;
116860         &lt;matrix&gt;
116861                 -0.543174 0.83962 0 -16520
116862 -0.83962 -0.543174 0 -802110
116863 0 0 1 -2110
116864 0.0 0.0 0.0 1.0
116865 &lt;/matrix&gt;
116866         &lt;instance_node url="#_dd_Geometry_Sites_lvNearSiteRock0xad7af08"/&gt;
116867       &lt;/node&gt;
116868     &lt;/node&gt;


116824     &lt;node id="_dd_Geometry_Sites_lvNearSiteRock0xad7af08"&gt;    ########### LV OMITTED FROM THE VRML2 SHAPE LIST
116825       &lt;instance_geometry url="#near_rock0xabafe30"&gt;
116826         &lt;bind_material&gt;
116827           &lt;technique_common&gt;
116828             &lt;instance_material symbol="WHITE" target="#_dd_Materials_Rock0x8b58188"/&gt;
116829           &lt;/technique_common&gt;
116830         &lt;/bind_material&gt;
116831       &lt;/instance_geometry&gt;
116832       &lt;node id="_dd_Geometry_Sites_lvNearSiteRock_pvNearHallTop0xad7ad70"&gt;    #### PV INCLUDED IN VRML2
116833         &lt;matrix&gt;
116834                 1 0 0 2500
116835 0 1 0 -500
116836 0 0 1 7500
116837 0.0 0.0 0.0 1.0
116838 &lt;/matrix&gt;
116839         &lt;instance_node url="#_dd_Geometry_Sites_lvNearHallTop0xabc3670"/&gt;
116840       &lt;/node&gt;
116841       &lt;node id="_dd_Geometry_Sites_lvNearSiteRock_pvNearHallBot0xad7b0b0"&gt;    #### SIBLING PV INCLUDED IN VRML2
116842         &lt;matrix&gt;
116843                 1 0 0 0
116844 0 1 0 0
116845 0 0 1 -5150
116846 0.0 0.0 0.0 1.0
116847 &lt;/matrix&gt;
116848         &lt;instance_node url="#_dd_Geometry_Sites_lvNearHallBot0xad7a618"/&gt;
116849       &lt;/node&gt;
116850     &lt;/node&gt;</pre>
</div>
<p>Looks to be a pattern that the LV referenced by instance_node are skipped in the VRML2 list.</p>
<blockquote>
<div><ul class="simple">
<li>yes, the VRML2 has just the PV</li>
</ul>
</div></blockquote>
<div class="highlight-python"><pre>sqlite&gt; select id, name from shape where name like '/dd/Geometry/Sites/lvNearSiteRock%' ;
id          name
----------  ---------------------------------------------------------------------------------------------
2           /dd/Geometry/Sites/lvNearSiteRock#pvNearHallTop.1000
3147        /dd/Geometry/Sites/lvNearSiteRock#pvNearHallBot.1001
sqlite&gt;</pre>
</div>
<div class="highlight-python"><pre>sqlite&gt; select id, name from shape where name like '/dd/Geometry/Sites/lvNearHall%' ;
id          name
----------  ---------------------------------------------------------------------------------------------
3           /dd/Geometry/Sites/lvNearHallTop#pvNearTopCover.1000
4           /dd/Geometry/Sites/lvNearHallTop#pvNearTeleRpc#pvNearTeleRpc:1.1
46          /dd/Geometry/Sites/lvNearHallTop#pvNearTeleRpc#pvNearTeleRpc:2.2
88          /dd/Geometry/Sites/lvNearHallTop#pvNearRPCRoof.1003
2357        /dd/Geometry/Sites/lvNearHallTop#pvNearRPCSptRoof.1004
3148        /dd/Geometry/Sites/lvNearHallBot#pvNearPoolDead.1000
12221       /dd/Geometry/Sites/lvNearHallBot#pvNearHallRadSlabs#pvNearHallRadSlab1.1001
12222       /dd/Geometry/Sites/lvNearHallBot#pvNearHallRadSlabs#pvNearHallRadSlab2.1002
12223       /dd/Geometry/Sites/lvNearHallBot#pvNearHallRadSlabs#pvNearHallRadSlab3.1003
12224       /dd/Geometry/Sites/lvNearHallBot#pvNearHallRadSlabs#pvNearHallRadSlab4.1004
12225       /dd/Geometry/Sites/lvNearHallBot#pvNearHallRadSlabs#pvNearHallRadSlab5.1005
12226       /dd/Geometry/Sites/lvNearHallBot#pvNearHallRadSlabs#pvNearHallRadSlab6.1006
12227       /dd/Geometry/Sites/lvNearHallBot#pvNearHallRadSlabs#pvNearHallRadSlab7.1007
12228       /dd/Geometry/Sites/lvNearHallBot#pvNearHallRadSlabs#pvNearHallRadSlab8.1008
12229       /dd/Geometry/Sites/lvNearHallBot#pvNearHallRadSlabs#pvNearHallRadSlab9.1009
sqlite&gt;</pre>
</div>
</div>
<div class="section" id="compare-daenames-with-wrlnames-tracing-the-id">
<h2><a class="toc-backref" href="#id4">Compare daenames with wrlnames : tracing the id</a><a class="headerlink" href="#compare-daenames-with-wrlnames-tracing-the-id" title="Permalink to this headline">¶</a></h2>
<p>Succeed to match the bases, but not the <cite>.1001</cite> extensions:</p>
<div class="highlight-python"><pre>echo "select rtrim(substr(name,0,instr(name,'.'))) from shape ;" | sqlite3 -noheader $(shapedb-path) &gt; wrlnames.txt
cat wrlnames.txt | cut -d" " -f1 &gt; wrlnames.cut.txt    # get rid of bizarre whitespace padding
diff wrlnames.cut.txt daenames.txt   # they match</pre>
</div>
<p>The WRL names, are actually coming from <cite>G4PhysicalVolumeModel::GetCurrentTag</cite></p>
<p>external/build/LCG/geant4.9.2.p01/source/visualization/VRML/src/G4VRML2SceneHandlerFunc.icc:</p>
<div class="highlight-python"><pre>182     // Current Model
183     const G4VModel* pv_model  = GetModel();
184     G4String pv_name = "No model";
185         if (pv_model) pv_name = pv_model-&gt;GetCurrentTag() ;
186
187     // VRML codes are generated below
188
189     fDest &lt;&lt; "#---------- SOLID: " &lt;&lt; pv_name &lt;&lt; "\n";</pre>
</div>
<p>external/build/LCG/geant4.9.2.p01/source/visualization/modeling/include/G4VModel.hh:</p>
<div class="highlight-python"><pre>74   virtual G4String GetCurrentTag () const;
75   // A tag which depends on the current state of the model.</pre>
</div>
<div class="highlight-python"><pre>[blyth@cms01 source]$ find . -name '*.hh' -exec grep -H GetCurrentTag {} \;
./visualization/modeling/include/G4PhysicalVolumeModel.hh:  G4String GetCurrentTag () const;
./visualization/modeling/include/G4VModel.hh:  virtual G4String GetCurrentTag () const;</pre>
</div>
<p>external/build/LCG/geant4.9.2.p01/source/visualization/modeling/include/G4PhysicalVolumeModel.hh:</p>
<div class="highlight-python"><pre>67 class G4PhysicalVolumeModel: public G4VModel {
68
69 public: // With description
70
71   enum {UNLIMITED = -1};
72
73   enum ClippingMode {subtraction, intersection};
74
75   class G4PhysicalVolumeNodeID {
76   public:
77     G4PhysicalVolumeNodeID
78     (G4VPhysicalVolume* pPV = 0, G4int iCopyNo = 0, G4int depth = 0):
79       fpPV(pPV), fCopyNo(iCopyNo), fNonCulledDepth(depth) {}
80     G4VPhysicalVolume* GetPhysicalVolume() const {return fpPV;}
81     G4int GetCopyNo() const {return fCopyNo;}
82     G4int GetNonCulledDepth() const {return fNonCulledDepth;}
83     G4bool operator&lt; (const G4PhysicalVolumeNodeID&amp; right) const;
84   private:
85     G4VPhysicalVolume* fpPV;
86     G4int fCopyNo;
87     G4int fNonCulledDepth;
88   };
89   // Nested class for identifying physical volume nodes.
...
205   G4VPhysicalVolume* fpCurrentPV;    // Current physical volume.</pre>
</div>
<p>Suspect the CopyNo should hail from:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">geometry</span><span class="o">/</span><span class="n">volumes</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">G4PVPlacement</span><span class="o">.</span><span class="n">cc</span>
<span class="n">geometry</span><span class="o">/</span><span class="n">volumes</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">G4PVPlacement</span><span class="o">.</span><span class="n">hh</span>
</pre></div>
</div>
<p>G4PhysicalVolumeNodeID:</p>
<div class="highlight-python"><pre>[blyth@cms01 source]$ find . -name '*.cc' -exec grep -H G4PhysicalVolumeNodeID {} \;
./visualization/modeling/src/G4PhysicalVolumeModel.cc:G4bool G4PhysicalVolumeModel::G4PhysicalVolumeNodeID::operator&lt;
./visualization/modeling/src/G4PhysicalVolumeModel.cc:  (const G4PhysicalVolumeModel::G4PhysicalVolumeNodeID&amp; right) const
./visualization/modeling/src/G4PhysicalVolumeModel.cc:  (std::ostream&amp; os, const G4PhysicalVolumeModel::G4PhysicalVolumeNodeID node)
./visualization/modeling/src/G4PhysicalVolumeModel.cc:    (G4PhysicalVolumeNodeID(fpCurrentPV,copyNo,fCurrentDepth));
./visualization/modeling/src/G4PhysicalVolumeModel.cc:      (G4PhysicalVolumeNodeID(fpCurrentPV,copyNo,fCurrentDepth));
./visualization/Tree/src/G4ASCIITreeSceneHandler.cc:  typedef G4PhysicalVolumeModel::G4PhysicalVolumeNodeID PVNodeID;
./visualization/Tree/src/G4VTreeSceneHandler.cc:  typedef G4PhysicalVolumeModel::G4PhysicalVolumeNodeID PVNodeID;
./visualization/HepRep/src/G4HepRepFileSceneHandler.cc:                 typedef G4PhysicalVolumeModel::G4PhysicalVolumeNodeID PVNodeID;
./visualization/XXX/src/G4XXXSGSceneHandler.cc:    typedef G4PhysicalVolumeModel::G4PhysicalVolumeNodeID PVNodeID;
./visualization/OpenInventor/src/G4OpenInventorSceneHandler.cc:    typedef G4PhysicalVolumeModel::G4PhysicalVolumeNodeID PVNodeID;
[blyth@cms01 source]$</pre>
</div>
<p>PVPath:</p>
<div class="highlight-python"><pre>[blyth@cms01 source]$ find . -name '*.cc' -exec grep -l PVPath {} \;
./visualization/modeling/src/G4PhysicalVolumeModel.cc
./visualization/Tree/src/G4ASCIITreeSceneHandler.cc
./visualization/Tree/src/G4VTreeSceneHandler.cc
./visualization/HepRep/src/G4HepRepFileSceneHandler.cc
./visualization/XXX/src/G4XXXSGSceneHandler.cc
./visualization/OpenInventor/src/G4OpenInventorSceneHandler.cc</pre>
</div>
<p>external/build/LCG/geant4.9.2.p01/source/visualization/modeling/src/G4PhysicalVolumeModel.cc:</p>
<div class="highlight-python"><pre>181 G4String G4PhysicalVolumeModel::GetCurrentTag () const
182 {
183   if (fpCurrentPV) {
184     std::ostringstream o;
185     o &lt;&lt; fpCurrentPV -&gt; GetCopyNo ();
186     return fpCurrentPV -&gt; GetName () + "." + o.str();
187   }
188   else {
189     return "WARNING: NO CURRENT VOLUME - global tag is " + fGlobalTag;
190   }
191 }</pre>
</div>
<div class="sidebar">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../pycollada_internals/" title="PyCOLLADA Internals"
             >next</a> |</li>
        <li class="right" >
          <a href="../export/" title="Planning Geant4 Collada Exporter"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../" >geant4</a> &raquo;</li>
          <li><a href="../../" >Geant4 Geometry Export</a> &raquo;</li>
          <li><a href="../" >Geant4 Geometry in Collada</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>