<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>g4daeview.py &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../../../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../../../../" />
    <link rel="up" title="g4daeview" href="../" />
    <link rel="next" title="G4DAEView Chroma" href="../g4daeview_chroma/" />
    <link rel="prev" title="G4DAE and G4DAEVIEW Development History" href="../g4daeview_history/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../g4daeview_chroma/" title="G4DAEView Chroma"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../g4daeview_history/" title="G4DAE and G4DAEVIEW Development History"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../../" >geant4</a> &raquo;</li>
          <li><a href="../../../" >Geant4 Geometry Export</a> &raquo;</li>
          <li><a href="../../" >Geant4 Geometry in Collada</a> &raquo;</li>
          <li><a href="../" accesskey="U">g4daeview</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../pycuda/">pycuda</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../">geant4</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../release_notes/">Geant4 Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../geant4_gpu/">Geant4 GPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../geant4_profiling/">Geant4 Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../release_notes/">Geant4 Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../verbosity/">Verbosity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/">Geant4 Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../giga/">GiGa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api/">Geant4 API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../opticalphoton/">Geant4 Optical Photon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../processes/">Geant4 Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../medical/">Medical Communities Using Geant4 (esp. optical photon)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../">Geant4 Geometry Export</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../g4py/">g4py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../nuwa/">nuwa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../event/">Geant4 Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../geant4_future_doe/">Geant4</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../hg/">hg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../simoncblyth.bitbucket.org/">simoncblyth.bitbucket.org</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../../../_sources/geant4/geometry/collada/g4daeview/g4daeview_usage.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../g4daeview_history/"
                        title="previous chapter">G4DAE and G4DAEVIEW Development History</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../g4daeview_chroma/"
                        title="next chapter">G4DAEView Chroma</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="g4daeview-py">
<h1>g4daeview.py<a class="headerlink" href="#g4daeview-py" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#usage-tips" id="id2">Usage Tips</a></li>
<li><a class="reference internal" href="#usage-text" id="id3">Usage text</a></li>
<li><a class="reference internal" href="#receive-chromaphotonlist-from-remote-geant4" id="id4">Receive ChromaPhotonList from Remote Geant4</a></li>
<li><a class="reference internal" href="#load-save-chromaphotonlist" id="id5">Load/Save ChromaPhotonList</a></li>
<li><a class="reference internal" href="#screen-captures-and-apache-publishing" id="id6">Screen Captures and apache publishing</a></li>
<li><a class="reference internal" href="#grab-screen-captures-including-glut-menus" id="id7">Grab Screen Captures including GLUT menus</a></li>
<li><a class="reference internal" href="#partial-geometry" id="id8">Partial geometry</a></li>
<li><a class="reference internal" href="#target-mode" id="id9">Target Mode</a><ul>
<li><a class="reference internal" href="#interactive-target-selection" id="id10">interactive target selection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#near-far-clipping-controls" id="id11">near/far clipping controls</a><ul>
<li><a class="reference internal" href="#issues" id="id12">ISSUES</a></li>
</ul>
</li>
<li><a class="reference internal" href="#solid-picking" id="id13">solid picking</a><ul>
<li><a class="reference internal" href="#todo" id="id14">TODO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#placemarks" id="id15">placemarks</a></li>
<li><a class="reference internal" href="#markers" id="id16">markers</a></li>
<li><a class="reference internal" href="#viewpoint-bookmarks" id="id17">Viewpoint Bookmarks</a><ul>
<li><a class="reference internal" href="#id1" id="id18">ISSUES</a></li>
</ul>
</li>
<li><a class="reference internal" href="#animation" id="id19">Animation</a><ul>
<li><a class="reference internal" href="#interpolate-between-bookmarks" id="id20">interpolate between bookmarks</a></li>
<li><a class="reference internal" href="#orbiting-mode" id="id21">orbiting mode</a></li>
<li><a class="reference internal" href="#animation-control" id="id22">animation control</a></li>
<li><a class="reference internal" href="#photon-propagation-time-control-interactive-and-auto-scanning" id="id23">photon propagation time control : interactive and auto scanning</a></li>
</ul>
</li>
<li><a class="reference internal" href="#remote-control" id="id24">remote control</a></li>
<li><a class="reference internal" href="#raycast-launch-control" id="id25">raycast launch control</a><ul>
<li><a class="reference internal" href="#interactive-switch-to-metric-pixels-presentation" id="id26">interactive switch to metric pixels presentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#screen-capture" id="id27">screen capture</a></li>
<li><a class="reference internal" href="#movie-capture" id="id28">movie capture</a></li>
<li><a class="reference internal" href="#parallel-orthographic-projection" id="id29">Parallel/Orthographic projection</a></li>
<li><a class="reference internal" href="#presentation" id="id30">Presentation</a></li>
</ul>
</div>
<div class="section" id="usage-tips">
<h2><a class="toc-backref" href="#id2">Usage Tips</a><a class="headerlink" href="#usage-tips" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Exit other apps that make heavy use of GPU acceleration whilst running
g4daeview.py (and especially when launching Chroma raycasts)<ul>
<li>Google Chrome snags GPU resources far more that Safari,</li>
<li>Uncheck <cite>Use hardware acceleration when available</cite> in <cite>Chrome &gt; Settings &gt; Advanced Settings [System]</cite></li>
<li>and restart Chrome for it to take effect</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="usage-text">
<h2><a class="toc-backref" href="#id3">Usage text</a><a class="headerlink" href="#usage-text" title="Permalink to this headline">¶</a></h2>
<p>On pressing &#8220;U&#8221; usage text describing the actions of each key
are written to stdout.  (TODO: display to screen)</p>
</div>
<div class="section" id="receive-chromaphotonlist-from-remote-geant4">
<h2><a class="toc-backref" href="#id4">Receive ChromaPhotonList from Remote Geant4</a><a class="headerlink" href="#receive-chromaphotonlist-from-remote-geant4" title="Permalink to this headline">¶</a></h2>
<p>ChromaPhotonList instances are transported using ZMQRoot</p>
<ul class="simple">
<li><a class="reference external" href="http://dayabay.ihep.ac.cn/tracs/dybsvn/browser/dybgaudi/trunk/Utilities/ZMQRoot">http://dayabay.ihep.ac.cn/tracs/dybsvn/browser/dybgaudi/trunk/Utilities/ZMQRoot</a></li>
</ul>
<p><cite>ZMQRoot</cite> package uses ROOT TMessage (de)serialization
and ZeroMQ messaging to implement a simple API:</p>
<div class="highlight-python"><pre>class ZMQRoot {
public:
      ZMQRoot(const char* envvar);
      void SendObject(TObject* obj);
      TObject* ReceiveObject();</pre>
</div>
<p>A three node network topology is currently used:</p>
<dl class="docutils">
<dt><em>client</em></dt>
<dd><cite>nuwa.py/Geant4</cite> process</dd>
<dt><em>worker</em></dt>
<dd><cite>g4daeview.py/Chroma</cite> process</dd>
<dt><em>broker</em></dt>
<dd><cite>zmq_broker.sh</cite> process</dd>
</dl>
<p>Usage steps:</p>
<ul>
<li><p class="first">check if the ZMQ broker is running on belle7, if not launch it:</p>
<div class="highlight-python"><pre>delta:~ blyth$ ssh N
[blyth@belle7 ~]$ pgrep zmq_broker
[blyth@belle7 ~]$ zmq_broker.sh</pre>
</div>
</li>
<li><p class="first">launch the worker, envvar defaults configure connection to broker on belle7:</p>
<div class="highlight-python"><pre>delta:~ blyth$ g4daeview.sh</pre>
</div>
</li>
<li><p class="first">launch the client on belle7:</p>
<div class="highlight-python"><pre>[blyth@belle7 ~]$ which csa.sh   # CSA for ChromaStackAction
~/env/bin/csa.sh
[blyth@belle7 ~]$ csa.sh</pre>
</div>
</li>
</ul>
<p>The <cite>csa.sh</cite> job within its ChromaStackAction collects photons
into a <cite>ChromaPhotonList</cite> and ready for transport with <cite>ZMQRoot</cite>.</p>
</div>
<div class="section" id="load-save-chromaphotonlist">
<h2><a class="toc-backref" href="#id5">Load/Save ChromaPhotonList</a><a class="headerlink" href="#load-save-chromaphotonlist" title="Permalink to this headline">¶</a></h2>
<p>Once a CPL has arrived via ZMQ, it can be saved to file with:</p>
<div class="highlight-python"><pre>delta:~ blyth$ udp.py --save /usr/local/env/tmp/1.root</pre>
</div>
<p>Subsequently can load the root file at launch with:</p>
<div class="highlight-python"><pre>delta:g4daeview blyth$ g4daeview.sh --load /usr/local/env/tmp/1.root</pre>
</div>
<p>Or loading can be done interactively with <cite>udp.py</cite> to change or set the loaded event:</p>
<div class="highlight-python"><pre>delta:~ blyth$ udp.py --load /usr/local/env/tmp/1.root</pre>
</div>
<p>The objects loaded or saved from root files can also have an associated <em>key</em> using
option <cite>&#8211;key WHATEVER</cite> the default key is <strong>CPL</strong>.</p>
<p>Launch arguments only support a single <cite>&#8211;load</cite>, but interactive arguments
support multiple loads allowing multiple objects to be loaded.</p>
<ul class="simple">
<li>TODO: dont replace but concatenate drawing of multiple loaded objects</li>
</ul>
</div>
<div class="section" id="screen-captures-and-apache-publishing">
<h2><a class="toc-backref" href="#id6">Screen Captures and apache publishing</a><a class="headerlink" href="#screen-captures-and-apache-publishing" title="Permalink to this headline">¶</a></h2>
<p>Save any screencaptures directly into apache htdocs using:</p>
<div class="highlight-python"><pre>g4(){
    apache-
    g4daeview.sh --outdir=$(apache-htdocs)/env/geant4/geometry/collada/g4daeview --load 1 $*
}</pre>
</div>
<p>Captures can be remotely invoked using:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">udp</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">screencapture</span>
</pre></div>
</div>
</div>
<div class="section" id="grab-screen-captures-including-glut-menus">
<h2><a class="toc-backref" href="#id7">Grab Screen Captures including GLUT menus</a><a class="headerlink" href="#grab-screen-captures-including-glut-menus" title="Permalink to this headline">¶</a></h2>
<p>The above screencapture techniqies exclude any GLUT menus that are appearing.
To include those use:</p>
<ul class="simple">
<li><cite>Grab.app &gt; Capture &gt; Timed Screen</cite>  screen is captured 10s after starting timer, allowing to prepare menus</li>
<li>the image is opened in Grab.app and can be saved in a <cite>.tiff</cite></li>
</ul>
<p>Subsequently propagate to remote apache with:</p>
<div class="highlight-python"><pre>env-htdocs-rsync C2</pre>
</div>
<p>TODO: adopt config file for settings like outdir (maybe <cite>~/.g4daeview/config.cfg</cite>)</p>
</div>
<div class="section" id="partial-geometry">
<h2><a class="toc-backref" href="#id8">Partial geometry</a><a class="headerlink" href="#partial-geometry" title="Permalink to this headline">¶</a></h2>
<p>Partial geometry can be specified listwise or treewise, for example:</p>
<div class="highlight-python"><pre># listwise
g4daeview.py -p dyb -g 3153:      # skips Universe, rock and RPC, but includes everything in the pool
g4daeview.py -p dyb -g 6473:      # skips the ADs
g4daeview.py -p dyb -g 4:3146     # RPC

# treewise shortform
g4daeview.py -p dyb -g 3147+      #
g4daeview.py -p dyb -g 3152+      # without radslabs
g4daeview.py -p dyb -g 3154-      # includes only SST and nodes beneath that in the tree, ie the contents of SST
g4daeview.py -p dyb -g 4536+ -n2  # children of a volume (calibration dome) excluding the volume itself, near is specified to avoid near clipping

# treewise longform
g4daeview.py -p dyb -g 3154_1.5   # specify min/max recursion depth from the basenode
g4daeview.py -p dyb -g 2_0.0        # just volume 2
g4daeview.py -p dyb -g 2_1.1        # just immediate children of volume 2

# combination form
g4daeview.py -p dyb -g 3153+,4813+
g4daeview.py -p dyb -g 3153_1.2,4813_1.2
g4daeview.py -p dyb -g 3153_0.2,4813_0.2,6473: --with-chroma    # smoke and mirrors, looks like default "3153:" but with much fewer volumes

g4daeview.py -p dyb -g 3153_0.2,4813_0.2,6473: --with-chroma --size 640,480 --launch 1,1,1</pre>
</div>
<p>TIP: to determine node tree indices click on the solids in the viewer and
use daeserver urls like the below to list the tree:</p>
<div class="highlight-python"><pre>http://belle7.nuu.edu.tw/dae/tree/4813___2.txt?ancestors=1</pre>
</div>
<p>The partial geometry specified is also used for Chroma raycasting, which
is a simple way to make raycast rendering faster.</p>
</div>
<div class="section" id="target-mode">
<h2><a class="toc-backref" href="#id9">Target Mode</a><a class="headerlink" href="#target-mode" title="Permalink to this headline">¶</a></h2>
<p>Target mode presents many volumes but targets one by
orienting the initial viewpoint with respect to the target using
units based on the extent of the target and axis directions</p>
<p>Identify target via relative to node list (starting with <cite>+</cite> or <cite>-</cite>) or absolute addressing:</p>
<div class="highlight-python"><pre>g4daeview.py -g 3153:12230 -t -300
g4daeview.py -g 3153:12230 -t +10

   # target relative to the node list

g4daeview.py -g 3153:12230 -t +0       # relative
g4daeview.py -g 3153:12230 -t 3153     # absolute equivalent

g4daeview.py -t +0

   # when using a sensible default node list, this is convenient

g4daeview.py -g 3153:12230 -t 5000 --eye="-2,-2,-2"

   # control the starting eyepoint relative to the target</pre>
</div>
<div class="section" id="interactive-target-selection">
<h3><a class="toc-backref" href="#id10">interactive target selection</a><a class="headerlink" href="#interactive-target-selection" title="Permalink to this headline">¶</a></h3>
<p>Switching target to a volume adjusts the viewpoint to
be close to the volume and looking towards it and also
modifies the center of virtual trackball rotation.
Simply drag around on the trackpad to adjust viewpoint
relative to the target.</p>
<p>To switch target:</p>
<ol class="arabic simple">
<li>hold the Q key whilst clicking on a directly visible volume, beware of
selecting transparent volumes that are infront of the volume you intended</li>
<li>this may result in being closer than intended and near clipping might make
the target invisible<ul>
<li>press N whilst dragging up/down to adjust the near point</li>
<li>press Z whilst dragging down to back off the viewpoint position</li>
</ul>
</li>
<li>optionally to create a bookmark for the viewpoint:<ul>
<li>click again on the target volume whilst pressing a number key not yet
used for a bookmark</li>
</ul>
</li>
</ol>
<p>TODO:</p>
<ol class="arabic simple">
<li>avoid target selection changing viewpoint direction</li>
</ol>
</div>
</div>
<div class="section" id="near-far-clipping-controls">
<h2><a class="toc-backref" href="#id11">near/far clipping controls</a><a class="headerlink" href="#near-far-clipping-controls" title="Permalink to this headline">¶</a></h2>
<p>When you approach too closely to some geometry it will disappear due to
near clipping. Similarly distant geometry can disappear from far clipping.
To control the near/far clipping planes:</p>
<ul class="simple">
<li>press &#8220;N&#8221; while dragging up/down to change &#8220;near&#8221; distance</li>
<li>press &#8220;F&#8221; while dragging up/down to change &#8220;far&#8221; distance</li>
</ul>
<p>To illustrate the viewing frustum (square pyramid chopped at near/far planes
with &#8220;eye&#8221; at the apex) and near/far planes press &#8220;K&#8221; to switch on
markers and trackball away from the view into order to look back
at its frustum. Also change &#8220;near&#8221; and &#8220;far&#8221; to see how that
changes the depth planes.</p>
<div class="section" id="issues">
<h3><a class="toc-backref" href="#id12">ISSUES</a><a class="headerlink" href="#issues" title="Permalink to this headline">¶</a></h3>
<p>Somehow changing &#8220;near&#8221; sometimes acts to change &#8220;far&#8221; clipping.
Possibly this is due to limited depth buffering, the issue
seems less prevalent with less extreme &#8220;near&#8221; and &#8220;far&#8221; values.</p>
</div>
</div>
<div class="section" id="solid-picking">
<h2><a class="toc-backref" href="#id13">solid picking</a><a class="headerlink" href="#solid-picking" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Clicking pixels with mouse/trackpad, yields an (x,y,z) screen position
the z value comes from the depth buffer representing the  position of nearest surface.</li>
<li>An unprojection transforms the screen space coordinate into world space.</li>
<li>This coordinate is then used to determine the list of solids which
contain the point within their bounding box. The solid indices, names and
extents in mm are written to the screen.</li>
<li>The smallest solid is regarded as &#8220;picked&#8221;. Key &#8220;O&#8221; toggles high-lighting
of picked solids with wireframe spheres.</li>
</ol>
<div class="section" id="todo">
<h3><a class="toc-backref" href="#id14">TODO</a><a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h3>
<p>Make more use of this, eg to display material/surface properties,
position in heirarchy</p>
</div>
</div>
<div class="section" id="placemarks">
<h2><a class="toc-backref" href="#id15">placemarks</a><a class="headerlink" href="#placemarks" title="Permalink to this headline">¶</a></h2>
<p>The commandline to return to a viewpoint and camera configuration
is written to stdout on exiting or on pressing &#8220;W&#8221;.</p>
</div>
<div class="section" id="markers">
<h2><a class="toc-backref" href="#id16">markers</a><a class="headerlink" href="#markers" title="Permalink to this headline">¶</a></h2>
<p>Switch on markers with &#8220;K&#8221;, the look point is illustrated with a
wireframe cube with wireframe sphere inside. Also the frustum of the current view
excluding any offset trackball rotation + translation and raycast direction/origin
are illustrated.</p>
</div>
<div class="section" id="viewpoint-bookmarks">
<h2><a class="toc-backref" href="#id17">Viewpoint Bookmarks</a><a class="headerlink" href="#viewpoint-bookmarks" title="Permalink to this headline">¶</a></h2>
<p>Number keys are used to create and visit bookmarks.
While pressing a number key 1-9 click on a solid to create a bookmark,
the view adopts the coordinate frame corresponding to the solid clicked.
Subsequently pressing number keys 0-9 visit the bookmarks created,
and pressing SPACE updates the current bookmark (last one created/visited)
to bake any offsets made from the view into the view.
Bookmark 0 is created at startup for the initial viewpoint.</p>
<p>A bookmark comprises:</p>
<ul class="simple">
<li>a solid (or the entiremesh), which defines the view coordinate system.
Unit of length is the extent of the solid</li>
<li>&#8220;eye&#8221; position, eg -2,-2,0</li>
<li>&#8220;look&#8221; position, eg 0,0,0 : about which trackball rotations are applied</li>
<li>&#8220;up&#8221; direction, eg 0,0,1</li>
</ul>
<p>Note that trackball translations/rotations do not update the &#8220;view&#8221;,
although they do of course update what you see. To solidify trackballing
offsets into the current view press SPACE.</p>
<ul class="simple">
<li>drag around to rotate about the &#8220;look&#8221; point using a virtual trackball,
XY positions are projected onto virtual sphere trackball, which allow
offset rotations to be obtained via some Quaternion math</li>
<li>press &#8220;X&#8221; while dragging around to translate in screen XY direction</li>
<li>press &#8220;Z&#8221; while dragging up/down to tranlate in screen Z direction (in/out)</li>
</ul>
<p>All bookmarks other than bookmark zero which corresponds to the launch viewpoint
are persisted at exit into a &#8220;bookmarks_%(path)s.cfg&#8221; file in the working directory,
where the path is filled in with in launch path argument. This allows separate
bookmarks to be maintained per site.
A subsequent session from the same directory re-loads the bookmarks.</p>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id18">ISSUES</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>when viewing partial geometry bookmarks which refer to volumes that are not present
are not loaded, so bookmarks set when using more complete geometry will be lost.
Workaround is to launch from a different directories for different
geometries or use <cite>&#8211;bookmarks path</cite> option.
Solution of incorporating geometry spec into the bookmarks name, seems clumsy.</li>
<li>perhaps persist the exiting viewpoint into bookmark-0 ?</li>
</ol>
</div>
</div>
<div class="section" id="animation">
<h2><a class="toc-backref" href="#id19">Animation</a><a class="headerlink" href="#animation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="interpolate-between-bookmarks">
<h3><a class="toc-backref" href="#id20">interpolate between bookmarks</a><a class="headerlink" href="#interpolate-between-bookmarks" title="Permalink to this headline">¶</a></h3>
<p>Press &#8220;B&#8221; to setup an animation that linearly interpolates between the
bookmarked views starting at the current bookmark. Two or more bookmarks
are required.  To change the animation first update the bookmarks
and then press &#8220;B&#8221; again.</p>
</div>
<div class="section" id="orbiting-mode">
<h3><a class="toc-backref" href="#id21">orbiting mode</a><a class="headerlink" href="#orbiting-mode" title="Permalink to this headline">¶</a></h3>
<p>Press &#8220;V&#8221; to setup a flyaround or orbit mode for the current bookmark.
The initial &#8220;look&#8221; direction is tangential, so you might need to turn inwards
using the trackball controls to see the geometry.</p>
<p>ISSUES: rotation point not where intended, makes difficult to use</p>
</div>
<div class="section" id="animation-control">
<h3><a class="toc-backref" href="#id22">animation control</a><a class="headerlink" href="#animation-control" title="Permalink to this headline">¶</a></h3>
<p>Following setup of bookmark or orbit animations, pressing &#8220;M&#8221; will toggle
the animation. Speed of animation can be adjusted using the right/left arrow keys.
During animation trackball translation/rotation can still be used to adjust the effective viewpoint.
Also most other controls can still be used during the animation, such as near/far clipping or
switching to Chroma raycast rendering.</p>
<p>TODO: key to reverse animation</p>
</div>
<div class="section" id="photon-propagation-time-control-interactive-and-auto-scanning">
<h3><a class="toc-backref" href="#id23">photon propagation time control : interactive and auto scanning</a><a class="headerlink" href="#photon-propagation-time-control-interactive-and-auto-scanning" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>press control key and tap on the trackpad whilst over g4daeview window
to display the contextual menu, select <cite>photons &gt; style &gt; movie-extra</cite></li>
<li>several other presentational styles also give animated propagation effects<ul>
<li><cite>movie</cite></li>
<li><cite>dmovie</cite></li>
<li><cite>confetti-1</cite></li>
<li><cite>dconfetti-1</cite></li>
</ul>
</li>
<li>scrub backwards/forwards the propagation global time (in ns) by
toggling time mode by holding the QUOTELEFT key (with tilde at top left of keyboard)
whilst dragging up/down on trackpad.  The time in nanoseconds is displayed at the
top left of the window title bar.</li>
<li>to toggle automatic scanning of global time press <cite>M</cite> whilst in time mode (holding QUOTELEFT)</li>
</ol>
</div>
</div>
<div class="section" id="remote-control">
<h2><a class="toc-backref" href="#id24">remote control</a><a class="headerlink" href="#remote-control" title="Permalink to this headline">¶</a></h2>
<p>A subset of the commandline launch options can be sent over the network to the running
application. This allows numerical control of viewpoint and camera parameters.:</p>
<div class="highlight-python"><pre>udp.py -t 7000 --eye=10,0,0 --look=0,0,0 --up=0,0,1
udp.py -t 7000_10,0,0_0,0,0_0,0,1                    # equivalent short form</pre>
</div>
<p>The viewpoint is defined by the <cite>eye</cite> and <cite>look</cite> positions and the <cite>up</cite> direction, which
are provided in the coordinate frame of the target solid. NB rotations are performed about the
look position, that is often set to 0,0,0 corresponding to the center of the solid.
The &#8220;K&#8221; key toggle markers indicating the eye and look position.</p>
<p>The options that are accepted interactively are marked with &#8220;I&#8221; in the options list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">daeview</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
</div>
<div class="section" id="raycast-launch-control">
<h2><a class="toc-backref" href="#id25">raycast launch control</a><a class="headerlink" href="#raycast-launch-control" title="Permalink to this headline">¶</a></h2>
<p>Press &#8220;R&#8221; to toggle raycast mode.</p>
<p>To avoid GPU panics/system crashes</p>
<ul class="simple">
<li>subsequent raycast launches are aborted when launch times exceed <em>max-time</em> cutoff</li>
<li>launch configuration is controlled by eg <em>launch=3,2,1</em> and <em>block=8,8,1</em>
options which configure 2D launch</li>
<li>raycast launches tyically use 2D pixel thread blocks,
some speedups achieved by moving from line of pixels to 2D regions
in order for the work within a warp of 32 threads to be more uniform</li>
</ul>
<div class="section" id="interactive-switch-to-metric-pixels-presentation">
<h3><a class="toc-backref" href="#id26">interactive switch to metric pixels presentation</a><a class="headerlink" href="#interactive-switch-to-metric-pixels-presentation" title="Permalink to this headline">¶</a></h3>
<p>The chroma raycast metrics available for display must be defined at
launch with eg:</p>
<div class="highlight-python"><pre>g4daeview.py --metric time/tri/node</pre>
</div>
<p>The restricted flexibility is due to needing to compile
the kernel to change the metric. This is to avoid little
used branching in the kernel.</p>
<p>Kernel flags can be controlled by remote control, eg:</p>
<div class="highlight-python"><pre>udp.py --flags 15,0    # does 15 controls bit shift, here "metric &gt;&gt; 15"</pre>
</div>
</div>
</div>
<div class="section" id="screen-capture">
<h2><a class="toc-backref" href="#id27">screen capture</a><a class="headerlink" href="#screen-capture" title="Permalink to this headline">¶</a></h2>
<p>Pressing &#8220;E&#8221; will create a screen capture and write a timestamp dated .png
to the current directory.</p>
</div>
<div class="section" id="movie-capture">
<h2><a class="toc-backref" href="#id28">movie capture</a><a class="headerlink" href="#movie-capture" title="Permalink to this headline">¶</a></h2>
<p>Not implemented, as find that on OSX can simply use <cite>QuickTime Player.app</cite></p>
<ul class="simple">
<li><cite>File &gt; New Screen Recording</cite> to create a very large .mov (~1GB for ~2min)</li>
<li><cite>File &gt; Export ...</cite> to compress .mov to .m4v</li>
</ul>
</div>
<div class="section" id="parallel-orthographic-projection">
<h2><a class="toc-backref" href="#id29">Parallel/Orthographic projection</a><a class="headerlink" href="#parallel-orthographic-projection" title="Permalink to this headline">¶</a></h2>
<p>Press &#8220;P&#8221; to toggle between orthographic/parallel projection and the default
perspective projection.</p>
<ul>
<li><p class="first">&#8220;Z&#8221; to translate eye point in/out</p>
<p>As parallel projection corresponds to the view from infinity it is
somewhat paradoxical that translating in Z has any effect, however
it does so indirectly via changing where the near clipping plane falls</p>
</li>
<li><p class="first">&#8220;N&#8221; to change near</p>
</li>
<li><p class="first">&#8220;Y&#8221; to change yfov</p>
</li>
<li><p class="first">&#8220;F&#8221; to change far</p>
</li>
</ul>
<p>To &#8220;enter&#8221; geometry while in parallel, use small FOV (eg 5 degrees)
and vary near and Z in order to clip the volumes.</p>
<dl class="docutils">
<dt>TODO: Get Chroma raycast to work in parallel projection mode, need to</dt>
<dd>come up with the matrix and probably change the kernel.</dd>
</dl>
</div>
<div class="section" id="presentation">
<h2><a class="toc-backref" href="#id30">Presentation</a><a class="headerlink" href="#presentation" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>g4daeview.py -g 4998:6000

  # default includes lights, fill with transparency

g4daeview.py -g 4998:6000 --line

  # adding wireframe lines slows rendering significantly,toggle lines with "L"

g4daeview.py -g 4998 --nofill

   # without polygon fill the lighting/transparency has no effect, toggle face fill with "A"

g4daeview.py -g 4998 --nofill

   # blank white

g4daeview.py -g 4900:5000,4815 --notransparent

   # see the base of the PMTs poking out of the cylinder when transparency off

g4daeview.py -g 4900:5000,4815 --rgba .7,.7,.7,0.5

   # changing colors, especially alpha has a drastic effect on output

g4daeview.py -g 3153:6000

   # inside the pool, 2 ADs : navigation is a challenge, its dark inside

g4daeview.py -g 6070:6450

   # AD structure, shows partial radial shield

g4daeview.py -g 6480:12230

   # pool PMTs, AD support, scaffold?    when including lots of volumes switching off lines is a speedup

g4daeview.py -g 12221:12230

   # rad slabs

g4daeview.py -g 2:12230

   # full geometry, excluding only boring (and large) universe and rock

g4daeview.py -g 3153:12230

   # skipping universe, rock and RPC makes for easier inspection inside the pool</pre>
</div>
<div class="sidebar">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../g4daeview_chroma/" title="G4DAEView Chroma"
             >next</a> |</li>
        <li class="right" >
          <a href="../g4daeview_history/" title="G4DAE and G4DAEVIEW Development History"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../../" >geant4</a> &raquo;</li>
          <li><a href="../../../" >Geant4 Geometry Export</a> &raquo;</li>
          <li><a href="../../" >Geant4 Geometry in Collada</a> &raquo;</li>
          <li><a href="../" >g4daeview</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>