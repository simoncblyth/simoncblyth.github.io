<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Daeview Dev Notes &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../../../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../../../../" />
    <link rel="up" title="g4daeview" href="../" />
    <link rel="next" title="DAEVertexBuffer Dev Notes" href="../daevertexbuffer/" />
    <link rel="prev" title="G4DAEVIEW Lights" href="../g4daeview_lights/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../daevertexbuffer/" title="DAEVertexBuffer Dev Notes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../g4daeview_lights/" title="G4DAEVIEW Lights"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../../" >geant4</a> &raquo;</li>
          <li><a href="../../../" >Geant4 Geometry Export</a> &raquo;</li>
          <li><a href="../../" >Geant4 Geometry in Collada</a> &raquo;</li>
          <li><a href="../" accesskey="U">g4daeview</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../pycuda/">pycuda</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../">geant4</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../release_notes/">Geant4 Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../geant4_gpu/">Geant4 GPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../geant4_profiling/">Geant4 Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../release_notes/">Geant4 Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../verbosity/">Verbosity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/">Geant4 Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../giga/">GiGa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api/">Geant4 API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../opticalphoton/">Geant4 Optical Photon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../processes/">Geant4 Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../medical/">Medical Communities Using Geant4 (esp. optical photon)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../">Geant4 Geometry Export</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../g4py/">g4py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../nuwa/">nuwa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../event/">Geant4 Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../geant4_future_doe/">Geant4</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../hg/">hg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../simoncblyth.bitbucket.org/">simoncblyth.bitbucket.org</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../../../_sources/geant4/geometry/collada/g4daeview/g4daeview_devnotes.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../g4daeview_lights/"
                        title="previous chapter">G4DAEVIEW Lights</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../daevertexbuffer/"
                        title="next chapter">DAEVertexBuffer Dev Notes</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="daeview-dev-notes">
<h1>Daeview Dev Notes<a class="headerlink" href="#daeview-dev-notes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="dependencies-tree">
<h2>Dependencies Tree<a class="headerlink" href="#dependencies-tree" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>PyOpenGL</li>
<li>glumpy<ul>
<li>OpenGL.GLUT (PyOpenGL wrapped)<ul>
<li>GLUT.framework</li>
</ul>
</li>
</ul>
</li>
<li>ROOT, used for ChromaPhotonList deserialization</li>
</ul>
</div>
<div class="section" id="alternatives-to-glut">
<h2>Alternatives to GLUT ?<a class="headerlink" href="#alternatives-to-glut" title="Permalink to this headline">¶</a></h2>
<p>The glumpy dependency <cite>GLUT.framework</cite> prevents going beyond OpenGL 2.1, GLSL 120.
This is despite OSX 10.9 system and MBP hardware supporting OpenGL 4.1.</p>
<div class="section" id="implications-of-ancient-opengl-2-1">
<h3>Implications of ancient OpenGL 2.1<a class="headerlink" href="#implications-of-ancient-opengl-2-1" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>developing against obsolete API, eg the geometry shader extension API</li>
<li>GLSL 120 (even with extensions) have very poor int/uint support
so forced to do even simple things like photon selection based on flags in CUDA
rather than the shader</li>
</ol>
</div>
<div class="section" id="glfw">
<h3>GLFW<a class="headerlink" href="#glfw" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Modern OpenGL support on OSX, Linux, Windows</li>
<li>Not a GLUT drop in (no menu-ing)</li>
<li><a class="reference external" href="http://www.geeks3d.com/20121109/overview-of-opengl-support-on-os-x/">http://www.geeks3d.com/20121109/overview-of-opengl-support-on-os-x/</a></li>
<li><a class="reference external" href="http://stackoverflow.com/questions/19993078/looking-for-a-simple-opengl-3-2-python-example-that-uses-glfw">http://stackoverflow.com/questions/19993078/looking-for-a-simple-opengl-3-2-python-example-that-uses-glfw</a></li>
</ul>
</div>
<div class="section" id="glfwcy-with-pyopengl-and-opengl-3-2">
<h3>glfwcy with PyOpenGL and OpenGL 3.2<a class="headerlink" href="#glfwcy-with-pyopengl-and-opengl-3-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://github.com/electronut/pp/blob/master/simplegl/simpleglfw.py">https://github.com/electronut/pp/blob/master/simplegl/simpleglfw.py</a></li>
</ul>
</div>
<div class="section" id="glfw-python-wrappers">
<h3>glfw python wrappers<a class="headerlink" href="#glfw-python-wrappers" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://pypi.python.org/pypi/glfw/1.0.1">https://pypi.python.org/pypi/glfw/1.0.1</a></li>
<li><a class="reference external" href="https://github.com/enthought/glfwpy">https://github.com/enthought/glfwpy</a></li>
<li><a class="reference external" href="https://github.com/glfw/glfw">https://github.com/glfw/glfw</a></li>
</ul>
</div>
<div class="section" id="migration-from-glumpy-to-glfw">
<h3>migration from glumpy to glfw<a class="headerlink" href="#migration-from-glumpy-to-glfw" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://groups.google.com/forum/m/#!msg/pupil-discuss/qrxH8KGh7vU/ZvRpbg7Mnu0J">https://groups.google.com/forum/m/#!msg/pupil-discuss/qrxH8KGh7vU/ZvRpbg7Mnu0J</a><ul>
<li>example of a python project making the move to GLFW</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="alternatives-serialization-deserialization-to-root">
<h2>Alternatives serialization/deserialization to ROOT ?<a class="headerlink" href="#alternatives-serialization-deserialization-to-root" title="Permalink to this headline">¶</a></h2>
<p>Ginormous monolithic ROOT dependency, just to be able to
deserialize ChromaPhotonList objects.</p>
<p>Requirements:</p>
<ol class="arabic simple">
<li>serialization usable from Geant4 C++</li>
<li>deserialization usable from Python</li>
<li>in future both usable from iOS</li>
<li>efficient handling of millions of photons!</li>
</ol>
<p>ChromaPhotonList exists for transport alone, so
can easily change the format to something else,
eg go directly into capnproto structures, from
Geant4 C++</p>
<p>Also consider what happens at other end, need to
form numpy arrays with the data in order for
easy uploading to GPU.</p>
<p>Non-requirements:</p>
<ol class="arabic simple">
<li>schema evolution, careful versioning</li>
</ol>
<div class="section" id="next">
<h3>NEXT<a class="headerlink" href="#next" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Make some comparisons for usecase of large numbers of floats,
no necessarily in <cite>std::vector&lt;float&gt;</cite></li>
</ol>
</div>
<div class="section" id="contenders">
<h3>contenders<a class="headerlink" href="#contenders" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://www.google.com/search?q=protobuf boost.serialize capnproto thrift">google:protobuf boost.serialize capnproto thrift</a></li>
</ul>
<ol class="arabic simple">
<li>capnproto, improvement on protobuf from former protobuf principal</li>
<li>cereal</li>
<li>google protobuf</li>
<li>boost serialization <a class="reference external" href="http://www.ibm.com/developerworks/aix/library/au-boostserialization/">http://www.ibm.com/developerworks/aix/library/au-boostserialization/</a></li>
<li><a class="reference external" href="http://home.gna.org/autoserial/objects.html">http://home.gna.org/autoserial/objects.html</a></li>
<li><a class="reference external" href="http://thrift.apache.org">http://thrift.apache.org</a></li>
</ol>
</div>
<div class="section" id="comparisons">
<h3>comparisons<a class="headerlink" href="#comparisons" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://www.igvita.com/2011/08/01/protocol-buffers-avro-thrift-messagepack/">https://www.igvita.com/2011/08/01/protocol-buffers-avro-thrift-messagepack/</a></li>
<li><a class="reference external" href="http://www.codeproject.com/Articles/225988/A-practical-guide-to-Cplusplus-serialization">http://www.codeproject.com/Articles/225988/A-practical-guide-to-Cplusplus-serialization</a></li>
<li><a class="reference external" href="https://github.com/thekvs/cpp-serializers">https://github.com/thekvs/cpp-serializers</a></li>
<li><a class="reference external" href="http://leopard.in.ua/2013/10/13/binary-serialization-formats/">http://leopard.in.ua/2013/10/13/binary-serialization-formats/</a></li>
<li><a class="reference external" href="http://stackoverflow.com/questions/1061169/boost-serialization-vs-google-protocol-buffers">http://stackoverflow.com/questions/1061169/boost-serialization-vs-google-protocol-buffers</a></li>
<li><a class="reference external" href="https://github.com/mapbox/mapnik-vector-tile/issues/1">https://github.com/mapbox/mapnik-vector-tile/issues/1</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Comparison_of_data_serialization_formats">http://en.wikipedia.org/wiki/Comparison_of_data_serialization_formats</a></li>
</ul>
</div>
<div class="section" id="capnproto">
<h3>capnproto<a class="headerlink" href="#capnproto" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Requires GCC 4.7+ or Clang 3.2+</li>
<li>iOS ported: <a class="reference external" href="https://groups.google.com/forum/#!topic/capnproto/YIcDJzSQh34">https://groups.google.com/forum/#!topic/capnproto/YIcDJzSQh34</a></li>
<li><a class="reference external" href="https://github.com/kentonv/capnproto">https://github.com/kentonv/capnproto</a></li>
<li><a class="reference external" href="http://kentonv.github.io/capnproto/">http://kentonv.github.io/capnproto/</a></li>
<li><a class="reference external" href="https://trac.macports.org/browser/trunk/dports/devel/capnproto/Portfile">https://trac.macports.org/browser/trunk/dports/devel/capnproto/Portfile</a></li>
<li><a class="reference external" href="http://blog.jparyani.com/pycapnp/">http://blog.jparyani.com/pycapnp/</a>  python binding</li>
</ul>
<p>Random quote:</p>
<blockquote>
<div>It&#8217;s extremely performant for C, because its format mimics the layout of C data
structures in memory. So for C, the encoding time is zero - just dump the bytes
as-is, pretty much.</div></blockquote>
<p>Hmm, what about byte buffer reinterpretation as numpy array ? (a la MySQL-numpy).</p>
</div>
<div class="section" id="cereal">
<h3>cereal<a class="headerlink" href="#cereal" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://uscilab.github.io/cereal/index.html">http://uscilab.github.io/cereal/index.html</a></li>
<li><a class="reference external" href="https://github.com/USCiLab/cereal">https://github.com/USCiLab/cereal</a></li>
</ul>
</div>
<div class="section" id="boost-serialization">
<h3>boost serialization<a class="headerlink" href="#boost-serialization" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>can monolithic-ness be avoided ? iOS ?</li>
</ul>
</div>
</div>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="gpu-out-of-memory-during-bvh-construction-with-full-juno-geometry-50m-nodes">
<h3>GPU Out-of-memory during BVH construction with full Juno geometry (50M nodes?)<a class="headerlink" href="#gpu-out-of-memory-during-bvh-construction-with-full-juno-geometry-50m-nodes" title="Permalink to this headline">¶</a></h3>
<p>Restricting to about half the geometry succeeds:</p>
<div class="highlight-python"><pre>g4daeview.sh -p juno -g 1:25000 --with-chroma --launch 3,3,1</pre>
</div>
<p>Maybe can reorganize the work to avoid using too much memory ?:</p>
<div class="highlight-python"><pre>g4daeview.sh -p juno --with-chroma

074 2014-05-26 10:51:22,642 env.geant4.geometry.collada.collada_to_chroma:297 ColladaToChroma adding BVH
075 2014-05-26 10:51:23,879 chroma.loader       :155 Building new BVH using recursive grid algorithm.
076 Expanding 422925 parent nodes
077 Merging 50232688 nodes to 15826587 parents
078 Expanding 48194 parent nodes
079 Merging 16250194 nodes to 4923755 parents
080 Merging 4971964 nodes to 1289438 parents
081 Merging 1289438 nodes to 266462 parents
082 Merging 266462 nodes to 51806 parents
083 Merging 51806 nodes to 10332 parents
084 Merging 10332 nodes to 2216 parents
085 Merging 2216 nodes to 480 parents
086 Merging 480 nodes to 104 parents
087 Merging 104 nodes to 32 parents
088 Merging 32 nodes to 8 parents
089 Merging 8 nodes to 2 parents
090 Merging 2 nodes to 1 parent
091 Traceback (most recent call last):
092   File "/Users/blyth/env/bin/g4daeview.py", line 4, in &lt;module&gt;
093     main()
094   File "/usr/local/env/chroma_env/lib/python2.7/site-packages/env/geant4/geometry/collada/g4daeview/g4daeview.py", line 186, in main
095     scene = DAEScene(geometry, config )
096   File "/usr/local/env/chroma_env/lib/python2.7/site-packages/env/geant4/geometry/collada/g4daeview/daescene.py", line 45, in __init__
097     chroma_geometry = geometry.make_chroma_geometry()
098   File "/usr/local/env/chroma_env/lib/python2.7/site-packages/env/geant4/geometry/collada/g4daeview/daegeometry.py", line 315, in make_chroma_ge    ometry
099     cc.convert_geometry(nodes=self.nodes())
100   File "/usr/local/env/chroma_env/lib/python2.7/site-packages/env/geant4/geometry/collada/collada_to_chroma.py", line 291, in convert_geometry
101     self.add_bvh()
102   File "/usr/local/env/chroma_env/lib/python2.7/site-packages/env/geant4/geometry/collada/collada_to_chroma.py", line 304, in add_bvh
103     cuda_device=cuda_device)
104   File "/usr/local/env/chroma_env/src/chroma/chroma/loader.py", line 160, in load_bvh
105     bvh = make_recursive_grid_bvh(geometry.mesh, target_degree=3)
106   File "/usr/local/env/chroma_env/src/chroma/chroma/bvh/grid.py", line 91, in make_recursive_grid_bvh
107     nodes, layer_bounds = concatenate_layers(layers)
108   File "/usr/local/env/chroma_env/src/chroma/chroma/gpu/bvh.py", line 266, in concatenate_layers
109     grid=(nblocks_this_iter,1))
110   File "/usr/local/env/chroma_env/lib/python2.7/site-packages/pycuda/driver.py", line 355, in function_call
111     handlers, arg_buf = _build_arg_buf(args)
112   File "/usr/local/env/chroma_env/lib/python2.7/site-packages/pycuda/driver.py", line 125, in _build_arg_buf
113     arg_data.append(int(arg.get_device_alloc()))
114   File "/usr/local/env/chroma_env/lib/python2.7/site-packages/pycuda/driver.py", line 59, in get_device_alloc
115     self.dev_alloc = mem_alloc_like(self.array)
116   File "/usr/local/env/chroma_env/lib/python2.7/site-packages/pycuda/driver.py", line 608, in mem_alloc_like
117     return mem_alloc(ary.nbytes)
118 pycuda._driver.MemoryError: cuMemAlloc failed: out of memory</pre>
</div>
</div>
</div>
<div class="section" id="old-issues-to-be-revisited">
<h2>Old Issues To Be Revisited<a class="headerlink" href="#old-issues-to-be-revisited" title="Permalink to this headline">¶</a></h2>
<div class="section" id="more-bizarrness">
<h3>More Bizarrness<a class="headerlink" href="#more-bizarrness" title="Permalink to this headline">¶</a></h3>
<p>Off into outerspace and back:</p>
<div class="highlight-python"><pre>(chroma_env)delta:daeview blyth$ grep ESR solids.txt
1274  DAESolid v 578  t 1188  n 578   : 4427 __dd__Geometry__AdDetails__lvTopRefGap--pvTopESR0xab4bd50.0
1277  DAESolid v 330  t 688  n 330   : 4430 __dd__Geometry__AdDetails__lvBotRefGap--pvBotESR0xae4eda0.0
2934  DAESolid v 578  t 1188  n 578   : 6087 __dd__Geometry__AdDetails__lvTopRefGap--pvTopESR0xab4bd50.1
2937  DAESolid v 330  t 688  n 330   : 6090 __dd__Geometry__AdDetails__lvBotRefGap--pvBotESR0xae4eda0.1
(chroma_env)delta:daeview blyth$
(chroma_env)delta:daeview blyth$ ./udp.py "-j 4427_-5,2,2:"
sending -j 4427_-5,2,2:</pre>
</div>
<p>Its because its a 4.5 disk shape, look from above:</p>
<div class="highlight-python"><pre>udp.py "-t 4427_0,0.001,-2"
udp.py "-t 4427_0,0.001,5"

./udp.py "-t 4427_0,0.001,-5"   # view upwards from bottom of AD</pre>
</div>
</div>
<div class="section" id="animation">
<h3>Animation<a class="headerlink" href="#animation" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>(chroma_env)delta:daeview blyth$ ./daegeometry.py &gt; solids.txt
INFO:env.geant4.geometry.collada.daenode:DAENode.parse pycollada parse /Users/blyth/env/geant4/geometry/materials/g4_00.dae
INFO:__main__:Flattening 9077 DAESolid into one DAEMesh...
INFO:__main__:DAEMesh v 1234834  t 2438640  n 1234834
(chroma_env)delta:daeview blyth$ vi solids.txt
(chroma_env)delta:daeview blyth$ grep ball solids.txt
(chroma_env)delta:daeview blyth$ grep Ball solids.txt
1369  DAESolid v 267  t 528  n 267   : 4522 __dd__Geometry__CalibrationSources__lvWallLedSourceAssy--pvWallLedDiffuserBall0xab71f78.0
1372  DAESolid v 267  t 528  n 267   : 4525 __dd__Geometry__CalibrationSources__lvWallLedSourceAssy--pvWallLedDiffuserBall0xab71f78.1
1375  DAESolid v 267  t 528  n 267   : 4528 __dd__Geometry__CalibrationSources__lvWallLedSourceAssy--pvWallLedDiffuserBall0xab71f78.2
1389  DAESolid v 267  t 528  n 267   : 4542 __dd__Geometry__CalibrationSources__lvLedSourceShell--pvDiffuserBall0xabe00c8.0
1477  DAESolid v 267  t 528  n 267   : 4630 __dd__Geometry__CalibrationSources__lvLedSourceShell--pvDiffuserBall0xabe00c8.1
1559  DAESolid v 267  t 528  n 267   : 4712 __dd__Geometry__CalibrationSources__lvLedSourceShell--pvDiffuserBall0xabe00c8.2
3029  DAESolid v 267  t 528  n 267   : 6182 __dd__Geometry__CalibrationSources__lvWallLedSourceAssy--pvWallLedDiffuserBall0xab71f78.3
3032  DAESolid v 267  t 528  n 267   : 6185 __dd__Geometry__CalibrationSources__lvWallLedSourceAssy--pvWallLedDiffuserBall0xab71f78.4
3035  DAESolid v 267  t 528  n 267   : 6188 __dd__Geometry__CalibrationSources__lvWallLedSourceAssy--pvWallLedDiffuserBall0xab71f78.5
3049  DAESolid v 267  t 528  n 267   : 6202 __dd__Geometry__CalibrationSources__lvLedSourceShell--pvDiffuserBall0xabe00c8.3
3137  DAESolid v 267  t 528  n 267   : 6290 __dd__Geometry__CalibrationSources__lvLedSourceShell--pvDiffuserBall0xabe00c8.4
3219  DAESolid v 267  t 528  n 267   : 6372 __dd__Geometry__CalibrationSources__lvLedSourceShell--pvDiffuserBall0xabe00c8.5
(chroma_env)delta:daeview blyth$
(chroma_env)delta:daeview blyth$ g4daeview.py -t +0 -j +1369,+1372,+1375,+1389,+1477,+1559,+3029,+3032,+3035,+3049,+3137,+3219 --near 1e-5</pre>
</div>
</div>
</div>
<div class="section" id="reflectors">
<h2>Reflectors<a class="headerlink" href="#reflectors" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>(chroma_env)delta:daeview blyth$ grep TopReflector solids.txt
1272  DAESolid v 296  t 608  n 296   : 4425 __dd__Geometry__AD__lvOIL--pvTopReflector0xab22490.0
1273  DAESolid v 296  t 608  n 296   : 4426 __dd__Geometry__AdDetails__lvTopReflector--pvTopRefGap0xabcc228.0
2932  DAESolid v 296  t 608  n 296   : 6085 __dd__Geometry__AD__lvOIL--pvTopReflector0xab22490.1
2933  DAESolid v 296  t 608  n 296   : 6086 __dd__Geometry__AdDetails__lvTopReflector--pvTopRefGap0xabcc228.1
(chroma_env)delta:daeview blyth$

./udp.py "-t 4425_0,0.001,-2_-2,-2,0
# looking up at top reflector</pre>
</div>
<div class="section" id="bizarre">
<h3>Bizarre<a class="headerlink" href="#bizarre" title="Permalink to this headline">¶</a></h3>
<p>Issues when small extent ?</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">g4daeview</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">t</span> <span class="o">+</span><span class="mi">1369</span>

<span class="n">g4daeview</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">t</span> <span class="o">+</span><span class="mi">1369</span> <span class="o">--</span><span class="n">eye</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.001</span><span class="p">,</span><span class="mi">20</span>    <span class="c"># small ball and cylinder</span>
</pre></div>
</div>
</div>
<div class="section" id="interpolation">
<h3>Interpolation<a class="headerlink" href="#interpolation" title="Permalink to this headline">¶</a></h3>
<p>Expected yoyo, just get fall:</p>
<div class="highlight-python"><pre>g4daeview.py -t 8153 --eye="2,2,40" --look="2,2.001,0" -j +0_2,2,-40:+0_2,2,40</pre>
</div>
<p>Very long shapes are problematic:</p>
<div class="highlight-python"><pre>g4daeview.py -t 4522 -j 4522_0,5,0:4522_5,0,0:4522_0,0.001,5 --near 1e-6 --far 1e6

g4daeview.py -g 4522,4525,4528,4542,4630,4712

g4daeview.py -g 4522,4525,4528,4542,4630,4712 -t "" -j 4522:4525:4528:4542:4630:4712

g4daeview.py -g 4522:4712 -t 4522

g4daeview.py -t 4522 -j 4522_0,5,0:4522_5,0,0:4522_0,0.001,5 --near 0.01

g4daeview.py -t 4522 -j 4522_0,5,0:4522_5,0,0:4522_0,0.001,5</pre>
</div>
</div>
<div class="section" id="interpolation-jumps-fixed">
<h3>Interpolation Jumps (FIXED)<a class="headerlink" href="#interpolation-jumps-fixed" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>g4daeview.py -t +1000 -j +1000_2,2,2:+1000_2,2,10

g4daeview.py -t 4522 -j 4522_0,5,0:4522_5,0,0:4522_0,0.001,5</pre>
</div>
<div class="sidebar">
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../daevertexbuffer/" title="DAEVertexBuffer Dev Notes"
             >next</a> |</li>
        <li class="right" >
          <a href="../g4daeview_lights/" title="G4DAEVIEW Lights"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../../" >geant4</a> &raquo;</li>
          <li><a href="../../../" >Geant4 Geometry Export</a> &raquo;</li>
          <li><a href="../../" >Geant4 Geometry in Collada</a> &raquo;</li>
          <li><a href="../" >g4daeview</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>