<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>G4LogicalBorderSurface &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../../../" />
    <link rel="up" title="surfaces" href="../" />
    <link rel="next" title="G4OpticalSurface" href="../opticalsurface/" />
    <link rel="prev" title="surfaces" href="../" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../opticalsurface/" title="G4OpticalSurface"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../" title="surfaces"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../" >geant4</a> &raquo;</li>
          <li><a href="../../" >Geant4 Geometry Export</a> &raquo;</li>
          <li><a href="../" accesskey="U">surfaces</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pycuda/">pycuda</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../">geant4</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../release_notes/">Geant4 Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../geant4_gpu/">Geant4 GPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../geant4_profiling/">Geant4 Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../release_notes/">Geant4 Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../verbosity/">Verbosity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../docs/">Geant4 Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../giga/">GiGa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/">Geant4 API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../opticalphoton/">Geant4 Optical Photon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../processes/">Geant4 Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../medical/">Medical Communities Using Geant4 (esp. optical photon)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../">Geant4 Geometry Export</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../g4py/">g4py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../nuwa/">nuwa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../event/">Geant4 Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../geant4_future_doe/">Geant4</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hg/">hg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../simoncblyth.bitbucket.org/">simoncblyth.bitbucket.org</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../../_sources/geant4/geometry/surfaces/bordersurface.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../"
                        title="previous chapter">surfaces</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../opticalsurface/"
                        title="next chapter">G4OpticalSurface</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="g4logicalbordersurface">
<h1>G4LogicalBorderSurface<a class="headerlink" href="#g4logicalbordersurface" title="Permalink to this headline">¶</a></h1>
<div class="section" id="gdml-g4dae-persisted-form">
<h2>GDML/G4DAE persisted form<a class="headerlink" href="#gdml-g4dae-persisted-form" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>157610       &lt;bordersurface name="__dd__Geometry__AdDetails__AdSurfacesAll__ESRAirSurfaceTop" surfaceproperty="__dd__Geometry__AdDetails__AdSurfacesAll__ESRAirSurfaceTop"&gt;
157611         &lt;physvolref ref="__dd__Geometry__AdDetails__lvTopReflector--pvTopRefGap0xabcc228"/&gt;
157612         &lt;physvolref ref="__dd__Geometry__AdDetails__lvTopRefGap--pvTopESR0xab4bd50"/&gt;
157613       &lt;/bordersurface&gt;
157614       &lt;bordersurface name="__dd__Geometry__AdDetails__AdSurfacesAll__ESRAirSurfaceBot" surfaceproperty="__dd__Geometry__AdDetails__AdSurfacesAll__ESRAirSurfaceBot"&gt;
157615         &lt;physvolref ref="__dd__Geometry__AdDetails__lvBotReflector--pvBotRefGap0xaa6e3d8"/&gt;
157616         &lt;physvolref ref="__dd__Geometry__AdDetails__lvBotRefGap--pvBotESR0xae4eda0"/&gt;
157617       &lt;/bordersurface&gt;</pre>
</div>
<div class="section" id="issues">
<h3>Issues<a class="headerlink" href="#issues" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>no copy numbers on the PV ref attributes, means not unique ?<ul>
<li><a class="reference external" href="http://www-zeuthen.desy.de/geant4/geant4.9.3.b01/classG4LogicalBorderSurface.html">http://www-zeuthen.desy.de/geant4/geant4.9.3.b01/classG4LogicalBorderSurface.html</a></li>
<li><a class="reference external" href="http://www-zeuthen.desy.de/geant4/geant4.9.3.b01/classG4PVPlacement.html">http://www-zeuthen.desy.de/geant4/geant4.9.3.b01/classG4PVPlacement.html</a></li>
<li>maybe should be using G4PVPlacement which implements G4VPhysicalVolume in order to have a CopyNo to give a unique ID</li>
</ul>
</li>
</ol>
</div>
</div>
<div class="section" id="refs">
<h2>Refs<a class="headerlink" href="#refs" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first"><a class="reference external" href="http://www.google.com/search?q=G4LogicalBorderSurface">google:G4LogicalBorderSurface</a></p>
</li>
<li><p class="first"><a class="reference external" href="http://hypernews.slac.stanford.edu/HyperNews/geant4/get/docsexamples/263.html">http://hypernews.slac.stanford.edu/HyperNews/geant4/get/docsexamples/263.html</a></p>
</li>
<li><p class="first"><a class="reference external" href="http://hypernews.slac.stanford.edu/HyperNews/geant4/get/opticalphotons/428.html">http://hypernews.slac.stanford.edu/HyperNews/geant4/get/opticalphotons/428.html</a></p>
<ul class="simple">
<li>suggests need to double up G4LogicalBorderSurface with volumes switched if want photons from
either direction to see the same surface</li>
</ul>
</li>
<li><p class="first"><a class="reference external" href="http://geant4.in2p3.fr/2005/Workshop/ShortCourse/session4/P.Gumplinger.pdf">http://geant4.in2p3.fr/2005/Workshop/ShortCourse/session4/P.Gumplinger.pdf</a></p>
<blockquote>
<div><p>Hmm <a class="reference external" href="mailto:physvolref/&#37;&#52;&#48;ref">physvolref/<span>&#64;</span>ref</a> attributes are PV names, these cannot directly
be matched against <cite>node.id</cite> as that has a uniquing count tacked on.
Using pvlookup reveals that cannot match to precise PV in many cases
getting two possibilites one from each of the 2 AD.</p>
<p>Maybe need to change G4DAE to pluck the uid at C++ level ? Or
could be bug in BorderSurface creation ? Persisting has lost
the association.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="geant4-usage-of-g4logicalbordersurface">
<h2>Geant4 Usage of  G4LogicalBorderSurface<a class="headerlink" href="#geant4-usage-of-g4logicalbordersurface" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>[blyth@belle7 source]$ find . -name '*.cc' -exec grep -l G4LogicalBorderSurface {} \;
./persistency/gdml/src/G4GDMLReadStructure.cc
./processes/optical/src/G4OpBoundaryProcess.cc
./geometry/volumes/src/G4LogicalBorderSurface.cc
[blyth@belle7 source]$</pre>
</div>
<p><cite>processes/optical/src/G4OpBoundaryProcess.cc</cite>:</p>
<div class="highlight-python"><pre>132 G4VParticleChange*
133 G4OpBoundaryProcess::PostStepDoIt(const G4Track&amp; aTrack, const G4Step&amp; aStep)
134 {

218         theModel = glisur;
219         theFinish = polished;
220
221         G4SurfaceType type = dielectric_dielectric;
222
223         Rindex = NULL;
224         OpticalSurface = NULL;
225
226         G4LogicalSurface* Surface = NULL;
227
228         Surface = G4LogicalBorderSurface::GetSurface
229               (pPreStepPoint -&gt;GetPhysicalVolume(),
230                pPostStepPoint-&gt;GetPhysicalVolume());

           // THIS IS ONLY CHANCE TO SNAG A BORDERSURFACE
231
232         if (Surface == NULL){
233       G4bool enteredDaughter=(pPostStepPoint-&gt;GetPhysicalVolume()
234                   -&gt;GetMotherLogical() ==
235                   pPreStepPoint-&gt;GetPhysicalVolume()
236                   -&gt;GetLogicalVolume());

          //  poststep.PV.motherLV == prestep.PV.LV
          //  poststep mother logical is prestep logical ... so poststep must be daughter of prestep

237       if(enteredDaughter){
238         Surface = G4LogicalSkinSurface::GetSurface
239           (pPostStepPoint-&gt;GetPhysicalVolume()-&gt;
240            GetLogicalVolume());

241         if(Surface == NULL)
242           Surface = G4LogicalSkinSurface::GetSurface
243           (pPreStepPoint-&gt;GetPhysicalVolume()-&gt;
244            GetLogicalVolume());
245       }
246       else {

         // does this imply poststep must be mother of prestep ?
         // what about stepping between siblings ?

247         Surface = G4LogicalSkinSurface::GetSurface
248           (pPreStepPoint-&gt;GetPhysicalVolume()-&gt;
249            GetLogicalVolume());
250         if(Surface == NULL)
251           Surface = G4LogicalSkinSurface::GetSurface
252           (pPostStepPoint-&gt;GetPhysicalVolume()-&gt;
253            GetLogicalVolume());
254       }
255     }

 Translating that into something digestable,

         //   Surface = G4LogicalBorderSurface::GetSurface(pPreStepPoint -&gt;GetPhysicalVolume(),pPostStepPoint-&gt;GetPhysicalVolume());
         //      *  border surface takes priority
         //
         //   if(Surface == NULL){
         //   ...
         //   if(enteredDaughter){    // first try post and then pre : daughter has first dibs
         //        Surface = G4LogicalSkinSurface::GetSurface(pPostStepPoint-&gt;GetPhysicalVolume()-&gt;GetLogicalVolume());
         //        if(Surface == NULL){
         //           Surface = G4LogicalSkinSurface::GetSurface(pPreStepPoint-&gt;GetPhysicalVolume()-&gt;GetLogicalVolume());
         //         }
         //   }
         //   else
         //   {                // first pre then post :
         //
         //




256
257     if (Surface) OpticalSurface =
258            dynamic_cast &lt;G4OpticalSurface*&gt; (Surface-&gt;GetSurfaceProperty());
259</pre>
</div>
</div>
<div class="section" id="pv-ambiguity-issue">
<h2>PV Ambiguity Issue<a class="headerlink" href="#pv-ambiguity-issue" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>dump_bordersurface

[00] &lt;BorderSurface AdDetails__AdSurfacesAll__ESRAirSurfaceTop REFLECTIVITY &gt;

     pv1 (2) AdDetails__lvTopReflector--pvTopRefGap0xabcc228
       __dd__Geometry__AdDetails__lvTopReflector--pvTopRefGap0xabcc228.0             __dd__Materials__Air0xab09580
       __dd__Geometry__AdDetails__lvTopReflector--pvTopRefGap0xabcc228.1             __dd__Materials__Air0xab09580

     pv2 (2) AdDetails__lvTopRefGap--pvTopESR0xab4bd50
       __dd__Geometry__AdDetails__lvTopRefGap--pvTopESR0xab4bd50.0             __dd__Materials__ESR0xaeaaeb8
       __dd__Geometry__AdDetails__lvTopRefGap--pvTopESR0xab4bd50.1             __dd__Materials__ESR0xaeaaeb8


    Oil http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__AD__lvSST--pvOIL0xaa6d998.0.html
        http://belle7.nuu.edu.tw/dae/tree/3155.html  (many children)

    Acr http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__AD__lvOIL--pvTopReflector0xab22490.0.html
        http://belle7.nuu.edu.tw/dae/tree/4425.html    (Acrylic, single child)

    pv1 http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__AdDetails__lvTopReflector--pvTopRefGap0xabcc228.0___4.html
    pv1 http://belle7.nuu.edu.tw/dae/tree/4426___4.html  (Air, single child)

    pv2 http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__AdDetails__lvTopRefGap--pvTopESR0xab4bd50.0.html
    pv2 http://belle7.nuu.edu.tw/dae/tree/4427.html   (EST, leaf )


    http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__AdDetails__lvTopReflector--pvTopRefGap0xabcc228.1___4.html
    http://belle7.nuu.edu.tw/dae/tree/6086___4.html
    http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__AdDetails__lvTopRefGap--pvTopESR0xab4bd50.1.html
    http://belle7.nuu.edu.tw/dae/tree/6087.html

    This bordersurface pair are (single-parent)-(single-child) with the child being leaf node
    The PV ambiguity is between the two ADs.
    Construction is simarly shaped discs

              Oil-Acrylic-Air-ESR
                          pv1 pv2

    Double ambiguity, should yield two border surfaces ... the parent child pairings
    can be used to break ambiguity ?


[01] &lt;BorderSurface AdDetails__AdSurfacesAll__ESRAirSurfaceBot REFLECTIVITY &gt;
     pv1 (2) AdDetails__lvBotReflector--pvBotRefGap0xaa6e3d8
       __dd__Geometry__AdDetails__lvBotReflector--pvBotRefGap0xaa6e3d8.0             __dd__Materials__Air0xab09580
       __dd__Geometry__AdDetails__lvBotReflector--pvBotRefGap0xaa6e3d8.1             __dd__Materials__Air0xab09580
     pv2 (2) AdDetails__lvBotRefGap--pvBotESR0xae4eda0
       __dd__Geometry__AdDetails__lvBotRefGap--pvBotESR0xae4eda0.0             __dd__Materials__ESR0xaeaaeb8
       __dd__Geometry__AdDetails__lvBotRefGap--pvBotESR0xae4eda0.1             __dd__Materials__ESR0xaeaaeb8

     Presumably same pattern as top reflector

     Double ambiguity, means this should yield two surfaces... one for each AD


[02] &lt;BorderSurface AdDetails__AdSurfacesAll__SSTOilSurface REFLECTIVITY &gt;
     pv1 (2) AD__lvSST--pvOIL0xaa6d998
       __dd__Geometry__AD__lvSST--pvOIL0xaa6d998.0             __dd__Materials__MineralOil0xaecfd78
       __dd__Geometry__AD__lvSST--pvOIL0xaa6d998.1             __dd__Materials__MineralOil0xaecfd78

       http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__AD__lvSST--pvOIL0xaa6d998.0.html
       http://belle7.nuu.edu.tw/dae/tree/3155.html   Oil

     pv2 (2) AD__lvADE--pvSST0xaba3f60
       __dd__Geometry__AD__lvADE--pvSST0xaba3f60.0             __dd__Materials__StainlessSteel0xadf7930
       __dd__Geometry__AD__lvADE--pvSST0xaba3f60.1             __dd__Materials__StainlessSteel0xadf7930

       http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__AD__lvADE--pvSST0xaba3f60.0.html
       http://belle7.nuu.edu.tw/dae/tree/3154.html
                  (4 children, one of which os the Oil)

     child(Oil)-parent(Steel) border

     Thanks to the double ambiguity, this should yield two surfaces ? One for each AD



[03] &lt;BorderSurface AdDetails__AdSurfacesNear__SSTWaterSurfaceNear1 REFLECTIVITY &gt;
     pv1 (1) Pool__lvNearPoolIWS--pvNearADE10xaa9d608
       __dd__Geometry__Pool__lvNearPoolIWS--pvNearADE10xaa9d608.0             __dd__Materials__IwsWater0xab82978

       http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__Pool__lvNearPoolIWS--pvNearADE10xaa9d608.0.html
       http://belle7.nuu.edu.tw/dae/tree/3153___1.html   cylindrical Iws containing SST

     pv2 (2) AD__lvADE--pvSST0xaba3f60
       __dd__Geometry__AD__lvADE--pvSST0xaba3f60.0             __dd__Materials__StainlessSteel0xadf7930
       __dd__Geometry__AD__lvADE--pvSST0xaba3f60.1             __dd__Materials__StainlessSteel0xadf7930

       http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__AD__lvADE--pvSST0xaba3f60.0.html
       http://belle7.nuu.edu.tw/dae/tree/3154.html
       http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__AD__lvADE--pvSST0xaba3f60.1.html
       http://belle7.nuu.edu.tw/dae/tree/4814.html

       Parent(water)-child(Steel),

[04] &lt;BorderSurface AdDetails__AdSurfacesNear__SSTWaterSurfaceNear2 REFLECTIVITY &gt;
     pv1 (1) Pool__lvNearPoolIWS--pvNearADE20xaaa18b8
       __dd__Geometry__Pool__lvNearPoolIWS--pvNearADE20xaaa18b8.0             __dd__Materials__IwsWater0xab82978

     pv2 (2) AD__lvADE--pvSST0xaba3f60
       __dd__Geometry__AD__lvADE--pvSST0xaba3f60.0             __dd__Materials__StainlessSteel0xadf7930
       __dd__Geometry__AD__lvADE--pvSST0xaba3f60.1             __dd__Materials__StainlessSteel0xadf7930

     Same for other AD, no ambiguity for pv1 but is for pv2


[05] &lt;BorderSurface PoolDetails__NearPoolSurfaces__NearIWSCurtainSurface BACKSCATTERCONSTANT,SPECULARSPIKECONSTANT,REFLECTIVITY,SPECULARLOBECONSTANT &gt;
     pv1 (1) Pool__lvNearPoolCurtain--pvNearPoolIWS0xae08fa0
       __dd__Geometry__Pool__lvNearPoolCurtain--pvNearPoolIWS0xae08fa0.0             __dd__Materials__IwsWater0xab82978

       http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__Pool__lvNearPoolCurtain--pvNearPoolIWS0xae08fa0.0.html
       http://belle7.nuu.edu.tw/dae/tree/3152.html


     pv2 (1) Pool__lvNearPoolOWS--pvNearPoolCurtain0xae9ba38
       __dd__Geometry__Pool__lvNearPoolOWS--pvNearPoolCurtain0xae9ba38.0             __dd__Materials__Tyvek0xab26538

       http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__Pool__lvNearPoolOWS--pvNearPoolCurtain0xae9ba38.0.html
       http://belle7.nuu.edu.tw/dae/tree/3151.html

       child-parent



[06] &lt;BorderSurface PoolDetails__NearPoolSurfaces__NearOWSLinerSurface BACKSCATTERCONSTANT,SPECULARSPIKECONSTANT,REFLECTIVITY,SPECULARLOBECONSTANT &gt;
     pv1 (1) Pool__lvNearPoolLiner--pvNearPoolOWS0xaa64f68
       __dd__Geometry__Pool__lvNearPoolLiner--pvNearPoolOWS0xaa64f68.0             __dd__Materials__OwsWater0xabb2118

       http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__Pool__lvNearPoolLiner--pvNearPoolOWS0xaa64f68.0.html
       http://belle7.nuu.edu.tw/dae/tree/3150.html

     pv2 (1) Pool__lvNearPoolDead--pvNearPoolLiner0xab6b300
       __dd__Geometry__Pool__lvNearPoolDead--pvNearPoolLiner0xab6b300.0             __dd__Materials__Tyvek0xab26538

       http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__Pool__lvNearPoolDead--pvNearPoolLiner0xab6b300.0.html
       http://belle7.nuu.edu.tw/dae/tree/3149.html

       child-parent


[07] &lt;BorderSurface PoolDetails__NearPoolSurfaces__NearDeadLinerSurface BACKSCATTERCONSTANT,SPECULARSPIKECONSTANT,REFLECTIVITY,SPECULARLOBECONSTANT &gt;

     pv1 (1) Sites__lvNearHallBot--pvNearPoolDead0xaa63ff0
       __dd__Geometry__Sites__lvNearHallBot--pvNearPoolDead0xaa63ff0.0             __dd__Materials__DeadWater0xaabb308

       http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__Sites__lvNearHallBot--pvNearPoolDead0xaa63ff0.0.html
       http://belle7.nuu.edu.tw/dae/tree/3148.html

     pv2 (1) Pool__lvNearPoolDead--pvNearPoolLiner0xab6b300
       __dd__Geometry__Pool__lvNearPoolDead--pvNearPoolLiner0xab6b300.0             __dd__Materials__Tyvek0xab26538

       http://belle7.nuu.edu.tw/dae/tree/__dd__Geometry__Pool__lvNearPoolDead--pvNearPoolLiner0xab6b300.0.html
       http://belle7.nuu.edu.tw/dae/tree/3149.html

     parent-child</pre>
</div>
<div class="section" id="how-deep-does-the-ambiguity-bug-go">
<h3>How deep does the ambiguity bug go ?<a class="headerlink" href="#how-deep-does-the-ambiguity-bug-go" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>GDML appending the pointer to volume IDs is a crutch, that assumes C++ instance identity
and PV identity are equivalent : this issue seems to indicates that is not true</li>
</ol>
</div>
<div class="section" id="check-vmrl-code">
<h3>Check VMRL code<a class="headerlink" href="#check-vmrl-code" title="Permalink to this headline">¶</a></h3>
<p><cite>G4VRML2SceneHandlerFunc.icc</cite>:</p>
<div class="highlight-python"><pre>169 void G4VRML2SCENEHANDLER::AddPrimitive(const G4Polyhedron&amp; polyhedron)
170 {
...
182     // Current Model
183     const G4VModel* pv_model  = GetModel();
184     G4String pv_name = "No model";
185         if (pv_model) pv_name = pv_model-&gt;GetCurrentTag() ;
186
187     // VRML codes are generated below
188
189     //std::cerr &lt;&lt; "SCB " &lt;&lt; pv_name &lt;&lt; "\n";
190     fDest &lt;&lt; "#---------- SOLID: " &lt;&lt; pv_name &lt;&lt; "\n";
191
192</pre>
</div>
<p><cite>visualization/modeling/include/G4VModel.hh</cite>:</p>
<div class="highlight-python"><pre>74   virtual G4String GetCurrentTag () const;
75   // A tag which depends on the current state of the model.
76</pre>
</div>
<p><cite>visualization/modeling/src/G4VModel.cc</cite>:</p>
<div class="highlight-python"><pre>49 G4String G4VModel::GetCurrentTag () const {
50   // Override in concrete class if concept of "current" is meaningful.
51   return fGlobalTag;
52 }</pre>
</div>
<p><cite>visualization/modeling/src/G4PhysicalVolumeModel.cc</cite>:</p>
<div class="highlight-python"><pre>181 G4String G4PhysicalVolumeModel::GetCurrentTag () const
182 {
183   if (fpCurrentPV) {
184     std::ostringstream o;
185     o &lt;&lt; fpCurrentPV -&gt; GetCopyNo ();
186     return fpCurrentPV -&gt; GetName () + "." + o.str();
187   }
188   else {
189     return "WARNING: NO CURRENT VOLUME - global tag is " + fGlobalTag;
190   }
191 }</pre>
</div>
</div>
<div class="section" id="pv-copyno">
<h3>PV CopyNo<a class="headerlink" href="#pv-copyno" title="Permalink to this headline">¶</a></h3>
<p><cite>geometry/management/include/G4VPhysicalVolume.hh</cite>:</p>
<div class="highlight-python"><pre>140     virtual G4bool IsMany() const = 0;
141       // Return true if the volume is MANY (not implemented yet).
142     virtual G4int GetCopyNo() const = 0;
143       // Return the volumes copy number.
144     virtual void  SetCopyNo(G4int CopyNo) = 0;
145       // Set the volumes copy number.
146     virtual G4bool IsReplicated() const = 0;
147       // Return true if replicated (single object instance represents
148       // many real volumes), else false.
149     virtual G4bool IsParameterised() const = 0;
150       // Return true if parameterised (single object instance represents
151       // many real parameterised volumes), else false.</pre>
</div>
<p><cite>geometry/volumes/src/G4PVPlacement.cc</cite>:</p>
<div class="highlight-python"><pre>174 // GetCopyNo
175 //
176 G4int G4PVPlacement::GetCopyNo() const
177 {
178   return fcopyNo;
179 }
180
181 // ----------------------------------------------------------------------
182 // SetCopyNo
183 //
184 void G4PVPlacement::SetCopyNo(G4int newCopyNo)
185 {
186   fcopyNo= newCopyNo;
187 }
188</pre>
</div>
<p>What is setting the CopyNo?:</p>
<div class="highlight-python"><pre>[blyth@belle7 source]$ find . -name '*.cc' -exec grep -H SetCopyNo {} \;
./persistency/ascii/src/G4tgbPlaceParamCircle.cc:  physVol-&gt;SetCopyNo( copyNo );
./persistency/ascii/src/G4tgbPlaceParamLinear.cc:  physVol-&gt;SetCopyNo( copyNo );
./persistency/ascii/src/G4tgbPlaceParamSquare.cc:  physVol-&gt;SetCopyNo( copyNo );
./visualization/modeling/src/G4PhysicalVolumeModel.cc:  pVPV -&gt; SetCopyNo (n);
./visualization/modeling/src/G4PhysicalVolumeModel.cc:  pVPV -&gt; SetCopyNo (n);
./geometry/volumes/src/G4PVReplica.cc:void  G4PVReplica::SetCopyNo(G4int newCopyNo)
./geometry/volumes/src/G4PVPlacement.cc:// SetCopyNo
./geometry/volumes/src/G4PVPlacement.cc:void G4PVPlacement::SetCopyNo(G4int newCopyNo)
./geometry/divisions/src/G4PVDivision.cc:void  G4PVDivision::SetCopyNo(G4int newCopyNo)
./geometry/navigation/src/G4RegularNavigation.cc:    pPhysical-&gt;SetCopyNo(replicaNo);
./geometry/navigation/src/G4ParameterisedNavigation.cc:        pPhysical-&gt;SetCopyNo(replicaNo);
./geometry/navigation/src/G4Navigator.cc:              fBlockedPhysicalVolume-&gt;SetCopyNo(fBlockedReplicaNo);
./geometry/navigation/src/G4Navigator.cc:                fBlockedPhysicalVolume-&gt;SetCopyNo(fBlockedReplicaNo);
[blyth@belle7 source]$</pre>
</div>
</div>
<div class="section" id="dae-copyno">
<h3>DAE CopyNo<a class="headerlink" href="#dae-copyno" title="Permalink to this headline">¶</a></h3>
<p>CopyNo is non trivial to persist into DAE, as DAE retains the tree structure unlike VRML2 that fully unwinds it.
The copyNo kinda emerges from the traverse. Despite this it is included in DAE metadata elements, but difficult
to interpret.</p>
</div>
</div>
<div class="section" id="dae-debug">
<h2>DAE Debug<a class="headerlink" href="#dae-debug" title="Permalink to this headline">¶</a></h2>
<p>Interleaving the bordersurface with the debug bsurf from the meta element. Observations:</p>
<ul class="simple">
<li>one extra bsurf,</li>
<li>copyNo not helping... presumably because of when it is requested, need to do this during the traverse somehow as the copyNo is being incremented</li>
</ul>
<div class="highlight-python"><pre>157610       &lt;bordersurface name="__dd__Geometry__AdDetails__AdSurfacesAll__ESRAirSurfaceTop" surfaceproperty="__dd__Geometry__AdDetails__AdSurfacesAll__ESRAirSurfaceTop"&gt;
157611         &lt;physvolref ref="__dd__Geometry__AdDetails__lvTopReflector--pvTopRefGap0xc05e0f0"/&gt;
157612         &lt;physvolref ref="__dd__Geometry__AdDetails__lvTopRefGap--pvTopESR0xc208d58"/&gt;
157613       &lt;/bordersurface&gt;
157614       &lt;bordersurface name="__dd__Geometry__AdDetails__AdSurfacesAll__ESRAirSurfaceBot" surfaceproperty="__dd__Geometry__AdDetails__AdSurfacesAll__ESRAirSurfaceBot"&gt;
157615         &lt;physvolref ref="__dd__Geometry__AdDetails__lvBotReflector--pvBotRefGap0xbd9e0e0"/&gt;
157616         &lt;physvolref ref="__dd__Geometry__AdDetails__lvBotRefGap--pvBotESR0xbd93990"/&gt;
157617       &lt;/bordersurface&gt;
157618       &lt;bordersurface name="__dd__Geometry__AdDetails__AdSurfacesAll__SSTOilSurface" surfaceproperty="__dd__Geometry__AdDetails__AdSurfacesAll__SSTOilSurface"&gt;
157619         &lt;physvolref ref="__dd__Geometry__AD__lvSST--pvOIL0xc039198"/&gt;
157620         &lt;physvolref ref="__dd__Geometry__AD__lvADE--pvSST0xbf20a18"/&gt;
157621       &lt;/bordersurface&gt;

157642       &lt;meta&gt;
157643         &lt;bsurf name="__dd__Geometry__AdDetails__AdSurfacesAll__ESRAirSurfaceTop" surfaceproperty="__dd__Geometry__AdDetails__AdSurfacesAll__ESRAirSurfaceTop"&gt;
157644           &lt;pv copyNo="1000" name="__dd__Geometry__AdDetails__lvTopReflector--pvTopRefGap" ref="__dd__Geometry__AdDetails__lvTopReflector--pvTopRefGap0xc05e0f0"/&gt;
157645           &lt;pv copyNo="1000" name="__dd__Geometry__AdDetails__lvTopRefGap--pvTopESR" ref="__dd__Geometry__AdDetails__lvTopRefGap--pvTopESR0xc208d58"/&gt;
157646         &lt;/bsurf&gt;
157647         &lt;bsurf name="__dd__Geometry__AdDetails__AdSurfacesAll__ESRAirSurfaceBot" surfaceproperty="__dd__Geometry__AdDetails__AdSurfacesAll__ESRAirSurfaceBot"&gt;
157648           &lt;pv copyNo="1000" name="__dd__Geometry__AdDetails__lvBotReflector--pvBotRefGap" ref="__dd__Geometry__AdDetails__lvBotReflector--pvBotRefGap0xbd9e0e0"/&gt;
157649           &lt;pv copyNo="1000" name="__dd__Geometry__AdDetails__lvBotRefGap--pvBotESR" ref="__dd__Geometry__AdDetails__lvBotRefGap--pvBotESR0xbd93990"/&gt;
157650         &lt;/bsurf&gt;
157651         &lt;bsurf name="__dd__Geometry__AdDetails__AdSurfacesAll__SSTOilSurface" surfaceproperty="__dd__Geometry__AdDetails__AdSurfacesAll__SSTOilSurface"&gt;
157652           &lt;pv copyNo="1000" name="__dd__Geometry__AD__lvSST--pvOIL" ref="__dd__Geometry__AD__lvSST--pvOIL0xc039198"/&gt;
157653           &lt;pv copyNo="1000" name="__dd__Geometry__AD__lvADE--pvSST" ref="__dd__Geometry__AD__lvADE--pvSST0xbf20a18"/&gt;
157654         &lt;/bsurf&gt;




157622       &lt;bordersurface name="__dd__Geometry__AdDetails__AdSurfacesNear__SSTWaterSurfaceNear1" surfaceproperty="__dd__Geometry__AdDetails__AdSurfacesNear__SSTWaterSurfaceNear1"&gt;
157623         &lt;physvolref ref="__dd__Geometry__Pool__lvNearPoolIWS--pvNearADE10xc0c71b0"/&gt;
157624         &lt;physvolref ref="__dd__Geometry__AD__lvADE--pvSST0xbf20a18"/&gt;
157625       &lt;/bordersurface&gt;
157626       &lt;bordersurface name="__dd__Geometry__AdDetails__AdSurfacesNear__SSTWaterSurfaceNear2" surfaceproperty="__dd__Geometry__AdDetails__AdSurfacesNear__SSTWaterSurfaceNear2"&gt;
157627         &lt;physvolref ref="__dd__Geometry__Pool__lvNearPoolIWS--pvNearADE20xbe3f650"/&gt;
157628         &lt;physvolref ref="__dd__Geometry__AD__lvADE--pvSST0xbf20a18"/&gt;
157629       &lt;/bordersurface&gt;

157655         &lt;bsurf name="__dd__Geometry__AdDetails__AdSurfacesNear__SSTWaterSurfaceNear1" surfaceproperty="__dd__Geometry__AdDetails__AdSurfacesNear__SSTWaterSurfaceNear1"&gt;
157656           &lt;pv copyNo="1000" name="__dd__Geometry__Pool__lvNearPoolIWS--pvNearADE1" ref="__dd__Geometry__Pool__lvNearPoolIWS--pvNearADE10xc0c71b0"/&gt;
157657           &lt;pv copyNo="1000" name="__dd__Geometry__AD__lvADE--pvSST" ref="__dd__Geometry__AD__lvADE--pvSST0xbf20a18"/&gt;
157658         &lt;/bsurf&gt;
157659         &lt;bsurf name="__dd__Geometry__AdDetails__AdSurfacesNear__SSTWaterSurfaceNear2" surfaceproperty="__dd__Geometry__AdDetails__AdSurfacesNear__SSTWaterSurfaceNear2"&gt;
157660           &lt;pv copyNo="1001" name="__dd__Geometry__Pool__lvNearPoolIWS--pvNearADE2" ref="__dd__Geometry__Pool__lvNearPoolIWS--pvNearADE20xbe3f650"/&gt;
157661           &lt;pv copyNo="1000" name="__dd__Geometry__AD__lvADE--pvSST" ref="__dd__Geometry__AD__lvADE--pvSST0xbf20a18"/&gt;
157662         &lt;/bsurf&gt;




157630       &lt;bordersurface name="__dd__Geometry__PoolDetails__NearPoolSurfaces__NearIWSCurtainSurface" surfaceproperty="__dd__Geometry__PoolDetails__NearPoolSurfaces__NearIWSCurtainSurface"&gt;
157631         &lt;physvolref ref="__dd__Geometry__Pool__lvNearPoolCurtain--pvNearPoolIWS0xbf52120"/&gt;
157632         &lt;physvolref ref="__dd__Geometry__Pool__lvNearPoolOWS--pvNearPoolCurtain0xc3bdb90"/&gt;
157633       &lt;/bordersurface&gt;

157675         &lt;bsurf name="__dd__Geometry__PoolDetails__NearPoolSurfaces__NearIWSCurtainSurface" surfaceproperty="__dd__Geometry__PoolDetails__NearPoolSurfaces__NearIWSCurtainSurface"&gt;
157676           &lt;pv copyNo="1000" name="__dd__Geometry__Pool__lvNearPoolCurtain--pvNearPoolIWS" ref="__dd__Geometry__Pool__lvNearPoolCurtain--pvNearPoolIWS0xbf52120"/&gt;
157677           &lt;pv copyNo="1000" name="__dd__Geometry__Pool__lvNearPoolOWS--pvNearPoolCurtain" ref="__dd__Geometry__Pool__lvNearPoolOWS--pvNearPoolCurtain0xc3bdb90"/&gt;
157678         &lt;/bsurf&gt;



157634       &lt;bordersurface name="__dd__Geometry__PoolDetails__NearPoolSurfaces__NearOWSLinerSurface" surfaceproperty="__dd__Geometry__PoolDetails__NearPoolSurfaces__NearOWSLinerSurface"&gt;
157635         &lt;physvolref ref="__dd__Geometry__Pool__lvNearPoolLiner--pvNearPoolOWS0xbd579a8"/&gt;
157636         &lt;physvolref ref="__dd__Geometry__Pool__lvNearPoolDead--pvNearPoolLiner0xbd42ef8"/&gt;
157637       &lt;/bordersurface&gt;

157663         &lt;bsurf name="__dd__Geometry__PoolDetails__NearPoolSurfaces__NearOWSLinerSurface" surfaceproperty="__dd__Geometry__PoolDetails__NearPoolSurfaces__NearOWSLinerSurface"&gt;
157664           &lt;pv copyNo="1000" name="__dd__Geometry__Pool__lvNearPoolLiner--pvNearPoolOWS" ref="__dd__Geometry__Pool__lvNearPoolLiner--pvNearPoolOWS0xbd579a8"/&gt;
157665           &lt;pv copyNo="1000" name="__dd__Geometry__Pool__lvNearPoolDead--pvNearPoolLiner" ref="__dd__Geometry__Pool__lvNearPoolDead--pvNearPoolLiner0xbd42ef8"/&gt;
157666         &lt;/bsurf&gt;

   ########### HUH THIS ONE WITH SAME PV1 AS PRIOR IS MISSING IN THE ABOVE
   ########### THE GDML EXTRACTED CODE THAT JUST CHECKS THE FIRST OF THE PAIR IS WRONG

157671         &lt;bsurf name="__dd__Geometry__PoolDetails__NearPoolSurfaces__NearOWSCurtainSurface" surfaceproperty="__dd__Geometry__PoolDetails__NearPoolSurfaces__NearOWSCurtainSurface"&gt;
157672           &lt;pv copyNo="1000" name="__dd__Geometry__Pool__lvNearPoolLiner--pvNearPoolOWS" ref="__dd__Geometry__Pool__lvNearPoolLiner--pvNearPoolOWS0xbd579a8"/&gt;
157673           &lt;pv copyNo="1000" name="__dd__Geometry__Pool__lvNearPoolOWS--pvNearPoolCurtain" ref="__dd__Geometry__Pool__lvNearPoolOWS--pvNearPoolCurtain0xc3bdb90"/&gt;
157674         &lt;/bsurf&gt;




157638       &lt;bordersurface name="__dd__Geometry__PoolDetails__NearPoolSurfaces__NearDeadLinerSurface" surfaceproperty="__dd__Geometry__PoolDetails__NearPoolSurfaces__NearDeadLinerSurface"&gt;
157639         &lt;physvolref ref="__dd__Geometry__Sites__lvNearHallBot--pvNearPoolDead0xbf33ca0"/&gt;
157640         &lt;physvolref ref="__dd__Geometry__Pool__lvNearPoolDead--pvNearPoolLiner0xbd42ef8"/&gt;
157641       &lt;/bordersurface&gt;

157667         &lt;bsurf name="__dd__Geometry__PoolDetails__NearPoolSurfaces__NearDeadLinerSurface" surfaceproperty="__dd__Geometry__PoolDetails__NearPoolSurfaces__NearDeadLinerSurface"&gt;
157668           &lt;pv copyNo="1000" name="__dd__Geometry__Sites__lvNearHallBot--pvNearPoolDead" ref="__dd__Geometry__Sites__lvNearHallBot--pvNearPoolDead0xbf33ca0"/&gt;
157669           &lt;pv copyNo="1000" name="__dd__Geometry__Pool__lvNearPoolDead--pvNearPoolLiner" ref="__dd__Geometry__Pool__lvNearPoolDead--pvNearPoolLiner0xbd42ef8"/&gt;
157670         &lt;/bsurf&gt;




157679       &lt;/meta&gt;
157680     &lt;/extra&gt;
157681   &lt;/library_nodes&gt;</pre>
</div>
</div>
<div class="section" id="giga-creation">
<h2>GiGa Creation<a class="headerlink" href="#giga-creation" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>[blyth@belle7 lhcb]$ find . -name '*.cpp' -exec grep -H G4LogicalBorderSurface {} \;
./Sim/GiGaCnv/src/component/GiGaSurfaceCnv.cpp:#include  "G4LogicalBorderSurface.hh"
./Sim/GiGaCnv/src/component/GiGaSurfaceCnv.cpp:  G4LogicalBorderSurface* surf =
./Sim/GiGaCnv/src/component/GiGaSurfaceCnv.cpp:    G4LogicalBorderSurface::GetSurface( pv1 , pv2 );
./Sim/GiGaCnv/src/component/GiGaSurfaceCnv.cpp:    { logsurf = new G4LogicalBorderSurface( surface-&gt;registry()-&gt;identifier() ,
[blyth@belle7 lhcb]$</pre>
</div>
</div>
<div class="section" id="ambiguity-by-design-detdesc-xml-would-suggest-so">
<h2>Ambiguity By Design ? Detdesc XML would suggest so<a class="headerlink" href="#ambiguity-by-design-detdesc-xml-would-suggest-so" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>see geant4/geometry/materials/dd.py for detdesc parsing</li>
</ul>
<div class="highlight-python"><pre>[blyth@belle7 DDDB]$ pwd
/data1/env/local/dybx/NuWa-trunk/dybgaudi/Detector/XmlDetDesc/DDDB

[blyth@belle7 DDDB]$ find . -name surfaces.xml
./AdDetails/surfaces.xml
./Parameters/surfaces.xml
./AdDetails_213/surfaces.xml
./PoolDetails/surfaces.xml</pre>
</div>
<p>Only one surface definition for all such reflectors in all ADs ?</p>
<p>AdDetails/surfaces.xml:</p>
<div class="highlight-python"><pre>43
44   &lt;!-- Reflector top and bottom --&gt;
45
46   &lt;surface name="ESRAirSurfaceTop"
47        model="unified"
48        finish="polished"
49        type="dielectric_metal"
50        value="0.0"
51        volfirst="/dd/Geometry/AdDetails/lvTopReflector#pvTopRefGap"
52        volsecond="/dd/Geometry/AdDetails/lvTopRefGap#pvTopESR"&gt;
53     &lt;tabprops address="/dd/Geometry/AdDetails/AdTabProperties/ESRAirReflectivity"/&gt;
54   &lt;/surface&gt;
55   &lt;surface name="ESRAirSurfaceBot"
56        model="unified"
57        finish="polished"
58        type="dielectric_metal"
59        value="0.0"
60        volfirst="/dd/Geometry/AdDetails/lvBotReflector#pvBotRefGap"
61        volsecond="/dd/Geometry/AdDetails/lvBotRefGap#pvBotESR"&gt;
62     &lt;tabprops address="/dd/Geometry/AdDetails/AdTabProperties/ESRAirReflectivity"/&gt;
63   &lt;/surface&gt;</pre>
</div>
<p>Parameters/surfaces.xml:</p>
<div class="highlight-python"><pre>09 &lt;!-- Geant4's G4OpticalSurface enums --&gt;
10 &lt;parameter name="polished" value="0"/&gt;
11 &lt;parameter name="polishedfrontpainted" value="1" /&gt;
12 &lt;parameter name="polishedbackpainted" value="2" /&gt;
13 &lt;parameter name="ground" value="3" /&gt;
14 &lt;parameter name="groundfrontpainted" value="4" /&gt;
15 &lt;parameter name="groundbackpainted" value="5" /&gt;
16
17 &lt;parameter name="dielectric_metal" value="0" /&gt;
18 &lt;parameter name="dielectric_dielectric" value="1" /&gt;
19
20 &lt;parameter name="glisur" value="0" /&gt;
21 &lt;parameter name="unified" value="1" /&gt;</pre>
</div>
<div class="highlight-python"><pre>[blyth@belle7 DDDB]$ diff AdDetails/surfaces.xml AdDetails_213/surfaces.xml
6a7,8
&gt; &lt;!-- Modified for 2-1-3 configuration --&gt;
&gt;
18c20
&lt;     &lt;surfaceref href="#SSTWaterSurfaceNear2"/&gt;
---
&gt;     &lt;!-- REMOVED surfaceref href="#SSTWaterSurfaceNear2"/ Unneeded for 2-1-3 config --&gt;
24c26
&lt;     &lt;surfaceref href="#SSTWaterSurfaceFar4"/&gt;
---
&gt;     &lt;!-- REMOVED surfaceref href="#SSTWaterSurfaceFar4"/  Unneeded for 2-1-3 config --&gt;
28,37c30,39
&lt;     &lt;tabpropertyref href="properties.xml#RSOilReflectivity"/&gt; &lt;!--Radial Shield--&gt;
&lt;     &lt;tabpropertyref href="properties.xml#RSOilSpecularLobe"/&gt; &lt;!--Radial Shield--&gt;
&lt;     &lt;tabpropertyref href="properties.xml#RSOilSpecularSpike"/&gt; &lt;!--Radial Shield--&gt;
&lt;     &lt;tabpropertyref href="properties.xml#RSOilBackScattering"/&gt; &lt;!--Radial Shield--&gt;
&lt;     &lt;tabpropertyref href="properties.xml#ESRAirReflectivity"/&gt;
&lt;     &lt;tabpropertyref href="properties.xml#ESRAirSpecularLobe"/&gt;
&lt;     &lt;tabpropertyref href="properties.xml#ESRAirSpecularSpike"/&gt;
&lt;     &lt;tabpropertyref href="properties.xml#ESRAirBackScattering"/&gt;
&lt;     &lt;tabpropertyref href="properties.xml#SSTOilReflectivity"/&gt;
&lt;     &lt;tabpropertyref href="properties.xml#SSTWaterReflectivity"/&gt;
---
&gt;     &lt;tabpropertyref href="../AdDetails/properties.xml#RSOilReflectivity"/&gt; &lt;!--Radial Shield--&gt;
&gt;     &lt;tabpropertyref href="../AdDetails/properties.xml#RSOilSpecularLobe"/&gt; &lt;!--Radial Shield--&gt;
&gt;     &lt;tabpropertyref href="../AdDetails/properties.xml#RSOilSpecularSpike"/&gt; &lt;!--Radial Shield--&gt;
&gt;     &lt;tabpropertyref href="../AdDetails/properties.xml#RSOilBackScattering"/&gt; &lt;!--Radial Shield--&gt;
&gt;     &lt;tabpropertyref href="../AdDetails/properties.xml#ESRAirReflectivity"/&gt;
&gt;     &lt;tabpropertyref href="../AdDetails/properties.xml#ESRAirSpecularLobe"/&gt;
&gt;     &lt;tabpropertyref href="../AdDetails/properties.xml#ESRAirSpecularSpike"/&gt;
&gt;     &lt;tabpropertyref href="../AdDetails/properties.xml#ESRAirBackScattering"/&gt;
&gt;     &lt;tabpropertyref href="../AdDetails/properties.xml#SSTOilReflectivity"/&gt;
&gt;     &lt;tabpropertyref href="../AdDetails/properties.xml#SSTWaterReflectivity"/&gt;
88,96c90,92
&lt;   &lt;surface name="SSTWaterSurfaceNear2"
&lt;          model="unified"
&lt;          finish="ground"
&lt;          type="dielectric_metal"
&lt;          value="1.0"
&lt;          volfirst="/dd/Geometry/Pool/lvNearPoolIWS#pvNearADE2"
&lt;          volsecond="/dd/Geometry/AD/lvADE#pvSST"&gt;
&lt;     &lt;tabprops address="/dd/Geometry/AdDetails/AdTabProperties/SSTWaterReflectivity"/&gt;
&lt;   &lt;/surface&gt;
---
&gt;
&gt;   &lt;!-- Removed pvNearADE2 for 2-1-3 configuration --&gt;
&gt;
128,136c124,125
&lt;   &lt;surface name="SSTWaterSurfaceFar4"
&lt;          model="unified"
&lt;          finish="ground"
&lt;          type="dielectric_metal"
&lt;          value="1.0"
&lt;          volfirst="/dd/Geometry/Pool/lvFarPoolIWS#pvFarADE4"
&lt;          volsecond="/dd/Geometry/AD/lvADE#pvSST"&gt;
&lt;     &lt;tabprops address="/dd/Geometry/AdDetails/AdTabProperties/SSTWaterReflectivity"/&gt;
&lt;   &lt;/surface&gt;
---
&gt;
&gt;   &lt;!-- Removed pvFarADE4 for 2-1-3 configuration --&gt;
[blyth@belle7 DDDB]$</pre>
</div>
</div>
<div class="section" id="bordersurface-debug-during-traverse">
<h2>BorderSurface Debug during traverse<a class="headerlink" href="#bordersurface-debug-during-traverse" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>PV2 matches on the volume before (the mother ?)</li>
</ul>
<div class="highlight-python"><pre>G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvOIL#pvRadialShield:27[27]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvOIL#pvRadialShield:28[28]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvOIL#pvRadialShield:29[29]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvOIL#pvRadialShield:30[30]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvOIL#pvRadialShield:31[31]

G4DAE::GetBorderSurface ... /dd/Geometry/AdDetails/lvTopRefGap#pvTopESR[1000]
G4DAE::GetBorderSurface surf PV2 match
         PV1 [copyNo]name [1000]/dd/Geometry/AdDetails/lvTopReflector#pvTopRefGap
         PV2 [copyNo]name [1000]/dd/Geometry/AdDetails/lvTopRefGap#pvTopESR
G4DAE::GetBorderSurface ... /dd/Geometry/AdDetails/lvTopReflector#pvTopRefGap[1000]
G4DAE::GetBorderSurface surf_first_pv1
         PV1 [copyNo]name [1000]/dd/Geometry/AdDetails/lvTopReflector#pvTopRefGap
         PV2 [copyNo]name [1000]/dd/Geometry/AdDetails/lvTopRefGap#pvTopESR
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvOIL#pvTopReflector[1429]
G4DAE::GetBorderSurface ... /dd/Geometry/AdDetails/lvBotRefGap#pvBotESR[1000]
G4DAE::GetBorderSurface surf PV2 match
         PV1 [copyNo]name [1000]/dd/Geometry/AdDetails/lvBotReflector#pvBotRefGap
         PV2 [copyNo]name [1000]/dd/Geometry/AdDetails/lvBotRefGap#pvBotESR
G4DAE::GetBorderSurface ... /dd/Geometry/AdDetails/lvBotReflector#pvBotRefGap[1000]
G4DAE::GetBorderSurface surf_first_pv1
         PV1 [copyNo]name [1000]/dd/Geometry/AdDetails/lvBotReflector#pvBotRefGap
         PV2 [copyNo]name [1000]/dd/Geometry/AdDetails/lvBotRefGap#pvBotESR
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvOIL#pvBotReflector[1430]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvOIL#pvSstBotRadiusRibs#SstBotRibs#SstBotRibRot[1431]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvOIL#pvSstBotRadiusRibs#SstBotRibs:1#SstBotRibRot[1]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvOIL#pvSstBotRadiusRibs#SstBotRibs:2#SstBotRibRot[2]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvOIL#pvSstBotRadiusRibs#SstBotRibs:3#SstBotRibRot[3]



G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvOIL#pvWallUpperLedSourceAssy[1517]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvOIL#pvWallMidLedSourceAssy[1518]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvOIL#pvWallBotLedSourceAssy[1519]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvSST#pvOIL[1000]
G4DAE::GetBorderSurface surf_first_pv1
         PV1 [copyNo]name [1000]/dd/Geometry/AD/lvSST#pvOIL
         PV2 [copyNo]name [1000]/dd/Geometry/AD/lvADE#pvSST
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvSST#lvCenterCalibHoleSST[1001]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvSST#pvOffCenterCalibHoleSST[1002]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvSST#pvGCatCalibHoleSST[1003]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvADE#pvSST[1000]
G4DAE::GetBorderSurface surf PV2 match
         PV1 [copyNo]name [1000]/dd/Geometry/AD/lvSST#pvOIL
         PV2 [copyNo]name [1000]/dd/Geometry/AD/lvADE#pvSST
G4DAE::GetBorderSurface surf PV2 match
         PV1 [copyNo]name [1000]/dd/Geometry/Pool/lvNearPoolIWS#pvNearADE1
         PV2 [copyNo]name [1000]/dd/Geometry/AD/lvADE#pvSST
G4DAE::GetBorderSurface surf PV2 match
         PV1 [copyNo]name [1001]/dd/Geometry/Pool/lvNearPoolIWS#pvNearADE2
         PV2 [copyNo]name [1000]/dd/Geometry/AD/lvADE#pvSST
G4DAE::GetBorderSurface ... /dd/Geometry/CalibrationBox/lvCenterCalibE#pvCenterBottomPlate[1000]
G4DAE::GetBorderSurface ... /dd/Geometry/CalibrationBox/lvDomeInterior#pvShieldingPuck[1000]
G4DAE::GetBorderSurface ... /dd/Geometry/CalibrationBox/lvDomeInterior#pvBearingRing[1001]
G4DAE::GetBorderSurface ... /dd/Geometry/CalibrationBox/lvDomeInterior#pvTurntableLowerPlate[1002]



G4DAE::GetBorderSurface ... /dd/Geometry/AdDetails/lvMOOverflowTankE#pvMOFTTopFlangeInterior[1004]
G4DAE::GetBorderSurface ... /dd/Geometry/AdDetails/lvMOOverflowTankE#pvMOFTTopCover[1005]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvADE#pvlvMOOverflowTankE1[1009]
G4DAE::GetBorderSurface ... /dd/Geometry/AD/lvADE#pvlvMOOverflowTankE2[1010]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolIWS#pvNearADE1[1000]
G4DAE::GetBorderSurface surf_first_pv1
         PV1 [copyNo]name [1000]/dd/Geometry/Pool/lvNearPoolIWS#pvNearADE1
         PV2 [copyNo]name [1000]/dd/Geometry/AD/lvADE#pvSST
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolIWS#pvNearADE2[1001]
G4DAE::GetBorderSurface surf_first_pv1
         PV1 [copyNo]name [1001]/dd/Geometry/Pool/lvNearPoolIWS#pvNearADE2
         PV2 [copyNo]name [1000]/dd/Geometry/AD/lvADE#pvSST
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolIWS#pvVetoPmtNearInn#pvNearInnWall1#pvNearInnWall1:1#pvVetoPmtUnit#pvPmtHemi[1]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolIWS#pvVetoPmtNearInn#pvNearInnWall1#pvNearInnWall1:1#pvVetoPmtUnit#pvPmtMount#pvPmtTopRing[1]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolIWS#pvVetoPmtNearInn#pvNearInnWall1#pvNearInnWall1:1#pvVetoPmtUnit#pvPmtMount#pvPmtBaseRing[1]



G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolOWS#pvNearMuonCableTray#pvMuonCableTrayNear:2#MuonHalfCableTrayNear:7[2]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolOWS#pvOutWaterPipeNear#OutWaterPipeNear:1[1]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolOWS#pvOutWaterPipeNear#OutWaterPipeNear:2[2]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolLiner#pvNearPoolOWS[1000]
G4DAE::GetBorderSurface surf_first_pv1
         PV1 [copyNo]name [1000]/dd/Geometry/Pool/lvNearPoolLiner#pvNearPoolOWS
         PV2 [copyNo]name [1000]/dd/Geometry/Pool/lvNearPoolDead#pvNearPoolLiner
G4DAE::GetBorderSurface surf other PV1 match
         PV1 [copyNo]name [1000]/dd/Geometry/Pool/lvNearPoolLiner#pvNearPoolOWS
         PV2 [copyNo]name [1000]/dd/Geometry/Pool/lvNearPoolOWS#pvNearPoolCurtain
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolLiner#pvNearADE1LinerLegs#pvLegInLiner:1#pvLegInLinerUnit[1]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolLiner#pvNearADE1LinerLegs#pvLegInLiner:2#pvLegInLinerUnit[2]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolLiner#pvNearADE1LinerLegs#pvLegInLiner:3#pvLegInLinerUnit[3]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolLiner#pvNearADE1LinerLegs#pvLegInLiner:4#pvLegInLinerUnit[4]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolLiner#pvNearADE2LinerLegs#pvLegInLiner:1#pvLegInLinerUnit[1]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolLiner#pvNearADE2LinerLegs#pvLegInLiner:2#pvLegInLinerUnit[2]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolLiner#pvNearADE2LinerLegs#pvLegInLiner:3#pvLegInLinerUnit[3]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolLiner#pvNearADE2LinerLegs#pvLegInLiner:4#pvLegInLinerUnit[4]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolDead#pvNearPoolLiner[1000]
G4DAE::GetBorderSurface surf PV2 match
         PV1 [copyNo]name [1000]/dd/Geometry/Pool/lvNearPoolLiner#pvNearPoolOWS
         PV2 [copyNo]name [1000]/dd/Geometry/Pool/lvNearPoolDead#pvNearPoolLiner
G4DAE::GetBorderSurface surf PV2 match
         PV1 [copyNo]name [1000]/dd/Geometry/Sites/lvNearHallBot#pvNearPoolDead
         PV2 [copyNo]name [1000]/dd/Geometry/Pool/lvNearPoolDead#pvNearPoolLiner
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolDead#pvNearADE1DeadLegs#pvLegInDead:1#pvLegInDeadUnit[1]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolDead#pvNearADE1DeadLegs#pvLegInDead:2#pvLegInDeadUnit[2]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolDead#pvNearADE1DeadLegs#pvLegInDead:3#pvLegInDeadUnit[3]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolDead#pvNearADE1DeadLegs#pvLegInDead:4#pvLegInDeadUnit[4]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolDead#pvNearADE2DeadLegs#pvLegInDead:1#pvLegInDeadUnit[1]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolDead#pvNearADE2DeadLegs#pvLegInDead:2#pvLegInDeadUnit[2]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolDead#pvNearADE2DeadLegs#pvLegInDead:3#pvLegInDeadUnit[3]
G4DAE::GetBorderSurface ... /dd/Geometry/Pool/lvNearPoolDead#pvNearADE2DeadLegs#pvLegInDead:4#pvLegInDeadUnit[4]
G4DAE::GetBorderSurface ... /dd/Geometry/Sites/lvNearHallBot#pvNearPoolDead[1000]
G4DAE::GetBorderSurface surf_first_pv1
         PV1 [copyNo]name [1000]/dd/Geometry/Sites/lvNearHallBot#pvNearPoolDead
         PV2 [copyNo]name [1000]/dd/Geometry/Pool/lvNearPoolDead#pvNearPoolLiner
G4DAE::GetBorderSurface ... /dd/Geometry/Sites/lvNearHallBot#pvNearHallRadSlabs#pvNearHallRadSlab1[1001]
G4DAE::GetBorderSurface ... /dd/Geometry/Sites/lvNearHallBot#pvNearHallRadSlabs#pvNearHallRadSlab2[1002]
G4DAE::GetBorderSurface ... /dd/Geometry/Sites/lvNearHallBot#pvNearHallRadSlabs#pvNearHallRadSlab3[1003]
G4DAE::GetBorderSurface ... /dd/Geometry/Sites/lvNearHallBot#pvNearHallRadSlabs#pvNearHallRadSlab4[1004]
G4DAE::GetBorderSurface ... /dd/Geometry/Sites/lvNearHallBot#pvNearHallRadSlabs#pvNearHallRadSlab5[1005]</pre>
</div>
<div class="sidebar">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../opticalsurface/" title="G4OpticalSurface"
             >next</a> |</li>
        <li class="right" >
          <a href="../" title="surfaces"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../../" >geant4</a> &raquo;</li>
          <li><a href="../../" >Geant4 Geometry Export</a> &raquo;</li>
          <li><a href="../" >surfaces</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>