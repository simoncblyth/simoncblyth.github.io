<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Geant4 StackingAction &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../../" />
    <link rel="up" title="Geant4 Event" href="../" />
    <link rel="next" title="Geant4 StackManager" href="../geant4_stackmanager/" />
    <link rel="prev" title="Geant4 EventManager" href="../geant4_eventmanager/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../geant4_stackmanager/" title="Geant4 StackManager"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../geant4_eventmanager/" title="Geant4 EventManager"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../" >geant4</a> &raquo;</li>
          <li><a href="../" accesskey="U">Geant4 Event</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pycuda/">pycuda</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../">geant4</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../release_notes/">Geant4 Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../geant4_gpu/">Geant4 GPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../geant4_profiling/">Geant4 Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes/">Geant4 Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../verbosity/">Verbosity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../docs/">Geant4 Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../giga/">GiGa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/">Geant4 API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../opticalphoton/">Geant4 Optical Photon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../processes/">Geant4 Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../medical/">Medical Communities Using Geant4 (esp. optical photon)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../geometry/">Geant4 Geometry Export</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../g4py/">g4py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nuwa/">nuwa</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../">Geant4 Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../geant4_future_doe/">Geant4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../geant4_multi_threading/">Geant4 Multi Threading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hg/">hg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../simoncblyth.bitbucket.org/">simoncblyth.bitbucket.org</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../numpy/">numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../presentation/">Muon Simulation Presentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../optix/">optix</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../_sources/geant4/event/geant4_stackingaction.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../geant4_eventmanager/"
                        title="previous chapter">Geant4 EventManager</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../geant4_stackmanager/"
                        title="next chapter">Geant4 StackManager</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="geant4-stackingaction">
<h1>Geant4 StackingAction<a class="headerlink" href="#geant4-stackingaction" title="Permalink to this headline">¶</a></h1>
<div class="section" id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://geant4.web.cern.ch/geant4/G4UsersDocuments/UsersGuides/ForApplicationDeveloper/html/UserActions/OptionalActions.html">http://geant4.web.cern.ch/geant4/G4UsersDocuments/UsersGuides/ForApplicationDeveloper/html/UserActions/OptionalActions.html</a></li>
</ul>
</div>
<div class="section" id="g4userstackingaction">
<h2>G4UserStackingAction<a class="headerlink" href="#g4userstackingaction" title="Permalink to this headline">¶</a></h2>
<p><cite>source/event/include/G4UserStackingAction.hh</cite>:</p>
<div class="highlight-python"><pre>44 class G4UserStackingAction
45 {
46   public:
47       G4UserStackingAction();
48       virtual ~G4UserStackingAction();
49   protected:
50       G4StackManager * stackManager;
51   public:
52       inline void SetStackManager(G4StackManager * value)
53       { stackManager = value; }
54
55   public: // with description
56 //---------------------------------------------------------------
57 // vitual methods to be implemented by user
58 //---------------------------------------------------------------
59 //
60       virtual G4ClassificationOfNewTrack
61         ClassifyNewTrack(const G4Track* aTrack);</pre>
</div>
</div>
<div class="section" id="documentation-extracts">
<h2>Documentation Extracts<a class="headerlink" href="#documentation-extracts" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://geant4.web.cern.ch/geant4/G4UsersDocuments/UsersGuides/ForApplicationDeveloper/html/UserActions/OptionalActions.html">http://geant4.web.cern.ch/geant4/G4UsersDocuments/UsersGuides/ForApplicationDeveloper/html/UserActions/OptionalActions.html</a></li>
</ul>
<div class="section" id="classifynewtrack">
<h3>ClassifyNewTrack<a class="headerlink" href="#classifynewtrack" title="Permalink to this headline">¶</a></h3>
<p><cite>ClassifyNewTrack()</cite> is invoked by <cite>G4StackManager</cite> whenever a new <cite>G4Track</cite>
object is &#8220;pushed&#8221; onto a stack by <cite>G4EventManager</cite>.  <cite>ClassifyNewTrack()</cite>
returns an enumerator, <cite>G4ClassificationOfNewTrack</cite>, whose value indicates to
which stack, if any, the track will be sent.  This value should be determined
by the user. <cite>G4ClassificationOfNewTrack</cite> has four possible values:</p>
<ol class="arabic simple">
<li><cite>fUrgent</cite> - track is placed in the urgent stack</li>
<li><cite>fWaiting</cite> - track is placed in the waiting stack, and will not be simulated until the urgent stack is empty</li>
<li><cite>fPostpone</cite> - track is postponed to the next event</li>
<li><cite>fKill</cite> - the track is deleted immediately and not stored in any stack.</li>
</ol>
<p>These assignments may be made based on the origin of the track which is obtained as follows:
<cite>G4int parent_ID = aTrack-&gt;get_parentID();</cite>
where</p>
<ol class="arabic simple">
<li><cite>parent_ID = 0</cite> indicates a primary particle</li>
<li><cite>parent_ID &gt; 0</cite> indicates a secondary particle</li>
<li><cite>parent_ID &lt; 0</cite> indicates postponed particle from previous event.</li>
</ol>
<ul class="simple">
<li>always returning <cite>fUrgent</cite> would result in stepping proceeding
for tracks as they arise, ie with OP mixed up with everything else</li>
</ul>
</div>
<div class="section" id="newstage-deal-with-the-wait-stack">
<h3>NewStage : deal with the wait stack<a class="headerlink" href="#newstage-deal-with-the-wait-stack" title="Permalink to this headline">¶</a></h3>
<p><cite>NewStage()</cite> is invoked when the urgent stack is empty and the waiting stack
contains at least one <cite>G4Track</cite> object.  Here the user may kill or re-assign to
different stacks all the tracks in the waiting stack by calling the
<cite>stackManager-&gt;ReClassify()</cite> method which, in turn, calls the
<cite>ClassifyNewTrack()</cite> method.</p>
<p>If no user action is taken, all tracks in the waiting stack are transferred to
the urgent stack.</p>
<ul class="simple">
<li>HMM: so can see how long the Optical Photons are taking could first
collect them into the wait stack and then &#8220;do nothing&#8221; at NewStage</li>
</ul>
<p>The user may also decide to abort the current event even though some tracks may
remain in the waiting stack by calling <cite>stackManager-&gt;clear()</cite>.  This method is
valid and safe only if it is called from the <cite>G4UserStackingAction</cite> class.</p>
<p>A global method of event abortion is:</p>
<div class="highlight-python"><pre>G4UImanager * UImanager = G4UImanager::GetUIpointer();
UImanager-&gt;ApplyCommand("/event/abort");</pre>
</div>
</div>
<div class="section" id="preparenewevent">
<h3>PrepareNewEvent<a class="headerlink" href="#preparenewevent" title="Permalink to this headline">¶</a></h3>
<p><cite>PrepareNewEvent()</cite> is invoked at the beginning of each event. At this point no
primary particles have been converted to tracks, so the urgent and waiting
stacks are empty. However, there may be tracks in the postponed-to-next-event
stack; for each of these the <cite>ClassifyNewTrack()</cite> method is called and the track
is assigned to the appropriate stack.</p>
</div>
</div>
<div class="section" id="stackingaction-source">
<h2>StackingAction Source<a class="headerlink" href="#stackingaction-source" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>delta:geant4.10.00.p01 blyth$ find source -name '*.cc' -exec grep -l StackingAction {} \;

source/run/src/G4RunManager.cc                         #  just holds userStackingAction property
source/event/src/G4EventManager.cc                     #  just holds userStackingAction property also
source/event/src/G4StackManager.cc                     #  invokes the action and acts on classification in G4StackManager::PushOneTrack

source/event/src/G4AdjointStackingAction.cc
source/event/src/G4UserStackingAction.cc               # default empty-ish implementation

source/run/src/G4AdjointSimManager.cc
source/run/src/G4MaterialScanner.cc
source/run/src/G4MTRunManager.cc
source/run/src/G4VUserActionInitialization.cc
source/run/src/G4WorkerRunManager.cc

source/visualization/RayTracer/src/G4RTWorkerInitialization.cc
source/visualization/RayTracer/src/G4TheRayTracer.cc</pre>
</div>
<div class="highlight-python"><pre>813 void G4RunManager::SetUserAction(G4UserStackingAction* userAction)
814 {
815   eventManager-&gt;SetUserAction(userAction);
816   userStackingAction = userAction;
817 }

315 void G4EventManager::SetUserAction(G4UserStackingAction* userAction)
316 {
317   userStackingAction = userAction;
318   trackContainer-&gt;SetUserStackingAction(userAction);        ## trackContainer is G4StackManager
319 }</pre>
</div>
<div class="highlight-python"><pre>57 G4ClassificationOfNewTrack G4UserStackingAction::ClassifyNewTrack
58 (const G4Track*)
59 {
60   return fUrgent;
61 }
62
63 void G4UserStackingAction::NewStage()
64 {;}
65
66 void G4UserStackingAction::PrepareNewEvent()
67 {;}
68</pre>
</div>
</div>
<div class="section" id="stackingaction-examples">
<h2>StackingAction examples<a class="headerlink" href="#stackingaction-examples" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>delta:geant4.10.00.p01 blyth$ find examples -name '*.cc' -exec grep -l ClassifyNewTrack {} \;
examples/advanced/composite_calorimeter/src/CCalStackingAction.cc
examples/advanced/underground_physics/src/DMXStackingAction.cc
examples/basic/B3/src/B3StackingAction.cc
examples/extended/electromagnetic/TestEm1/src/StackingAction.cc
examples/extended/electromagnetic/TestEm17/src/StackingAction.cc
examples/extended/electromagnetic/TestEm18/src/StackingAction.cc
examples/extended/electromagnetic/TestEm5/src/StackingAction.cc
examples/extended/electromagnetic/TestEm6/src/StackingAction.cc
examples/extended/electromagnetic/TestEm8/src/StackingAction.cc
examples/extended/eventgenerator/HepMC/HepMCEx01/src/ExN04StackingAction.cc
examples/extended/exoticphysics/phonon/src/XPhononStackingAction.cc
examples/extended/exoticphysics/phonon/src/XPrimaryGeneratorAction.cc
examples/extended/field/field04/src/F04StackingAction.cc
examples/extended/hadronic/Hadr01/src/StackingAction.cc
examples/extended/hadronic/Hadr02/src/StackingAction.cc
examples/extended/hadronic/Hadr04/src/StackingAction.cc
examples/extended/medical/fanoCavity/src/StackingAction.cc
examples/extended/optical/LXe/src/LXeStackingAction.cc
examples/extended/optical/OpNovice/src/OpNoviceStackingAction.cc
examples/extended/optical/wls/src/WLSStackingAction.cc
examples/extended/parallel/TopC/ParN04/src/ExN04StackingAction.cc
examples/extended/runAndEvent/RE01/src/RE01StackingAction.cc
examples/extended/runAndEvent/RE05/src/RE05StackingAction.cc
delta:geant4.10.00.p01 blyth$</pre>
</div>
<div class="sidebar">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../geant4_stackmanager/" title="Geant4 StackManager"
             >next</a> |</li>
        <li class="right" >
          <a href="../geant4_eventmanager/" title="Geant4 EventManager"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../../">Env  documentation</a> &raquo;</li>

          <li><a href="../../" >geant4</a> &raquo;</li>
          <li><a href="../" >Geant4 Event</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>