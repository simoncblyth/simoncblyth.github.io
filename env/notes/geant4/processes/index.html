<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Geant4 Processes &mdash; Env  documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/highstock/highstock.js"></script>
    <script type="text/javascript" src="../../_static/highstock/modules/exporting.js"></script>
    <link rel="top" title="Env  documentation" href="../../" />
    <link rel="up" title="geant4" href="../" />
    <link rel="next" title="Medical Communities Using Geant4 (esp. optical photon)" href="../medical/" />
    <link rel="prev" title="Geant4 Optical Photon" href="../opticalphoton/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../medical/" title="Medical Communities Using Geant4 (esp. optical photon)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../opticalphoton/" title="Geant4 Optical Photon"
             accesskey="P">previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>

          <li><a href="../" accesskey="U">geant4</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Links</h3>
<ul class="this-page-menu">
	<li><a href="/tracs/env"> env </a>  <a href="/tracs/env/timeline"> tl </a> <a href="/repos/env/trunk"> repo </a> <a href="/e"> edocs </a> </li>
	<li><a href="/tracs/heprez"> heprez </a>  <a href="/tracs/heprez/timeline"> tl </a> <a href="/repos/heprez/trunk"> repo</a> <a href="/h">hdocs</a>   </li>
        <li><a href="/e/scm/monitor/" > backup status </a> </li>
</ul>

<h3>Content Skeleton</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installing <strong>env</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../base/">Base Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../log/May2012/">LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TODO/">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sysadmin/">Sys Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plot/">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scm/">SCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trac/">Trac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../root/">ROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sphinxext/">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../matplotlib/">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nose/">nose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../svn/">SVN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../npy/">Numerical Python, numpy et al</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pypy/">PyPy : faster python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysqlhotcopy/">MySQL hotcopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysql/">MySQL Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sqlite/">SQLite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../db/">DB scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../qxml/">QXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fossil/">Fossil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../java/">Java Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pycuda/">pycuda</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">geant4</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../release_notes/">Geant4 Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geant4_gpu/">Geant4 GPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geant4_profiling/">Geant4 Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release_notes/">Geant4 Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../verbosity/">Verbosity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../docs/">Geant4 Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../giga/">GiGa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/">Geant4 API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../opticalphoton/">Geant4 Optical Photon</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Geant4 Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../medical/">Medical Communities Using Geant4 (esp. optical photon)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry/">Geant4 Geometry Export</a></li>
<li class="toctree-l2"><a class="reference internal" href="../g4py/">g4py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nuwa/">nuwa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../event/">Geant4 Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geant4_future_doe/">Geant4</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../muon_simulation/">muon_simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chroma/">chroma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../llvm/">llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../graphics/">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cuda/">cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../opencl/">opencl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linux/">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../package_management/">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ui/">ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../debugging/">debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mercurial/">mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javascript/">javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nuwa/">nuwa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ccgpu/">ccgpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pygame/">pygame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../zeromq/">zeromq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/">doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../osx/">osx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hg/">hg</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/geant4/processes.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../opticalphoton/"
                        title="previous chapter">Geant4 Optical Photon</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../medical/"
                        title="next chapter">Medical Communities Using Geant4 (esp. optical photon)</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="geant4-processes">
<h1>Geant4 Processes<a class="headerlink" href="#geant4-processes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="modelling-processes">
<h2>Modelling Processes<a class="headerlink" href="#modelling-processes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://geant4.web.cern.ch/geant4/G4UsersDocuments/UsersGuides/ForApplicationDeveloper/html/TrackingAndPhysics/physicsProcess.html">http://geant4.web.cern.ch/geant4/G4UsersDocuments/UsersGuides/ForApplicationDeveloper/html/TrackingAndPhysics/physicsProcess.html</a></li>
</ul>
<p>Each process has two groups of methods which play an important role in tracking,</p>
<dl class="docutils">
<dt><cite>GetPhysicalInteractionLength (GPIL)</cite></dt>
<dd>Get step length from the current space-time point to the next space-time point.
It does this by calculating the probability of interaction based on the
process&#8217;s cross section information. At the end of this step the DoIt method
should be invoked.</dd>
<dt><cite>DoIt</cite>.</dt>
<dd>The DoIt method implements the details of the interaction,
changing the particle&#8217;s energy, momentum, direction and position, and producing
secondary tracks if required. These changes are recorded as G4VParticleChange
objects(see Particle Change).</dd>
<dt><cite>G4VRestProcess</cite></dt>
<dd>processes using only the <cite>AtRestDoIt</cite> method, example: neutron capture</dd>
<dt><cite>G4VContinuousProcess</cite></dt>
<dd>processes using only the <cite>AlongStepDoIt</cite> method, example: cerenkov</dd>
<dt><cite>G4VDiscreteProcess</cite></dt>
<dd>processes using only the <cite>PostStepDoIt</cite> method, example: compton scattering, hadron inelastic interaction</dd>
</dl>
<p>OR for more complex processes which implement 2 or 3 of those 3 methods:
<cite>G4VContinuousDiscreteProcess</cite>, <cite>G4VRestDiscreteProcess</cite>, <cite>G4VRestContinuousProcess</cite>, <cite>G4VRestContinuousDiscreteProcess</cite></p>
</div>
<div class="section" id="tracking-of-photons-in-processes-optical">
<h2>Tracking of Photons in processes/optical<a class="headerlink" href="#tracking-of-photons-in-processes-optical" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://geant4.web.cern.ch/geant4/G4UsersDocuments/UsersGuides/ForApplicationDeveloper/html/TrackingAndPhysics/physicsProcess.html">http://geant4.web.cern.ch/geant4/G4UsersDocuments/UsersGuides/ForApplicationDeveloper/html/TrackingAndPhysics/physicsProcess.html</a></li>
</ul>
<div class="section" id="absorption">
<h3>Absorption<a class="headerlink" href="#absorption" title="Permalink to this headline">¶</a></h3>
<p>The implementation of optical photon bulk absorption, <cite>G4OpAbsorption</cite>, is
trivial in that the process merely kills the particle. The procedure requires
the user to fill the relevant <cite>G4MaterialPropertiesTable</cite> with empirical data for
the absorption length, using <cite>ABSLENGTH</cite> as the property key in the public method
AddProperty. The absorption length is the average distance traveled by a photon
before being absorpted by the medium; i.e. it is the mean free path returned by
the <cite>GetMeanFreePath</cite> method.</p>
<div class="section" id="abslength">
<h4>ABSLENGTH<a class="headerlink" href="#abslength" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><pre>[blyth@cms01 source]$ find . -name '*.cc' -exec grep -H 'ABSLENGTH' {} \;
./processes/optical/src/G4OpWLS.cc:      GetProperty("WLSABSLENGTH");
./processes/optical/src/G4OpAbsorption.cc:                                                GetProperty("ABSLENGTH");</pre>
</div>
</div>
<div class="section" id="g4opabsorption-poststepdoit">
<h4>G4OpAbsorption::PostStepDoIt<a class="headerlink" href="#g4opabsorption-poststepdoit" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><pre>101 G4VParticleChange*
102 G4OpAbsorption::PostStepDoIt(const G4Track&amp; aTrack, const G4Step&amp; aStep)
103 {
104         aParticleChange.Initialize(aTrack);
105
106         aParticleChange.ProposeTrackStatus(fStopAndKill);
107
108         if (verboseLevel&gt;0) {
109        G4cout &lt;&lt; "\n** Photon absorbed! **" &lt;&lt; G4endl;
110         }
111         return G4VDiscreteProcess::PostStepDoIt(aTrack, aStep);
112 }</pre>
</div>
</div>
<div class="section" id="g4opabsorption-getmeanfreepath">
<h4>G4OpAbsorption::GetMeanFreePath<a class="headerlink" href="#g4opabsorption-getmeanfreepath" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><pre>118 G4double G4OpAbsorption::GetMeanFreePath(const G4Track&amp; aTrack,
119                          G4double ,
120                          G4ForceCondition* )
121 {
122     const G4DynamicParticle* aParticle = aTrack.GetDynamicParticle();
123         const G4Material* aMaterial = aTrack.GetMaterial();
124
125     G4double thePhotonMomentum = aParticle-&gt;GetTotalMomentum();
126
127     G4MaterialPropertiesTable* aMaterialPropertyTable;
128     G4MaterialPropertyVector* AttenuationLengthVector;
129
130         G4double AttenuationLength = DBL_MAX;
131
132     aMaterialPropertyTable = aMaterial-&gt;GetMaterialPropertiesTable();
133
134     if ( aMaterialPropertyTable ) {
135        AttenuationLengthVector = aMaterialPropertyTable-&gt;
136                                                 GetProperty("ABSLENGTH");
137            if ( AttenuationLengthVector ){
138              AttenuationLength = AttenuationLengthVector-&gt;
139                                          GetProperty (thePhotonMomentum);</pre>
</div>
</div>
<div class="section" id="g4vdiscreteprocess-poststepgetphysicalinteractionlength">
<h4>G4VDiscreteProcess::PostStepGetPhysicalInteractionLength<a class="headerlink" href="#g4vdiscreteprocess-poststepgetphysicalinteractionlength" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><pre>(gdb) b 'G4VDiscreteProcess::PostStepGetPhysicalInteractionLength(G4Track const&amp;, double, G4ForceCondition*)'
Breakpoint 1 at 0x68f34ed: file /data1/env/local/dyb/NuWa-trunk/../external/build/LCG/geant4.9.2.p01/source/processes/management/include/G4VDiscreteProcess.hh, line 137.

(gdb) bt
#0  G4VDiscreteProcess::PostStepGetPhysicalInteractionLength (this=0xd37b178, track=@0x10c8cd90, previousStepSize=0, condition=0xc481da0) at /data1/env/local/dyb/NuWa-trunk/../external/build/LCG/geant4.9.2.p01/source/processes/management/include/G4VDiscreteProcess.hh:137
#1  0x07247e95 in G4VProcess::PostStepGPIL (this=0xd37b178, track=@0x10c8cd90, previousStepSize=0, condition=0xc481da0) at /data1/env/local/dyb/NuWa-trunk/../external/build/LCG/geant4.9.2.p01/source/processes/management/include/G4VProcess.hh:464
#2  0x0724655a in G4SteppingManager::DefinePhysicalStepLength (this=0xc481c98) at src/G4SteppingManager2.cc:165
#3  0x07242e2c in G4SteppingManager::Stepping (this=0xc481c98) at src/G4SteppingManager.cc:181
#4  0x0725150a in G4TrackingManager::ProcessOneTrack (this=0xc481c70, apValueG4Track=0x10c8cd90) at src/G4TrackingManager.cc:126
#5  0xb666c24f in G4EventManager::DoProcessing (this=0xc481480, anEvent=0x10832350) at src/G4EventManager.cc:185
#6  0xb666c9e6 in G4EventManager::ProcessOneEvent (this=0xc481480, anEvent=0x10832350) at src/G4EventManager.cc:335
#7  0xb4e605e8 in GiGaRunManager::processTheEvent (this=0xc480c18) at ../src/component/GiGaRunManager.cpp:207
#8  0xb4e5f522 in GiGaRunManager::retrieveTheEvent (this=0xc480c18, event=@0xbfa6c9d8) at ../src/component/GiGaRunManager.cpp:158
#9  0xb4e3b64f in GiGa::retrieveTheEvent (this=0xc480220, event=@0xbfa6c9d8) at ../src/component/GiGa.cpp:469
#10 0xb4e38564 in GiGa::operator&gt;&gt; (this=0xc480220, event=@0xbfa6c9d8) at ../src/component/GiGaIGiGaSvc.cpp:73
#11 0xb4e362fa in GiGa::retrieveEvent (this=0xc480220, event=@0xbfa6c9d8) at ../src/component/GiGaIGiGaSvc.cpp:211
#12 0xb507fcd3 in DsPullEvent::execute (this=0xc473470) at ../src/DsPullEvent.cc:54
#13 0x046d6408 in Algorithm::sysExecute (this=0xc473470) at ../src/Lib/Algorithm.cpp:558
#14 0x03a61d4e in DybBaseAlg::sysExecute (this=0xc473470) at ../src/lib/DybBaseAlg.cc:53
#15 0x01cf0fd4 in GaudiSequencer::execute (this=0xbf36020) at ../src/lib/GaudiSequencer.cpp:100
#16 0x046d6408 in Algorithm::sysExecute (this=0xbf36020) at ../src/Lib/Algorithm.cpp:558
#17 0x01c8868f in GaudiAlgorithm::sysExecute (this=0xbf36020) at ../src/lib/GaudiAlgorithm.cpp:161
#18 0x0475241a in MinimalEventLoopMgr::executeEvent (this=0xbaf2f98) at ../src/Lib/MinimalEventLoopMgr.cpp:450
#19 0x03b20956 in DybEventLoopMgr::executeEvent (this=0xbaf2f98, par=0x0) at ../src/DybEventLoopMgr.cpp:125
#20 0x03b2118a in DybEventLoopMgr::nextEvent (this=0xbaf2f98, maxevt=10) at ../src/DybEventLoopMgr.cpp:188
#21 0x04750dbd in MinimalEventLoopMgr::executeRun (this=0xbaf2f98, maxevt=10) at ../src/Lib/MinimalEventLoopMgr.cpp:400
#22 0x08c086d9 in ApplicationMgr::executeRun (this=0xb7b9ad0, evtmax=10) at ../src/ApplicationMgr/ApplicationMgr.cpp:867
#23 0x0239af57 in method_3426 (retaddr=0xc5821b0, o=0xb7b9efc, arg=@0xb825c50) at ../i686-slc5-gcc41-dbg/dict/GaudiKernel/dictionary_dict.cpp:4375
#24 0x0030cadd in ROOT::Cintex::Method_stub_with_context (context=0xb825c48, result=0xc5cafe4, libp=0xc5cb03c) at cint/cintex/src/CINTFunctional.cxx:319</pre>
</div>
</div>
<div class="section" id="g4vprocess-poststepgpil">
<h4>G4VProcess::PostStepGPIL<a class="headerlink" href="#g4vprocess-poststepgpil" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><pre>(gdb) frame 1
#1  0x07247e95 in G4VProcess::PostStepGPIL (this=0xd37b178, track=@0x10c8cd90, previousStepSize=0, condition=0xc481da0) at /data1/env/local/dyb/NuWa-trunk/../external/build/LCG/geant4.9.2.p01/source/processes/management/include/G4VProcess.hh:464
464        =PostStepGetPhysicalInteractionLength(track, previousStepSize, condition);
(gdb) list
459     inline G4double G4VProcess::PostStepGPIL( const G4Track&amp; track,
460                                        G4double   previousStepSize,
461                                        G4ForceCondition* condition )
462     {
463       G4double value
464        =PostStepGetPhysicalInteractionLength(track, previousStepSize, condition);
465       return thePILfactor*value;
466     }</pre>
</div>
</div>
<div class="section" id="id1">
<h4>G4VDiscreteProcess::PostStepGetPhysicalInteractionLength<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><pre>131 inline G4double G4VDiscreteProcess::PostStepGetPhysicalInteractionLength(
132                              const G4Track&amp; track,
133                  G4double   previousStepSize,
134                  G4ForceCondition* condition
135                 )
136 {
137   if ( (previousStepSize &lt; 0.0) || (theNumberOfInteractionLengthLeft&lt;=0.0)) {
138     // beggining of tracking (or just after DoIt of this process)
139     ResetNumberOfInteractionLengthLeft();
140   } else if ( previousStepSize &gt; 0.0) {
141     // subtract NumberOfInteractionLengthLeft
142     SubtractNumberOfInteractionLengthLeft(previousStepSize);
143   } else {
144     // zero step
145     //  DO NOTHING
146   }
147
148   // condition is set to "Not Forced"
149   *condition = NotForced;
150
151   // get mean free path
152   currentInteractionLength = GetMeanFreePath(track, previousStepSize, condition);
153
154   G4double value;
155   if (currentInteractionLength &lt;DBL_MAX) {
156     value = theNumberOfInteractionLengthLeft * currentInteractionLength;
157   } else {
158     value = DBL_MAX;
159   }
160 #ifdef G4VERBOSE
161   if (verboseLevel&gt;1){
162     G4cout &lt;&lt; "G4VDiscreteProcess::PostStepGetPhysicalInteractionLength ";
163     G4cout &lt;&lt; "[ " &lt;&lt; GetProcessName() &lt;&lt; "]" &lt;&lt;G4endl;
164     track.GetDynamicParticle()-&gt;DumpInfo();
165     G4cout &lt;&lt; " in Material  " &lt;&lt;  track.GetMaterial()-&gt;GetName() &lt;&lt;G4endl;
166     G4cout &lt;&lt; "InteractionLength= " &lt;&lt; value/cm &lt;&lt;"[cm] " &lt;&lt;G4endl;
167   }
168 #endif
169   return value;
170 }</pre>
</div>
</div>
<div class="section" id="processes-management-include-g4vprocess-hh">
<h4>processes/management/include/G4VProcess.hh<a class="headerlink" href="#processes-management-include-g4vprocess-hh" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><pre>076 class G4VProcess
077 {
078   //  A virtual class for physics process objects. It defines
079   //  public methods which describe the behavior of a
080   //  physics process.
081
...
147       virtual G4double PostStepGetPhysicalInteractionLength(
148                              const G4Track&amp; track,
149                  G4double   previousStepSize,
150                  G4ForceCondition* condition
151                 ) = 0;
152
153       //  Returns the Step-size (actual length) which is allowed
154       //  by "this" process. (for AtRestGetPhysicalInteractionLength,
155       //  return value is Step-time) The NumberOfInteractionLengthLeft is
156       //  recalculated by using previousStepSize and the Step-size is
157       //  calucalted accoding to the resultant NumberOfInteractionLengthLeft.
158       //  using NumberOfInteractionLengthLeft, which is recalculated at
159       //    arguments
160       //      const G4Track&amp;    track:
161       //        reference to the current G4Track information
162       //      G4double*          previousStepSize:
163       //        the Step-size (actual length) of the previous Step
164       //        of this track. Negative calue indicates that
165       //        NumberOfInteractionLengthLeft must be reset.
166       //        the current physical interaction legth of this process
167       //      G4ForceCondition* condition:
168       //        the flag indicates DoIt of this process is forced
169       //        to be called
170       //         Forced:    Corresponding DoIt is forced
171       //         NotForced: Corresponding DoIt is called
172       //                    if the Step size of this Step is determined
173       //                    by this process
174       //        !! AlongStepDoIt is always called !!
175       //      G4double&amp; currentMinimumStep:
176       //        this value is used for transformation of
177       //        true path length to geometrical path length
178
179       G4double GetCurrentInteractionLength() const;
180       // Returns currentInteractionLength
181
182       ////////// PIL factor ////////
183       void SetPILfactor(G4double value);
184       G4double GetPILfactor() const;
185       // Set/Get factor for PhysicsInteractionLength
186       // which is passed to G4SteppingManager for both AtRest and PostStep
187
188       // These three GPIL methods are used by Stepping Manager.
189       // They invoke virtual GPIL methods listed above.
190       // As for AtRest and PostStep the returned value is multipled by thePILfactor
191       //
...
287   protected:
288       G4VParticleChange* pParticleChange;
289       //  The pointer to G4VParticleChange object
290       //  which is modified and returned by address by the DoIt() method.
291       //  This pointer should be set in each physics process
292       //  after construction of derived class object.
293
294       G4ParticleChange aParticleChange;
295       //  This object is kept for compatibility with old scheme
296       //  This will be removed in future
297
298       G4double          theNumberOfInteractionLengthLeft;
299      // The flight length left for the current tracking particle
300      // in unit of "Interaction length".
301
302       G4double          currentInteractionLength;
303      // The InteractionLength in the current material
304
305  public: // with description
306       virtual void      ResetNumberOfInteractionLengthLeft();
307      // reset (determine the value of)NumberOfInteractionLengthLeft
308
309  protected:  // with description
310      virtual void      SubtractNumberOfInteractionLengthLeft(
311                   G4double previousStepSize
312                                 );
313      // subtract NumberOfInteractionLengthLeft by the value corresponding to
314      // previousStepSize</pre>
</div>
</div>
</div>
<div class="section" id="rayleigh-scattering">
<h3>Rayleigh Scattering<a class="headerlink" href="#rayleigh-scattering" title="Permalink to this headline">¶</a></h3>
<p>The differential cross section in Rayleigh scattering, <cite>sigma/omega</cite> , is proportional to
<cite>cos2(theta)</cite>, where <cite>theta</cite> is the polar angle of the new polarization vector with respect to
the old polarization vector. The <cite>G4OpRayleigh</cite> scattering process samples this
angle accordingly and then calculates the scattered photon&#8217;s new direction by
requiring that it be perpendicular to the photon&#8217;s new polarization in such a
way that the final direction, initial and final polarizations are all in one
plane. This process thus depends on the particle&#8217;s polarization (spin). The
photon&#8217;s polarization is a data member of the <cite>G4DynamicParticle</cite> class.</p>
<p>A photon which is not assigned a polarization at production, either via the
<cite>SetPolarization</cite> method of the <cite>G4PrimaryParticle</cite> class, or indirectly with the
<cite>SetParticlePolarization</cite> method of the <cite>G4ParticleGun</cite> class, may not be Rayleigh
scattered. Optical photons produced by the <cite>G4Cerenkov</cite> process have inherently a
polarization perpendicular to the cone&#8217;s surface at production. Scintillation
photons have a random linear polarization perpendicular to their direction.</p>
<p>The process requires a <cite>G4MaterialPropertiesTable</cite> to be filled by the user with
Rayleigh scattering length data. The Rayleigh scattering attenuation length is
the average distance traveled by a photon before it is Rayleigh scattered in
the medium and it is the distance returned by the <cite>GetMeanFreePath</cite> method. The
<cite>G4OpRayleigh</cite> class provides a <cite>RayleighAttenuationLengthGenerator</cite> method which
calculates the attenuation coefficient of a medium following the
Einstein-Smoluchowski formula whose derivation requires the use of statistical
mechanics, includes temperature, and depends on the isothermal compressibility
of the medium. This generator is convenient when the Rayleigh attenuation
length is not known from measurement but may be calculated from first
principles using the above material constants. For a medium named Water and no
Rayleigh scattering attenutation length specified by the user, the program
automatically calls the RayleighAttenuationLengthGenerator
which calculates it for 10 degrees Celsius liquid water.</p>
</div>
</div>
<div class="section" id="g4steppingmanager-getprocessnumber">
<h2>G4SteppingManager::GetProcessNumber<a class="headerlink" href="#g4steppingmanager-getprocessnumber" title="Permalink to this headline">¶</a></h2>
<p>Three categories of DoIt:</p>
<dl class="docutils">
<dt><cite>AtRestDoIt</cite></dt>
<dd>eg decays</dd>
<dt><cite>AlongStepDoIt</cite></dt>
<dd>relevant for <cite>G4VContinuousProcess</cite></dd>
<dt><cite>PostStepDoIt</cite></dt>
<dd>relevant for <cite>G4VDiscreteProcess</cite> like those that optical photons undergo: Absorption, Scattering, Boundaries</dd>
</dl>
<div class="highlight-python"><pre>56 /////////////////////////////////////////////////
57 void G4SteppingManager::GetProcessNumber()
58 /////////////////////////////////////////////////
59 {
60 #ifdef debug
61   G4cout&lt;&lt;"G4SteppingManager::GetProcessNumber: is called track="&lt;&lt;fTrack&lt;&lt;G4endl;
62 #endif
63
64   G4ProcessManager* pm= fTrack-&gt;GetDefinition()-&gt;GetProcessManager();
65         if(!pm)
66   {
67     G4cout&lt;&lt;"G4SteppingManager::GetProcessNumber: ProcessManager=0 for particle="
68           &lt;&lt;fTrack-&gt;GetDefinition()-&gt;GetParticleName()&lt;&lt;", PDG_code="
69           &lt;&lt;fTrack-&gt;GetDefinition()-&gt;GetPDGEncoding()&lt;&lt;G4endl;
70                 G4Exception("G4SteppingManager::GetProcessNumber: Process Manager is not found.");
71   }
72
73 // AtRestDoits
74    MAXofAtRestLoops =        pm-&gt;GetAtRestProcessVector()-&gt;entries();
75    fAtRestDoItVector =       pm-&gt;GetAtRestProcessVector(typeDoIt);
76    fAtRestGetPhysIntVector = pm-&gt;GetAtRestProcessVector(typeGPIL);
77 #ifdef debug
78   G4cout&lt;&lt;"G4SteppingManager::GetProcessNumber: #ofAtRest="&lt;&lt;MAXofAtRestLoops&lt;&lt;G4endl;
79 #endif
80
81 // AlongStepDoits
82    MAXofAlongStepLoops = pm-&gt;GetAlongStepProcessVector()-&gt;entries();
83    fAlongStepDoItVector = pm-&gt;GetAlongStepProcessVector(typeDoIt);
84    fAlongStepGetPhysIntVector = pm-&gt;GetAlongStepProcessVector(typeGPIL);
85 #ifdef debug
86             G4cout&lt;&lt;"G4SteppingManager::GetProcessNumber:#ofAlongStp="&lt;&lt;MAXofAlongStepLoops&lt;&lt;G4endl;
87 #endif
88
89 // PostStepDoits
90    MAXofPostStepLoops = pm-&gt;GetPostStepProcessVector()-&gt;entries();
91    fPostStepDoItVector = pm-&gt;GetPostStepProcessVector(typeDoIt);
92    fPostStepGetPhysIntVector = pm-&gt;GetPostStepProcessVector(typeGPIL);
93 #ifdef debug
94             G4cout&lt;&lt;"G4SteppingManager::GetProcessNumber: #ofPostStep="&lt;&lt;MAXofPostStepLoops&lt;&lt;G4endl;
95 #endif
96
97    if (SizeOfSelectedDoItVector&lt;MAXofAtRestLoops    ||
98        SizeOfSelectedDoItVector&lt;MAXofAlongStepLoops ||
99        SizeOfSelectedDoItVector&lt;MAXofPostStepLoops  )
100             {
101               G4cout&lt;&lt;"G4SteppingManager::GetProcessNumber: SizeOfSelectedDoItVector="
102            &lt;&lt;SizeOfSelectedDoItVector&lt;&lt;" is smaller then one of MAXofAtRestLoops="
103            &lt;&lt;MAXofAtRestLoops&lt;&lt;" or MAXofAlongStepLoops="&lt;&lt;MAXofAlongStepLoops
104            &lt;&lt;" or MAXofPostStepLoops="&lt;&lt;MAXofPostStepLoops&lt;&lt;G4endl;
105                     G4Exception("G4SteppingManager::GetProcessNumber: The array size is smaller than the actutal number of processes. Chnage G4SteppingManager.hh and recompile is needed.");
106    }
107 }</pre>
</div>
</div>
<div class="section" id="how-are-the-relevant-processes-determined">
<h2>How are the relevant processes determined ?<a class="headerlink" href="#how-are-the-relevant-processes-determined" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>[blyth@cms01 source]$ find . -name '*.cc' -exec grep -H fPostStepDoItVector {} \;
./tracking/src/G4SteppingManager2.cc:   fPostStepDoItVector = pm-&gt;GetPostStepProcessVector(typeDoIt);
./tracking/src/G4SteppingManager2.cc:         fCurrentProcess = (*fPostStepDoItVector)[np];
./tracking/src/G4SteppingVerbose.cc:             ptProcManager = (*fPostStepDoItVector)[np];
./tracking/src/G4SteppingVerbose.cc:             ptProcManager = (*fPostStepDoItVector)[np];
./tracking/src/G4VSteppingVerbose.cc:   fPostStepDoItVector = fManager-&gt;GetfPostStepDoItVector();
[blyth@cms01 source]$</pre>
</div>
</div>
<div class="section" id="what-distribution-is-used-for-op-times-energy">
<h2>What distribution is used for OP times, energy<a class="headerlink" href="#what-distribution-is-used-for-op-times-energy" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dspmtsensdet-processhits">
<h3>DsPmtSensDet::ProcessHits<a class="headerlink" href="#dspmtsensdet-processhits" title="Permalink to this headline">¶</a></h3>
<p>From the G4Step, energies and times feed into creating hits.</p>
<p>For OP, wavelength is more relevant than energy.
From <a class="reference external" href="http://geant4.web.cern.ch/geant4/G4UsersDocuments/UsersGuides/ForApplicationDeveloper/html/TrackingAndPhysics/physicsProcess.html">http://geant4.web.cern.ch/geant4/G4UsersDocuments/UsersGuides/ForApplicationDeveloper/html/TrackingAndPhysics/physicsProcess.html</a></p>
<blockquote>
<div><ul class="simple">
<li>Optical photons are generated in GEANT4 without energy conservation and
their energy must therefore not be tallied as part of the energy balance of an event.</li>
</ul>
</div></blockquote>
<div class="highlight-python"><pre>318 bool DsPmtSensDet::ProcessHits(G4Step* step,
319                                G4TouchableHistory* /*history*/)
320 {
321     //if (!step) return false; just crash for now if not defined
322
323     // Find out what detector we are in (ADx, IWS or OWS)
324     G4StepPoint* preStepPoint = step-&gt;GetPreStepPoint();
325
326     double energyDep = step-&gt;GetTotalEnergyDeposit();
...
...
...
434     double wavelength = CLHEP::twopi*CLHEP::hbarc/energyDep;
...
...
...
459     DayaBay::SimPmtHit* sphit = new DayaBay::SimPmtHit();
460
461     // base hit
462
463     // Time since event created
464     sphit-&gt;setHitTime(preStepPoint-&gt;GetGlobalTime());
465
466     //#include "G4NavigationHistory.hh"
467
468     const G4AffineTransform&amp; trans = hist-&gt;GetHistory()-&gt;GetTopTransform();
469     const G4ThreeVector&amp; global_pos = preStepPoint-&gt;GetPosition();
470     G4ThreeVector pos = trans.TransformPoint(global_pos);
471     sphit-&gt;setLocalPos(pos);
472     sphit-&gt;setSensDetId(pmtid);
473
474     // pmt hit
475     // sphit-&gt;setDir(...);       // for now
476     G4ThreeVector pol = trans.TransformAxis(track-&gt;GetPolarization());
477     pol = pol.unit();
478     G4ThreeVector dir = trans.TransformAxis(track-&gt;GetMomentum());
479     dir = dir.unit();
480     sphit-&gt;setPol(pol);
481     sphit-&gt;setDir(dir);
482     sphit-&gt;setWavelength(wavelength);
483     sphit-&gt;setType(0);
484     // G4cerr&lt;&lt;"PMT: set hit weight "&lt;&lt;weight&lt;&lt;G4endl; //gonchar
485     sphit-&gt;setWeight(weight);</pre>
</div>
</div>
<div class="section" id="where-do-the-times-come-from">
<h3>Where do the times come from ?<a class="headerlink" href="#where-do-the-times-come-from" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>[blyth@cms01 source]$ find . -name '*.cc' -exec grep -H SetGlobalTime {} \;
./track/src/G4ParticleChangeForDecay.cc:  pPostStepPoint-&gt;SetGlobalTime( theTimeChange  );
./track/src/G4ParticleChange.cc:  pPostStepPoint-&gt;SetGlobalTime( theTimeChange  );
./track/src/G4ParticleChange.cc:  pPostStepPoint-&gt;SetGlobalTime( theTimeChange  );
./processes/hadronic/models/lll_fission/src/G4FissionLibrary.cc://    it-&gt;SetGlobalTime(getnage_(&amp;i)*second);
./processes/hadronic/models/lll_fission/src/G4FissionLibrary.cc://    it-&gt;SetGlobalTime(getpage_(&amp;i)*second);
./processes/parameterisation/src/G4FastStep.cc:  pPostStepPoint-&gt;SetGlobalTime( theTimeChange  );
./processes/parameterisation/src/G4FastStep.cc:  pPostStepPoint-&gt;SetGlobalTime( theTimeChange  );
[blyth@cms01 source]$</pre>
</div>
<div class="highlight-python"><pre>[blyth@cms01 source]$ find . -name '*.cc' -exec grep -H ProposeGlobalTime {} \;
./processes/hadronic/models/radioactive_decay/src/G4RadioactiveDecay.cc:      fParticleChangeForRadDecay.ProposeGlobalTime( finalGlobalTime );
./processes/transportation/src/G4Transportation.cc:  fParticleChange.ProposeGlobalTime( fCandidateEndGlobalTime ) ;
./processes/transportation/src/G4CoupledTransportation.cc:  fParticleChange.ProposeGlobalTime( fCandidateEndGlobalTime ) ;
./processes/decay/src/G4UnknownDecay.cc:  fParticleChangeForDecay.ProposeGlobalTime( finalGlobalTime );
./processes/decay/src/G4Decay.cc:  fParticleChangeForDecay.ProposeGlobalTime( finalGlobalTime );
[blyth@cms01 source]$</pre>
</div>
</div>
<div class="section" id="g4transportation-alongstepdoit">
<h3>G4Transportation::AlongStepDoIt<a class="headerlink" href="#g4transportation-alongstepdoit" title="Permalink to this headline">¶</a></h3>
<p>For OP, what determines the GlobalTime is</p>
<ul class="simple">
<li><cite>startTime + (stepLength/finalVelocity)</cite></li>
</ul>
<p>So question becomes: where is stepLength distribution implemented ? Each process provides a MeanFreePath, where
is the dice rolled ?</p>
<div class="highlight-python"><pre>450 G4VParticleChange* G4Transportation::AlongStepDoIt( const G4Track&amp; track,
451                                                     const G4Step&amp;  stepData )
452 {
453   static G4int noCalls=0;
454   static const G4ParticleDefinition* fOpticalPhoton =
455            G4ParticleTable::GetParticleTable()-&gt;FindParticle("opticalphoton");
456
457   noCalls++;
458
459   fParticleChange.Initialize(track) ;
460
461   //  Code for specific process
462   //
463   fParticleChange.ProposePosition(fTransportEndPosition) ;
464   fParticleChange.ProposeMomentumDirection(fTransportEndMomentumDir) ;
465   fParticleChange.ProposeEnergy(fTransportEndKineticEnergy) ;
466   fParticleChange.SetMomentumChanged(fMomentumChanged) ;
467
468   fParticleChange.ProposePolarization(fTransportEndSpin);
469
470   G4double deltaTime = 0.0 ;
471
472   // Calculate  Lab Time of Flight (ONLY if field Equations used it!)
473      // G4double endTime   = fCandidateEndGlobalTime;
474      // G4double delta_time = endTime - startTime;
475
476   G4double startTime = track.GetGlobalTime() ;
477
478   if (!fEndGlobalTimeComputed)
479   {
480      // The time was not integrated .. make the best estimate possible
481      //
482      G4double finalVelocity   = track.GetVelocity() ;
483      G4double initialVelocity = stepData.GetPreStepPoint()-&gt;GetVelocity() ;
484      G4double stepLength      = track.GetStepLength() ;
485
486      deltaTime= 0.0;  // in case initialVelocity = 0
487      const G4DynamicParticle* fpDynamicParticle = track.GetDynamicParticle();
488      if (fpDynamicParticle-&gt;GetDefinition()== fOpticalPhoton)
489      {
490         //  A photon is in the medium of the final point
491         //  during the step, so it has the final velocity.
492         deltaTime = stepLength/finalVelocity ;
493      }
494      else if (finalVelocity &gt; 0.0)
495      {
496         G4double meanInverseVelocity ;
497         // deltaTime = stepLength/finalVelocity ;
498         meanInverseVelocity = 0.5
499                             * ( 1.0 / initialVelocity + 1.0 / finalVelocity ) ;
500         deltaTime = stepLength * meanInverseVelocity ;
501      }
502      else if( initialVelocity &gt; 0.0 )
503      {
504         deltaTime = stepLength/initialVelocity ;
505      }
506      fCandidateEndGlobalTime   = startTime + deltaTime ;
507   }
508   else
509   {
510      deltaTime = fCandidateEndGlobalTime - startTime ;
511   }
512
513   fParticleChange.ProposeGlobalTime( fCandidateEndGlobalTime ) ;</pre>
</div>
</div>
<div class="section" id="g4steppingmanager-definephysicalsteplength">
<h3>G4SteppingManager::DefinePhysicalStepLength<a class="headerlink" href="#g4steppingmanager-definephysicalsteplength" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>[blyth@cms01 source]$ find . -name '*.cc' -exec grep -H DefinePhysicalStepLength {} \;
./tracking/src/G4SteppingManager.cc:     DefinePhysicalStepLength();
./tracking/src/G4SteppingManager2.cc: void G4SteppingManager::DefinePhysicalStepLength()
./tracking/src/G4SteppingManager2.cc:} // void G4SteppingManager::DefinePhysicalStepLength() //
./tracking/src/G4SteppingVerbose.cc:    G4cout &lt;&lt; G4endl &lt;&lt; " &gt;&gt;DefinePhysicalStepLength (List of proposed StepLengths): "  &lt;&lt; G4endl;</pre>
</div>
<div class="highlight-python"><pre>118  void G4SteppingManager::DefinePhysicalStepLength()
119 /////////////////////////////////////////////////////////
120 {
121
122 // ReSet the counter etc.
123    PhysicalStep  = DBL_MAX;          // Initialize by a huge number
124    physIntLength = DBL_MAX;          // Initialize by a huge number
125 #ifdef G4VERBOSE
126                          // !!!!! Verbose
127            if(verboseLevel&gt;0) fVerbose-&gt;DPSLStarted();
128 #endif
129
130 // Obtain the user defined maximum allowed Step in the volume
131 //   1997.12.13 adds argument for  GetMaxAllowedStep by K.Kurashige
132 //   2004.01.20 This block will be removed by Geant4 7.0
133 //   G4UserLimits* ul= fCurrentVolume-&gt;GetLogicalVolume()-&gt;GetUserLimits();
134 //   if (ul) {
135 //      physIntLength = ul-&gt;GetMaxAllowedStep(*fTrack);
136 //#ifdef G4VERBOSE
137 //                         // !!!!! Verbose
138 //           if(verboseLevel&gt;0) fVerbose-&gt;DPSLUserLimit();
139 //#endif
140 //   }
141 //
142 //   if(physIntLength &lt; PhysicalStep ){
143 //      PhysicalStep = physIntLength;
144 //      fStepStatus = fUserDefinedLimit;
145 //      fStep-&gt;GetPostStepPoint()
146 //           -&gt;SetProcessDefinedStep(NULL);
147 //      // Take note that the process pointer is 'NULL' if the Step
148 //      // is defined by the user defined limit.
149 //   }
150 //   2004.01.20 This block will be removed by Geant4 7.0
151
152 // GPIL for PostStep
153    fPostStepDoItProcTriggered = MAXofPostStepLoops;
154
155    for(size_t np=0; np &lt; MAXofPostStepLoops; np++){
156      fCurrentProcess = (*fPostStepGetPhysIntVector)(np);
157      if (fCurrentProcess== NULL) {
158        (*fSelectedPostStepDoItVector)[np] = InActivated;
159        continue;
160      }   // NULL means the process is inactivated by a user on fly.
161
162      physIntLength = fCurrentProcess-&gt;
163                      PostStepGPIL( *fTrack,
164                                                  fPreviousStepSize,
165                                                       &amp;fCondition );
166 #ifdef G4VERBOSE
167                          // !!!!! Verbose
168            if(verboseLevel&gt;0) fVerbose-&gt;DPSLPostStep();
169 #endif
170
171      switch (fCondition) {
172      case ExclusivelyForced:
173          (*fSelectedPostStepDoItVector)[np] = ExclusivelyForced;
174          fStepStatus = fExclusivelyForcedProc;
175          fStep-&gt;GetPostStepPoint()
176          -&gt;SetProcessDefinedStep(fCurrentProcess);
177          break;
178      case Conditionally:
179          (*fSelectedPostStepDoItVector)[np] = Conditionally;
180          break;
181      case Forced:</pre>
</div>
</div>
</div>
<div class="section" id="id2">
<h2>G4SteppingManager::DefinePhysicalStepLength<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="only-6-processes">
<h3>Only 6 processes ?<a class="headerlink" href="#only-6-processes" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>(gdb) p fCurrentProcess-&gt;GetProcessName()
$9 = (const G4String &amp;) @0xc094a20: {&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;&gt; = {static npos = 4294967295, _M_dataplus = {&lt;std::allocator&lt;char&gt;&gt; = {&lt;__gnu_cxx::new_allocator&lt;char&gt;&gt; = {&lt;No data fields&gt;}, &lt;No data fields&gt;},
      _M_p = 0xc094c04 "Transportation"}}, &lt;No data fields&gt;}
(gdb) c
Continuing.
    1 -1.43e+04   -8e+05 -1.14e+03  2.31e-06        0  3.3e+03   3.3e+03 /dd/Geometry/Sites/lvNearHallTop#pvNearRPCRoof Transportation

Breakpoint 2, G4SteppingManager::DefinePhysicalStepLength (this=0xc481c98) at src/G4SteppingManager2.cc:168
168                if(verboseLevel&gt;0) fVerbose-&gt;DPSLPostStep();
(gdb) p fCurrentProcess-&gt;GetProcessName()
$10 = (const G4String &amp;) @0xce5a190: {&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;&gt; = {static npos = 4294967295, _M_dataplus = {&lt;std::allocator&lt;char&gt;&gt; = {&lt;__gnu_cxx::new_allocator&lt;char&gt;&gt; = {&lt;No data fields&gt;}, &lt;No data fields&gt;},
      _M_p = 0xc484aec "Scintillation"}}, &lt;No data fields&gt;}
(gdb) c
Continuing.

Breakpoint 2, G4SteppingManager::DefinePhysicalStepLength (this=0xc481c98) at src/G4SteppingManager2.cc:168
168                if(verboseLevel&gt;0) fVerbose-&gt;DPSLPostStep();
(gdb) p fCurrentProcess-&gt;GetProcessName()
$11 = (const G4String &amp;) @0xd37bc80: {&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;&gt; = {static npos = 4294967295, _M_dataplus = {&lt;std::allocator&lt;char&gt;&gt; = {&lt;__gnu_cxx::new_allocator&lt;char&gt;&gt; = {&lt;No data fields&gt;}, &lt;No data fields&gt;},
      _M_p = 0xd379024 "fast_sim_man"}}, &lt;No data fields&gt;}
(gdb) c
Continuing.

Breakpoint 2, G4SteppingManager::DefinePhysicalStepLength (this=0xc481c98) at src/G4SteppingManager2.cc:168
168                if(verboseLevel&gt;0) fVerbose-&gt;DPSLPostStep();
(gdb) p fCurrentProcess-&gt;GetProcessName()
$12 = (const G4String &amp;) @0xd37b258: {&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;&gt; = {static npos = 4294967295, _M_dataplus = {&lt;std::allocator&lt;char&gt;&gt; = {&lt;__gnu_cxx::new_allocator&lt;char&gt;&gt; = {&lt;No data fields&gt;}, &lt;No data fields&gt;},
      _M_p = 0xd37b164 "OpBoundary"}}, &lt;No data fields&gt;}
(gdb) c
Continuing.

Breakpoint 2, G4SteppingManager::DefinePhysicalStepLength (this=0xc481c98) at src/G4SteppingManager2.cc:168
168                if(verboseLevel&gt;0) fVerbose-&gt;DPSLPostStep();
(gdb) p fCurrentProcess-&gt;GetProcessName()
$13 = (const G4String &amp;) @0xd3782f8: {&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;&gt; = {static npos = 4294967295, _M_dataplus = {&lt;std::allocator&lt;char&gt;&gt; = {&lt;__gnu_cxx::new_allocator&lt;char&gt;&gt; = {&lt;No data fields&gt;}, &lt;No data fields&gt;},
      _M_p = 0xce5eb2c "OpRayleigh"}}, &lt;No data fields&gt;}
(gdb) c
Continuing.

Breakpoint 2, G4SteppingManager::DefinePhysicalStepLength (this=0xc481c98) at src/G4SteppingManager2.cc:168
168                if(verboseLevel&gt;0) fVerbose-&gt;DPSLPostStep();
(gdb) p fCurrentProcess-&gt;GetProcessName()
$14 = (const G4String &amp;) @0xd3779e8: {&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;&gt; = {static npos = 4294967295, _M_dataplus = {&lt;std::allocator&lt;char&gt;&gt; = {&lt;__gnu_cxx::new_allocator&lt;char&gt;&gt; = {&lt;No data fields&gt;}, &lt;No data fields&gt;},
      _M_p = 0xce6044c "OpAbsorption"}}, &lt;No data fields&gt;}
(gdb) c
Continuing.

Breakpoint 2, G4SteppingManager::DefinePhysicalStepLength (this=0xc481c98) at src/G4SteppingManager2.cc:168
168                if(verboseLevel&gt;0) fVerbose-&gt;DPSLPostStep();
(gdb) p fCurrentProcess-&gt;GetProcessName()
$15 = (const G4String &amp;) @0xc094a20: {&lt;std::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;&gt; = {static npos = 4294967295, _M_dataplus = {&lt;std::allocator&lt;char&gt;&gt; = {&lt;__gnu_cxx::new_allocator&lt;char&gt;&gt; = {&lt;No data fields&gt;}, &lt;No data fields&gt;},
      _M_p = 0xc094c04 "Transportation"}}, &lt;No data fields&gt;}
(gdb) c
Continuing.
    2 -1.45e+04   -8e+05 -1.31e+03  2.31e-06        0      208  3.51e+03 /dd/Geometry/RPC/lvNearRPCRoof#pvNearUnSlopModArray#pvNearUnSlopModOne:3#pvNearUnSlopMod:2#pvNearSlopModUnit Transportation
Step#    X(mm)    Y(mm)    Z(mm) KinE(MeV)  dE(MeV) StepLeng TrackLeng  NextVolume ProcName
    0 -1.23e+04   -8e+05 1.56e+03  5.77e-06        0        0         0 /dd/Geometry/Sites/lvNearSiteRock#pvNearHallTop initStep

Breakpoint 2, G4SteppingManager::DefinePhysicalStepLength (this=0xc481c98) at src/G4SteppingManager2.cc:168
168                if(verboseLevel&gt;0) fVerbose-&gt;DPSLPostStep();</pre>
</div>
</div>
<div class="section" id="interaction-with-physics-processes">
<h3>2.4.4.  Interaction with Physics Processes<a class="headerlink" href="#interaction-with-physics-processes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://geant4.web.cern.ch/geant4/UserDocumentation/UsersGuides/ForToolkitDeveloper/html/ch02s04.html">http://geant4.web.cern.ch/geant4/UserDocumentation/UsersGuides/ForToolkitDeveloper/html/ch02s04.html</a></li>
</ul>
<p>The interaction of the tracking category with the physics processes is done in
two ways. First each process can limit the step length through one of its three
<cite>GetPhysicalInteractionLength()</cite> methods, <cite>AtRest</cite>, <cite>AlongStep</cite>, or <cite>PostStep</cite>.
Second, for the selected processes the <cite>DoIt</cite> (<cite>AtRest</cite>, <cite>AlongStep</cite> or <cite>PostStep</cite>) methods are
invoked. All this interaction is managed by the <cite>Stepping</cite> method of
<cite>G4SteppingManager</cite>. To calculate the step length, the <cite>DefinePhysicalStepLength()</cite>
method is called. The flow of this method is the following:</p>
<p>Obtain maximum allowed Step in the volume define by the user through G4UserLimits.</p>
<ol class="arabic simple">
<li>The <cite>PostStepGetPhysicalInteractionLength</cite> of all active processes is called.</li>
<li>Each process returns a step length and the minimum one is chosen.</li>
<li>This method also returns a <cite>G4ForceCondition</cite> flag, to indicate if the process is forced or not:</li>
</ol>
<dl class="docutils">
<dt><cite>Forced</cite></dt>
<dd>Corresponding <cite>PostStepDoIt</cite> is forced.</dd>
<dt><cite>NotForced</cite></dt>
<dd>Corresponding <cite>PostStepDoIt</cite> is not forced unless this process limits the step.</dd>
<dt><cite>Conditionally</cite></dt>
<dd>Only when <cite>AlongStepDoIt</cite> limits the step, corresponding <cite>PoststepDoIt</cite> is invoked.</dd>
<dt><cite>ExclusivelyForced</cite></dt>
<dd>Corresponding <cite>PostStepDoIt</cite> is exclusively forced. All other <cite>DoIt</cite> including <cite>AlongStepDoIts</cite> are ignored.</dd>
</dl>
<p>The <cite>AlongStepGetPhysicalInteractionLength</cite> method of all active processes is
called. Each process returns a step length and the minimum of these and the
This method also returns a <cite>fGPILSelection</cite> flag, to indicate if the process is
the selected one can be is forced or not.</p>
<dl class="docutils">
<dt><cite>CandidateForSelection</cite></dt>
<dd>this process can be the winner. If its step length is the smallest, it will be the process
defining the step (the process =</dd>
<dt><cite>NotCandidateForSelection</cite></dt>
<dd>this process cannot be the winner. Even if its step length is taken as the smallest, it will not be
the process defining the step</dd>
</dl>
</div>
</div>
<div class="section" id="g4-stepping-process-mechanics">
<h2>G4 Stepping, Process mechanics<a class="headerlink" href="#g4-stepping-process-mechanics" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://geant4.web.cern.ch/geant4/UserDocumentation/UsersGuides/ForApplicationDeveloper/html/ch05.html">https://geant4.web.cern.ch/geant4/UserDocumentation/UsersGuides/ForApplicationDeveloper/html/ch05.html</a></li>
</ul>
<div class="section" id="what-is-a-process">
<h3>What is a Process?<a class="headerlink" href="#what-is-a-process" title="Permalink to this headline">¶</a></h3>
<p>Only processes can change information of G4Track and add secondary tracks via
ParticleChange. G4VProcess is a base class of all processes and it has 3 kinds
of DoIt and GetPhysicalInteraction methods in order to describe interactions
generically. If a user want to modify information of G4Track, he (or she)
SHOULD create a special process for the purpose and register the process to the
particle.</p>
</div>
<div class="section" id="what-is-a-particlechange">
<h3>What is a ParticleChange?<a class="headerlink" href="#what-is-a-particlechange" title="Permalink to this headline">¶</a></h3>
<p>Processes do NOT change any information of G4Track directly in their DoIt.
Instead, they proposes changes as a result of interactions by using
ParticleChange. After each DoIt, ParticleChange updates PostStepPoint based on
proposed changes. Then, G4Track is updated after finishing all AlongStepDoIts
and after each PostStepDoIt.</p>
<div class="sidebar">
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../medical/" title="Medical Communities Using Geant4 (esp. optical photon)"
             >next</a> |</li>
        <li class="right" >
          <a href="../opticalphoton/" title="Geant4 Optical Photon"
             >previous</a> |</li>
    <li><a href="/tracs/env/timeline">env</a> &raquo;</li>
    
        <li><a href="../../">Env  documentation</a> &raquo;</li>

          <li><a href="../" >geant4</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Simon C Blyth.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>