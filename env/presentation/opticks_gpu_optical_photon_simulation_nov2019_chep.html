<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<meta name="version" content="S5 1.1" />
<title>Opticks : GPU Optical Photon Simulation for Particle Physics with NVIDIA OptiX</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="visible" />
<!-- style sheet links -->
<script src="ui/my-small-white/slides.js" type="text/javascript"></script>
<link rel="stylesheet" href="ui/my-small-white/slides.css"
      type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/my-small-white/outline.css"
      type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/my-small-white/print.css"
      type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/my-small-white/opera.css"
      type="text/css" media="projection" id="operaFix" />
</head>
<body>
<div class="layout">
<div id="controls"></div>
<div id="currentSlide"></div>
<div id="header">

</div>
<div id="footer">
<h1><span class="i">Opticks : GPU Optical Photon Simulation for Particle Physics with NVIDIA OptiX</span></h1>

</div>
</div>
<div class="presentation">
<div class="slide" id="slide0">
<h1 class="title"><span class="i">Opticks : GPU Optical Photon Simulation for Particle Physics with NVIDIA OptiX</span></h1>

<!-- Definitions of interpreted text roles (classes) for S5/HTML data. -->
<!-- This data file has been placed in the public domain. -->
<!-- Colours
======= -->
<!-- Text Sizes
========== -->
<!-- Display in Slides (Presentation Mode) Only
========================================== -->
<!-- Display in Outline Mode Only
============================ -->
<!-- Display in Print Only
===================== -->
<!-- Display in Handout Mode Only
============================ -->
<!-- Incremental Display
=================== -->
<style type="text/css">

    .strike { text-decoration: line-through; }
    .center {text-align: center;}

    span.alarm { color: red; }
    span.warn { color: orange; }
    span.ok { color: green; }
    span.i { display: none; }
    pre.sliteral { class:"literal-block small"; }
    pre.mypre {
         display: block;
         font-family: monospace;
         font-size: 20px;
         white-space: pre;
         margin: 1em 0;
    }

    pre.mypretiny {
         display: block;
         font-family: monospace;
         font-size: 15px;
         white-space: pre;
         margin: 1em 0;
    }

    pre.myfoot {
         display: block;
         font-family: monospace;
         font-size: 18px;
         white-space: pre;
         color: white;
         position: absolute; top:86%; left:4%; width:50%; height:10% ;
    }

    a.mylink {
         display: block;
         font-family: monospace;
         font-size: 18px;
         white-space: pre;
         color: black;
         position: absolute; top:86%; left:4%; width:50%; height:10% ;
    }


    div.mytitle {
         font-size: 20px;
         color: black;
         position: absolute; top:0%; left:5%; width:90%; height:10% ;
    }

    div.mycredit {
         font-size: 20px;
         color: black;
         position: absolute; top:90%; left:5%; width:80%; height:10% ;
    }

    div.mysidebar {
        margin: 0 0 0.5em 1em;
        border: medium outset;
        padding: 1em;
        background-color: #ffffee;
        width: 20%;
        float: right;
        clear: right;
    }



</style><!-- comment

Recall can navigate the HTML slides by entering a page number and pressing return -->
<div class="mytitle">
<header>
<h1 style="background-color:lightgrey">
      Meeting the Challenge of JUNO Simulation with <i>Opticks</i> : GPU Optical Photon Acceleration via NVIDIA® OptiX™
</h1>
    <h2 style="background-color:lightgrey;text-align:center"> On behalf of the JUNO Collaboration </h2>
</header>

</div>

<img style="position:absolute; top:200px; LEFT:100px; WIDTH:200px; " src="/env/presentation/juno/JUNO_logo.png"  />


<div class="mycredit">
<h2 style="background-color:lightgrey"> Simon C Blyth, IHEP, CAS &mdash; https://bitbucket.org/simoncblyth/opticks &mdash; CHEP, Nov 2019, Adelaide</h2>
</div>
</div>
<div class="slide" id="outline">
<h1>Outline</h1>
<img alt="/env/presentation/newtons-opticks.png" class="align-right" src="/env/presentation/newtons-opticks.png" style="width: 299px; height: 547px;" />
<div class="small"><span>&nbsp;</span></div><ul class="small simple">
<li>Context and Problem<ul>
<li>Jiangmen Underground Neutrino Observatory (JUNO)</li>
<li>Optical Photon Simulation Problem...</li>
</ul>
</li>
<li>Tools to create solution<ul>
<li>Optical Photon Simulation ≈ Ray Traced Image Rendering</li>
<li>Rasterization and Ray tracing</li>
<li>Turing Built for RTX</li>
<li>BVH : Boundary Volume Hierarchy</li>
<li>NVIDIA OptiX Ray Tracing Engine</li>
</ul>
</li>
<li>Opticks : The Solution<ul>
<li>Geant4 + Opticks Hybrid Workflow : External Optical Photon Simulation</li>
<li>Opticks : translates G4 optical physics to CUDA/OptiX</li>
<li>Opticks : translates G4 geometry to GPU, without approximation`</li>
<li>CUDA/OptiX Intersection functions for ~10 primitives</li>
<li>CUDA/OptiX Intersection functions for Arbitrarily Complex CSG shapes</li>
</ul>
</li>
</ul>
<div class="small"><hr/></div><ul class="small simple">
<li>Former<ul>
<li>Opticks Primitives, CSG on GPU</li>
<li>Translate Geometry and Physics</li>
<li><span class="blue">Geometry changes enabling translation</span></li>
</ul>
</li>
<li>p15 <span class="red">Updates</span> : Support OptiX 6.0.0, RTX mode, RT Cores<ul>
<li>JUNO-360 benchmark, RTX mode speedup, multi-GPU scaling</li>
</ul>
</li>
<li>p21 <span class="red">Validation</span> : Systematic Scan of 40 JUNO Solids<ul>
<li>Random Aligned Bi-Simulation -&gt; Direct Array Comparison</li>
</ul>
</li>
<li>p34 <span class="red">Performance</span> : Scanning from 1M to 60M photons<ul>
<li>Opticks vs Geant4 performance (test geometry)</li>
</ul>
</li>
<li>Opticks : Aims to Revolutionize JUNO Muon Simulation</li>
<li><span class="red">(Tao Lin, Simulation Group) Deferred OP Sim using Gensteps</span></li>
<li>Opticks Links</li>
</ul>
</div>
<div class="slide" id="juno-basics-pedro-nufact-2019">
<h1><span class="i">JUNO_Basics_Pedro_NuFact_2019</span></h1>
<div class="mysidebar" style="position: absolute; top:20%; left:70%; width:25%; height:30% ;" >

   <dl class="small docutils">
     <dt>
       <strong> Primary Goal </strong>
     </dt>
     <dd>determine neutrino mass ordering<dd>
   </dl>

   <ul class="small">
      <li>reactor neutrino oscillated energy spectrum</li>
      <li>energy resolution 3% @ 1MeV </li>
      <li>worlds largest LS detector</li>
   </ul>

</div><!-- comment -->
</div>
<div class="slide" id="juno-multipurpose-pedro-nufact-2019">
<h1><span class="i">JUNO_Multipurpose_Pedro_NuFact_2019</span></h1>
<div class="mysidebar" style="position: absolute; top:10%; left:70%; width:25%; height:40% ;" >
   <dl class="small docutils">
     <dt>
       <strong> Primary JUNO Backgrounds </strong>
     </dt>
     <dd>cosmic muon induced</dd>
   </dl>

   <ul class="small">
      <li>underground site</li>
      <li>water shield</li>
      <li>muon veto system</li>
   </ul>

   <dl class="small docutils">
     <dt>
       <strong> Minimize veto time/volume </strong>
     </dt>
     <dd> precise muon reconstruction </dd>
   </dl>

   <ul class="small">
      <li>large simulated muon samples : essential</li>
   </ul>



</div><!-- comment

:i:`JPMT Before Contact 2`
- - - - - - - - - - - - - - - - - - - - - - - - - - -->
</div>
<div class="slide" id="optical-photon-simulation-problem">
<h1><span class="incremental">Optical Photon Simulation Problem...</span></h1>
<pre>







</pre><div class="sidebar">
<p class="first sidebar-title"><span class="small">Huge CPU Memory+Time Expense</span></p>
<dl class="small last docutils">
<dt><strong>JUNO Muon Simulation Bottleneck</strong></dt>
<dd>~99% CPU time, memory constraints</dd>
<dt><strong>Ray-Geometry intersection Dominates</strong></dt>
<dd>simulation is not alone in this problem...</dd>
<dt><strong>Optical photons : naturally parallel, simple :</strong></dt>
<dd><ul class="first last simple">
<li>produced by Cerenkov+Scintillation</li>
<li>yield only Photomultiplier hits</li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="slide" id="optical-photon-simulation-ray-traced-image-rendering">
<h1><span class="small">Optical Photon Simulation ≈ Ray Traced Image Rendering</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Not a Photo, a Calculation</p>
<img alt="/env/optix/samples/optix-ray-tracing-glasses.png" class="align-right" src="/env/optix/samples/optix-ray-tracing-glasses.png" style="width: 450px;" />
<p class="tiny last"><a class="reference external" href="http://on-demand.gputechconf.com/siggraph/2013/presentation/SG3106-Building-Ray-Tracing-Applications-OptiX.pdf">http://on-demand.gputechconf.com/siggraph/2013/presentation/SG3106-Building-Ray-Tracing-Applications-OptiX.pdf</a></p>
</div>
<p class="small"><strong>Much in common : geometry, light sources, optical physics</strong></p>
<ul class="small simple">
<li><span class="blue">simulation</span> : photon parameters at PMT detectors</li>
<li><span class="blue">rendering</span> : pixel values at image plane</li>
<li><span class="red">both limited by ray geometry intersection, aka ray tracing</span></li>
</ul>
<p class="small"><strong>Many Applications of ray tracing</strong> :</p>
<ul class="small simple">
<li>advertising, design, architecture, films, games,...</li>
<li>-&gt; huge efforts to improve hw+sw over 30 yrs</li>
</ul>
<p class="small"><strong>August 2018 : Major Ray Tracing Advance</strong></p>
<ul class="small simple">
<li>NVIDIA RTX Platform, Turing GPU</li>
<li><span class="red">ray trace dedicated hardware : RT cores</span></li>
</ul>
</div>
<div class="slide" id="ray-tracing-vs-rasterization">
<h1><span class="i">Ray-tracing vs Rasterization</span></h1>
<img alt="/env/presentation/nvidia/nv_rasterization.png" class="align-left" src="/env/presentation/nvidia/nv_rasterization.png" style="width: 550px;" />
<img alt="/env/presentation/nvidia/nv_raytrace.png" class="align-right" src="/env/presentation/nvidia/nv_raytrace.png" style="width: 550px;" />
<!-- comment

Rasterization

* starts from the objects in a scene, and projects them onto pixels in image plane
* approximation : usually triangulated geometry

ray-tracing

* closer to the physics -> easier to create realistic images with raytracing
* can use analytic geometry, rasterization is

https://www.youtube.com/watch?v=Mrixi27G9yM

RTX Launch -->
</div>
<div class="slide" id="turing-built-for-rtx-2">
<h1><span class="i">TURING BUILT FOR RTX 2</span></h1>
<pre>






</pre><div class="sidebar">
<p class="first sidebar-title"><span class="small">Ray Trace Dedicated RT Cores</span></p>
<ul class="small simple">
<li>BVH (Boundary Volume Hierarchy) traversal</li>
<li>ray triangle intersection</li>
</ul>
<p class="small last"><strong>Move part of ray tracing : SM -&gt; RT Core</strong></p>
</div>
</div>
<div class="slide" id="nvidia-rtx-metro-exodus">
<h1><span class="i">NVIDIA RTX Metro Exodus</span></h1>
<pre>







</pre><div class="sidebar">
<p class="first sidebar-title"><span class="small">NVIDIA RTX Platform : Hybrid Rendering</span></p>
<ul class="small simple">
<li><span class="red">Ray trace (RT cores)</span></li>
<li>AI inference (Tensor cores) -&gt; Denoising</li>
<li>Compute (SM, CUDA cores)</li>
<li>Rasterization (pipeline)</li>
</ul>
<p class="small last">-&gt; <span class="red">real-time realistic 3D rendering</span></p>
</div>
</div>
<div class="slide" id="spatial-index-acceleration-structure">
<h1><tt class="docutils literal">Spatial Index Acceleration Structure</tt></h1>
<pre>











</pre><div class="sidebar">
<p class="first sidebar-title"><span class="small">Tree of Bounding Boxes (bbox)</span></p>
<ul class="small last simple">
<li>aims to minimize bbox+primitive intersects</li>
<li>accelerates ray-geometry intersection</li>
</ul>
</div>
</div>
<div class="slide" id="hardware-traversal-of-bvh-spatial-index">
<h1><tt class="docutils literal">Hardware Traversal of BVH Spatial Index</tt></h1>
<!-- comment

https://www.anandtech.com/show/13282/nvidia-turing-architecture-deep-dive/3
https://images.anandtech.com/galleries/6660/NV_Turing_Editors_Day_029.png
https://images.anandtech.com/galleries/6660/NV_Turing_Editors_Day_030.png
https://images.anandtech.com/galleries/6660/NV_Turing_Editors_Day_031.png -->
<!-- comment



:small:`CPU vs GPU architectures, Latency vs Throughput`
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

.. class:: small

    .. image:: /env/presentation/nvidia/cpu_vs_gpu_architecture.png
       :width: 800px
       :align: center

.. class:: small

   Waiting for memory read/write, is major source of latency...

   **CPU : latency-oriented : Minimize time to complete single task** : :red:`avoid latency with caching`
       * complex : caching system, branch prediction, speculative execution, ...

   **GPU : throughput-oriented : Maximize total work per unit time** : :red:`hide latency with parallelism`
       * many simple processing cores, hardware multithreading, SIMD (single instruction multiple data)
       * simpler : :green:`lots of compute (ALU)`, at expense of cache+control
       * design assumes :red:`abundant parallelism`

   Effective use of **Totally different processor architecture** -> :red:`Total reorganization of data and computation`


.. class:: tiny

    Understanding Throughput-oriented Architectures
    https://cacm.acm.org/magazines/2010/11/100622-understanding-throughput-oriented-architectures/fulltext


.. comment

   Latency hiding works using hardware multi-threading, so when one group of threads is blocked
   waiting to read from global memory for example : other groups of thread and be resumed. This
   is only effective at hiding latency when there are enough other threads in flight at the same time.

   Porting CPU code to run on the GPU : is not a straightforward thing to do, because the archirecture is totally
   different.  To make effective use of GPUs requires a total reorganization of data and compute.



:i:`Introducing OptiX 7`
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

.. sidebar:: :small:`low-level CUDA-centric thin API`

    .. class:: small

        * Vulkanization : *flexibility* + thread-safety
        * :red:`Need rewrite : Opticks<->OptiX7 interface`


`TITAN RTX : 72 Raytrace Dedicated RT Cores, 4608 CUDA Cores, 24GB VRAM, 2500 USD`
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<!-- comment

:i:`NVIDIA RTX Technology`
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
</div>
<div class="slide" id="nvidia-optix-ray-tracing-engine-http-developer-nvidia-com-optix">
<h1><span class="small">NVIDIA® OptiX™ Ray Tracing Engine -- http://developer.nvidia.com/optix</span></h1>
<div class="sidebar">
<p class="first sidebar-title">OptiX Raytracing Pipeline</p>
<p class="small">Analogous to OpenGL rasterization pipeline:</p>
<img alt="/env/optix/docs/optix-model.png" class="last align-right" src="/env/optix/docs/optix-model.png" style="width: 450px;" />
</div>
<p class="small"><strong>OptiX makes GPU ray tracing accessible</strong></p>
<ul class="small simple">
<li><strong>accelerates</strong> ray-geometry intersections</li>
<li>simple : single-ray programming model</li>
<li>&quot;...free to use within any application...&quot;</li>
<li><span class="red">access RT Cores[1] with OptiX 6.0.0+ via RTX™ mode</span></li>
</ul>
<p class="small"><strong>NVIDIA expertise:</strong></p>
<ul class="small simple">
<li><span class="red">~linear scaling up to 4 GPUs</span></li>
<li>acceleration structure creation + traversal (Blue)</li>
<li>instanced sharing of geometry + acceleration structures</li>
<li>compiler optimized for GPU ray tracing</li>
</ul>
<p class="small"><strong>Opticks provides (Yellow):</strong></p>
<ul class="small simple">
<li>ray generation program</li>
<li><span class="red">ray geometry intersection+bbox programs</span></li>
</ul>
<p class="tiny">[1] Turing RTX GPUs</p>
<!-- comment

``NVIDIA OptiX : programming model analogous to rasterization APIs : OpenGL shaders``
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
</div>
<div class="slide" id="geant4opticksworkflow">
<h1><span class="i">Geant4OpticksWorkflow</span></h1>
</div>
<div class="slide" id="opticks-translates-g4-optical-physics-to-cuda-optix">
<h1><span class="small">Opticks : translates G4 optical physics to CUDA/OptiX</span></h1>
<div class="sidebar">
<p class="first sidebar-title">GPU Resident Photons</p>
<dl class="small docutils">
<dt><strong>Seeded on GPU</strong></dt>
<dd>associate photons -&gt; <em>gensteps</em> (via seed buffer)</dd>
<dt><strong>Generated on GPU, using genstep param:</strong></dt>
<dd><ul class="first last simple">
<li>number of photons to generate</li>
<li>start/end position of step</li>
</ul>
</dd>
<dt><strong>Propagated on GPU</strong></dt>
<dd><span class="red">Only photons hitting PMTs copied to CPU</span></dd>
</dl>
<p class="small">Thrust: <strong>high level C++ access to CUDA</strong></p>
<div class="small figure align-right">
<img alt="/env/numerics/thrust/thrust.png" src="/env/numerics/thrust/thrust.png" style="width: 300px;" />
</div>
<ul class="small last simple">
<li><a class="reference external" href="https://developer.nvidia.com/Thrust">https://developer.nvidia.com/Thrust</a></li>
</ul>
</div>
<p class="small"><span class="blue">OptiX : single-ray programming model</span> -&gt; line-by-line translation</p>
<dl class="small docutils">
<dt><strong>CUDA Ports of Geant4 classes</strong></dt>
<dd><ul class="first last simple">
<li>G4Cerenkov (only generation loop)</li>
<li>G4Scintillation (only generation loop)</li>
<li>G4OpAbsorption</li>
<li>G4OpRayleigh</li>
<li>G4OpBoundaryProcess (only a few surface types)</li>
</ul>
</dd>
<dt><strong>Modify Cerenkov + Scintillation Processes</strong></dt>
<dd><ul class="first last simple">
<li>collect <em>genstep</em>, copy to GPU for generation</li>
<li><span class="red">avoids copying millions of photons to GPU</span></li>
</ul>
</dd>
<dt><strong>Scintillator Reemission</strong></dt>
<dd><ul class="first last simple">
<li>fraction of bulk absorbed &quot;reborn&quot; within same thread</li>
<li>wavelength generated by reemission texture lookup</li>
</ul>
</dd>
<dt><strong>Opticks (OptiX/Thrust GPU interoperation)</strong></dt>
<dd><ul class="first last simple">
<li><strong>OptiX</strong> : upload gensteps</li>
<li><strong>Thrust</strong> : seeding, distribute genstep indices to photons</li>
<li><strong>OptiX</strong> : launch photon generation and propagation</li>
<li><strong>Thrust</strong> : pullback photons that hit PMTs</li>
<li><strong>Thrust</strong> : index photon step sequences (optional)</li>
</ul>
</dd>
</dl>
</div>
<div class="slide" id="opticks-translates-g4-geometry-to-gpu-without-approximation">
<h1><span class="small">Opticks : translates G4 geometry to GPU, without approximation</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Volumes -&gt; Boundaries</p>
<p class="small"><strong>Ray tracing favors Boundaries</strong></p>
<p class="small">Material/surface boundary : 4 indices</p>
<ul class="small simple">
<li>outer material (parent)</li>
<li>outer surface (inward photons, parent -&gt; self)</li>
<li>inner surface (outward photons, self -&gt; parent)</li>
<li>inner material (self)</li>
</ul>
<p class="small">Primitives labelled with unique boundary index</p>
<ul class="small last simple">
<li>ray primitive intersection -&gt; boundary index</li>
<li>texture lookup -&gt; material/surface properties</li>
</ul>
</div>
<dl class="small docutils">
<dt><strong>Automated : Geant4 &quot;World&quot; -&gt; Opticks CSG -&gt; CUDA/OptiX</strong></dt>
<dd><ul class="first last simple">
<li>intersection functions for ~10 primitives</li>
<li>intersection program for arbitrarily complex CSG shapes</li>
</ul>
</dd>
<dt><strong>Structure</strong></dt>
<dd><ul class="first last simple">
<li>repeated geometry instances identified (progeny digests)</li>
<li>instance transforms used in OptiX/OpenGL geometry</li>
<li>merge CSG trees into global + instance buffers</li>
</ul>
</dd>
<dt><strong>Material/Surface/Scintillator properties</strong></dt>
<dd><ul class="first last simple">
<li>interpolated to standard wavelength domain</li>
<li>interleaved into &quot;boundary&quot; texture</li>
<li>&quot;reemission&quot; texture for wavelength generation</li>
</ul>
</dd>
</dl>
</div>
<div class="slide" id="cuda-optix-intersection-functions-for-10-primitives">
<h1><span class="small">CUDA/OptiX Intersection functions for ~10 primitives</span></h1>
<ul class="small simple">
<li>3D parametric ray : <strong>ray(x,y,z;t) = rayOrigin  +  t * rayDirection</strong></li>
<li>implicit equation of primitive : <strong>f(x,y,z) = 0</strong></li>
<li>-&gt; polynomial in <strong>t</strong> , roots: <strong>t &gt; t_min</strong>  -&gt; intersection positions + surface normals</li>
</ul>
<div class="figure align-center">
<img alt="/env/presentation/tboolean_parade_sep2017.png" src="/env/presentation/tboolean_parade_sep2017.png" style="width: 900px;" />
<p class="caption">Sphere, Cylinder, Disc, Cone, Convex Polyhedron, Hyperboloid, <span class="red">Torus</span>, ...</p>
</div>
</div>
<div class="slide" id="cuda-optix-intersection-program-for-arbitrarily-complex-csg-shapes">
<h1><span class="small">CUDA/OptiX Intersection Program for Arbitrarily Complex CSG shapes</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Outside/Inside Unions</p>
<p class="small">dot(normal,rayDir) -&gt; Enter/Exit</p>
<img alt="/env/presentation/kensler_union_of_two_spheres_from_outside.png" class="align-center" src="/env/presentation/kensler_union_of_two_spheres_from_outside.png" style="width: 300px;" />
<img alt="/env/presentation/kensler_union_of_two_spheres_from_inside.png" class="align-center" src="/env/presentation/kensler_union_of_two_spheres_from_inside.png" style="width: 300px;" />
<ul class="small last simple">
<li><strong>A + B</strong> boundary not inside other</li>
<li><strong>A * B</strong> boundary inside other</li>
</ul>
</div>
<p class="small">Complete Binary Tree, pick between pairs of nearest intersects:</p>
<table border="1" class="small docutils">
<colgroup>
<col width="37%" />
<col width="17%" />
<col width="24%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><em>UNION</em> tA &lt; tB</th>
<th class="head">Enter B</th>
<th class="head">Exit B</th>
<th class="head">Miss B</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><strong>Enter A</strong></td>
<td>ReturnA</td>
<td><span class="blue">LoopA</span></td>
<td>ReturnA</td>
</tr>
<tr><td><strong>Exit A</strong></td>
<td>ReturnA</td>
<td>ReturnB</td>
<td>ReturnA</td>
</tr>
<tr><td><strong>Miss A</strong></td>
<td>ReturnB</td>
<td>ReturnB</td>
<td>ReturnMiss</td>
</tr>
</tbody>
</table>
<ul class="small simple">
<li><em>Nearest hit intersect algorithm</em> [1] avoids state<ul>
<li>sometimes <span class="blue">Loop</span> : advance <strong>t_min</strong> , re-intersect both</li>
<li>classification shows if inside/outside</li>
</ul>
</li>
<li><em>Evaluative</em> [2] implementation emulates recursion:<ul>
<li><span class="red">recursion not allowed</span> in OptiX intersect programs</li>
<li>bit twiddle traversal of complete binary tree</li>
<li>stacks of postorder slices and intersects</li>
</ul>
</li>
<li><span class="red">Identical geometry to Geant4</span><ul>
<li>solving the same polynomials</li>
<li>near perfect intersection match</li>
</ul>
</li>
</ul>
<dl class="tiny docutils">
<dt>[1] Ray Tracing CSG Objects Using Single Hit Intersections, Andrew Kensler (2006)</dt>
<dd>with corrections by author of XRT Raytracer <a class="reference external" href="http://xrt.wikidot.com/doc:csg">http://xrt.wikidot.com/doc:csg</a></dd>
<dt>[2] <a class="reference external" href="https://bitbucket.org/simoncblyth/opticks/src/tip/optixrap/cu/csg_intersect_boolean.h">https://bitbucket.org/simoncblyth/opticks/src/tip/optixrap/cu/csg_intersect_boolean.h</a></dt>
<dd>Similar to binary expression tree evaluation using postorder traverse.</dd>
</dl>
<!-- comment

* DELL Precision 7920T Workstation
* Intel Xeon Silver 4114, 2.2GHz, 40 cores, 65G
* NVIDIA Quadro RTX 8000, 48G

* DELL Precision 7920T Workstation
* Intel Xeon Gold 5118, 2.3GHz, 48 cores, 65G
* NVIDIA TITAN RTX, 24G
* NVIDIA TITAN V, 12G -->
</div>
<div class="slide" id="performance-scanning-from-1m-to-400m-photons">
<h1><span class="small">Performance : Scanning from 1M to 400M photons</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">Test Hardware + Software</span></p>
<p class="small"><strong>Hardware</strong></p>
<ul class="small simple">
<li>DELL Precision 7920T Workstation</li>
<li>Intel Xeon Gold 5118, 2.3GHz, 48 cores, 62G</li>
<li>NVIDIA Quadro RTX 8000 (48G)</li>
</ul>
<p class="small"><strong>Software</strong></p>
<ul class="small last simple">
<li>Opticks 0.0.0 Alpha</li>
<li>Geant4 10.4p2</li>
<li>NVIDIA OptiX 6.5.0</li>
<li>NVIDIA Driver 435.21</li>
<li>CUDA 10.1</li>
</ul>
</div>
<p class="small"><strong>Full JUNO Geometry j1808v5</strong></p>
<ul class="small simple">
<li>&quot;calibration&quot; source genstep at center of scintillator</li>
</ul>
<p class="small"><strong>Production Mode : does the minimum</strong></p>
<ul class="small simple">
<li>only saves hits</li>
<li>skips : genstep, photon, source, record, sequence, index, ..</li>
<li>no <em>Geant4</em> propagation (other than at 1M for extrapolation)</li>
</ul>
<p class="small"><strong>Multi-Event Running</strong> : measure <span class="red">interval</span> and <span class="red">launch</span></p>
<p class="small"><span class="red">interval</span> : <strong>avg time between successive launches</strong>, including:</p>
<ul class="small simple">
<li>upload gensteps</li>
<li><span class="red">launch</span> : avg <strong>photon generation + propagation</strong> time</li>
<li>download hits</li>
</ul>
</div>
<div class="slide" id="nvidia-quadro-rtx-8000-48g">
<h1><tt class="docutils literal">NVIDIA Quadro RTX 8000 (48G)</tt></h1>
<div class="mysidebar" style="position: absolute; top:15%; left:65%; width:22%; height:10% ;" >
   <strong> 谢谢 NVIDIA China <br> for loaning the card </strong>
</div><!-- comment

update these profilesmry.py plots with::

    scan-plot     # on workstation
    scan-pub      # on laptop with simoncblyth.bitbucket.org clone
    scan-pubrst   # prepare RST for inclusion at tail -->
</div>
<div class="slide" id="scan-pf-1-nhit">
<h1><span class="i">scan-pf-1_NHit</span></h1>
<pre>




</pre><div class="sidebar">
<p class="first sidebar-title"><span class="small">Photon Launch Size : VRAM Limited</span></p>
<p class="small"><strong>NVIDIA Quadro RTX 8000 (48 GB)</strong></p>
<ul class="small simple">
<li>photon 4*4 floats : 64 bytes</li>
<li>curandState       : 48 bytes</li>
</ul>
<p class="small"><strong>400M photons</strong> x <span class="blue">112 bytes</span> ~ 45G</p>
<p class="small last">&quot;hit&quot; mask: BULK_REEMIT | BULK_SCATTER | BOUNDARY_TRANSMIT | SURFACE_ABSORB</p>
</div>
</div>
<div class="slide" id="scan-pf-1-interval-over-launch">
<h1><span class="i">scan-pf-1_Interval_over_Launch</span></h1>
<pre>








</pre><div class="sidebar">
<p class="first sidebar-title"><span class="small">Genstep/Hit Copying Overheads</span></p>
<dl class="small docutils">
<dt><strong>launch</strong></dt>
<dd>time of each OptiX launch (avg of 10)</dd>
<dt><strong>interval, including overhead</strong></dt>
<dd>time between subsequent launches (avg of 9)</dd>
</dl>
<p class="small last"><span class="red">Mostly &lt; 10% Overhead beyond 20M photons</span></p>
</div>
</div>
<div class="slide" id="scan-pf-1-opticks-vs-geant4-2">
<h1><span class="i">scan-pf-1_Opticks_vs_Geant4 2</span></h1>
<pre>




</pre><table border="1" class="small docutils align-center">
<colgroup>
<col width="42%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head" colspan="2">JUNO Full, 400M photons from center</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Geant4 Extrap.</td>
<td>95,600 s (26 hrs)</td>
</tr>
<tr><td>Opticks RTX ON (i)</td>
<td>58 s</td>
</tr>
</tbody>
</table>
</div>
<div class="slide" id="scan-pf-1-opticks-speedup-2">
<h1><span class="i">scan-pf-1_Opticks_Speedup 2</span></h1>
<pre>









</pre><table border="1" class="small docutils align-center">
<colgroup>
<col width="41%" />
<col width="30%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head" colspan="2">JUNO Full, 400M photons from center</th>
<th class="head">Speedup</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Opticks RTX ON (i)</td>
<td>58s</td>
<td>x1660</td>
</tr>
<tr><td>Opticks RTX OFF (i)</td>
<td>275s</td>
<td>x348</td>
</tr>
<tr><td>Geant4 Extrap.</td>
<td>95,600s (26 hrs)</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<!-- comment

:i:`geocache_360`
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -


JUNO-360 benchmark with OptiX 6.0.0, RTX mode
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

.. sidebar:: :small:`Ray tracing Benchmark`

     .. class:: small

         * JUNO 360 degree view
         * Equirectangular Projection
         * very high resolution 59M pixels

           * 10240x5760 = 8x8x1280x720

         * compare GPUs and RTX mode
         * checking scaling across multiple GPUs



:i:`bench_20190526_202537`
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -


:i:`bench_20190526_202537 2`
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -


.. sidebar:: :small:`NVIDIA OptiX 6.0.0 : RTX Mode`

     .. class:: small

         Ray trace performance improvements:

         * 1.25x with TITAN V
         * 3.5x with TITAN RTX (RT Cores)

           * BVH traversal done in hardware
           * analytic intersection still software
           * triangle geometry can be done in hardware


         **Initially was 0.33x with RTX**
            OptiX developers helped find the cause

            * unused double precision torus code
            * performance improved by eliminating *.f64* from PTX, *ptx.py*





:i:`bench_20190526_143808`
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -


:i:`bench_20190526_143808 2`
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -


.. sidebar:: :small:`GPU Scaling Performance`

     .. class:: small

         **Opticks on IHEP GPU Cluster**

         OptiX : Almost perfect scaling for 1,2,4 GPUs

         * degrades for > 4 GPUs
         * PCIe bus congestion, pinned host memory

         "cvd" selects GPUs
            CUDA_VISIBLE_DEVICES envvar
         R0/R1
            RTX mode OFF/ON


         **NVIDIA Tesla V100 GPUs**
            No RT Cores, RTX still gives ~ 1.25x -->
</div>
<div class="slide" id="validation-systematic-scan-of-all-40-juno-solids">
<h1><span class="small">Validation : Systematic Scan of All 40 JUNO Solids</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">Masked Running</span></p>
<p class="small">Repeatable bi-simulation of any photon subset</p>
<ul class="small last simple">
<li>essential for debugging</li>
<li>limited to input photons (not gensteps)</li>
<li>constructs curandState buffer subset</li>
</ul>
</div>
<p class="small"><strong>Create test geometries using solids, materials, surfaces from base geometry geocache</strong></p>
<dl class="small docutils">
<dt>40 geometries</dt>
<dd>test containers for all JUNO solids</dd>
<dt>input photons</dt>
<dd>feed same initial photons to <em>Opticks</em> and <em>Geant4</em></dd>
<dt>input cuRAND randoms to <em>Geant4</em></dt>
<dd>same random sequence for <em>Opticks</em> and <em>Geant4</em></dd>
<dt>bi-simulation executable</dt>
<dd>save propagations from <em>Opticks</em> and <em>Geant4</em> as <em>OpticksEvents</em> (.npy arrays)</dd>
</dl>
</div>
<div class="slide" id="validation-random-aligned-bi-simulation-direct-array-comparison">
<h1><span class="small">Validation : Random Aligned Bi-Simulation -&gt; Direct Array Comparison</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">3-way &quot;zip&quot; : 2*code + randoms</span></p>
<dl class="small last docutils">
<dt><strong>Align CPU/GPU Random Number Sequences</strong></dt>
<dd>G4 random engine providing <em>cuRAND</em> sequence</dd>
<dt><strong>&quot;Align&quot; CPU/GPU codes (some jumps)</strong></dt>
<dd><span class="red">simplest possible direct comparison</span></dd>
</dl>
</div>
<p class="small"><strong>NPY serialized arrays</strong></p>
<ul class="small simple">
<li>convenient analysis with <em>NumPy</em></li>
<li><em>np.load(path, mmap_mode=&quot;r&quot;)</em> : loading array slices</li>
</ul>
<span>&nbsp;</span>

<pre class="mypretiny">




In [11]: pdv = np.where(dv > 0.0001)[0]
In [12]: ab.dumpline(pdv)
      0   1230 : TO BR SC BT BR BT SA
      1   2413 : TO BT BT SC BT BR BR BT SA
      2   9041 : TO BT SC BR BR BR BR BT SA
      3  14510 : TO SC BT BR BR BT SA
      4  14747 : TO BT SC BR BR BR BR BR BR BR
      5  14747 : TO BT SC BR BR BR BR BR BR BR
    ...

In [20]: ab.b.ox[pdv,0]                                 In [21]: ab.a.ox[pdv,0]
Out[20]:                                                Out[21]:
A()sliced                                               A()sliced
A([    [-191.6262, -240.3634,  450.    ,    5.566 ],    A([    [-191.626 , -240.3634,  450.    ,    5.566 ],
       [ 185.7708, -133.8457,  450.    ,    7.3141],           [ 185.7708, -133.8456,  450.    ,    7.3141],
       [-450.    , -104.4142,  311.143 ,    9.0581],           [-450.    , -104.4142,  311.1431,    9.0581],
       [  83.6955,  208.9171, -450.    ,    5.6188],           [  83.6954,  208.9172, -450.    ,    5.6188],
       [  32.8972,  150.    ,   24.9922,    7.6757],           [  32.8973,  150.    ,   24.992 ,    7.6757],
       [  32.8972,  150.    ,   24.9922,    7.6757],           [  32.8973,  150.    ,   24.992 ,    7.6757],
       [ 450.    , -186.7449,  310.6051,    5.0707],           [ 450.    , -186.7451,  310.605 ,    5.0707],
       [ 299.2227,  318.1443, -450.    ,    4.8717],           [ 299.2229,  318.144 , -450.    ,    4.8717],
 ...
</pre><p class="tiny"><a class="reference external" href="http://bitbucket.com/simoncblyth/opticks/src/tip/notes/issues/tboolean_box_perfect_alignment_small_deviations.rst">http://bitbucket.com/simoncblyth/opticks/src/tip/notes/issues/tboolean_box_perfect_alignment_small_deviations.rst</a></p>
</div>
<div class="slide" id="tv21-1m-a">
<h1><span class="i">tv21_1M_a</span></h1>
</div>
<div class="slide" id="tv21-1m-a-2">
<h1><span class="i">tv21_1M_a 2</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">&quot;Darkroom&quot; Geometry Testing</span></p>
<p class="small"><strong>Random Aligned Bi-Simulation</strong></p>
<ul class="small simple">
<li>shoot 1M photons at solid</li>
<li>save <em>Geant4</em> and <em>Opticks</em> propagations</li>
<li><em>NumPy</em> analysis</li>
</ul>
<p class="small"><strong>Future flags (next step point)</strong></p>
<dl class="small last docutils">
<dt>Cyan</dt>
<dd>BT : boundary transmit</dd>
<dt>Orange</dt>
<dd>SA : surface absorb</dd>
<dt>Yellow</dt>
<dd>BR : boundary reflect</dd>
</dl>
</div>
</div>
<div class="slide" id="tv21-1m-c">
<h1><span class="i">tv21_1M_c</span></h1>
</div>
<div class="slide" id="tv16-fastener">
<h1><span class="i">tv16_Fastener</span></h1>
</div>
<div class="slide" id="absmry-1m">
<h1><span class="i">absmry_1M</span></h1>
</div>
<div class="slide" id="absmry-1m-2">
<h1><span class="i">absmry_1M 2</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">Mis-aligned + Deviation Summary</span></p>
<dl class="small last docutils">
<dt>npho</dt>
<dd>number of photons (1M)</dd>
<dt>fmal</dt>
<dd>mis-aligned history fraction <span class="red">mostly &lt; 0.5%</span></dd>
<dt>ndvp</dt>
<dd>deviant photons <span class="red">mostly &lt; 0.05% (500/1M)</span></dd>
<dt>rpost_dv</dt>
<dd>&lt;16 step point positions, times (compressed)</dd>
<dt>rpol_dv</dt>
<dd>&lt;16 step point polarizations (compressed)</dd>
<dt>ox_dv</dt>
<dd>final position, time, direction, polarization, wavelength (float)</dd>
<dt><strong>mis-alignment</strong></dt>
<dd><span class="blue">debug needed to duplicate G4 indigestion</span></dd>
<dt><strong>deviants</strong></dt>
<dd><span class="blue">f32 vs f64 + many bounces + &quot;lever arm&quot; ?</span>
(f64 tests to confirm)</dd>
</dl>
</div>
</div>
<div class="slide" id="ta34-1m">
<h1><span class="i">ta34_1M</span></h1>
</div>
<div class="slide" id="ta34-1m-2">
<h1><span class="i">ta34_1M 2</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">Example Solid : sInnerWater</span></p>
<dl class="small docutils">
<dt>nitem</dt>
<dd>photons compared</dd>
<dt>nelem</dt>
<dd>floats compared (many millions)</dd>
<dt>fwar/ferr/ffat</dt>
<dd>fractions above deviation cuts</dd>
<dt>ndvp</dt>
<dd>total error/fatal photons</dd>
</dl>
<dl class="tiny last docutils">
<dt>BT(BR)</dt>
<dd>boundary transmit(reflect)</dd>
<dt>SC(AB)</dt>
<dd>bulk scatter(absorb)</dd>
<dt>SA</dt>
<dd>surface absorb</dd>
</dl>
</div>
</div>
<div class="slide" id="validation-issue-1-history-mis-alignment-0-01-0-50-of-photons">
<h1><span class="small">Validation Issue 1 : History Mis-alignment : 0.01-0.50% of photons</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">3-way zipper snagged</span></p>
<ul class="small last simple">
<li>starts aligned, then history diverges</li>
<li><span class="red">py scripted lldb (macOS) required</span></li>
<li><em>G4</em> random edge cases not yet duplicated</li>
<li>Several tricks[1] already in use, more needed</li>
</ul>
</div>
<p class="small"><strong>Large Range 0.01% 0.50% 3% depending on extent</strong></p>
<dl class="small docutils">
<dt>PMT_20inch_inner2_solid(LV 19) 163/1M</dt>
<dd>extra BR(boundary reflect) or BT(boundary transmit)</dd>
<dt>sWorld(LV 39) 29906/1M ~3%</dt>
<dd><ul class="first last simple">
<li>large extent : direct photons travel 360m</li>
<li>many &quot;maxbounce&quot; truncations, lots of scattering</li>
</ul>
</dd>
</dl>
<pre class="mypretiny">

ab.mal (LV 19)
aligned   999837/1000000 : 0.9998 : 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24
maligned     163/1000000 : 0.0002 : 2908,4860,5477,12338,17891,18117,28709,32764,37671,43675,45874,...

      0   2908 : * :                   TO BT BR BR BT SA                 TO BT BR BR BR BT SA
      1   4860 : * :                      TO BT BT BT SA                    TO BT BT BT BT SA
      2   5477 : * :                      TO BT BT BT SA                    TO BT BT BT BT SA
      3  12338 : * :                      TO BT BR BT SA        TO BT BR BR BR BR BR BR BR BR
...
ab.mal (LV 39)
aligned   970094/1000000 : 0.9701 : 0,1,2,4,5,6,7,8,9,10,11,12,13,14,16,17,18,19,20,21,22,23,24,26,27
maligned   29906/1000000 : 0.0299 : 3,15,25,80,132,288,294,329,376,377,379,436,511,536,655,662,...
slice(0, 25, None)
      0      3 : * :        TO BT SC BR BR BR BR BR BR BR        TO BT SC BR BR BR BR BR SC BR
      1     15 : * :        TO BT SC BR BR BR BR BR SC BR        TO BT SC BR BR SC BT SC BT SC
      2     25 : * :                 TO BT SC BR BR BR AB        TO BT SC BR BR BR BR BR BR BR
      3     80 : * :                 TO BT BT SC BT BR AB        TO BT BT SC BT BR BR SC BR AB
...
</pre><p class="tiny">[1] <a class="reference external" href="https://bitbucket.org/simoncblyth/opticks/src/tip/notes/issues/alignment_options_review.rst">https://bitbucket.org/simoncblyth/opticks/src/tip/notes/issues/alignment_options_review.rst</a></p>
</div>
<div class="slide" id="validation-issue-2-history-aligned-but-deviant-mostly-0-05-of-photons">
<h1><span class="small">Validation Issue 2 : History Aligned but Deviant : Mostly &lt; 0.05% of photons</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">Interference : Mis-aligned &lt;-&gt; deviant</span></p>
<ul class="small last simple">
<li>mis-aligned, but same history -&gt; large &quot;invalid&quot; deviations</li>
<li>TODO: improve alignment judgement<ul>
<li>eg: compare randoms collected at end of propagations <em>--utaildebug</em></li>
</ul>
</li>
</ul>
</div>
<p class="small"><strong>float vs double precision</strong></p>
<dl class="small docutils">
<dt>Likely cause of deviations</dt>
<dd><ul class="first last simple">
<li>small deviations grow from bounce to bounce</li>
<li>&quot;lever arm&quot; amplification of small errors depending on geometry</li>
<li><em>Opticks</em> uses <em>double</em> only when unavoidable
(eg scattering/absorption distance from <em>log(u)</em> [1])</li>
<li><em>Geant4</em> uses <em>double</em> everywhere</li>
<li><em>double</em> has high performance cost on GPU</li>
<li><em>OptiX</em> can only partially[2] operate in <em>double</em> precision</li>
</ul>
</dd>
<dt><strong>Plan</strong></dt>
<dd><ul class="first last simple">
<li>attempt to isolate sources, with double precision tests</li>
</ul>
</dd>
</dl>
<p class="tiny">[1] <a class="reference external" href="https://bitbucket.org/simoncblyth/opticks/src/tip/optixrap/cu/propagate.h">https://bitbucket.org/simoncblyth/opticks/src/tip/optixrap/cu/propagate.h</a></p>
<p class="tiny">[2] <a class="reference external" href="https://devtalk.nvidia.com/default/topic/1036155/optix/double-precision-of-ray-lengths/">https://devtalk.nvidia.com/default/topic/1036155/optix/double-precision-of-ray-lengths/</a></p>
</div>
<div class="slide" id="opticks-1-aims-to-revolutionize-juno-muon-simulation">
<h1><span class="small">Opticks[1] : Aims to Revolutionize JUNO Muon Simulation</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">100 GeV muon, millions of photons</span></p>
<img alt="/env/presentation/opticks_juno_pmt_muon_approach_portrait.png" class="last align-right" src="/env/presentation/opticks_juno_pmt_muon_approach_portrait.png" style="width: 450px;" />
</div>
<p class="small"><span class="blue">State-of-the-art GPU ray tracing[2] applied to optical simulation</span></p>
<ul class="small simple">
<li>replaces Geant4 optical simulation with GPU equivalent<ul>
<li>translate G4 geometry to GPU without approximation[3]</li>
<li>port G4 optical physics to CUDA[4]</li>
</ul>
</li>
</ul>
<p class="small"><strong>Optical photons generated+propagated entirely on GPU</strong></p>
<ul class="small simple">
<li>only photons hitting PMTs require CPU memory<ul>
<li>optical photon CPU memory --&gt; ~zero</li>
</ul>
</li>
<li>muon workload perfect for GPUs, <em>Opticks</em> &gt;&gt; 1000x <em>Geant4</em><ul>
<li>optical photon simulation time --&gt; ~zero</li>
</ul>
</li>
</ul>
<p class="small"><strong>Status : validation iterations ongoing</strong></p>
<ul class="small simple">
<li>direct comparison of random aligned bi-simulations</li>
<li>geometry changes made at GDML level</li>
</ul>
<p class="tiny">[1] Open source project <a class="reference external" href="http://bitbucket.org/simoncblyth/opticks">http://bitbucket.org/simoncblyth/opticks</a></p>
<p class="tiny">[2] NVIDIA OptiX ray tracing engine</p>
<p class="tiny">[3] using innovative Constructive Solid Geometry implementation on GPU</p>
<p class="tiny">[4] scattering, boundary, reemission, absorption</p>
</div>
<div class="slide" id="opticks-links">
<h1><span class="small">Opticks Links</span></h1>
<dl class="docutils">
<dt><a class="reference external" href="https://simoncblyth.bitbucket.io">https://simoncblyth.bitbucket.io</a></dt>
<dd>Opticks presentations and videos</dd>
<dt><a class="reference external" href="https://juno.ihep.ac.cn/cgi-bin/Dev_DocDB/ShowDocument?docid=3927">https://juno.ihep.ac.cn/cgi-bin/Dev_DocDB/ShowDocument?docid=3927</a></dt>
<dd>Opticks visualization screen capture movie of JUNO</dd>
<dt><a class="reference external" href="https://groups.io/g/opticks">https://groups.io/g/opticks</a></dt>
<dd>Opticks mailing list archive</dd>
<dt><a class="reference external" href="mailto:opticks+subscribe&#64;groups.io">opticks+subscribe&#64;groups.io</a></dt>
<dd>send email to this address, to subscribe</dd>
</dl>
<dl class="huge docutils">
<dt><a class="reference external" href="https://simoncblyth.bitbucket.io/opticks/index.html">https://simoncblyth.bitbucket.io/opticks/index.html</a></dt>
<dd>Opticks installation instructions</dd>
<dt><a class="reference external" href="https://bitbucket.org/simoncblyth/opticks">https://bitbucket.org/simoncblyth/opticks</a></dt>
<dd>Opticks code repository</dd>
</dl>

       <style type="text/css">

          div.slide { 
             background-clip: border-box;
             background-repeat: no-repeat;
             height: 100%;
          }
          div.slide#slide0{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-wide_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-benefits{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-wide_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#visualizing-an-optical-photon-simulation{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-wide_crop.png);
             background-size: 640px 360px;
             background-position: 600px 100px;
          }
          div.slide#overview{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-wide_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#g4daeview-py-fast-opengl-3d-viewer-for-g4dae-files{
             background-image: url(/env/geant4/geometry/collada/g4daeview/20140419-170713.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#cerenkov-photons-simulation-top-view{
             background-image: url(/env/geant4/geometry/collada/g4daeview/20141224-115923.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#cerenkov-photons-simulation-side-view{
             background-image: url(/env/geant4/geometry/collada/g4daeview/20141224-115935.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#scintillation-photons-simulation-top-view{
             background-image: url(/env/geant4/geometry/collada/g4daeview/20141224-121444.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#scintillation-photons-simulation-side-view{
             background-image: url(/env/geant4/geometry/collada/g4daeview/20141224-121435.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#standard-geant4-workflow{
             background-image: url(/env/keynotefigs/G4DAEChroma/G4DAEChroma.001.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#external-photon-simulation-workflow{
             background-image: url(/env/keynotefigs/G4DAEChroma/G4DAEChroma.002.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#geant4opticksworkflow{
             background-image: url(/env/Documents/Geant4OpticksWorkflow/Geant4OpticksWorkflow.001.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#ggeoview{
             background-image: url(/env/graphics/ggeoview/ggeoview-cerenkov-001.png);
             background-size: 1047px 795px;
             background-position: 0px 0px;
          }
          div.slide#ggeoview-m1-points{
             background-image: url(/env/graphics/ggeoview/ggeoview-scintillation-points-mat1.png);
             background-size: 1435px 848px;
             background-position: 0px 0px;
          }
          div.slide#ggeoview-flag-selection{
             background-image: url(/env/graphics/ggeoview/ggeoview-scintillation-flag-seq-select.png);
             background-size: 1436px 842px;
             background-position: 0px 0px;
          }
          div.slide#ggeoview-cerenkov-geom-m1{
             background-image: url(/env/graphics/ggeoview/ggeoview-cerenkov-m1-geom.png);
             background-size: 1416px 845px;
             background-position: 0px 0px;
          }
          div.slide#detecting-neutrinos-via-optical-photons-1{
             background-image: url(/env/presentation/dayabay-principal_half.png);
             background-size: 1417px 830px;
             background-position: 0px 0px;
          }
          div.slide#detecting-neutrinos-via-optical-photons-2{
             background-image: url(/env/presentation/dayabay-principal_half.png);
             background-size: 1417px 830px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-inside-wide{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-wide_half.png);
             background-size: 1432px 844px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-wide{
             background-image: url(/env/graphics/ggeoview/jpmt-wide_half.png);
             background-size: 1409px 836px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-headview{
             background-image: url(/env/graphics/ggeoview/jpmt-headview_half.png);
             background-size: 1308px 783px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-backview{
             background-image: url(/env/graphics/ggeoview/jpmt-backview_half.png);
             background-size: 1149px 794px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-approach{
             background-image: url(/env/graphics/ggeoview/jpmt-approach_half.png);
             background-size: 1431px 839px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-arrival{
             background-image: url(/env/graphics/ggeoview/jpmt-arrival_half.png);
             background-size: 1427px 841px;
             background-position: 0px 0px;
          }
          div.slide#optical-photon-simulation-problem{
             background-image: url(/env/graphics/ggeoview/jpmt-before-contact_half.png);
             background-size: 1430px 844px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-before-contact{
             background-image: url(/env/graphics/ggeoview/jpmt-before-contact_half.png);
             background-size: 1430px 844px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-before-contact-2{
             background-image: url(/env/graphics/ggeoview/jpmt-before-contact_half.png);
             background-size: 1430px 844px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-before-contact-3{
             background-image: url(/env/graphics/ggeoview/jpmt-before-contact_half.png);
             background-size: 1430px 844px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-after-contact{
             background-image: url(/env/graphics/ggeoview/jpmt-after-contact_half.png);
             background-size: 1425px 840px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-inside-outside{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-outside_half.png);
             background-size: 1401px 842px;
             background-position: 0px 0px;
          }
          div.slide#nvidia-optix-in-action{
             background-image: url(/env/presentation/optix-in-action_half.png);
             background-size: 966px 646px;
             background-position: 100px 50px;
          }
          div.slide#pmtinbox-approach-1{
             background-image: url(/env/graphics/ggeoview/PmtInBox-approach.png);
             background-size: 1069px 769px;
             background-position: 0px 0px;
          }
          div.slide#pmtinbox-approach-2{
             background-image: url(/env/graphics/ggeoview/PmtInBox-approach.png);
             background-size: 1069px 769px;
             background-position: 0px 0px;
          }
          div.slide#pmtinbox-after-1{
             background-image: url(/env/graphics/ggeoview/PmtInBox-after.png);
             background-size: 1057px 760px;
             background-position: 0px 0px;
          }
          div.slide#pmtinbox-after-2{
             background-image: url(/env/graphics/ggeoview/PmtInBox-after.png);
             background-size: 1057px 760px;
             background-position: 0px 0px;
          }
          div.slide#daya-bay-pmt-wall-photo-1{
             background-image: url(/env/presentation/gtc2016/dyb-pmt-wall-photo.png);
             background-size: 1329px 798px;
             background-position: 0px 0px;
          }
          div.slide#daya-bay-pmt-wall-photo-2{
             background-image: url(/env/presentation/gtc2016/dyb-pmt-wall-photo.png);
             background-size: 1329px 798px;
             background-position: 0px 0px;
          }
          div.slide#super-kamiokande-pmts-not-16-9{
             background-image: url(/env/presentation/gtc2016/sk-PH20-water-withboat-apr23-wm.png);
             background-size: 1181px 771px;
             background-position: 0px 0px;
          }
          div.slide#super-kamiokande-pmts-1{
             background-image: url(/env/presentation/PH20-water-withboat-apr23-wm_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#super-kamiokande-pmts-2{
             background-image: url(/env/presentation/PH20-water-withboat-apr23-wm_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#super-kamiokande-pmts-3{
             background-image: url(/env/presentation/PH20-water-withboat-apr23-wm_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#super-kamiokande-pmts-4{
             background-image: url(/env/presentation/PH20-water-withboat-apr23-wm_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#kamiokande-ii-1{
             background-image: url(/env/presentation/1987a.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#kamiokande-ii-2{
             background-image: url(/env/presentation/1987a.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#kamiokande-ii-3{
             background-image: url(/env/presentation/1987a.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#fast-optical-photon-simulation{
             background-image: url(/env/presentation/newtons-opticks.png);
             background-size: 374px 684px;
             background-position: 800px 0px;
          }
          div.slide#photomultiplier-tubes-pmts{
             background-image: url(/env/presentation/hamamatsu-pmt-16x9.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#photomultiplier-tube-operation{
             background-image: url(/env/presentation/hamamatsu-pmt-16x9.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#old-hamamatsu-photomultiplier-tubes-pmts{
             background-image: url(/env/presentation/hamamatsu-pmt.png);
             background-size: 1099px 734px;
             background-position: 0px 0px;
          }
          div.slide#old-photomultiplier-tube-operation{
             background-image: url(/env/presentation/hamamatsu-pmt.png);
             background-size: 1099px 734px;
             background-position: 0px 0px;
          }
          div.slide#jiangmen-underground-neutrino-observatory-juno{
             background-image: url(/env/presentation/juno-schematic-5.png);
             background-size: 1391px 734px;
             background-position: 0px 0px;
          }
          div.slide#jiangmen-underground-neutrino-observatory-goals{
             background-image: url(/env/presentation/juno-schematic-5.png);
             background-size: 1391px 734px;
             background-position: 0px 0px;
          }
          div.slide#dayabay-reactor-neutrino-expt-far-site{
             background-image: url(/env/presentation/DybFar_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#daya-bay-far-site-2{
             background-image: url(/env/presentation/DybFar_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#daya-bay-far-site-3{
             background-image: url(/env/presentation/DybFar_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#geant4-monte-carlo-simulation-toolkit{
             background-image: url(/env/presentation/g4-hep.png);
             background-size: 1025px 621px;
             background-position: 100px 100px;
          }
          div.slide#geant4-monte-carlo-simulation-toolkit-generality{
             background-image: url(/env/presentation/g4-hep.png);
             background-size: 1025px 621px;
             background-position: 100px 100px;
          }
          div.slide#seeing-neutrinos-via-scintillation-cherenkov-light{
             background-image: url(/env/presentation/cherenkov.png);
             background-size: 316px 203px;
             background-position: 850px 400px;
          }
          div.slide#opticks-auto-instancing{
             background-image: url(/env/graphics/ggeoview/ggv-juno-instancing.png);
             background-size: 852px 592px;
             background-position: 450px 80px;
          }
          div.slide#nvidia-optix-1{
             background-image: url(/env/presentation/NVIDIAOptiXWebsite_Oct2016.png);
             background-size: 1280px;
             background-position: 0px 0px;
          }
          div.slide#nvidia-optix-2{
             background-image: url(/env/presentation/NVIDIAOptiXWebsite_Oct2016.png);
             background-size: 1280px;
             background-position: 0px 0px;
          }
          div.slide#opticksdocs{
             background-image: url(/env/presentation/OpticksDocs.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#daya-bay-antineutrino-detection-via-inverse-beta-decay-1{
             background-image: url(/env/presentation/AntineutrinoDetectionViaIBDJetterSept2014.png);
             background-size: 809px 576px;
             background-position: 100px 100px;
          }
          div.slide#daya-bay-antineutrino-detection-via-inverse-beta-decay-2{
             background-image: url(/env/presentation/AntineutrinoDetectionViaIBDJetterSept2014.png);
             background-size: 809px 576px;
             background-position: 100px 100px;
          }
          div.slide#daya-bay-energy-response-model-1{
             background-image: url(/env/presentation/ZheTaupDetectorResponseModel.png);
             background-size: 968px 576px;
             background-position: 100px 100px;
          }
          div.slide#daya-bay-energy-response-model-2{
             background-image: url(/env/presentation/ZheTaupDetectorResponseModel.png);
             background-size: 968px 576px;
             background-position: 100px 100px;
          }
          div.slide#daya-bay-energy-response-model-fit-to-calibration-data-1{
             background-image: url(/env/presentation/EnergyResponseModel.png);
             background-size: 693px 504px;
             background-position: 0px 100px;
          }
          div.slide#daya-bay-energy-response-model-fit-to-calibration-data-2{
             background-image: url(/env/presentation/ConstrainingNonLinearity.png);
             background-size: 761px 553px;
             background-position: 0px 80px;
          }
          div.slide#daya-bay-ngd-analysis-most-precise-theta13{
             background-image: url(/env/presentation/DYBZheTaup2015Theta13OscillationAnalysis.png);
             background-size: 1057px 625px;
             background-position: 100px 60px;
          }
          div.slide#opticks-analytic-daya-bay-near-site-gpu-raytrace-3{
             background-image: url(/env/presentation/op_full_raytrace_3.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-analytic-daya-bay-near-site-gpu-raytrace-1{
             background-image: url(/env/presentation/op_full_raytrace_1.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-analytic-daya-bay-near-site-gpu-raytrace-0{
             background-image: url(/env/presentation/op_full_raytrace_0.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-analytic-daya-bay-near-site-gpu-raytrace-2{
             background-image: url(/env/presentation/op_full_raytrace_2.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-analytic-juno-chimney-gpu-raytrace-0{
             background-image: url(/env/presentation/j1707_chimney_analytic_raytrace.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-analytic-juno-pmt-snap-gpu-raytrace-1{
             background-image: url(/env/presentation/j1707-okop-snap.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#gpu-instance-culling-with-level-of-detail{
             background-image: url(/env/presentation/j1707_lod_oglrap_instcull.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-export-of-g4-geometry-to-gltf-2-0{
             background-image: url(/env/yoctoglrap/dyb_near_venice_half.png);
             background-size: 1020px 737px;
             background-position: 0px 0px;
          }
          div.slide#what-are-numpy-arrays{
             background-image: url(/env/presentation/what_are_numpy_arrays.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#what-are-numpy-arrays-2{
             background-image: url(/env/presentation/what_are_numpy_arrays.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#bvh{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_029.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#spatial-index-acceleration-structure{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_029.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#bvh-pascal{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_030.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#bvh-turing{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_031.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#hardware-traversal-of-bvh-spatial-index{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_031.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#nvidia-turing-gpu-72-sm-4608-cuda-cores{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_009.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#nvidia-turing-gpu-72-sm-4608-cuda-cores-spec{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_009.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#raytrace-vs-raster{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_132.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#ray-tracing-vs-rasterization{
             background-image: url(/env/presentation/nvidia/black.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#raytrace-diagram{
             background-image: url(/env/presentation/graphics/1024px-ray_trace_diagram.svg.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#j1808-top-ogl{
             background-image: url(/env/presentation/j1808/j1808_top_ogl.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#j1808-top-rtx{
             background-image: url(/env/presentation/j1808/j1808_top_rtx.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#j1808-escapes{
             background-image: url(/env/presentation/j1808/j1808_escapes.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#geocache-360{
             background-image: url(/env/presentation/geocache_360.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#juno-360-benchmark-with-optix-6-0-0-rtx-mode{
             background-image: url(/env/presentation/geocache_360.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#absmry-1m{
             background-image: url(/env/presentation/ana/absmry_1M.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#absmry-1m-2{
             background-image: url(/env/presentation/ana/absmry_1M.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#ta34-1m{
             background-image: url(/env/presentation/ana/ta34_1M.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#ta34-1m-2{
             background-image: url(/env/presentation/ana/ta34_1M.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#tv34-1m-a{
             background-image: url(/env/presentation/ana/tv34_1M_a.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#tv34-1m-b{
             background-image: url(/env/presentation/ana/tv34_1M_b.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#tv21-1m-a{
             background-image: url(/env/presentation/ana/tv21_1M_a.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#tv21-1m-a-2{
             background-image: url(/env/presentation/ana/tv21_1M_a.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#tv21-1m-c{
             background-image: url(/env/presentation/ana/tv21_1M_c.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#rtx-speedup{
             background-image: url(/env/presentation/ana/RTX_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#overheads{
             background-image: url(/env/presentation/ana/Overheads.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-speedup{
             background-image: url(/env/presentation/ana/Opticks_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-vs-geant4{
             background-image: url(/env/presentation/ana/Opticks_vs_Geant4.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-vs-geant4-2{
             background-image: url(/env/presentation/ana/Opticks_vs_Geant4.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#nhit{
             background-image: url(/env/presentation/ana/NHit.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#interval-over-launch{
             background-image: url(/env/presentation/ana/Interval_over_Launch.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#titan-rtx-72-raytrace-dedicated-rt-cores-4608-cuda-cores-24gb-vram-2500-usd{
             background-image: url(/env/presentation/nvidia/TITAN_RTX.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#bench-20190526-143808{
             background-image: url(/env/presentation/ana/bench_20190526_143808.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#bench-20190526-143808-2{
             background-image: url(/env/presentation/ana/bench_20190526_143808.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#bench-20190526-202537{
             background-image: url(/env/presentation/ana/bench_20190526_202537.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#bench-20190526-202537-2{
             background-image: url(/env/presentation/ana/bench_20190526_202537.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#tv16-fastener{
             background-image: url(/env/presentation/tv/tv16_Fastener.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#tv20-polycone-neck{
             background-image: url(/env/presentation/tv/tv20_polycone_neck.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#inch-pmt-neck-cylinder-torus-polycone{
             background-image: url(/env/presentation/tv/tv20_polycone_neck.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#genstep-interface{
             background-image: url(/env/presentation/simulation/genstep_interface.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#introducing-optix-7{
             background-image: url(/env/presentation/nvidia/Introducing_OptiX_7.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#turing-built-for-rtx{
             background-image: url(/env/presentation/nvidia/TURING_Built_for_RTX_half.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#turing-built-for-rtx-2{
             background-image: url(/env/presentation/nvidia/TURING_Built_for_RTX_half.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#nvidia-rtx-metro-exodus{
             background-image: url(/env/presentation/nvidia/NVIDIA_RTX_Metro_Exodus_half.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#modern-gpu-ray-tracing{
             background-image: url(/env/presentation/nvidia/Modern_GPU_RAY_Tracing.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#nvidia-optix-programming-model-analogous-to-rasterization-apis-opengl-shaders{
             background-image: url(/env/presentation/nvidia/Modern_GPU_RAY_Tracing.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#nvidia-quadro-rtx-8000-48g{
             background-image: url(/env/presentation/nvidia/NVIDIA_Quadro_RTX.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#siggraph-2010-optix-a-general-purpose-ray-tracing-engine{
             background-image: url(/env/presentation/nvidia/SIGGRAPH_2010_OptiX_A_General_Purpose_Ray_Tracing_Engine.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#juno-basics-pedro-nufact-2019{
             background-image: url(/env/presentation/juno/JUNO_Basics_Pedro_NuFact_2019.png);
             background-size: 960px 720px;
             background-position: 0px 0px;
          }
          div.slide#juno-multipurpose-pedro-nufact-2019{
             background-image: url(/env/presentation/juno/JUNO_Multipurpose_Pedro_NuFact_2019.png);
             background-size: 960px 720px;
             background-position: 0px 0px;
          }
          div.slide#dhart-siggraph-2019-optix-5-traversal{
             background-image: url(/env/presentation/nvidia/dhart_siggraph_2019_OptiX_5_traversal.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#dhart-siggraph-2019-optix-5-traversal{
             background-image: url(/env/presentation/nvidia/dhart_siggraph_2019_OptiX_5_traversal.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#scan-pf-0-interval-over-launch{
             background-image: url(/env/presentation/ana/scan-pf-0/Interval_over_Launch.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#scan-pf-0-nhit{
             background-image: url(/env/presentation/ana/scan-pf-0/NHit.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#scan-pf-0-opticks-speedup{
             background-image: url(/env/presentation/ana/scan-pf-0/Opticks_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#scan-pf-0-opticks-vs-geant4{
             background-image: url(/env/presentation/ana/scan-pf-0/Opticks_vs_Geant4.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#scan-pf-0-overheads{
             background-image: url(/env/presentation/ana/scan-pf-0/Overheads.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#scan-pf-0-rtx-speedup{
             background-image: url(/env/presentation/ana/scan-pf-0/RTX_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#scan-pf-0-rtx-speedup-2{
             background-image: url(/env/presentation/ana/scan-pf-0/RTX_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#scan-pf-1-interval-over-launch{
             background-image: url(/env/presentation/ana/scan-pf-1/Interval_over_Launch.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#scan-pf-1-nhit{
             background-image: url(/env/presentation/ana/scan-pf-1/NHit.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#scan-pf-1-opticks-speedup{
             background-image: url(/env/presentation/ana/scan-pf-1/Opticks_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#scan-pf-1-opticks-speedup-2{
             background-image: url(/env/presentation/ana/scan-pf-1/Opticks_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#scan-pf-1-opticks-vs-geant4{
             background-image: url(/env/presentation/ana/scan-pf-1/Opticks_vs_Geant4.png);
             background-size: 1280px 720pxS;
             background-position: 0px 0px;
          }
          div.slide#scan-pf-1-opticks-vs-geant4-2{
             background-image: url(/env/presentation/ana/scan-pf-1/Opticks_vs_Geant4.png);
             background-size: 1280px 720pxS;
             background-position: 0px 0px;
          }
          div.slide#scan-pf-1-overheads{
             background-image: url(/env/presentation/ana/scan-pf-1/Overheads.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#scan-pf-1-rtx-speedup{
             background-image: url(/env/presentation/ana/scan-pf-1/RTX_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          } 

       </style>
    <!-- comment

:i:`scan-pf-1_Interval_over_Launch`
:i:`scan-pf-1_NHit`
:i:`scan-pf-1_Opticks_Speedup`
:i:`scan-pf-1_Opticks_vs_Geant4`
:i:`scan-pf-1_Overheads`
:i:`scan-pf-1_RTX_Speedup` -->
<!-- comment

:i:`scan-pf-0_Interval_over_Launch`
:i:`scan-pf-0_NHit`
:i:`scan-pf-0_Opticks_Speedup`
:i:`scan-pf-0_Opticks_vs_Geant4`
:i:`scan-pf-0_Overheads`
:i:`scan-pf-0_RTX_Speedup` -->
<!-- comment

CHEP

on-demand.gputechconf.com/gtc-eu/2018/pdf/e8527-real-time-ray-tracing-with-nvidia-rtx.pdf

https://www.youtube.com/watch?v=Mrixi27G9yM
   RTX launch event : Gamescon (Germany) Aug 21, 2018

   13:30

https://nvidianews.nvidia.com/multimedia -->
<!-- comment

DANCE : 15+5
CHEP  : 25+5 -->
<!-- comment

points to stress

* high level : what is opticks
* Geant4 interface and gensteps -> GPU resident photons -> memory advantage (thrust stream compaction)

Pedro NUFACT

* https://juno.ihep.ac.cn/cgi-bin/Dev_DocDB/ShowDocument?docid=5079 -->
<!-- comment


NVIDIA
                    Memory    Bandwidth     CUDA(RT) Cores
TITAN V             12 GB       651 GB/s    5120(0)
Tesla V100          32 GB       900 GB/s    5120(0)
TITAN RTX           24 GB       672 GB/s    4608(72)
Quadro RTX 8000     48 GB       672 GB/s    4608(72)

SM*64 gives cores

https://www.techpowerup.com/gpu-specs/titan-v.c3051
https://www.techpowerup.com/gpu-specs/titan-rtx.c3311
https://www.techpowerup.com/gpu-specs/quadro-rtx-8000.c3306 -->
<!-- comment

Check
- - - - - -

+- - - - - - - - - - - -+- - - - - - - - - - - -+- - - - - - - - - - -+
| Header 1   | Header 2   | Header 3  |
+============+============+===========+
| body row 1 | column 2   | column 3  |
+- - - - - - - - - - - -+- - - - - - - - - - - -+- - - - - - - - - - -+
| body row 2 | Cells may span columns.|
+- - - - - - - - - - - -+- - - - - - - - - - - -+- - - - - - - - - - -+
| body row 3 | Cells may  | - Cells   |
+- - - - - - - - - - - -+ span rows. | - contain |
| body row 4 |            | - blocks. |
+- - - - - - - - - - - -+- - - - - - - - - - - -+- - - - - - - - - - -+


.. class:: center

    +- - - - - - - - - - - -+- - - - - - - - - - - -+- - - - - - - - - - -+
    | Header 1     Header 2     Header 3  |
    +============+============+===========+
    | body row 1 | column 2   | column 3  |
    +- - - - - - - - - - - -+- - - - - - - - - - - -+- - - - - - - - - - -+
    | body row 2 | Cells may span columns.|
    +- - - - - - - - - - - -+- - - - - - - - - - - -+- - - - - - - - - - -+
    | body row 3 | Cells may  | - Cells   |
    +- - - - - - - - - - - -+ span rows. | - contain |
    | body row 4 |            | - blocks. |
    +- - - - - - - - - - - -+- - - - - - - - - - - -+- - - - - - - - - - -+ -->
</div>
</div>
</body>
</html>
