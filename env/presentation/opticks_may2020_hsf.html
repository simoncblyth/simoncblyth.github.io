<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<meta name="version" content="S5 1.1" />
<title>Opticks Experience of GPU Optical Photon Simulation with NVIDIA OptiX</title>
<meta content="Opticks GPU Optical Simulation with NVIDIA OptiX - Development Experience : Problems and Successes" name="title" />
<meta content="HSF" name="description" />
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<script src="ui/my-small-white/slides.js" type="text/javascript"></script>
<link rel="stylesheet" href="ui/my-small-white/slides.css"
      type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/my-small-white/outline.css"
      type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/my-small-white/print.css"
      type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/my-small-white/opera.css"
      type="text/css" media="projection" id="operaFix" />
</head>
<body>
<div class="layout">
<div id="controls"></div>
<div id="currentSlide"></div>
<div id="header">

</div>
<div id="footer">
<h1><span class="i">Opticks Experience of GPU Optical Photon Simulation with NVIDIA OptiX</span></h1>

</div>
</div>
<div class="presentation">
<div class="slide" id="slide0">
<h1 class="title"><span class="i">Opticks Experience of GPU Optical Photon Simulation with NVIDIA OptiX</span></h1>

<!-- comment

Navigate the HTML slides by entering a page number and pressing return -->
<!-- Definitions of interpreted text roles (classes) for S5/HTML data. -->
<!-- This data file has been placed in the public domain. -->
<!-- Colours
======= -->
<!-- Text Sizes
========== -->
<!-- Display in Slides (Presentation Mode) Only
========================================== -->
<!-- Display in Outline Mode Only
============================ -->
<!-- Display in Print Only
===================== -->
<!-- Display in Handout Mode Only
============================ -->
<!-- Incremental Display
=================== -->
<style type="text/css">

    .strike { text-decoration: line-through; }
    .center {text-align: center;}

    span.alarm { color: red; }
    span.warn { color: orange; }
    span.ok { color: green; }
    span.i { display: none; }
    pre.sliteral { class:"literal-block small"; }
    pre.mypre {
         display: block;
         font-family: monospace;
         font-size: 20px;
         white-space: pre;
         margin: 1em 0;
    }

    pre.mypretiny {
         display: block;
         font-family: monospace;
         font-size: 15px;
         white-space: pre;
         margin: 1em 0;
    }

    pre.myfoot {
         display: block;
         font-family: monospace;
         font-size: 18px;
         white-space: pre;
         color: white;
         position: absolute; top:86%; left:4%; width:50%; height:10% ;
    }

    a.mylink {
         display: block;
         font-family: monospace;
         font-size: 18px;
         white-space: pre;
         color: black;
         position: absolute; top:86%; left:4%; width:50%; height:10% ;
    }


    div.mytitle {
         font-size: 20px;
         color: black;
         position: absolute; top:0%; left:5%; width:90%; height:10% ;
    }

    div.mytitle2 {
         font-size: 20px;
         color: black;
         position: absolute; top:5%; left:5%; width:90%; height:10% ;
    }



    div.mycredit {
         font-size: 20px;
         color: black;
         position: absolute; top:90%; left:5%; width:80%; height:10% ;
    }

    div.mysidebar {
        margin: 0 0 0.5em 1em;
        border: medium outset;
        padding: 1em;
        background-color: #ffffee;
        width: 20%;
        float: right;
        clear: right;
    }

    table.mytable th {
         background-color: #ede;
    }
    table.mytable tr:nth-child(even) {
        background-color: #F3F3FF;
    }
    table.mytable tr:nth-child(odd) {
        background-color: #FFFFEE;
    }


</style><div class="mytitle">
<header>
<h1 style="background-color:lightgrey">
      <i>Opticks</i> GPU Optical Simulation with NVIDIA® OptiX™ - Development Experience : Problems and Successes
    <h2 style="background-color:lightgrey;text-align:center"> Open source, https://bitbucket.org/simoncblyth/opticks </h2>
</h1>
</header>
</div>

<div class="mycredit">
<h2 style="background-color:lightgrey"> Simon C Blyth, IHEP, CAS &mdash; HSF Simulation Working Group Meeting, 27 May 2020</h2>
</div>
        <!--  s5talk  -->
        <br/>
    <!-- comment

.. raw:: html

   <span>&nbsp;</span> -->

</div>
<div class="slide" id="outline">
<h1>Outline</h1>
<img alt="/env/presentation/newtons-opticks.png" class="align-right" src="/env/presentation/newtons-opticks.png" style="width: 299px; height: 547px;" />
<ul class="small simple">
<li>JUNO Optical Photon Simulation Problem...</li>
<li>GPU architecture and Ray tracing<ul>
<li>CPU vs GPU architectures, Latency vs Throughput</li>
<li>Understanding GPU Graphical Origins -&gt; Effective GPU Computation</li>
<li>Optical Photon Simulation ≈ Ray Traced Image Rendering</li>
<li>Rasterization and Ray tracing</li>
<li>Turing Built for RTX, BVH : Bounding Volume Hierarchy</li>
<li>NVIDIA OptiX Ray Tracing Engine</li>
</ul>
</li>
<li>Opticks : Translate Geant4 Context to GPU<ul>
<li>Geant4 + Opticks Hybrid Workflow : External Optical Photon Simulation</li>
<li>Opticks : Translates G4 Optical Physics to CUDA/OptiX</li>
<li>G4Solid -&gt; CUDA Intersect Functions for ~10 Primitives</li>
<li>G4Boolean -&gt; CUDA/OptiX Intersection Program Implementing CSG</li>
<li>Opticks : Translates G4 Geometry to GPU, Without Approximation</li>
</ul>
</li>
<li>Validation and Performance<ul>
<li>Validation of Opticks Simulation by Comparison with Geant4</li>
<li>Perfomance Scanning from 1M to 400M Photons</li>
</ul>
</li>
<li>Opticks Experience : Problems and Successes<ul>
<li>Main Operational Problem : Manpower</li>
<li>Main Technical Problem : Geometry Translation</li>
<li>Further Problems with using NVIDIA OptiX</li>
<li>Benefits from using NVIDIA OptiX</li>
</ul>
</li>
<li>Overview + Links</li>
</ul>
<div class="small"><hr/></div>
        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="juno-optical-photon-simulation-problem">
<h1><span class="incremental">JUNO Optical Photon Simulation Problem...</span></h1>
<pre>







</pre><div class="sidebar">
<p class="first sidebar-title"><span class="small">Huge CPU Memory+Time Expense</span></p>
<dl class="small last docutils">
<dt><strong>JUNO Muon Simulation Bottleneck</strong></dt>
<dd>~99% CPU time, memory constraints</dd>
<dt><strong>Ray-Geometry intersection Dominates</strong></dt>
<dd>simulation is not alone in this problem...</dd>
<dt><strong>Optical photons : naturally parallel, simple :</strong></dt>
<dd><ul class="first last simple">
<li>produced by Cherenkov+Scintillation</li>
<li>yield only Photomultiplier hits</li>
</ul>
</dd>
</dl>
</div>

        <!--  s5talk  -->
        <br/>
    <!-- comment

OpenGL/CUDA interoperation, using VBOs -->
</div>
<div class="slide" id="cpu-vs-gpu-architectures-latency-vs-throughput">
<h1><span class="small">CPU vs GPU architectures, Latency vs Throughput</span></h1>
<img alt="/env/presentation/nvidia/cpu_vs_gpu_architecture.png" class="small align-center" src="/env/presentation/nvidia/cpu_vs_gpu_architecture.png" style="width: 800px;" />
<p class="small">Waiting for memory read/write, is major source of latency...</p>
<dl class="small docutils">
<dt><strong>CPU : latency-oriented : Minimize time to complete single task</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><span class="red">avoid latency with caching</span></span></dt>
<dd><ul class="first last simple">
<li>complex : caching system, branch prediction, speculative execution, ...</li>
</ul>
</dd>
<dt><strong>GPU : throughput-oriented : Maximize total work per unit time</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><span class="red">hide latency with parallelism</span></span></dt>
<dd><ul class="first last simple">
<li>many simple processing cores, hardware multithreading, SIMD (single instruction multiple data)</li>
<li>simpler : <span class="green">lots of compute (ALU)</span>, at expense of cache+control</li>
<li>design assumes <span class="red">abundant parallelism</span></li>
</ul>
</dd>
</dl>
<p class="small">Effective use of <strong>Totally different processor architecture</strong> -&gt; <span class="red">Total reorganization of data and computation</span></p>
<p class="tiny">Understanding Throughput-oriented Architectures
<a class="reference external" href="https://cacm.acm.org/magazines/2010/11/100622-understanding-throughput-oriented-architectures/fulltext">https://cacm.acm.org/magazines/2010/11/100622-understanding-throughput-oriented-architectures/fulltext</a></p>

        <!--  s5talk  -->
        <br/>
    <!-- comment

Latency hiding works using hardware multi-threading, so when one group of threads is blocked
waiting to read from global memory for example : other groups of thread and be resumed. This
is only effective at hiding latency when there are enough other threads in flight at the same time.

Porting CPU code to run on the GPU : is not a straightforward thing to do, because the archirecture is totally
different.  To make effective use of GPUs requires a total reorganization of data and compute. -->
</div>
<div class="slide" id="understanding-gpu-graphical-origins-effective-gpu-computation">
<h1><span class="small">Understanding GPU Graphical Origins -&gt; Effective GPU Computation</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">OpenGL Rasterization Pipeline</span></p>
<img alt="/env/presentation/opengl/rasterization_pipeline_rhs.png" class="last align-right" src="/env/presentation/opengl/rasterization_pipeline_rhs.png" style="width: 450px;" />
</div>
<p class="small"><strong>GPUs evolved to rasterize 3D graphics at 30/60 fps</strong></p>
<ul class="small simple">
<li>30/60 &quot;launches&quot; per second, each handling millions of items</li>
<li><span class="red">literally billions of small &quot;shader&quot; programs run per second</span></li>
</ul>
<p class="small"><strong>Simple Array Data Structures (N-million,4)</strong></p>
<ul class="small simple">
<li>millions of vertices, millions of triangles</li>
<li>vertex: <strong>(x y z w)</strong></li>
<li>colors: <strong>(r g b a)</strong></li>
</ul>
<p class="small"><strong>Constant &quot;Uniform&quot; 4x4 matrices : scaling+rotation+translation</strong></p>
<ul class="small simple">
<li>4-component homogeneous coordinates -&gt; easy projection</li>
</ul>
<p class="small"><strong>Graphical Experience Informs Fast Computation on GPUs</strong></p>
<ul class="small simple">
<li>array shapes similar to graphics ones are faster<ul>
<li>&quot;float4&quot; 4*float(32bit) = 128 bit memory reads are favored</li>
<li>Opticks photons use &quot;float4x4&quot; just like 4x4 matrices</li>
</ul>
</li>
<li>GPU Launch frequency &lt; ~30/60 per second<ul>
<li>avoid copy+launch overheads becoming significant</li>
<li>ideally : handle millions of items in each launch</li>
</ul>
</li>
</ul>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="optical-photon-simulation-ray-traced-image-rendering">
<h1><span class="small">Optical Photon Simulation ≈ Ray Traced Image Rendering</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Not a Photo, a Calculation</p>
<img alt="/env/optix/samples/optix-ray-tracing-glasses.png" class="align-right" src="/env/optix/samples/optix-ray-tracing-glasses.png" style="width: 450px;" />
<p class="tiny last"><a class="reference external" href="http://on-demand.gputechconf.com/siggraph/2013/presentation/SG3106-Building-Ray-Tracing-Applications-OptiX.pdf">http://on-demand.gputechconf.com/siggraph/2013/presentation/SG3106-Building-Ray-Tracing-Applications-OptiX.pdf</a></p>
</div>
<p class="small"><strong>Much in common : geometry, light sources, optical physics</strong></p>
<ul class="small simple">
<li><span class="blue">simulation</span> : photon parameters at PMT detectors</li>
<li><span class="blue">rendering</span> : pixel values at image plane</li>
<li><span class="red">both limited by ray geometry intersection, aka ray tracing</span></li>
</ul>
<pre>

</pre><p class="small"><strong>Many Applications of ray tracing</strong> :</p>
<ul class="small simple">
<li>advertising, design, architecture, films, games,...</li>
<li>-&gt; huge efforts to improve hw+sw over 30 yrs</li>
</ul>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="ray-tracing-vs-rasterization">
<h1><span class="i">Ray-tracing vs Rasterization</span></h1>
<img alt="/env/presentation/nvidia/nv_rasterization.png" class="align-left" src="/env/presentation/nvidia/nv_rasterization.png" style="width: 550px;" />
<img alt="/env/presentation/nvidia/nv_raytrace.png" class="align-right" src="/env/presentation/nvidia/nv_raytrace.png" style="width: 550px;" />

        <!--  s5talk  -->
        <br/>
    <!-- comment

https://www.youtube.com/watch?v=Mrixi27G9yM
RTX Launch -->
</div>
<div class="slide" id="turing-built-for-rtx-2">
<h1><span class="i">TURING BUILT FOR RTX 2</span></h1>
<pre>






</pre><div class="sidebar">
<p class="first sidebar-title"><span class="small">Offload Ray Trace to Dedicated HW</span></p>
<ul class="small simple">
<li>RT core : BVH traversal + ray tri. intersection</li>
<li>frees up general purpose SM</li>
</ul>
<p class="tiny">SM : Streaming Multiprocessor</p>
<p class="tiny last">BVH : Bounding Volume Hierarchy</p>
</div>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="spatial-index-acceleration-structure">
<h1><tt class="docutils literal">Spatial Index Acceleration Structure</tt></h1>
<pre>











</pre><div class="sidebar">
<p class="first sidebar-title"><span class="small">Tree of Bounding Boxes (bbox)</span></p>
<ul class="small last simple">
<li>aims to minimize bbox+primitive intersects</li>
<li>accelerates ray-geometry intersection</li>
</ul>
</div>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="nvidia-optix-ray-tracing-engine-http-developer-nvidia-com-optix">
<h1><span class="small">NVIDIA® OptiX™ Ray Tracing Engine -- http://developer.nvidia.com/optix</span></h1>
<div class="sidebar">
<p class="first sidebar-title">OptiX Raytracing Pipeline</p>
<p class="small">Analogous to OpenGL rasterization pipeline:</p>
<img alt="/env/optix/docs/optix-model.png" class="last align-right" src="/env/optix/docs/optix-model.png" style="width: 450px;" />
</div>
<p class="small"><strong>OptiX makes GPU ray tracing accessible</strong></p>
<ul class="small simple">
<li><strong>accelerates</strong> ray-geometry intersections</li>
<li>simple : single-ray programming model</li>
<li>&quot;...free to use within any application...&quot;</li>
<li><span class="red">access RT Cores[1] with OptiX 6.0.0+ via RTX™ mode</span></li>
</ul>
<p class="small"><strong>NVIDIA expertise:</strong></p>
<ul class="small simple">
<li>compiler optimized for GPU ray tracing</li>
<li><span class="red">~linear scaling up to 4 GPUs</span></li>
<li>acceleration structure creation + traversal (Blue)</li>
<li>instanced sharing of geometry + acceleration structures</li>
</ul>
<p class="small"><strong>Opticks provides (Yellow):</strong></p>
<ul class="small simple">
<li>ray generation program</li>
<li><span class="red">ray geometry intersection+bbox programs</span></li>
</ul>
<p class="tiny">[1] Turing RTX GPUs</p>

        <!--  s5talk  -->
        <br/>
    <!-- skip

 * no need for fancy shading, so closest hit is simple, just collecting the normal
   and ray trace distance

* creating renderers is the most common use of OptiX, but it is a general
   intersection API so works fine to do simulation -->
</div>
<div class="slide" id="geant4opticksworkflow">
<h1><span class="i">Geant4OpticksWorkflow</span></h1>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="opticks-translates-g4-optical-physics-to-cuda-optix">
<h1><span class="small">Opticks : Translates G4 Optical Physics to CUDA/OptiX</span></h1>
<div class="sidebar">
<p class="first sidebar-title">GPU Resident Photons</p>
<dl class="small docutils">
<dt><strong>Seeded on GPU</strong></dt>
<dd>associate photons -&gt; <em>gensteps</em> (via seed buffer)</dd>
<dt><strong>Generated on GPU, using genstep param:</strong></dt>
<dd><ul class="first last simple">
<li>number of photons to generate</li>
<li>start/end position of step</li>
</ul>
</dd>
<dt><strong>Propagated on GPU</strong></dt>
<dd><span class="red">Only photons hitting PMTs copied to CPU</span></dd>
</dl>
<p class="small">Thrust: <strong>high level C++ access to CUDA</strong></p>
<div class="small figure align-right">
<img alt="/env/numerics/thrust/thrust.png" src="/env/numerics/thrust/thrust.png" style="width: 300px;" />
</div>
<ul class="small last simple">
<li><a class="reference external" href="https://developer.nvidia.com/Thrust">https://developer.nvidia.com/Thrust</a></li>
</ul>
</div>
<p class="small"><span class="blue">OptiX : single-ray programming model</span> -&gt; line-by-line translation</p>
<dl class="small docutils">
<dt><strong>CUDA Ports of Geant4 classes</strong></dt>
<dd><ul class="first last simple">
<li>G4Cerenkov (only generation loop)</li>
<li>G4Scintillation (only generation loop)</li>
<li>G4OpAbsorption</li>
<li>G4OpRayleigh</li>
<li>G4OpBoundaryProcess (only a few surface types)</li>
</ul>
</dd>
<dt><strong>Modify Cherenkov + Scintillation Processes</strong></dt>
<dd><ul class="first last simple">
<li>collect <em>genstep</em>, copy to GPU for generation</li>
<li><span class="red">avoids copying millions of photons to GPU</span></li>
</ul>
</dd>
<dt><strong>Scintillator Reemission</strong></dt>
<dd><ul class="first last simple">
<li>fraction of bulk absorbed &quot;reborn&quot; within same thread</li>
<li>wavelength generated by reemission texture lookup</li>
</ul>
</dd>
<dt><strong>Opticks (OptiX/Thrust GPU interoperation)</strong></dt>
<dd><ul class="first last simple">
<li><strong>OptiX</strong> : upload gensteps</li>
<li><strong>Thrust</strong> : seeding, distribute genstep indices to photons</li>
<li><strong>OptiX</strong> : launch photon generation and propagation</li>
<li><strong>Thrust</strong> : pullback photons that hit PMTs</li>
<li><strong>Thrust</strong> : index photon step sequences (optional)</li>
</ul>
</dd>
</dl>

        <!--  s5talk  -->
        <br/>
    <!-- skip

Some further detail is on the reemissio and also
use of CUDA Thrust : which provides a higher level way
of using CUDA -->
</div>
<div class="slide" id="g4solid-cuda-intersect-functions-for-10-primitives">
<h1><span class="small">G4Solid -&gt; CUDA Intersect Functions for ~10 Primitives</span></h1>
<ul class="small simple">
<li>3D parametric ray : <strong>ray(x,y,z;t) = rayOrigin  +  t * rayDirection</strong></li>
<li>implicit equation of primitive : <strong>f(x,y,z) = 0</strong></li>
<li>-&gt; polynomial in <strong>t</strong> , roots: <strong>t &gt; t_min</strong>  -&gt; intersection positions + surface normals</li>
</ul>
<div class="figure align-center">
<img alt="/env/presentation/tboolean_parade_sep2017.png" src="/env/presentation/tboolean_parade_sep2017.png" style="width: 900px;" />
<p class="caption">Sphere, Cylinder, Disc, Cone, Convex Polyhedron, Hyperboloid, <span class="red">Torus</span>, ...</p>
</div>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="g4boolean-cuda-optix-intersection-program-implementing-csg">
<h1><span class="small">G4Boolean -&gt; CUDA/OptiX Intersection Program Implementing CSG</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Outside/Inside Unions</p>
<p class="small">dot(normal,rayDir) -&gt; Enter/Exit</p>
<img alt="/env/presentation/kensler_union_of_two_spheres_from_outside.png" class="align-center" src="/env/presentation/kensler_union_of_two_spheres_from_outside.png" style="width: 300px;" />
<img alt="/env/presentation/kensler_union_of_two_spheres_from_inside.png" class="align-center" src="/env/presentation/kensler_union_of_two_spheres_from_inside.png" style="width: 300px;" />
<ul class="small last simple">
<li><strong>A + B</strong> boundary not inside other</li>
<li><strong>A * B</strong> boundary inside other</li>
</ul>
</div>
<p class="small">Complete Binary Tree, pick between pairs of nearest intersects:</p>
<table border="1" class="small docutils">
<colgroup>
<col width="37%" />
<col width="17%" />
<col width="24%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><em>UNION</em> tA &lt; tB</th>
<th class="head">Enter B</th>
<th class="head">Exit B</th>
<th class="head">Miss B</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><strong>Enter A</strong></td>
<td>ReturnA</td>
<td><span class="blue">LoopA</span></td>
<td>ReturnA</td>
</tr>
<tr><td><strong>Exit A</strong></td>
<td>ReturnA</td>
<td>ReturnB</td>
<td>ReturnA</td>
</tr>
<tr><td><strong>Miss A</strong></td>
<td>ReturnB</td>
<td>ReturnB</td>
<td>ReturnMiss</td>
</tr>
</tbody>
</table>
<ul class="small simple">
<li><em>Nearest hit intersect algorithm</em> [1] avoids state<ul>
<li>sometimes <span class="blue">Loop</span> : advance <strong>t_min</strong> , re-intersect both</li>
<li>classification shows if inside/outside</li>
</ul>
</li>
<li><em>Evaluative</em> [2] implementation emulates recursion:<ul>
<li><span class="red">recursion not allowed</span> in OptiX intersect programs</li>
<li>bit twiddle traversal of complete binary tree</li>
<li>stacks of postorder slices and intersects</li>
</ul>
</li>
<li><span class="red">Identical geometry to Geant4</span><ul>
<li>solving the same polynomials</li>
<li>near perfect intersection match</li>
</ul>
</li>
</ul>
<dl class="tiny docutils">
<dt>[1] Ray Tracing CSG Objects Using Single Hit Intersections, Andrew Kensler (2006)</dt>
<dd>with corrections by author of XRT Raytracer <a class="reference external" href="http://xrt.wikidot.com/doc:csg">http://xrt.wikidot.com/doc:csg</a></dd>
<dt>[2] <a class="reference external" href="https://bitbucket.org/simoncblyth/opticks/src/master/optixrap/cu/csg_intersect_boolean.h">https://bitbucket.org/simoncblyth/opticks/src/master/optixrap/cu/csg_intersect_boolean.h</a></dt>
<dd>Similar to binary expression tree evaluation using postorder traverse.</dd>
</dl>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="csg-complete-binary-tree-serialization-simplifies-gpu-side">
<h1><span class="small">CSG Complete Binary Tree Serialization -&gt; simplifies GPU side</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Bit Twiddling Navigation</p>
<ul class="small last simple">
<li>parent(i) = i/2 = i &gt;&gt; 1</li>
<li>leftchild(i) = 2*i = i &lt;&lt; 1</li>
<li>rightchild(i) = 2*i + 1 = (i &lt;&lt; 1) + 1</li>
<li>leftmost(height)  =  1 &lt;&lt; height</li>
</ul>
</div>
<p class="small">Geant4 solid -&gt; CSG binary tree (leaf primitives, non-leaf operators, 4x4 transforms on any node)</p>
<p class="small">Serialize to <strong>complete binary tree</strong> buffer:</p>
<ul class="small simple">
<li>no need to deserialize, no child/parent pointers</li>
<li>bit twiddling navigation <span class="red">avoids recursion</span></li>
<li>simple approach profits from small size of binary trees</li>
<li>BUT: very inefficient when unbalanced</li>
</ul>
<p class="small"><strong>Height 3 complete binary tree with level order indices:</strong></p>
<pre class="mypre">
                                                   depth     elevation

                     1                               0           3

          10                   11                    1           2

     100       101        110        111             2           1

 1000 1001  1010 1011  1100 1101  1110  1111         3           0
</pre>
<hr/><p class="small"><strong>postorder_next(i,elevation) = i &amp; 1 ? i &gt;&gt; 1 : (i &lt;&lt; elevation) + (1 &lt;&lt; elevation) ;</strong>   // from pattern of bits</p>
<p class="tiny">Postorder tree traverse visits all nodes, starting from leftmost, such that children
are visited prior to their parents.</p>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="opticks-translates-g4-geometry-to-gpu-without-approximation">
<h1><span class="small">Opticks : Translates G4 Geometry to GPU, Without Approximation</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">Materials/Surfaces -&gt; GPU Texture</span></p>
<p class="small"><strong>Material/Surface/Scintillator properties</strong></p>
<ul class="small simple">
<li>interpolated to standard wavelength domain</li>
<li>interleaved into &quot;boundary&quot; texture</li>
<li>&quot;reemission&quot; texture for wavelength generation</li>
</ul>
<p class="small"><strong>Material/surface boundary : 4 indices</strong></p>
<ul class="small simple">
<li>outer material (parent)</li>
<li>outer surface (inward photons, parent -&gt; self)</li>
<li>inner surface (outward photons, self -&gt; parent)</li>
<li>inner material (self)</li>
</ul>
<p class="small">Primitives labelled with unique boundary index</p>
<ul class="small simple">
<li>ray primitive intersection -&gt; boundary index</li>
<li>texture lookup -&gt; material/surface properties</li>
</ul>
<p class="small last"><span class="red">simple/fast properties + reemission wavelength</span></p>
</div>
<p class="small"><strong>G4 Structure Tree -&gt; Instance+Global Arrays -&gt; OptiX</strong></p>
<p class="small">Group structure into repeated instances + global remainder:</p>
<ul class="small simple">
<li>auto-identify repeated geometry with &quot;progeny digests&quot;<ul>
<li>JUNO : 5 distinct instances + 1 global</li>
</ul>
</li>
<li>instance transforms used in OptiX/OpenGL geometry</li>
</ul>
<p class="small"><span class="red">instancing -&gt; huge memory savings for JUNO PMTs</span></p>
<pre>
</pre><!-- comment

**Automated : Geant4 "World" -> Opticks CSG -> CUDA/OptiX**

**Solids : analytic CSG + triangulated**

* intersection functions for ~10 primitives
* intersection program for arbitrarily complex CSG shapes

  * :red:`automated : G4 -> Opticks -> OptiX` -->

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="j1808-top-rtx">
<h1><span class="i">j1808_top_rtx</span></h1>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="j1808-top-ogl">
<h1><span class="i">j1808_top_ogl</span></h1>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="validation-of-opticks-simulation-by-comparison-with-geant4">
<h1><span class="small">Validation of Opticks Simulation by Comparison with Geant4</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">Random Aligned Bi-Simulation</span></p>
<p class="small">Same inputs to <em>Opticks</em> and <em>Geant4</em>:</p>
<ul class="small simple">
<li>CPU generated photons</li>
<li>GPU generated randoms, fed to <em>Geant4</em></li>
</ul>
<p class="small">Common recording into <em>OpticksEvents</em>:</p>
<ul class="small simple">
<li>compressed photon step record, up to 16 steps</li>
<li>persisted as <em>NumPy</em> arrays for python analysis</li>
</ul>
<p class="small">Aligned random consumption, direct comparison:</p>
<ul class="small last simple">
<li>~every <strong>scatter, absorb, reflect, transmit</strong>
at matched positions, times, polarization, wavlen</li>
</ul>
</div>
<p class="small"><strong>Bi-simulations of all JUNO solids, with millions of photons</strong></p>
<dl class="small docutils">
<dt>mis-aligned histories</dt>
<dd>mostly &lt; 0.25%, &lt; 0.50% for largest solids</dd>
<dt>deviant photons within matched history</dt>
<dd>&lt; 0.05% (500/1M)</dd>
</dl>
<p class="small"><strong>Primary sources of problems</strong></p>
<ul class="small simple">
<li>grazing incidence, edge skimmers</li>
<li>incidence at constituent solid boundaries</li>
</ul>
<p class="small"><strong>Primary cause : float vs double</strong></p>
<p class="small"><em>Geant4</em> uses <em>double</em> everywhere, <em>Opticks</em> only sparingly (observed <em>double</em> costing 10x slowdown with RTX)</p>
<p class="small"><strong>Conclude</strong></p>
<ul class="small simple">
<li><span class="blue">neatly oriented photons more prone to issues than realistic ones</span></li>
<li>perfect &quot;technical&quot; matching not feasible</li>
<li>instead shift validation to more realistic full detector &quot;calibration&quot; situation</li>
</ul>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="scan-pf-check-gui-to-sc-bt5-sd">
<h1><span class="i">scan-pf-check-GUI-TO-SC-BT5-SD</span></h1>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="scan-pf-check-gui-to-bt5-sd">
<h1><span class="i">scan-pf-check-GUI-TO-BT5-SD</span></h1>

        <!--  s5talk  -->
        <br/>
    <!-- comment

* DELL Precision 7920T Workstation
* Intel Xeon Silver 4114, 2.2GHz, 40 cores, 65G
* NVIDIA Quadro RTX 8000, 48G

* DELL Precision 7920T Workstation
* Intel Xeon Gold 5118, 2.3GHz, 48 cores, 65G
* NVIDIA TITAN RTX, 24G
* NVIDIA TITAN V, 12G -->
</div>
<div class="slide" id="performance-scanning-from-1m-to-400m-photons">
<h1><span class="small">Performance : Scanning from 1M to 400M Photons</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">Test Hardware + Software</span></p>
<p class="small"><strong>Workstation</strong></p>
<ul class="small simple">
<li>DELL Precision 7920T Workstation</li>
<li>Intel Xeon Gold 5118, 2.3GHz, 48 cores, 62G</li>
<li>NVIDIA Quadro RTX 8000 (48G)</li>
</ul>
<p class="small"><strong>Software</strong></p>
<ul class="small simple">
<li>Opticks 0.0.0 Alpha</li>
<li>Geant4 10.4p2</li>
<li>NVIDIA OptiX 6.5.0</li>
<li>NVIDIA Driver 435.21</li>
<li>CUDA 10.1</li>
</ul>
<p class="small"><strong>IHEP GPU Cluster</strong></p>
<ul class="small last simple">
<li>10 nodes of 8x NVIDIA Tesla GV100 (32G)</li>
</ul>
</div>
<p class="small"><strong>Full JUNO Analytic Geometry j1808v5</strong></p>
<ul class="small simple">
<li>&quot;calibration source&quot; genstep at center of scintillator</li>
</ul>
<p class="small"><strong>Production Mode : does the minimum</strong></p>
<ul class="small simple">
<li>only saves hits</li>
<li>skips : genstep, photon, source, record, sequence, index, ..</li>
<li>no <em>Geant4</em> propagation (other than at 1M for extrapolation)</li>
</ul>
<p class="small"><strong>Multi-Event Running, Measure:</strong></p>
<dl class="small docutils">
<dt><span class="red">interval</span></dt>
<dd>avg time between successive launches, including overheads:
(upload gensteps + <span class="blue">launch</span> + download hits)</dd>
<dt><span class="blue">launch</span></dt>
<dd>avg of 10 OptiX launches</dd>
</dl>
<ul class="small simple">
<li>overheads &lt; 10% beyond 20M photons</li>
</ul>

        <!--  s5talk  -->
        <br/>
    <!-- comment

.. sidebar:: :small:`Genstep/Hit Copying Overheads`

     .. class:: small

         **launch**
           time of each OptiX launch (avg of 10)

         **interval, including overhead**
           time between subsequent launches (avg of 9)

         :red:`Mostly < 10% Overhead beyond 20M photons` -->
</div>
<div class="slide" id="nvidia-quadro-rtx-8000-48g">
<h1><tt class="docutils literal">NVIDIA Quadro RTX 8000 (48G)</tt></h1>
<div class="mysidebar" style="position: absolute; top:15%; left:65%; width:22%; height:10% ;" >
   <strong> 谢谢 NVIDIA China <br> for loaning the card </strong>
</div>
        <!--  s5talk  -->
        <br/>
    <!-- comment

update these profilesmry.py plots with::

    scan-plot     ## on workstation
    scan-pub      ## on laptop with simoncblyth.bitbucket.org clone
    scan-pubrst   ## prepare RST for inclusion at tail -->
</div>
<div class="slide" id="scan-pf-1-nhit">
<h1><span class="i">scan-pf-1_NHit</span></h1>
<pre>








</pre><div class="sidebar">
<p class="first sidebar-title"><span class="small">Photon Launch Size : VRAM Limited</span></p>
<p class="small"><strong>NVIDIA Quadro RTX 8000 (48 GB)</strong></p>
<ul class="small simple">
<li>photon 4*4 floats : 64 bytes</li>
<li>curandState       : 48 bytes</li>
</ul>
<p class="small last"><strong>400M photons</strong> x <span class="blue">112 bytes</span> ~ 45G</p>
</div>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="scan-pf-1-opticks-vs-geant4-2">
<h1><span class="i">scan-pf-1_Opticks_vs_Geant4 2</span></h1>
<pre>




</pre><table border="1" class="small docutils align-center">
<colgroup>
<col width="30%" />
<col width="42%" />
<col width="27%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head" colspan="2">JUNO analytic, 400M photons from center</th>
<th class="head">Speedup</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Geant4 Extrap.</td>
<td>95,600 s (26 hrs)</td>
<td>&nbsp;</td>
</tr>
<tr><td>Opticks RTX ON (i)</td>
<td>58 s</td>
<td>1650x</td>
</tr>
</tbody>
</table>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="scan-pf-1-opticks-speedup-2">
<h1><span class="i">scan-pf-1_Opticks_Speedup 2</span></h1>
<pre>









</pre><table border="1" class="small docutils align-center">
<colgroup>
<col width="41%" />
<col width="30%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head" colspan="2">JUNO analytic, 400M photons from center</th>
<th class="head">Speedup</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Opticks RTX ON (i)</td>
<td>58s</td>
<td>1650x</td>
</tr>
<tr><td>Opticks RTX OFF (i)</td>
<td>275s</td>
<td>350x</td>
</tr>
<tr><td>Geant4 Extrap.</td>
<td>95,600s (26 hrs)</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="scan-pf-1-rtx-speedup">
<h1><span class="i">scan-pf-1_RTX_Speedup</span></h1>
<pre>











</pre><table border="1" class="docutils align-center">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>5x Speedup from RTX with JUNO analytic geometry</strong></td>
</tr>
</tbody>
</table>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="opticks-experience-main-operational-problem-manpower">
<h1><span class="small">Opticks Experience : Main Operational Problem : Manpower</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">Atypical Experience Needed</span></p>
<ul class="small simple">
<li><span class="red">difficult for students/postdocs to help</span></li>
<li><span class="blue">Opticks is a one person project</span></li>
</ul>
<p class="small"><strong>Typical NVIDIA OptiX Users:</strong></p>
<ul class="small simple">
<li><strong>software company teams</strong> building commercial renderers for design/architecture/visual-effects</li>
<li>experienced graphics developers</li>
<li>Windows workstations</li>
</ul>
<p class="small"><strong>Typical Opticks Users (Candidate Devs):</strong></p>
<ul class="small last simple">
<li>neutrino and dark matter search experiments
with 0-0.25 FTE trying to improve Geant4 simulation performance</li>
<li>no graphics experience, little GPU experience</li>
<li>Linux servers</li>
</ul>
</div>
<p class="small"><span class="red">Lots of interest, very little contribution, why ?</span></p>
<p class="small"><strong>Tool Innovation is Disincentivized ?</strong></p>
<ul class="small simple">
<li>students/postdocs interested in Opticks</li>
<li>advisors steer them to analysis : less risky, better for career</li>
</ul>
<p class="small"><strong>Why GPU simulation development difficult ?</strong></p>
<ul class="small simple">
<li>totally different geometry model<ul>
<li><span class="strike">tree of C++ objects</span> -&gt; arrays, textures</li>
<li><span class="strike">solid primitives</span> -&gt; intersection by solving polynomials</li>
</ul>
</li>
<li>totally different development model<ul>
<li><span class="strike">complex libraries</span> -&gt; simple headers</li>
<li>simpler -&gt; smaller stack -&gt; more threads in flight</li>
<li>low level CUDA development, eg CSG from first principals</li>
<li>very few libs</li>
<li>restricted CUDA environment<ul>
<li>no recursion in intersect</li>
<li>no shared memory/synchronizations/barriers</li>
<li>double precision problematic, performance hit</li>
</ul>
</li>
</ul>
</li>
</ul>

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="opticks-experience-main-technical-problem-geometry-translation">
<h1><span class="small">Opticks Experience : Main Technical Problem : Geometry Translation</span></h1>
<!-- skip

* meshes can leak when shoot millions of rays at cracks -->
<div class="sidebar">
<p class="first sidebar-title"><span class="small">Approximate Triangulated geometry</span></p>
<p class="small"><strong>GPUs love triangles, BUT polygonization not easy</strong></p>
<ul class="small last simple">
<li>G4Polyhedron issue (black box code)<ul>
<li>polycones yield cleaved meshes</li>
<li>just visualization issue for Geant4</li>
<li>but breaks the geometry</li>
</ul>
</li>
<li>Opticks(OpenMesh) fixes meshes, BUT fragile</li>
<li>Failed to find/develop better polygonization</li>
<li>Triangulation too approximate for PMTs</li>
<li>Approx. tris : limits Opticks-Geant4 matching</li>
</ul>
</div>
<p class="small"><strong>Intersection Performance -&gt; Simulation Performance, Drivers:</strong></p>
<ul class="small simple">
<li>acceleration structure (AS) eg BVH</li>
<li>geometry model input to AS</li>
</ul>
<p class="small"><strong>Analytic Geometry : translate volume -&gt; surface based model</strong></p>
<p class="small">Coincident faces (even in CSG boolean constituents)</p>
<ul class="small simple">
<li>very common problem, causes spurious intersects<ul>
<li>manual modelling changes : avoiding coincidence</li>
</ul>
</li>
<li>CSG serialized using complete binary tree<ul>
<li>simple+convenient, <span class="red">very inefficient for unbalanced trees</span></li>
<li>balancing enables support for more complex trees</li>
<li>v.complicated solids (G4Boolean abuse) still problematic</li>
</ul>
</li>
</ul>
<p class="small"><strong>Analytic Torus Intersection</strong></p>
<ul class="small simple">
<li>double precision quartic root solving</li>
<li>very large coefficient range, robust solution difficult<ul>
<li>many techniques tried (numerical/computer science papers)</li>
</ul>
</li>
<li>very heavy kernel : 10x performance impact even when unused</li>
<li>pragmatic solution : avoid torus, or use triangulated</li>
</ul>
<!-- comment geometry cons

Large geometry problems : instancing required for limited VRAM

Geometry Changes needed to avoid problems in translation to GPU

double heavy quartic root code (for torus intersection) too difficult

bounding boxes that touch geometry cause leaks, slightly enlarging the boxes avoids leak (<1 in 3M)

surface vs volume representation of geometry : coincident faces, model translation

Coincident boundaries do not work in surface representation

speckle in the hole problems : fake intersects from CSG constituent coincident faces

thin cylinder endcap degeneracy (eg mirrors DYB ESR) : solved via dedicated disc primitive -->

        <!--  s5talk  -->
        <br/>
    </div>
<div class="slide" id="opticks-experience-problems-with-using-nvidia-optix">
<h1><span class="small">Opticks Experience : Problems with using NVIDIA OptiX</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">NVIDIA OptiX 7 : Entirely new API</span></p>
<ul class="small last simple">
<li>introduced August 2019</li>
<li>low-level CUDA-centric thin API (Vulkan-ized)</li>
<li><span class="strike">near perfect scaling to 4 GPUs, for free</span></li>
<li>Major effort needed to support in Opticks</li>
</ul>
</div>
<ul class="small simple">
<li>NVIDIA GPUs only</li>
<li>No influence on direction of NVIDIA OptiX (eg OptiX 7)</li>
<li>immature OptiX support for Linux debug/profiling<ul>
<li>most OptiX users develop on Windows ?</li>
<li>cuda-gdb not to level of Nsight VSE</li>
</ul>
</li>
</ul>
<p class="small"><strong>Optimization Issues</strong></p>
<ul class="small simple">
<li>difficult to approach 10 GigaRays/s</li>
<li>closed source : black box BVH<ul>
<li>blind experimentation</li>
</ul>
</li>
</ul>
<p class="small"><strong>Linux GPU Cluster (eg Tesla V100) Deployment Issues</strong></p>
<ul class="small simple">
<li>OptiX releases demand lastest <strong>short lived branch</strong> driver</li>
<li>GPU clusters typically use <strong>long lived branch</strong> drivers<ul>
<li>drivers appropriate for OptiX slow to appear</li>
<li>must use older OptiX release for many months</li>
</ul>
</li>
<li>RTX performance, RT cores ~not available in server GPUs[1,2]<ul>
<li>4 non-RTX GPUs ~ single RTX GPU performance</li>
</ul>
</li>
<li><a class="reference external" href="https://www.nvidia.com/en-us/design-visualization/quadro-data-center/">https://www.nvidia.com/en-us/design-visualization/quadro-data-center/</a></li>
</ul>
<p class="tiny">[1] NVIDIA RTX Server with 8x NVIDIA Quadro RTX 8000 : probably restricted to car, design, film companies ...
[2] NVIDIA Quadro RTX 8000 PCIe Server Card (Passive)</p>

        <!--  s5talk  -->
        <br/>
    <!-- comment

:small:`cuRAND : CUDA random number generation library`
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

.. class:: small

    * stack size needed to initialize cuRAND kills performance (> 10x)
    * split initialization into separate CUDA launch and persist cuRAND state to file
    * loading+uploading this state to GPU at setup of OptiX context allows
      cuRAND to be used without the performance killing stack size -->
</div>
<div class="slide" id="opticks-experience-benefits-from-using-nvidia-optix">
<h1><span class="small">Opticks Experience : Benefits from using NVIDIA OptiX</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">State-of-the-art GPU ray tracing</span></p>
<p class="small"><strong>OptiX makes this performance accessible</strong></p>
<ul class="small last simple">
<li>drastic performance factors &gt; 1000x Geant4</li>
<li>GPU offloading<ul>
<li>eliminates memory, time bottlenecks</li>
</ul>
</li>
<li>substantial improvements with each release</li>
<li>benefit from new GPU features</li>
</ul>
</div>
<p class="small"><strong>NVIDIA OptiX 3,4,5,6</strong></p>
<ul class="small simple">
<li>excellent easy to use API</li>
<li>useful shared host/device context</li>
<li>flexible geometry : implement intersection code</li>
<li><span class="red">automated acceleration structure (AS) building/traversal</span></li>
<li>instancing of geometry + AS, essential for JUNO PMTs</li>
<li>transparent ~linear scaling up to 4 GPUs</li>
<li>graphics interop buffer sharing CUDA/Thrust/OptiX/OpenGL<ul>
<li>in-situ visualization with no data movement</li>
</ul>
</li>
<li>straightforward port of Geant4 optical physics</li>
</ul>
<p class="small"><strong>NVIDIA OptiX 6</strong></p>
<ul class="small simple">
<li>accelerated with ray trace dedicated hardware (RT Cores)<ul>
<li>5x performance from RTX</li>
</ul>
</li>
</ul>
<p class="small"><strong>1 or 2 Releases per Year</strong></p>
<ul class="small simple">
<li>until OptiX 7, fairly compatible API changes</li>
<li>tuning for new GPUs</li>
</ul>

        <!--  s5talk  -->
        <br/>
    <!-- comment

key features https://developer.nvidia.com/designworks/optix/download

Programmable GPU-accelerated Ray-Tracing Pipeline

Single-ray shader programming model using C++

Optimized for current and future generations of NVIDIA GPU architectures


**pros**

OptiX : Higher level API than pure CUDA : shared host/device context system

Opticks integrates Geant4 simulations with state-of-the-art NVIDIA OptiX GPU ray tracing

Opticks aims to replace Geant4 optical photon propagation with an equivalent and drastically faster GPU implementation.

graphics compute interop : CUDA/Thrust/OptiX/OpenGL all sharing buffers

Shockingly Fast/Smooth graphics : single VBO : from model shift : smooth handling of millions of tris

Binary Geocache (NPY format) persisted GPU buffers : initialize in seconds rather than minutes

Visualization geometry shader : time as an input

Composited raytrace and rasterized images using Z-depth calculated for each raytrace pixel.

eliminates optical photon bottleneck

Geometry Set Free

GPU textures : convenient for material/surface properties : providing hardware interpolation

GPUs contain hardware dedicated to fast texture lookup and interpolation. Using texture lookup for all properties and reemission wavelengths keeps OptiX programs simple.

GPU resident photons : huge memory saving

thrust::copy_if stream compaction

photon indexing with Thrust fast CUDA integer sorting

NVIDIA expertise on efficient GPU/multi-GPU usage : load balancing

new GPU tuning

RTX : 10 GiGaRays/s -> ~1 billion photons/s

analytic CSG -> auto translation of Geant4 geometry

modern CMake target export (Opticks is a tree of ~20 pkgs : very fast rebuilds of sub-components)

Opticks.NPY -->
<!-- comment general cons

Separate address space : serialization : array oriented not object

inevitable duplication on GPU : brings matching validation costs : double/float makes that difficult -->
</div>
<div class="slide" id="summary">
<h1><span class="small">Summary</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><span class="small">Innovation = Problems...</span></p>
<ul class="small last simple">
<li>Problems Inevitable</li>
<li>Ample benefits reward efforts</li>
</ul>
</div>
<img alt="/env/presentation/1px.png" src="/env/presentation/1px.png" style="width: 500px; height: 50px;" />
<!--  -->
<blockquote>
<p><em>Opticks</em> : state-of-the-art GPU ray tracing applied to optical photon simulation and
integrated with <em>Geant4</em>, giving a leap in performance that eliminates memory and time bottlenecks.</p>
<img alt="/env/presentation/1px.png" src="/env/presentation/1px.png" style="width: 1000px; height: 1px;" />
<ul class="simple">
<li>Drastic speedup -&gt; better detector understanding -&gt; greater precision<ul>
<li><strong>any simulation limited by optical photons can benefit</strong></li>
<li>more photon limited -&gt; more overall speedup (99% -&gt; 100x)</li>
</ul>
</li>
</ul>
<img alt="/env/presentation/1px.png" src="/env/presentation/1px.png" style="width: 1000px; height: 10px;" />
</blockquote>
<table border="1" class="docutils align-center">
<colgroup>
<col width="53%" />
<col width="47%" />
</colgroup>
<tbody valign="top">
<tr><td><a class="reference external" href="https://bitbucket.org/simoncblyth/opticks">https://bitbucket.org/simoncblyth/opticks</a></td>
<td>code repository</td>
</tr>
<tr><td><a class="reference external" href="https://simoncblyth.bitbucket.io">https://simoncblyth.bitbucket.io</a></td>
<td>presentations and videos</td>
</tr>
<tr><td><a class="reference external" href="https://groups.io/g/opticks">https://groups.io/g/opticks</a></td>
<td>forum/mailing list archive</td>
</tr>
<tr><td>email:opticks+subscribe&#64;groups.io</td>
<td>subscribe to mailing list</td>
</tr>
</tbody>
</table>
<!-- comment

*Opticks* uses hardware accelerated GPU ray tracing
via NVIDIA OptiX to give **effectively zero time and zero CPU memory**
optical photon simulation to *Geant4* applications. -->

        <!--  s5talk  -->
        <br/>
    
       <style type="text/css">

          div.slide { 
             background-clip: border-box;
             background-repeat: no-repeat;
             height: 100%;
          }
          div.slide#slide0{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-wide_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#opticks-benefits{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-wide_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#visualizing-an-optical-photon-simulation{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-wide_crop.png);
             background-size: 640px 360px;
             background-position: 600px 100px;
             
          }
          div.slide#overview{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-wide_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#g4daeview-py-fast-opengl-3d-viewer-for-g4dae-files{
             background-image: url(/env/geant4/geometry/collada/g4daeview/20140419-170713.png);
             background-size: auto auto;
             background-position: 0px 0px;
             
          }
          div.slide#cerenkov-photons-simulation-top-view{
             background-image: url(/env/geant4/geometry/collada/g4daeview/20141224-115923.png);
             background-size: auto auto;
             background-position: 0px 0px;
             
          }
          div.slide#cerenkov-photons-simulation-side-view{
             background-image: url(/env/geant4/geometry/collada/g4daeview/20141224-115935.png);
             background-size: auto auto;
             background-position: 0px 0px;
             
          }
          div.slide#scintillation-photons-simulation-top-view{
             background-image: url(/env/geant4/geometry/collada/g4daeview/20141224-121444.png);
             background-size: auto auto;
             background-position: 0px 0px;
             
          }
          div.slide#scintillation-photons-simulation-side-view{
             background-image: url(/env/geant4/geometry/collada/g4daeview/20141224-121435.png);
             background-size: auto auto;
             background-position: 0px 0px;
             
          }
          div.slide#standard-geant4-workflow{
             background-image: url(/env/keynotefigs/G4DAEChroma/G4DAEChroma.001.png);
             background-size: auto auto;
             background-position: 0px 0px;
             
          }
          div.slide#external-photon-simulation-workflow{
             background-image: url(/env/keynotefigs/G4DAEChroma/G4DAEChroma.002.png);
             background-size: auto auto;
             background-position: 0px 0px;
             
          }
          div.slide#geant4opticksworkflow{
             background-image: url(/env/Documents/Geant4OpticksWorkflow/Geant4OpticksWorkflow.001.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#ggeoview{
             background-image: url(/env/graphics/ggeoview/ggeoview-cerenkov-001.png);
             background-size: 1047px 795px;
             background-position: 0px 0px;
             
          }
          div.slide#ggeoview-m1-points{
             background-image: url(/env/graphics/ggeoview/ggeoview-scintillation-points-mat1.png);
             background-size: 1435px 848px;
             background-position: 0px 0px;
             
          }
          div.slide#ggeoview-flag-selection{
             background-image: url(/env/graphics/ggeoview/ggeoview-scintillation-flag-seq-select.png);
             background-size: 1436px 842px;
             background-position: 0px 0px;
             
          }
          div.slide#ggeoview-cerenkov-geom-m1{
             background-image: url(/env/graphics/ggeoview/ggeoview-cerenkov-m1-geom.png);
             background-size: 1416px 845px;
             background-position: 0px 0px;
             
          }
          div.slide#detecting-neutrinos-via-optical-photons-1{
             background-image: url(/env/presentation/dayabay-principal_half.png);
             background-size: 1417px 830px;
             background-position: 0px 0px;
             
          }
          div.slide#detecting-neutrinos-via-optical-photons-2{
             background-image: url(/env/presentation/dayabay-principal_half.png);
             background-size: 1417px 830px;
             background-position: 0px 0px;
             
          }
          div.slide#jpmt-inside-wide{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-wide_half.png);
             background-size: 1432px 844px;
             background-position: 0px 0px;
             
          }
          div.slide#jpmt-wide{
             background-image: url(/env/graphics/ggeoview/jpmt-wide_half.png);
             background-size: 1409px 836px;
             background-position: 0px 0px;
             
          }
          div.slide#jpmt-headview{
             background-image: url(/env/graphics/ggeoview/jpmt-headview_half.png);
             background-size: 1308px 783px;
             background-position: 0px 0px;
             
          }
          div.slide#jpmt-backview{
             background-image: url(/env/graphics/ggeoview/jpmt-backview_half.png);
             background-size: 1149px 794px;
             background-position: 0px 0px;
             
          }
          div.slide#jpmt-approach{
             background-image: url(/env/graphics/ggeoview/jpmt-approach_half.png);
             background-size: 1431px 839px;
             background-position: 0px 0px;
             
          }
          div.slide#jpmt-arrival{
             background-image: url(/env/graphics/ggeoview/jpmt-arrival_half.png);
             background-size: 1427px 841px;
             background-position: 0px 0px;
             
          }
          div.slide#optical-photon-simulation-problem{
             background-image: url(/env/graphics/ggeoview/jpmt-before-contact_half.png);
             background-size: 1430px 844px;
             background-position: 0px 0px;
             
          }
          div.slide#juno-optical-photon-simulation-problem{
             background-image: url(/env/graphics/ggeoview/jpmt-before-contact_half.png);
             background-size: 1430px 844px;
             background-position: 0px 0px;
             
          }
          div.slide#jpmt-before-contact{
             background-image: url(/env/graphics/ggeoview/jpmt-before-contact_half.png);
             background-size: 1430px 844px;
             background-position: 0px 0px;
             
          }
          div.slide#jpmt-before-contact-2{
             background-image: url(/env/graphics/ggeoview/jpmt-before-contact_half.png);
             background-size: 1430px 844px;
             background-position: 0px 0px;
             
          }
          div.slide#jpmt-before-contact-3{
             background-image: url(/env/graphics/ggeoview/jpmt-before-contact_half.png);
             background-size: 1430px 844px;
             background-position: 0px 0px;
             
          }
          div.slide#jpmt-after-contact{
             background-image: url(/env/graphics/ggeoview/jpmt-after-contact_half.png);
             background-size: 1425px 840px;
             background-position: 0px 0px;
             
          }
          div.slide#jpmt-inside-outside{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-outside_half.png);
             background-size: 1401px 842px;
             background-position: 0px 0px;
             
          }
          div.slide#nvidia-optix-in-action{
             background-image: url(/env/presentation/optix-in-action_half.png);
             background-size: 966px 646px;
             background-position: 100px 50px;
             
          }
          div.slide#pmtinbox-approach-1{
             background-image: url(/env/graphics/ggeoview/PmtInBox-approach.png);
             background-size: 1069px 769px;
             background-position: 0px 0px;
             
          }
          div.slide#pmtinbox-approach-2{
             background-image: url(/env/graphics/ggeoview/PmtInBox-approach.png);
             background-size: 1069px 769px;
             background-position: 0px 0px;
             
          }
          div.slide#pmtinbox-after-1{
             background-image: url(/env/graphics/ggeoview/PmtInBox-after.png);
             background-size: 1057px 760px;
             background-position: 0px 0px;
             
          }
          div.slide#pmtinbox-after-2{
             background-image: url(/env/graphics/ggeoview/PmtInBox-after.png);
             background-size: 1057px 760px;
             background-position: 0px 0px;
             
          }
          div.slide#daya-bay-pmt-wall-photo-1{
             background-image: url(/env/presentation/gtc2016/dyb-pmt-wall-photo.png);
             background-size: 1329px 798px;
             background-position: 0px 0px;
             
          }
          div.slide#daya-bay-pmt-wall-photo-2{
             background-image: url(/env/presentation/gtc2016/dyb-pmt-wall-photo.png);
             background-size: 1329px 798px;
             background-position: 0px 0px;
             
          }
          div.slide#super-kamiokande-pmts-not-16-9{
             background-image: url(/env/presentation/gtc2016/sk-PH20-water-withboat-apr23-wm.png);
             background-size: 1181px 771px;
             background-position: 0px 0px;
             
          }
          div.slide#super-kamiokande-pmts-1{
             background-image: url(/env/presentation/PH20-water-withboat-apr23-wm_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#super-kamiokande-pmts-2{
             background-image: url(/env/presentation/PH20-water-withboat-apr23-wm_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#super-kamiokande-pmts-3{
             background-image: url(/env/presentation/PH20-water-withboat-apr23-wm_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#super-kamiokande-pmts-4{
             background-image: url(/env/presentation/PH20-water-withboat-apr23-wm_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#kamiokande-ii-1{
             background-image: url(/env/presentation/1987a.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#kamiokande-ii-2{
             background-image: url(/env/presentation/1987a.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#kamiokande-ii-3{
             background-image: url(/env/presentation/1987a.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#fast-optical-photon-simulation{
             background-image: url(/env/presentation/newtons-opticks.png);
             background-size: 374px 684px;
             background-position: 800px 0px;
             
          }
          div.slide#photomultiplier-tubes-pmts{
             background-image: url(/env/presentation/hamamatsu-pmt-16x9.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#photomultiplier-tube-operation{
             background-image: url(/env/presentation/hamamatsu-pmt-16x9.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#old-hamamatsu-photomultiplier-tubes-pmts{
             background-image: url(/env/presentation/hamamatsu-pmt.png);
             background-size: 1099px 734px;
             background-position: 0px 0px;
             
          }
          div.slide#old-photomultiplier-tube-operation{
             background-image: url(/env/presentation/hamamatsu-pmt.png);
             background-size: 1099px 734px;
             background-position: 0px 0px;
             
          }
          div.slide#jiangmen-underground-neutrino-observatory-juno{
             background-image: url(/env/presentation/juno-schematic-5.png);
             background-size: 1391px 734px;
             background-position: 0px 0px;
             
          }
          div.slide#jiangmen-underground-neutrino-observatory-goals{
             background-image: url(/env/presentation/juno-schematic-5.png);
             background-size: 1391px 734px;
             background-position: 0px 0px;
             
          }
          div.slide#dayabay-reactor-neutrino-expt-far-site{
             background-image: url(/env/presentation/DybFar_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#daya-bay-far-site-2{
             background-image: url(/env/presentation/DybFar_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#daya-bay-far-site-3{
             background-image: url(/env/presentation/DybFar_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#geant4-monte-carlo-simulation-toolkit{
             background-image: url(/env/presentation/g4-hep.png);
             background-size: 1025px 621px;
             background-position: 100px 100px;
             
          }
          div.slide#geant4-monte-carlo-simulation-toolkit-generality{
             background-image: url(/env/presentation/g4-hep.png);
             background-size: 1025px 621px;
             background-position: 100px 100px;
             
          }
          div.slide#seeing-neutrinos-via-scintillation-cherenkov-light{
             background-image: url(/env/presentation/cherenkov.png);
             background-size: 316px 203px;
             background-position: 850px 400px;
             
          }
          div.slide#opticks-auto-instancing{
             background-image: url(/env/graphics/ggeoview/ggv-juno-instancing.png);
             background-size: 852px 592px;
             background-position: 450px 80px;
             
          }
          div.slide#nvidia-optix-1{
             background-image: url(/env/presentation/NVIDIAOptiXWebsite_Oct2016.png);
             background-size: 1280px;
             background-position: 0px 0px;
             
          }
          div.slide#nvidia-optix-2{
             background-image: url(/env/presentation/NVIDIAOptiXWebsite_Oct2016.png);
             background-size: 1280px;
             background-position: 0px 0px;
             
          }
          div.slide#opticksdocs{
             background-image: url(/env/presentation/OpticksDocs.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#daya-bay-antineutrino-detection-via-inverse-beta-decay-1{
             background-image: url(/env/presentation/AntineutrinoDetectionViaIBDJetterSept2014.png);
             background-size: 809px 576px;
             background-position: 100px 100px;
             
          }
          div.slide#daya-bay-antineutrino-detection-via-inverse-beta-decay-2{
             background-image: url(/env/presentation/AntineutrinoDetectionViaIBDJetterSept2014.png);
             background-size: 809px 576px;
             background-position: 100px 100px;
             
          }
          div.slide#daya-bay-energy-response-model-1{
             background-image: url(/env/presentation/ZheTaupDetectorResponseModel.png);
             background-size: 968px 576px;
             background-position: 100px 100px;
             
          }
          div.slide#daya-bay-energy-response-model-2{
             background-image: url(/env/presentation/ZheTaupDetectorResponseModel.png);
             background-size: 968px 576px;
             background-position: 100px 100px;
             
          }
          div.slide#daya-bay-energy-response-model-fit-to-calibration-data-1{
             background-image: url(/env/presentation/EnergyResponseModel.png);
             background-size: 693px 504px;
             background-position: 0px 100px;
             
          }
          div.slide#daya-bay-energy-response-model-fit-to-calibration-data-2{
             background-image: url(/env/presentation/ConstrainingNonLinearity.png);
             background-size: 761px 553px;
             background-position: 0px 80px;
             
          }
          div.slide#daya-bay-ngd-analysis-most-precise-theta13{
             background-image: url(/env/presentation/DYBZheTaup2015Theta13OscillationAnalysis.png);
             background-size: 1057px 625px;
             background-position: 100px 60px;
             
          }
          div.slide#opticks-analytic-daya-bay-near-site-gpu-raytrace-3{
             background-image: url(/env/presentation/op_full_raytrace_3.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#opticks-analytic-daya-bay-near-site-gpu-raytrace-1{
             background-image: url(/env/presentation/op_full_raytrace_1.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#opticks-analytic-daya-bay-near-site-gpu-raytrace-0{
             background-image: url(/env/presentation/op_full_raytrace_0.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#opticks-analytic-daya-bay-near-site-gpu-raytrace-2{
             background-image: url(/env/presentation/op_full_raytrace_2.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#opticks-analytic-juno-chimney-gpu-raytrace-0{
             background-image: url(/env/presentation/j1707_chimney_analytic_raytrace.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#opticks-analytic-juno-pmt-snap-gpu-raytrace-1{
             background-image: url(/env/presentation/j1707-okop-snap.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#gpu-instance-culling-with-level-of-detail{
             background-image: url(/env/presentation/j1707_lod_oglrap_instcull.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#opticks-export-of-g4-geometry-to-gltf-2-0{
             background-image: url(/env/yoctoglrap/dyb_near_venice_half.png);
             background-size: 1020px 737px;
             background-position: 0px 0px;
             
          }
          div.slide#what-are-numpy-arrays{
             background-image: url(/env/presentation/what_are_numpy_arrays.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#what-are-numpy-arrays-2{
             background-image: url(/env/presentation/what_are_numpy_arrays.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#bvh{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_029.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#spatial-index-acceleration-structure{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_029.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#bvh-pascal{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_030.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#bvh-turing{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_031.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#hardware-traversal-of-bvh-spatial-index{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_031.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#siggraph-2018-announcing-worlds-first-ray-tracing-gpu{
             background-image: url(/env/presentation/nvidia/SIGGRAPH_2018_Announcing_Worlds_First_Ray_Tracing_GPU_half.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#siggraph-2019-eric-enderton-rt-cores{
             background-image: url(/env/presentation/nvidia/SIGGRAPH_2019_Eric_Enderton_RT_Cores.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#nvidia-turing-gpu-72-sm-4608-cuda-cores{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_009.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#nvidia-turing-gpu-72-sm-4608-cuda-cores-spec{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_009.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#raytrace-vs-raster{
             background-image: url(/env/presentation/nvidia/NV_Turing_Editors_Day_132.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#ray-tracing-vs-rasterization{
             background-image: url(/env/presentation/nvidia/black.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#raytrace-diagram{
             background-image: url(/env/presentation/graphics/1024px-ray_trace_diagram.svg.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#j1808-top-ogl{
             background-image: url(/env/presentation/j1808/j1808_top_ogl.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#j1808-top-rtx{
             background-image: url(/env/presentation/j1808/j1808_top_rtx.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#j1808-escapes{
             background-image: url(/env/presentation/j1808/j1808_escapes.png);
             background-size: auto auto;
             background-position: 0px 0px;
             
          }
          div.slide#geocache-360{
             background-image: url(/env/presentation/geocache_360.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#juno-360-benchmark-with-optix-6-0-0-rtx-mode{
             background-image: url(/env/presentation/geocache_360.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#absmry-1m{
             background-image: url(/env/presentation/ana/absmry_1M.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#absmry-1m-2{
             background-image: url(/env/presentation/ana/absmry_1M.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#ta34-1m{
             background-image: url(/env/presentation/ana/ta34_1M.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#ta34-1m-2{
             background-image: url(/env/presentation/ana/ta34_1M.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#tv34-1m-a{
             background-image: url(/env/presentation/ana/tv34_1M_a.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#tv34-1m-b{
             background-image: url(/env/presentation/ana/tv34_1M_b.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#tv21-1m-a{
             background-image: url(/env/presentation/ana/tv21_1M_a.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#tv21-1m-a-2{
             background-image: url(/env/presentation/ana/tv21_1M_a.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#tv21-1m-c{
             background-image: url(/env/presentation/ana/tv21_1M_c.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#rtx-speedup{
             background-image: url(/env/presentation/ana/RTX_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#overheads{
             background-image: url(/env/presentation/ana/Overheads.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#opticks-speedup{
             background-image: url(/env/presentation/ana/Opticks_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#opticks-vs-geant4{
             background-image: url(/env/presentation/ana/Opticks_vs_Geant4.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#opticks-vs-geant4-2{
             background-image: url(/env/presentation/ana/Opticks_vs_Geant4.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#nhit{
             background-image: url(/env/presentation/ana/NHit.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#interval-over-launch{
             background-image: url(/env/presentation/ana/Interval_over_Launch.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#titan-rtx-72-raytrace-dedicated-rt-cores-4608-cuda-cores-24gb-vram-2500-usd{
             background-image: url(/env/presentation/nvidia/TITAN_RTX.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#bench-20190526-143808{
             background-image: url(/env/presentation/ana/bench_20190526_143808.png);
             background-size: auto auto;
             background-position: 0px 0px;
             
          }
          div.slide#bench-20190526-143808-2{
             background-image: url(/env/presentation/ana/bench_20190526_143808.png);
             background-size: auto auto;
             background-position: 0px 0px;
             
          }
          div.slide#bench-20190526-202537{
             background-image: url(/env/presentation/ana/bench_20190526_202537.png);
             background-size: auto auto;
             background-position: 0px 0px;
             
          }
          div.slide#bench-20190526-202537-2{
             background-image: url(/env/presentation/ana/bench_20190526_202537.png);
             background-size: auto auto;
             background-position: 0px 0px;
             
          }
          div.slide#tv16-fastener{
             background-image: url(/env/presentation/tv/tv16_Fastener.png);
             background-size: auto auto;
             background-position: 0px 0px;
             
          }
          div.slide#tv20-polycone-neck{
             background-image: url(/env/presentation/tv/tv20_polycone_neck.png);
             background-size: auto auto;
             background-position: 0px 0px;
             
          }
          div.slide#inch-pmt-neck-cylinder-torus-polycone{
             background-image: url(/env/presentation/tv/tv20_polycone_neck.png);
             background-size: auto auto;
             background-position: 0px 0px;
             
          }
          div.slide#genstep-interface{
             background-image: url(/env/presentation/simulation/genstep_interface.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#introducing-optix-7{
             background-image: url(/env/presentation/nvidia/Introducing_OptiX_7.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#where-next-for-opticks{
             background-image: url(/env/presentation/nvidia/Introducing_OptiX_7.png);
             background-size: 640px 360px;
             background-position: 670px 300px;
             
          }
          div.slide#opticks-experience-problems-with-using-nvidia-optix{
             background-image: url(/env/presentation/nvidia/Introducing_OptiX_7.png);
             background-size: 640px 360px;
             background-position: 670px 300px;
             
          }
          div.slide#turing-built-for-rtx{
             background-image: url(/env/presentation/nvidia/TURING_Built_for_RTX_half.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#turing-built-for-rtx-2{
             background-image: url(/env/presentation/nvidia/TURING_Built_for_RTX_half.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#nvidia-rtx-metro-exodus{
             background-image: url(/env/presentation/nvidia/NVIDIA_RTX_Metro_Exodus_half.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#modern-gpu-ray-tracing{
             background-image: url(/env/presentation/nvidia/Modern_GPU_RAY_Tracing.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#nvidia-optix-programming-model-analogous-to-rasterization-apis-opengl-shaders{
             background-image: url(/env/presentation/nvidia/Modern_GPU_RAY_Tracing.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#nvidia-quadro-rtx-8000-48g{
             background-image: url(/env/presentation/nvidia/NVIDIA_Quadro_RTX.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#siggraph-2010-optix-a-general-purpose-ray-tracing-engine{
             background-image: url(/env/presentation/nvidia/SIGGRAPH_2010_OptiX_A_General_Purpose_Ray_Tracing_Engine.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#useful-speedup-1000x-but-why-not-giga-rays-s-1-photon-10-rays{
             background-image: url(/env/presentation/nvidia/dhart/dhart_siggraph_2019_RTX_traversal_custom_primitives.png);
             background-size: 720px 405px;
             background-position: 10px 210px;
             
          }
          div.slide#juno-intro-1{
             background-image: url(/env/Documents/JUNOIntro/JUNOIntro.001.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#juno-intro-2{
             background-image: url(/env/Documents/JUNOIntro/JUNOIntro.002.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#juno-intro-3{
             background-image: url(/env/Documents/JUNOIntro/JUNOIntro.003.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#juno-intro-4{
             background-image: url(/env/Documents/JUNOIntro/JUNOIntro.004.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#juno-multipurpose-pedro-nufact-2019{
             background-image: url(/env/presentation/juno/JUNO_Multipurpose_Pedro_NuFact_2019.png);
             background-size: 960px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#dhart-siggraph-2019-optix-5-traversal{
             background-image: url(/env/presentation/nvidia/dhart_siggraph_2019_OptiX_5_traversal.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#dhart-siggraph-2019-optix-5-traversal{
             background-image: url(/env/presentation/nvidia/dhart_siggraph_2019_OptiX_5_traversal.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-check-gui-to-bt5-sd{
             background-image: url(/env/presentation/ana/scan-pf-1/scan-pf-check-GUI-TO-BT5-SD.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-check-gui-to-sc-bt5-sd{
             background-image: url(/env/presentation/ana/scan-pf-1/scan-pf-check-GUI-TO-SC-BT5-SD.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-0-interval-over-launch{
             background-image: url(/env/presentation/ana/scan-pf-0/Interval_over_Launch.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-0-nhit{
             background-image: url(/env/presentation/ana/scan-pf-0/NHit.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-0-opticks-speedup{
             background-image: url(/env/presentation/ana/scan-pf-0/Opticks_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-0-opticks-vs-geant4{
             background-image: url(/env/presentation/ana/scan-pf-0/Opticks_vs_Geant4.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-0-overheads{
             background-image: url(/env/presentation/ana/scan-pf-0/Overheads.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-0-rtx-speedup{
             background-image: url(/env/presentation/ana/scan-pf-0/RTX_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-0-rtx-speedup-2{
             background-image: url(/env/presentation/ana/scan-pf-0/RTX_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-1-interval-over-launch{
             background-image: url(/env/presentation/ana/scan-pf-1/Interval_over_Launch.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-1-nhit{
             background-image: url(/env/presentation/ana/scan-pf-1/NHit.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-1-opticks-speedup{
             background-image: url(/env/presentation/ana/scan-pf-1/Opticks_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-1-opticks-speedup-2{
             background-image: url(/env/presentation/ana/scan-pf-1/Opticks_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-1-opticks-vs-geant4{
             background-image: url(/env/presentation/ana/scan-pf-1/Opticks_vs_Geant4.png);
             background-size: 1280px 720pxS;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-1-opticks-vs-geant4-2{
             background-image: url(/env/presentation/ana/scan-pf-1/Opticks_vs_Geant4.png);
             background-size: 1280px 720pxS;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-1-overheads{
             background-image: url(/env/presentation/ana/scan-pf-1/Overheads.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#scan-pf-1-rtx-speedup{
             background-image: url(/env/presentation/ana/scan-pf-1/RTX_Speedup.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
             
          }
          div.slide#opticks-translates-g4-geometry-to-gpu-without-approximation{
             background-image: url(/env/presentation/face_view_PMTs.png);
             background-size: 640px 360px;
             background-position: 20px 340px;
             
          } 

       </style>
    <!-- comment

NVIDIA
                    Memory    Bandwidth     CUDA(RT) Cores
TITAN V             12 GB       651 GB/s    5120(0)
Tesla V100          32 GB       900 GB/s    5120(0)
TITAN RTX           24 GB       672 GB/s    4608(72)
Quadro RTX 8000     48 GB       672 GB/s    4608(72)

SM*64 gives cores

https://www.techpowerup.com/gpu-specs/titan-v.c3051
https://www.techpowerup.com/gpu-specs/titan-rtx.c3311
https://www.techpowerup.com/gpu-specs/quadro-rtx-8000.c3306 -->
</div>
</div>
</body>
</html>
