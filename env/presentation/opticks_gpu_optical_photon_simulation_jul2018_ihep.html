<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<meta name="version" content="S5 1.1" />
<title>Opticks : GPU Optical Photon Simulation for Particle Physics with NVIDIA OptiX</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="visible" />
<!-- style sheet links -->
<script src="ui/my-small-white/slides.js" type="text/javascript"></script>
<link rel="stylesheet" href="ui/my-small-white/slides.css"
      type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/my-small-white/outline.css"
      type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/my-small-white/print.css"
      type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/my-small-white/opera.css"
      type="text/css" media="projection" id="operaFix" />
</head>
<body>
<div class="layout">
<div id="controls"></div>
<div id="currentSlide"></div>
<div id="header">

</div>
<div id="footer">
<h1><span class="i">Opticks : GPU Optical Photon Simulation for Particle Physics with NVIDIA OptiX</span></h1>

</div>
</div>
<div class="presentation">
<div class="slide" id="slide0">
<h1 class="title"><span class="i">Opticks : GPU Optical Photon Simulation for Particle Physics with NVIDIA OptiX</span></h1>

<!-- comment

00 : <inline classes="i">Opticks : GPU Optical Photon Simulation for Particle Physics with NVIDIA OptiX</inline>
01 : opticks benefits
02 : outline

    Highlights teaser statement and outline

03 : optical photon simulation problem...
04 : jpmt before contact 2

    Statement of problem

05 : ray traced realistic image synthesis - -> optical photon simulation

    Ray trace connection to simulation

06 : nvidia optix 1
07 : nvidia optix 2

    OptiX intro are refs

08 : opticks geometry workflow : geocache
09 : large geometry techniques : instancing mandatory
10 : opticks geometry workflow : gpu textures



11 : hybrid geant4/opticks event workflow
12 : opticks interoperation : optix/cuda/thrust/opengl


ABSTRACT

Opticks is an open source project that integrates the NVIDIA OptiX
GPU ray tracing engine with Geant4 toolkit based simulations.
Massive parallelism brings drastic performance improvements with
optical photon simulation speedup expected to exceed 1000 times Geant4
when using workstation GPUs. Optical photon simulation time becomes
effectively zero compared to the rest of the simulation.

Optical photons from scintillation and Cherenkov processes
are allocated, generated and propagated entirely on the GPU, minimizing
transfer overheads and allowing CPU memory usage to be restricted to
optical photons that hit photomultiplier tubes or other photon detectors.
Collecting hits into standard Geant4 hit collections then allows the
rest of the simulation chain to proceed unmodified.

Optical physics processes of scattering, absorption, reemission and
boundary processes are implemented as CUDA OptiX programs based on the Geant4
implementations. Wavelength dependent material and surface properties as well as
inverse cumulative distribution functions for reemission are interleaved into
GPU textures providing fast interpolated property lookup or wavelength generation.

Geometry is provided to OptiX in the form of CUDA programs that return bounding boxes
for each primitive and single ray geometry intersection results. Some critical parts
of the geometry such as photomultiplier tubes have been implemented analytically
with the remainder being tesselated.
OptiX handles the creation and application of a choice of acceleration structures
such as boundary volume heirarchies and the transparent use of multiple GPUs.

OptiX interoperation with OpenGL and CUDA Thrust has enabled
unprecedented visualisations of photon propagations to be developed
using OpenGL geometry shaders to provide interactive time scrubbing and
CUDA Thrust photon indexing to provide interactive history selection.

Validation and performance results are shown for the photomultiplier based
Daya Bay and JUNO Neutrino detectors. -->
<style type="text/css">
    span.alarm { color: red; }
    span.warn { color: orange; }
    span.ok { color: green; }
    span.i { display: none; }
    pre.sliteral { class:"literal-block small"; }
    pre.mypre {
         display: block;
         font-family: monospace;
         font-size: 20px;
         white-space: pre;
         margin: 1em 0;
    }

    pre.mypretiny {
         display: block;
         font-family: monospace;
         font-size: 15px;
         white-space: pre;
         margin: 1em 0;
    }

    pre.mypretinytiny {
         display: block;
         font-family: monospace;
         font-size: 10px;
         white-space: pre;
         margin: 1em 0;
    }



    pre.myfoot {
         display: block;
         font-family: monospace;
         font-size: 18px;
         white-space: pre;
         color: white;
         position: absolute; top:86%; left:4%; width:50%; height:10% ;
    }

    a.mylink {
         display: block;
         font-family: monospace;
         font-size: 18px;
         white-space: pre;
         color: black;
         position: absolute; top:86%; left:4%; width:50%; height:10% ;
    }


    div.mytitle {
         font-size: 20px;
         color: black;
         position: absolute; top:0%; left:5%; width:90%; height:10% ;
    }

    div.mycredit {
         font-size: 20px;
         color: black;
         position: absolute; top:90%; left:5%; width:80%; height:10% ;
    }





</style><!-- Definitions of interpreted text roles (classes) for S5/HTML data. -->
<!-- This data file has been placed in the public domain. -->
<!-- Colours
======= -->
<!-- Text Sizes
========== -->
<!-- Display in Slides (Presentation Mode) Only
========================================== -->
<!-- Display in Outline Mode Only
============================ -->
<!-- Display in Print Only
===================== -->
<!-- Display in Handout Mode Only
============================ -->
<!-- Incremental Display
=================== -->

       <style type="text/css">

          div.slide { 
             background-clip: border-box;
             background-repeat: no-repeat;
             height: 100%;
          }
          div.slide#slide0{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-wide_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-benefits{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-wide_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#visualizing-an-optical-photon-simulation{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-wide_crop.png);
             background-size: 640px 360px;
             background-position: 600px 100px;
          }
          div.slide#overview{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-wide_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#g4daeview-py-fast-opengl-3d-viewer-for-g4dae-files{
             background-image: url(/env/geant4/geometry/collada/g4daeview/20140419-170713.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#cerenkov-photons-simulation-top-view{
             background-image: url(/env/geant4/geometry/collada/g4daeview/20141224-115923.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#cerenkov-photons-simulation-side-view{
             background-image: url(/env/geant4/geometry/collada/g4daeview/20141224-115935.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#scintillation-photons-simulation-top-view{
             background-image: url(/env/geant4/geometry/collada/g4daeview/20141224-121444.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#scintillation-photons-simulation-side-view{
             background-image: url(/env/geant4/geometry/collada/g4daeview/20141224-121435.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#standard-geant4-workflow{
             background-image: url(/env/keynotefigs/G4DAEChroma/G4DAEChroma.001.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#external-photon-simulation-workflow{
             background-image: url(/env/keynotefigs/G4DAEChroma/G4DAEChroma.002.png);
             background-size: auto auto;
             background-position: 0px 0px;
          }
          div.slide#ggeoview{
             background-image: url(/env/graphics/ggeoview/ggeoview-cerenkov-001.png);
             background-size: 1047px 795px;
             background-position: 0px 0px;
          }
          div.slide#ggeoview-m1-points{
             background-image: url(/env/graphics/ggeoview/ggeoview-scintillation-points-mat1.png);
             background-size: 1435px 848px;
             background-position: 0px 0px;
          }
          div.slide#ggeoview-flag-selection{
             background-image: url(/env/graphics/ggeoview/ggeoview-scintillation-flag-seq-select.png);
             background-size: 1436px 842px;
             background-position: 0px 0px;
          }
          div.slide#ggeoview-cerenkov-geom-m1{
             background-image: url(/env/graphics/ggeoview/ggeoview-cerenkov-m1-geom.png);
             background-size: 1416px 845px;
             background-position: 0px 0px;
          }
          div.slide#detecting-neutrinos-via-optical-photons-1{
             background-image: url(/env/presentation/dayabay-principal_half.png);
             background-size: 1417px 830px;
             background-position: 0px 0px;
          }
          div.slide#detecting-neutrinos-via-optical-photons-2{
             background-image: url(/env/presentation/dayabay-principal_half.png);
             background-size: 1417px 830px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-inside-wide{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-wide_half.png);
             background-size: 1432px 844px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-wide{
             background-image: url(/env/graphics/ggeoview/jpmt-wide_half.png);
             background-size: 1409px 836px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-headview{
             background-image: url(/env/graphics/ggeoview/jpmt-headview_half.png);
             background-size: 1308px 783px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-backview{
             background-image: url(/env/graphics/ggeoview/jpmt-backview_half.png);
             background-size: 1149px 794px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-approach{
             background-image: url(/env/graphics/ggeoview/jpmt-approach_half.png);
             background-size: 1431px 839px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-arrival{
             background-image: url(/env/graphics/ggeoview/jpmt-arrival_half.png);
             background-size: 1427px 841px;
             background-position: 0px 0px;
          }
          div.slide#optical-photon-simulation-problem{
             background-image: url(/env/graphics/ggeoview/jpmt-before-contact_half.png);
             background-size: 1430px 844px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-before-contact{
             background-image: url(/env/graphics/ggeoview/jpmt-before-contact_half.png);
             background-size: 1430px 844px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-before-contact-2{
             background-image: url(/env/graphics/ggeoview/jpmt-before-contact_half.png);
             background-size: 1430px 844px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-before-contact-3{
             background-image: url(/env/graphics/ggeoview/jpmt-before-contact_half.png);
             background-size: 1430px 844px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-after-contact{
             background-image: url(/env/graphics/ggeoview/jpmt-after-contact_half.png);
             background-size: 1425px 840px;
             background-position: 0px 0px;
          }
          div.slide#jpmt-inside-outside{
             background-image: url(/env/graphics/ggeoview/jpmt-inside-outside_half.png);
             background-size: 1401px 842px;
             background-position: 0px 0px;
          }
          div.slide#nvidia-optix-in-action{
             background-image: url(/env/presentation/optix-in-action_half.png);
             background-size: 966px 646px;
             background-position: 100px 50px;
          }
          div.slide#pmtinbox-approach-1{
             background-image: url(/env/graphics/ggeoview/PmtInBox-approach.png);
             background-size: 1069px 769px;
             background-position: 0px 0px;
          }
          div.slide#pmtinbox-approach-2{
             background-image: url(/env/graphics/ggeoview/PmtInBox-approach.png);
             background-size: 1069px 769px;
             background-position: 0px 0px;
          }
          div.slide#pmtinbox-after-1{
             background-image: url(/env/graphics/ggeoview/PmtInBox-after.png);
             background-size: 1057px 760px;
             background-position: 0px 0px;
          }
          div.slide#pmtinbox-after-2{
             background-image: url(/env/graphics/ggeoview/PmtInBox-after.png);
             background-size: 1057px 760px;
             background-position: 0px 0px;
          }
          div.slide#daya-bay-pmt-wall-photo-1{
             background-image: url(/env/presentation/gtc2016/dyb-pmt-wall-photo.png);
             background-size: 1329px 798px;
             background-position: 0px 0px;
          }
          div.slide#daya-bay-pmt-wall-photo-2{
             background-image: url(/env/presentation/gtc2016/dyb-pmt-wall-photo.png);
             background-size: 1329px 798px;
             background-position: 0px 0px;
          }
          div.slide#super-kamiokande-pmts-not-16-9{
             background-image: url(/env/presentation/gtc2016/sk-PH20-water-withboat-apr23-wm.png);
             background-size: 1181px 771px;
             background-position: 0px 0px;
          }
          div.slide#super-kamiokande-pmts-1{
             background-image: url(/env/presentation/PH20-water-withboat-apr23-wm_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#super-kamiokande-pmts-2{
             background-image: url(/env/presentation/PH20-water-withboat-apr23-wm_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#super-kamiokande-pmts-3{
             background-image: url(/env/presentation/PH20-water-withboat-apr23-wm_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#super-kamiokande-pmts-4{
             background-image: url(/env/presentation/PH20-water-withboat-apr23-wm_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#kamiokande-ii-1{
             background-image: url(/env/presentation/1987a.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#kamiokande-ii-2{
             background-image: url(/env/presentation/1987a.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#kamiokande-ii-3{
             background-image: url(/env/presentation/1987a.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#fast-optical-photon-simulation{
             background-image: url(/env/presentation/newtons-opticks.png);
             background-size: 374px 684px;
             background-position: 800px 0px;
          }
          div.slide#photomultiplier-tubes-pmts{
             background-image: url(/env/presentation/hamamatsu-pmt-16x9.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#photomultiplier-tube-operation{
             background-image: url(/env/presentation/hamamatsu-pmt-16x9.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#old-hamamatsu-photomultiplier-tubes-pmts{
             background-image: url(/env/presentation/hamamatsu-pmt.png);
             background-size: 1099px 734px;
             background-position: 0px 0px;
          }
          div.slide#old-photomultiplier-tube-operation{
             background-image: url(/env/presentation/hamamatsu-pmt.png);
             background-size: 1099px 734px;
             background-position: 0px 0px;
          }
          div.slide#jiangmen-underground-neutrino-observatory-juno{
             background-image: url(/env/presentation/juno-schematic-5.png);
             background-size: 1391px 734px;
             background-position: 0px 0px;
          }
          div.slide#jiangmen-underground-neutrino-observatory-goals{
             background-image: url(/env/presentation/juno-schematic-5.png);
             background-size: 1391px 734px;
             background-position: 0px 0px;
          }
          div.slide#dayabay-reactor-neutrino-expt-far-site{
             background-image: url(/env/presentation/DybFar_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#daya-bay-far-site-2{
             background-image: url(/env/presentation/DybFar_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#daya-bay-far-site-3{
             background-image: url(/env/presentation/DybFar_crop.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#geant4-monte-carlo-simulation-toolkit{
             background-image: url(/env/presentation/g4-hep.png);
             background-size: 1025px 621px;
             background-position: 100px 100px;
          }
          div.slide#geant4-monte-carlo-simulation-toolkit-generality{
             background-image: url(/env/presentation/g4-hep.png);
             background-size: 1025px 621px;
             background-position: 100px 100px;
          }
          div.slide#seeing-neutrinos-via-scintillation-cherenkov-light{
             background-image: url(/env/presentation/cherenkov.png);
             background-size: 316px 203px;
             background-position: 850px 400px;
          }
          div.slide#large-geometry-techniques-instancing-mandatory{
             background-image: url(/env/graphics/ggeoview/ggv-juno-instancing.png);
             background-size: 852px 592px;
             background-position: 450px 80px;
          }
          div.slide#nvidia-optix-1{
             background-image: url(/env/presentation/NVIDIAOptiXWebsite_Oct2016.png);
             background-size: 1280px;
             background-position: 0px 30px;
          }
          div.slide#nvidia-optix-2{
             background-image: url(/env/presentation/NVIDIAOptiXWebsite_Oct2016.png);
             background-size: 1280px;
             background-position: 0px 30px;
          }
          div.slide#opticks-users-group{
             background-image: url(/env/presentation/groups_io_opticks_half.png);
             background-size: 1120px auto;
             background-position: 50px 30px;
          }
          div.slide#opticksdocs{
             background-image: url(/env/presentation/OpticksDocs.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#daya-bay-antineutrino-detection-via-inverse-beta-decay-1{
             background-image: url(/env/presentation/AntineutrinoDetectionViaIBDJetterSept2014.png);
             background-size: 809px 576px;
             background-position: 100px 100px;
          }
          div.slide#daya-bay-antineutrino-detection-via-inverse-beta-decay-2{
             background-image: url(/env/presentation/AntineutrinoDetectionViaIBDJetterSept2014.png);
             background-size: 809px 576px;
             background-position: 100px 100px;
          }
          div.slide#daya-bay-energy-response-model-1{
             background-image: url(/env/presentation/ZheTaupDetectorResponseModel.png);
             background-size: 968px 576px;
             background-position: 100px 100px;
          }
          div.slide#daya-bay-energy-response-model-2{
             background-image: url(/env/presentation/ZheTaupDetectorResponseModel.png);
             background-size: 968px 576px;
             background-position: 100px 100px;
          }
          div.slide#daya-bay-energy-response-model-fit-to-calibration-data-1{
             background-image: url(/env/presentation/EnergyResponseModel.png);
             background-size: 693px 504px;
             background-position: 0px 100px;
          }
          div.slide#daya-bay-energy-response-model-fit-to-calibration-data-2{
             background-image: url(/env/presentation/ConstrainingNonLinearity.png);
             background-size: 761px 553px;
             background-position: 0px 80px;
          }
          div.slide#daya-bay-ngd-analysis-most-precise-theta13{
             background-image: url(/env/presentation/DYBZheTaup2015Theta13OscillationAnalysis.png);
             background-size: 1057px 625px;
             background-position: 100px 60px;
          }
          div.slide#opticks-analytic-daya-bay-near-site-gpu-raytrace-3{
             background-image: url(/env/presentation/op_full_raytrace_3.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-analytic-daya-bay-near-site-gpu-raytrace-1{
             background-image: url(/env/presentation/op_full_raytrace_1.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-analytic-daya-bay-near-site-gpu-raytrace-0{
             background-image: url(/env/presentation/op_full_raytrace_0.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-analytic-daya-bay-near-site-gpu-raytrace-2{
             background-image: url(/env/presentation/op_full_raytrace_2.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-analytic-juno-chimney-gpu-raytrace-0{
             background-image: url(/env/presentation/j1707_chimney_analytic_raytrace.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-analytic-juno-pmt-snap-gpu-raytrace-1{
             background-image: url(/env/presentation/j1707-okop-snap.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#gpu-instance-culling-with-level-of-detail{
             background-image: url(/env/presentation/j1707_lod_oglrap_instcull.png);
             background-size: 1280px 720px;
             background-position: 0px 0px;
          }
          div.slide#opticks-export-of-g4-geometry-to-gltf-2-0{
             background-image: url(/env/yoctoglrap/dyb_near_venice_half.png);
             background-size: 1020px 737px;
             background-position: 0px 0px;
          }
          div.slide#nvidia-titan-v{
             background-image: url(/env/presentation/titan_v.png);
             background-size: 1280px 720px;
             background-position: 0px 10px;
          }
          div.slide#nvidia-titan-v-2{
             background-image: url(/env/presentation/titan_v.png);
             background-size: 1280px 720px;
             background-position: 0px 10px;
          }
          div.slide#optix-denoiser{
             background-image: url(/env/presentation/optix5_ai_denoiser.png);
             background-size: 1280px 720px;
             background-position: 0px 10px;
          } 

       </style>
    <!-- comment

Large Geometry/Event Techniques
/env/graphics/ggeoview/ggv-juno-instancing.png 2130px_1480px -> 1065px_740px


GGeoView image is 2094x1590 1047x795

GGeoView M1 Points is 2870x1696  1435x848

GGeoView Flag Selection 2872x1684 1436x842

GGeoView Cerenkov Geom M1 2832x1690 1416x845


Generated Scintillation Photons GPU cf Geant4
/env/g4dae/generated_scintillation_time_wavelength.png

G4/DetSim Generated Cerenkov Wavelength
/env/g4dae/g4_cerenkov_wavelength.png -->
<!-- comment

Placeholder

jpmt-after-contact.png 2850px_1680px
jpmt-approach.png 2862px_1678px
jpmt-arrival.png 2854px_1682px
jpmt-backview.png 2298px_1588px
jpmt-before-contact.png 2860px_1688px
jpmt-headview.png 2616px_1566px
jpmt-inside-outside.png 2802px_1684px
jpmt-wide.png 2818px_1672px -->
<!-- comment

I will introduce Opticks,
an optical photon simulation based on NVIDIA OptiX ray tracing
enabling particle physics detector simulations
to benefit from OptiX ray tracing.

The image visualizes photons coming from a cosmic ray muon
crossing a neutrino detector. -->
<div class="mytitle">
<h1 style="background-color:lightgrey"> <i>Opticks</i> : GPU Optical Photon Simulation for Particle Physics with NVIDIA® OptiX™ </h1>
</div>

<div class="mycredit">
<h2 style="background-color:lightgrey"> Simon C Blyth, IHEP, CAS &mdash; https://bitbucket.org/simoncblyth/opticks &mdash; July 2018, IHEP </h2>
</div>
</div>
<div class="slide" id="opticks-benefits">
<h1><span class="i">Opticks Benefits</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Opticks &gt; 1000x Geant4 (*)</p>
<p class="small">GPU massive parallelism <strong>eliminates bottleneck</strong>.</p>
<ul class="small simple">
<li>optical photon simulation time --&gt; zero</li>
<li>optical photon CPU memory --&gt; zero</li>
</ul>
<p class="small">[zero: effectively, compared to rest of simulation]</p>
<p class="small"><strong>More Photons -&gt; More Benefit</strong></p>
<ul class="small simple">
<li>huge benefits for JUNO neutrino detector</li>
</ul>
<p class="small"><a class="reference external" href="http://bitbucket.org/simoncblyth/opticks">http://bitbucket.org/simoncblyth/opticks</a></p>
<p class="small last">(*) core extrapolated from mobile GPU speed</p>
</div>
<!-- comment

Neutrino detectors can benefit the most as their operation
depends on production and propagation of sometimes many millions
of optical photons.

Neutrinos detectors need to be large, as neutrinos
interact only weakly.

**Radical simulation speedup -> short development cycle -> improved understanding** -->
</div>
<div class="slide" id="opticks-progress-current-focus-on-simplifying-usage">
<h1><span class="small">Opticks Progress : Current Focus on Simplifying Usage</span></h1>
<img alt="/env/presentation/newtons-opticks.png" class="align-right" src="/env/presentation/newtons-opticks.png" style="width: 299px; height: 547px;" />
<dl class="small docutils">
<dt>2018 July</dt>
<dd><ul class="first last simple">
<li>discuss proposed extended optical example with Geant4 members</li>
<li>port Opticks to Linux CentOS7 Workstation with Volta GPU</li>
<li>debugging direct geometry translation</li>
</ul>
</dd>
</dl>
<p class="small">2018 June : <span class="red">direct Geant4 to Opticks geometry conversion</span> : <strong>simplifies usage</strong></p>
<p class="small">2018 May : <span class="red">adopt modern CMake target export/import</span> : <strong>simplifies configuration</strong></p>
<dl class="small docutils">
<dt>2017 Dec <span class="classifier-delimiter">:</span> <span class="classifier"><span class="red">aligned bi-simulation ~perfect match with simple geometry</span> after fixes</span></dt>
<dd><ul class="first last simple">
<li>fix polarization + specular reflection discrepancies revealed by aligned running</li>
</ul>
</dd>
<dt>2017 Oct <span class="classifier-delimiter">:</span> <span class="classifier">emissive test geometry, CPU input photons</span></dt>
<dd><ul class="first last simple">
<li><span class="blue">presented Opticks in plenary session of Geant4 Collaboration meeting</span></li>
</ul>
</dd>
</dl>
<p class="small">2017 Sept : develop initial embedded Opticks implementation with Lin Tao</p>
<p class="small">2017 Aug : primitives for JUNO : ellipsoid, torus, hyperboloid : solve-quartic troubles</p>
<p class="large"><a class="reference external" href="https://bitbucket.org/simoncblyth/opticks/src/default/notes/progress.rst">https://bitbucket.org/simoncblyth/opticks/src/default/notes/progress.rst</a></p>
</div>
<div class="slide" id="optical-photon-simulation-problem">
<h1><tt class="docutils literal">Optical Photon Simulation <span class="pre">Problem...</span></tt></h1>
</div>
<div class="slide" id="jpmt-before-contact-2">
<h1><span class="i">JPMT Before Contact 2</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Optical Photon Problem</p>
<dl class="small docutils">
<dt><strong>Cosmic muon backgrounds</strong></dt>
<dd>many millions of optical photons in JUNO scintillator</dd>
<dt><strong>Simulation Bottleneck</strong></dt>
<dd>~99% CPU time, memory constraints</dd>
<dt><strong>Optical photons : naturally parallel, simple :</strong></dt>
<dd><ul class="first last simple">
<li>produced by Cerenkov+Scintillation</li>
<li>yield only Photomultiplier hits</li>
</ul>
</dd>
</dl>
<p class="small last"><strong>-&gt; Hybrid Solution : Geant4 + Opticks</strong></p>
</div>
</div>
<div class="slide" id="ray-traced-image-synthesis-optical-photon-simulation">
<h1><span class="small">Ray Traced Image Synthesis ≈ Optical Photon Simulation</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Not a Photo, a Calculation</p>
<img alt="/env/optix/samples/optix-ray-tracing-glasses.png" class="align-right" src="/env/optix/samples/optix-ray-tracing-glasses.png" style="width: 450px;" />
<p class="tiny last"><a class="reference external" href="http://on-demand.gputechconf.com/siggraph/2013/presentation/SG3106-Building-Ray-Tracing-Applications-OptiX.pdf">http://on-demand.gputechconf.com/siggraph/2013/presentation/SG3106-Building-Ray-Tracing-Applications-OptiX.pdf</a></p>
<!-- comment

Not a photo -->
</div>
<p class="small">Geometry, light sources, optical physics -&gt;</p>
<ul class="small simple">
<li>pixel values at image plane</li>
<li>photon parameters at detectors (eg PMTs)</li>
</ul>
<p class="small"><strong>Ray tracing has many applications</strong> :</p>
<ul class="small simple">
<li>advertising, design, entertainment, games,...</li>
<li>BUT : most ray tracers just render images</li>
</ul>
<p class="small"><strong>Ray-geometry intersection</strong></p>
<ul class="small simple">
<li>hw+sw continuously optimized over 30 years</li>
<li>performance &gt; 100M intersections per second per GPU</li>
</ul>
<pre class="mypre">

</pre><dl class="small docutils">
<dt><strong>rasterization</strong></dt>
<dd>project 3D primitives onto 2D image plane, combine fragments into pixel values</dd>
<dt><strong>ray tracing</strong></dt>
<dd>cast rays thru image pixels into scene, recursively reflect/refract at
intersects, combine returns into pixel values</dd>
</dl>
</div>
<div class="slide" id="nvidia-optix-ray-tracing-engine-http-developer-nvidia-com-optix">
<h1><span class="small">NVIDIA® OptiX™ Ray Tracing Engine -- http://developer.nvidia.com/optix</span></h1>
<div class="sidebar">
<p class="first sidebar-title">OptiX Raytracing Pipeline</p>
<p class="small">Analogous to OpenGL rasterization pipeline:</p>
<img alt="/env/optix/docs/optix-model.png" class="last align-right" src="/env/optix/docs/optix-model.png" style="width: 450px;" />
</div>
<p class="small"><strong>OptiX makes GPU ray tracing accessible</strong></p>
<ul class="small simple">
<li><strong>accelerates</strong> ray-geometry intersections</li>
<li>simple : single-ray programming model</li>
<li>&quot;...free to use within any application...&quot;</li>
</ul>
<p class="small"><strong>NVIDIA expertise:</strong></p>
<ul class="small simple">
<li>~linear scaling with CUDA cores across multiple GPUs</li>
<li>acceleration structure creation + traversal (Blue)</li>
<li>instanced sharing of geometry + acceleration structures</li>
<li><span class="red">compiler optimized for GPU ray tracing</span></li>
<li>regular updates, profit from new GPU features:<ul>
<li>NVIDIA RTX™ with Volta GPUs</li>
</ul>
</li>
</ul>
<p class="tiny"><tt class="docutils literal"><span class="pre">https://developer.nvidia.com/rtx</span></tt></p>
<p class="small"><strong>User provides (Yellow):</strong></p>
<ul class="small simple">
<li>ray generation</li>
<li>geometry bounding box, intersects</li>
</ul>
</div>
<div class="slide" id="opticks-gpu-geometry-starts-from-ray-primitive-intersection">
<h1><span class="small">Opticks : GPU Geometry starts from ray-primitive intersection</span></h1>
<ul class="small simple">
<li>3D parametric ray : <strong>ray(x,y,z;t) = rayOrigin  +  t * rayDirection</strong></li>
<li>implicit equation of primitive : <strong>f(x,y,z) = 0</strong></li>
<li>-&gt; polynomial in <strong>t</strong> , roots: <strong>t &gt; t_min</strong>  -&gt; intersection positions + surface normals</li>
</ul>
<div class="figure align-center">
<img alt="/env/presentation/tboolean_parade_sep2017.png" src="/env/presentation/tboolean_parade_sep2017.png" style="width: 900px;" />
<p class="caption"><span class="red">CUDA/OptiX intersection for ~10 primitives</span> -&gt; <span class="blue">Exact geometry translation</span></p>
</div>
</div>
<div class="slide" id="ray-intersection-with-general-csg-binary-trees-on-gpu">
<h1><span class="small">Ray intersection with general CSG binary trees, on GPU</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Outside/Inside Unions</p>
<p class="small">dot(normal,rayDir) -&gt; Enter/Exit</p>
<img alt="/env/presentation/kensler_union_of_two_spheres_from_outside.png" class="align-center" src="/env/presentation/kensler_union_of_two_spheres_from_outside.png" style="width: 300px;" />
<img alt="/env/presentation/kensler_union_of_two_spheres_from_inside.png" class="align-center" src="/env/presentation/kensler_union_of_two_spheres_from_inside.png" style="width: 300px;" />
<ul class="small last simple">
<li><strong>A + B</strong> boundary not inside other</li>
<li><strong>A * B</strong> boundary inside other</li>
</ul>
</div>
<p class="small">Pick between pairs of nearest intersects, eg:</p>
<table border="1" class="small docutils">
<colgroup>
<col width="37%" />
<col width="17%" />
<col width="24%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><em>UNION</em> tA &lt; tB</th>
<th class="head">Enter B</th>
<th class="head">Exit B</th>
<th class="head">Miss B</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><strong>Enter A</strong></td>
<td>ReturnA</td>
<td><span class="blue">LoopA</span></td>
<td>ReturnA</td>
</tr>
<tr><td><strong>Exit A</strong></td>
<td>ReturnA</td>
<td>ReturnB</td>
<td>ReturnA</td>
</tr>
<tr><td><strong>Miss A</strong></td>
<td>ReturnB</td>
<td>ReturnB</td>
<td>ReturnMiss</td>
</tr>
</tbody>
</table>
<ul class="small simple">
<li><em>Nearest hit intersect algorithm</em> [1] avoids state<ul>
<li>sometimes <span class="blue">Loop</span> : advance <strong>t_min</strong> , re-intersect both</li>
<li>classification shows if inside/outside</li>
</ul>
</li>
<li><em>Evaluative</em> [2] implementation emulates recursion:<ul>
<li><span class="red">recursion not allowed</span> in OptiX intersect programs</li>
<li>bit twiddle traversal of complete binary tree</li>
<li>stacks of postorder slices and intersects</li>
</ul>
</li>
<li><span class="red">Identical geometry to Geant4</span><ul>
<li>solving the same polynomials</li>
<li>near perfect intersection match</li>
</ul>
</li>
</ul>
<dl class="tiny docutils">
<dt>[1] Ray Tracing CSG Objects Using Single Hit Intersections, Andrew Kensler (2006)</dt>
<dd>with corrections by author of XRT Raytracer <a class="reference external" href="http://xrt.wikidot.com/doc:csg">http://xrt.wikidot.com/doc:csg</a></dd>
<dt>[2] <a class="reference external" href="https://bitbucket.org/simoncblyth/opticks/src/tip/optixrap/cu/csg_intersect_boolean.h">https://bitbucket.org/simoncblyth/opticks/src/tip/optixrap/cu/csg_intersect_boolean.h</a></dt>
<dd>Similar to binary expression tree evaluation using postorder traverse.</dd>
</dl>
</div>
<div class="slide" id="csg-complete-binary-tree-serialization-simplifies-gpu-side">
<h1><span class="small">CSG Complete Binary Tree Serialization -&gt; simplifies GPU side</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Bit Twiddling Navigation</p>
<ul class="small last simple">
<li>parent(i) = i/2 = i &gt;&gt; 1</li>
<li>leftchild(i) = 2*i = i &lt;&lt; 1</li>
<li>rightchild(i) = 2*i + 1 = (i &lt;&lt; 1) + 1</li>
<li>leftmost(height)  =  1 &lt;&lt; height</li>
</ul>
</div>
<p class="small">Geant4 solid -&gt; CSG binary tree (leaf primitives, non-leaf operators, 4x4 transforms on any node)</p>
<p class="small">Serialize to <strong>complete binary tree</strong> buffer:</p>
<ul class="small simple">
<li>no need to deserialize, no child/parent pointers</li>
<li>bit twiddling navigation <span class="red">avoids recursion</span></li>
<li>simple approach profits from small size of binary trees</li>
<li>BUT: very inefficient when unbalanced</li>
</ul>
<p class="small"><strong>Height 3 complete binary tree with level order indices:</strong></p>
<pre class="mypre">
                                                   depth     elevation

                     1                               0           3

          10                   11                    1           2

     100       101        110        111             2           1

 1000 1001  1010 1011  1100 1101  1110  1111         3           0
</pre>
<hr/><p class="small"><strong>postorder_next(i,elevation) = i &amp; 1 ? i &gt;&gt; 1 : (i &lt;&lt; elevation) + (1 &lt;&lt; elevation) ;</strong>   // from pattern of bits</p>
<p class="tiny">Postorder tree traverse visits all nodes, starting from leftmost, such that children
are visited prior to their parents.</p>
</div>
<div class="slide" id="opticks-analytic-juno-chimney-gpu-raytrace-0">
<h1><span class="i">Opticks Analytic JUNO Chimney, GPU Raytrace (0)</span></h1>
<p><tt class="docutils literal">JUNO Chimney at top of Central Detector Scintillator</tt></p>
</div>
<div class="slide" id="opticks-translates-g4-geometry-to-gpu-without-approximation">
<h1><span class="small">Opticks : translates G4 geometry to GPU, without approximation</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Volumes -&gt; Boundaries</p>
<p class="small"><strong>Ray tracing favors Boundaries</strong></p>
<p class="small">Material/surface boundary : 4 indices</p>
<ul class="small simple">
<li>outer material (parent)</li>
<li>outer surface (inward photons, parent -&gt; self)</li>
<li>inner surface (outward photons, self -&gt; parent)</li>
<li>inner material (self)</li>
</ul>
<p class="small">Primitives labelled with unique boundary index</p>
<ul class="small last simple">
<li>ray primitive intersection -&gt; boundary index</li>
<li>texture lookup -&gt; material/surface properties</li>
</ul>
</div>
<dl class="small docutils">
<dt><strong>Direct Geometry : Geant4 &quot;World&quot; -&gt; Opticks CSG -&gt; GPU</strong></dt>
<dd><ul class="first last simple">
<li>simpler : no G4DAE+GDML export/import</li>
</ul>
</dd>
<dt><strong>Material/Surface/Scintillator properties</strong></dt>
<dd><ul class="first last simple">
<li>interpolated to standard wavelength domain</li>
<li>interleaved into &quot;boundary&quot; texture</li>
<li>&quot;reemission&quot; texture for wavelength generation</li>
</ul>
</dd>
<dt><strong>Structure</strong></dt>
<dd><ul class="first last simple">
<li>repeated geometry instances identified (progeny digests)</li>
<li>instance transforms used in OptiX/OpenGL geometry</li>
<li>merge CSG trees into global + instance buffers</li>
<li>export meshes to glTF 2.0 for 3D visualization</li>
</ul>
</dd>
<dt><strong>Ease of Use</strong></dt>
<dd><ul class="first last simple">
<li>easy geometry : just handover &quot;World&quot;</li>
<li>easy config : modern CMake + BCM[1]</li>
<li>~easy event :  modify G4Cerenkov + G4Scintillation</li>
</ul>
</dd>
</dl>
<p class="tiny small">[1] Boost CMake 3.5+ modules : configure direct dependencies only</p>
<p class="tiny small"><a class="reference external" href="https://github.com/BoostCMake/cmake_modules">https://github.com/BoostCMake/cmake_modules</a></p>
<p class="tiny small"><a class="reference external" href="https://github.com/simoncblyth/bcm">https://github.com/simoncblyth/bcm</a></p>
</div>
<div class="slide" id="opticks-export-of-g4-geometry-to-gltf-2-0">
<h1><tt class="docutils literal">Opticks Export of G4 geometry to glTF 2.0</tt></h1>
<div class="sidebar">
<p class="first sidebar-title">Emerging 3D Standard</p>
<blockquote>
&quot;JPEG&quot; of 3D</blockquote>
<img alt="/env/presentation/gltf.png" class="align-center" src="/env/presentation/gltf.png" style="width: 300px;" />
<dl class="small last docutils">
<dt><strong>Growing Adoption</strong></dt>
<dd><a class="reference external" href="https://github.com/KhronosGroup/glTF">https://github.com/KhronosGroup/glTF</a>
<a class="reference external" href="https://www.khronos.org/gltf/">https://www.khronos.org/gltf/</a></dd>
<dt><strong>&lt;-- eg:Metal Renderer from GLTFKit</strong></dt>
<dd><a class="reference external" href="https://github.com/warrenm/GLTFKit">https://github.com/warrenm/GLTFKit</a></dd>
<dt><strong>Similar to Opticks geocache</strong></dt>
<dd>JSON + binary buffers (eg NPY)</dd>
</dl>
</div>
</div>
<div class="slide" id="opticks-translates-g4-optical-physics-to-gpu">
<h1><span class="small">Opticks : translates G4 optical physics to GPU</span></h1>
<div class="sidebar">
<p class="first sidebar-title">GPU Resident Photons</p>
<dl class="small docutils">
<dt><strong>Seeded on GPU</strong></dt>
<dd>associate photons -&gt; <em>gensteps</em> (via seed buffer)</dd>
<dt><strong>Generated on GPU, using genstep param:</strong></dt>
<dd><ul class="first last simple">
<li>number of photons to generate</li>
<li>start/end position of step</li>
</ul>
</dd>
<dt><strong>Propagated on GPU</strong></dt>
<dd><span class="red">Only photons hitting PMTs copied to CPU</span></dd>
</dl>
<p class="small">Thrust: <strong>high level C++ access to CUDA</strong></p>
<div class="small figure align-right">
<img alt="/env/numerics/thrust/thrust.png" src="/env/numerics/thrust/thrust.png" style="width: 300px;" />
</div>
<ul class="small last simple">
<li><a class="reference external" href="https://developer.nvidia.com/Thrust">https://developer.nvidia.com/Thrust</a></li>
</ul>
</div>
<p class="small"><span class="blue">OptiX : single-ray programming model</span> -&gt; line-by-line translation</p>
<dl class="small docutils">
<dt><strong>CUDA Ports of Geant4 classes</strong></dt>
<dd><ul class="first last simple">
<li>G4Cerenkov (only generation loop)</li>
<li>G4Scintillation (only generation loop)</li>
<li>G4OpAbsorption</li>
<li>G4OpRayleigh</li>
<li>G4OpBoundaryProcess (only a few surface types)</li>
</ul>
</dd>
<dt><strong>Modify Cerenkov + Scintillation Processes</strong></dt>
<dd><ul class="first last simple">
<li>collect <em>genstep</em>, copy to GPU for generation</li>
<li><span class="red">avoids copying millions of photons to GPU</span></li>
</ul>
</dd>
<dt><strong>Scintillator Reemission</strong></dt>
<dd><ul class="first last simple">
<li>fraction of bulk absorbed &quot;reborn&quot; within same thread</li>
<li>wavelength generated by reemission texture lookup</li>
</ul>
</dd>
<dt><strong>Opticks (OptiX/Thrust GPU interoperation)</strong></dt>
<dd><ul class="first last simple">
<li><strong>OptiX</strong> : upload gensteps</li>
<li><strong>Thrust</strong> : seeding, distribute genstep indices to photons</li>
<li><strong>OptiX</strong> : launch photon generation and propagation</li>
<li><strong>Thrust</strong> : pullback photons that hit PMTs</li>
<li><strong>Thrust</strong> : index photon step sequences (optional)</li>
</ul>
</dd>
</dl>
</div>
<div class="slide" id="validation-aligning-cpu-and-gpu-simulations">
<h1><span class="small">Validation : Aligning CPU and GPU Simulations</span></h1>
<div class="sidebar">
<p class="first sidebar-title">lldb python scripting</p>
<ul class="small simple">
<li>access C++ program state from python</li>
<li>step-by-step compare photon parameters with expectations, break at deviations</li>
</ul>
<p class="small">Auto-configure breakpoints using code markers:</p>
<p class="small"><tt class="docutils literal">opticks/tools/autobreakpoint.py</tt>
<tt class="docutils literal">opticks/tools/g4lldb.py</tt></p>
<p class="small"><strong>Ubiquitous Data access with NPY</strong></p>
<p class="small last">All Opticks data managed in NumPy buffers,
easy access from python,C++,CUDA,lldb-python</p>
</div>
<p class="small"><strong>Aligned zipping together of code and RNG values</strong></p>
<ul class="small simple">
<li>common input photon sample generated on <strong>CPU</strong></li>
<li>random number sequences generated on <strong>GPU</strong> (cuRAND)
and persisted to file (NPY buffers)</li>
</ul>
<p class="small">Single executable <tt class="docutils literal">lldb OKG4Test</tt>:</p>
<ol class="small arabic simple">
<li>run Opticks GPU simulation, persist event</li>
<li>run Geant4 simulation<ul>
<li>step-by-step check each G4 photon follows Opticks
history and parameters, break at deviations</li>
</ul>
</li>
<li>fix cause of misaligned RNG consumption, or other deviation<ul>
<li>tricks needed on both sides : burning RNGs, jump backs</li>
</ul>
</li>
</ol>
<p class="small"><strong>Payoff :</strong>  <span class="red">simplest possible direct comparison validation</span></p>
<p class="tiny"><a class="reference external" href="http://bitbucket.com/simoncblyth/opticks/src/tip/tools/autobreakpoint.py">http://bitbucket.com/simoncblyth/opticks/src/tip/tools/autobreakpoint.py</a></p>
<p class="tiny">(lldb) help breakpoint command add</p>
</div>
<div class="slide" id="validation-direct-comparison-of-gpu-cpu-numpy-arrays">
<h1><span class="small">Validation : Direct comparison of GPU/CPU NumPy arrays</span></h1>
<div class="sidebar">
<p class="first sidebar-title">CPU/GPU matching</p>
<dl class="small last docutils">
<dt><strong>Simple geometries</strong></dt>
<dd>same geometry, same physics, same results</dd>
<dt><strong>Full geometries</strong></dt>
<dd>aligned running will find geometry issues
eg coincident surface ambiguity</dd>
<dt><strong>NEXT:</strong></dt>
<dd>align generation, reemission, more geometries</dd>
</dl>
</div>
<p class="small"><strong>tboolean-box simple geometry test</strong></p>
<ul class="small simple">
<li>100k photons : position, time, polarization : 1.2M floats</li>
<li>34 deviations &gt; 1e-4 (mm or ns), largest 4e-4</li>
<li>deviants all involve scattering (more flops?)</li>
</ul>
<pre class="mypretiny">

In [11]: pdv = np.where(dv > 0.0001)[0]
In [12]: ab.dumpline(pdv)
      0   1230 : TO BR SC BT BR BT SA
      1   2413 : TO BT BT SC BT BR BR BT SA
      2   9041 : TO BT SC BR BR BR BR BT SA
      3  14510 : TO SC BT BR BR BT SA
      4  14747 : TO BT SC BR BR BR BR BR BR BR
      5  14747 : TO BT SC BR BR BR BR BR BR BR
    ...

In [20]: ab.b.ox[pdv,0]                                 In [21]: ab.a.ox[pdv,0]
Out[20]:                                                Out[21]:
A()sliced                                               A()sliced
A([    [-191.6262, -240.3634,  450.    ,    5.566 ],    A([    [-191.626 , -240.3634,  450.    ,    5.566 ],
       [ 185.7708, -133.8457,  450.    ,    7.3141],           [ 185.7708, -133.8456,  450.    ,    7.3141],
       [-450.    , -104.4142,  311.143 ,    9.0581],           [-450.    , -104.4142,  311.1431,    9.0581],
       [  83.6955,  208.9171, -450.    ,    5.6188],           [  83.6954,  208.9172, -450.    ,    5.6188],
       [  32.8972,  150.    ,   24.9922,    7.6757],           [  32.8973,  150.    ,   24.992 ,    7.6757],
       [  32.8972,  150.    ,   24.9922,    7.6757],           [  32.8973,  150.    ,   24.992 ,    7.6757],
       [ 450.    , -186.7449,  310.6051,    5.0707],           [ 450.    , -186.7451,  310.605 ,    5.0707],
       [ 299.2227,  318.1443, -450.    ,    4.8717],           [ 299.2229,  318.144 , -450.    ,    4.8717],
 ...
</pre><p class="tiny"><a class="reference external" href="http://bitbucket.com/simoncblyth/opticks/src/tip/notes/issues/tboolean_box_perfect_alignment_small_deviations.rst">http://bitbucket.com/simoncblyth/opticks/src/tip/notes/issues/tboolean_box_perfect_alignment_small_deviations.rst</a></p>
</div>
<div class="slide" id="coincident-faces-are-primary-cause-of-issues-spurious-intersects">
<h1><span class="small">Coincident Faces are Primary Cause of Issues : Spurious Intersects</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Cylinder - Cone</p>
<p class="small">Coincident endcaps -&gt; spurious intersects</p>
<img alt="/env/opticks_refs/lvidx_83_tbool_coincidence_artifact_at_cylinder_base.png" class="align-center" src="/env/opticks_refs/lvidx_83_tbool_coincidence_artifact_at_cylinder_base.png" style="width: 450px;" />
<p class="small last">Grow subtracted cone downwards, avoids coincidence : <strong>does not change composite solid</strong></p>
</div>
<p class="small">Coincidences common (alignment too tempting?). To fix:</p>
<ul class="small simple">
<li><strong>A-B</strong> : grow correct dimension of subtracted shape</li>
<li><strong>A+B</strong> : grow smaller interface shape into bigger, making join</li>
<li><span class="red">case-by-case fixes straightforward, not so easy to automate</span></li>
<li>WIP: automated coincidence finder/fixer</li>
</ul>
<img alt="/env/opticks_refs/opticks_tscan_29_nzero_5_OcrGdsPrt.png" class="small align-left" src="/env/opticks_refs/opticks_tscan_29_nzero_5_OcrGdsPrt.png" style="width: 500px;" />
</div>
<div class="slide" id="opticks-2018-july-nov-steps-into-production">
<h1><span class="small">Opticks 2018 July-Nov : Steps into Production</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><em>G4OK</em> Interface Package</p>
<p class="small">Interface G4 user code to embedded Opticks</p>
<ul class="small last simple">
<li>BeginOfRun : pass &quot;World&quot; to Opticks</li>
<li>G4Cerenkov+Scintillation : collect gensteps</li>
<li>EndOfEvent : populate hit collections</li>
</ul>
</div>
<div class="sidebar">
<p class="first sidebar-title">Production Simplified ?</p>
<p class="small"><strong>Opticks Docker Container</strong></p>
<ul class="small simple">
<li>Users from LZ (dark matter expt) are trying</li>
<li>installation difficulties &quot;contained&quot;</li>
</ul>
<p class="small"><strong>Distributed GPU jobs ?</strong></p>
<ul class="small last simple">
<li>CVMFS ? Event Storage ? Bookkeeping ?</li>
</ul>
</div>
<p class="small"><strong>Development Plan</strong></p>
<ul class="small simple">
<li>debug+validate direct geometry translation</li>
<li>extend aligned running to generation (perhaps reemission)<ul>
<li>-&gt; input gensteps, not photons</li>
</ul>
</li>
<li>finalize <em>G4OK</em> for Geant4 extended optical example</li>
</ul>
<p class="small"><strong>Validation Plan : using millions of photons</strong></p>
<p class="small">Aligned <em>bi-simulation</em> to <span class="red">find/fix discrepancies</span></p>
<ol class="small arabic simple">
<li>all JUNO solids individually (via code generation)</li>
<li>full JUNO geometry + sub-trees with issues</li>
</ol>
<p class="small"><strong>Production Plan</strong></p>
<ul class="small simple">
<li>apply <em>G4OK</em> integration to JUNO simulation</li>
<li>performance testing on GPU server, workstation</li>
<li>small scale deployment [IHEP, SDU] (improve scripts)</li>
<li>wider deployment : <strong>CAN YOU HELP ?</strong><ul>
<li>need recent NVIDIA GPU workstation or server</li>
</ul>
</li>
</ul>
<!-- comment

* tentative Windows port : for G4 example + GPU tools
* add tests, currently : ~330 unit tests, ~30 integration tests

  * -> reduce surprises from OptiX/Geant4 updates -->
</div>
<div class="slide" id="opticks-visualization-potential-realistic-images-video-vr">
<h1><span class="small">Opticks Visualization Potential : realistic Images/Video/VR</span></h1>
<p class="small">Opticks GPU optimized geometry +  <strong>GPU processing explosion</strong> : ripe with possibilities</p>
<div class="sidebar">
<p class="first sidebar-title">glTF 3D file format</p>
<p class="small">Supported by many tools:</p>
<ul class="small simple">
<li>renderers (OpenGL/DirectX/Vulkan/Metal)</li>
<li>game engines (Unity/Unreal)</li>
<li>Virtual/Augmented Reality systems</li>
</ul>
<p class="small"><span class="red">Opticks can now export glTF 2.0</span></p>
<p class="small last"><strong>glTF standard -&gt; shortcut to future</strong></p>
</div>
<ul class="small simple">
<li>Outreach/Education : realistic Images/Video/VR<ul>
<li>attract students</li>
<li>interest public</li>
<li>engage visitors</li>
<li><span class="red">ATLAS/CMS/BelleII all using VR for Outreach</span></li>
</ul>
</li>
</ul>
<img alt="/env/presentation/1px.png" class="small" src="/env/presentation/1px.png" style="width: 500px; height: 1px;" />
<ul class="small simple">
<li>VR Tools : analyse/monitor/learn from &quot;inside detector&quot;<ul>
<li>shifts : experience the physics, see the dataflow</li>
<li>algorithms : watch the performance</li>
<li>play with G4Gun inside the scintillator</li>
</ul>
</li>
</ul>
<img alt="/env/presentation/1px.png" class="small" src="/env/presentation/1px.png" style="width: 1000px; height: 10px;" />
<p class="small"><strong>Direct/natural interfaces are possible now(1)</strong> : just needs imagination, time to apply the technology</p>
<ul class="small simple">
<li>Engage &quot;direct&quot; experience -&gt; more understanding for more people</li>
</ul>
<ol class="tiny arabic simple">
<li>Try Google Tiltbrush 3D painting app on HTC Vive VR</li>
</ol>
</div>
<div class="slide" id="opticks-beyond-simulation-cradle-for-gpu-reconstruction-studies">
<h1><span class="small">Opticks Beyond Simulation</span> : <em>cradle</em> <span class="small">for GPU reconstruction studies</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Modular ~20 packages</p>
<p class="small">Many <span class="red">reusable + general</span> tools:</p>
<ul class="small simple">
<li>CPU buffer persistency</li>
<li>GPU buffer handling via CUDA+Thrust</li>
<li>visualize results within geometry</li>
</ul>
<p class="small">Modern CMake advantage:</p>
<ul class="small last simple">
<li>configure against chosen direct dependency,
required subtree configured automatically</li>
</ul>
</div>
<ul class="tiny simple">
<li><em>OKConf</em> : detects versions of Geant4, OptiX available</li>
<li><em>SysRap</em> : <span class="red">low level system utils</span></li>
<li><em>BoostRap</em> : <span class="red">wrapper for boost file_system, program_options etc...</span></li>
<li><em>NPY</em> : <span class="red">numerical workhorse sub-project</span><ul>
<li><span class="red">buffer persistency in NumPy format</span></li>
<li>mesh handling/polygonization</li>
<li>nnode, NCSG : CSG node tree representation of geometry</li>
</ul>
</li>
<li><em>YoctoGLRap</em> : wrapper for the YoctoGL external, glTF 2.0 3D parsing/writing</li>
<li><em>OpticksCore</em> : <span class="red">commandline parsing, app config/steering</span></li>
<li><em>GGeo</em> : Opticks geometry model ready for translation to GPU</li>
<li><em>ExtG4</em> : translates Geant4 solids into NCSG trees and Geant4 trees of volumes into GGeo geometries</li>
<li><em>AssimpRap</em> : wrapper for Assimp 3D geometry importer, can load G4DAE COLLADA geometry files</li>
<li><em>OpenMeshRap</em> : wrapper for OpenMesh, providing mesh traversal : used for mesh fixing</li>
<li><em>OpticksGeo</em> : OpticksHub : non-viz hostside intersection of configuraton, geometry and event</li>
<li><em>CUDARap</em> : <span class="red">wrapper for CUDA, used for RNG seed generation/persistance</span></li>
<li><em>ThrustRap</em> : <span class="red">wrapper for Thrust (higher level C++ access to CUDA)</span>, used for<ul>
<li>photon seeding(associating photon &quot;slots&quot; with their gensteps prior to generation)</li>
<li><span class="red">general buffer tools</span> eg used for copying back the hits</li>
</ul>
</li>
<li><em>OptiXRap</em> : wrapper for OptiX<ul>
<li>CUDA code for primitive and CSG intersection</li>
<li>converts GGeo geometry into OptiX geometry, using OGeo</li>
<li>sets up OptiX context using OScene, OEvent</li>
<li>provides OptiX GPU launcher in OPropagator</li>
</ul>
</li>
<li><em>OGLRap</em> : <span class="red">wrapper for OpenGL, visualization of geometry and photon propagations</span></li>
<li><em>OKOP</em> : pure compute propagation, with no OpenGL dependency</li>
<li><em>OpticksGL</em> : OpenGL/OptiX/CUDA interop propagation using shared OpenGL buffers</li>
<li><em>OK</em> : <span class="red">high level manager with OpenGL visualization</span></li>
<li><em>CFG4</em> : comparison of Opticks and Geant4 photon propagations</li>
<li><em>OKG4</em> : top level with visualization project intended for Opticks with Geant4 embedded</li>
<li><em>G4OK</em> : top level (non-visualization) project interfacing between Geant4 user code and  embedded Opticks</li>
</ul>
</div>
<div class="slide" id="summary">
<h1><span class="small">Summary</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Highlights</p>
<ul class="small last simple">
<li><strong>identical GPU geometry, auto-translated</strong></li>
<li>aligned running -&gt; simple validation</li>
<li>expect: <strong>Opticks &gt; 1000x Geant4</strong> (with workstation GPUs)</li>
<li>more photons -&gt; more overall speedup<ul>
<li>99% -&gt; 100x</li>
</ul>
</li>
</ul>
</div>
<img alt="/env/presentation/1px.png" src="/env/presentation/1px.png" style="width: 500px; height: 50px;" />
<!--  -->
<blockquote>
<p><em>Opticks</em> enables <em>Geant4</em> based simulations to benefit from
<strong>effectively zero time and zero CPU memory</strong> optical photon simulation,
due to massive parallelism made accessible by NVIDIA OptiX.</p>
<img alt="/env/presentation/1px.png" src="/env/presentation/1px.png" style="width: 1000px; height: 10px;" />
<ul class="simple">
<li>Drastic speedup -&gt; better detector understanding -&gt; greater precision</li>
<li>Performance discontinuity -&gt; new possibilities -&gt; imagination required</li>
</ul>
<img alt="/env/presentation/1px.png" src="/env/presentation/1px.png" style="width: 1000px; height: 10px;" />
<p class="small">Subscribe to stay informed on Opticks:</p>
<p class="huge"><a class="reference external" href="mailto:opticks+subscribe&#64;groups.io">opticks+subscribe&#64;groups.io</a></p>
<p class="huge"><a class="reference external" href="https://groups.io/g/opticks">https://groups.io/g/opticks</a></p>
<p class="huge"><a class="reference external" href="https://bitbucket.org/simoncblyth/opticks">https://bitbucket.org/simoncblyth/opticks</a></p>
</blockquote>
</div>
<div class="slide" id="nvidia-titan-v">
<h1><span class="i">NVIDIA TITAN V</span></h1>
</div>
<div class="slide" id="nvidia-titan-v-2">
<h1><span class="i">NVIDIA TITAN V (2)</span></h1>
<div class="sidebar">
<p class="first sidebar-title">NVIDIA TITAN V (Volta)</p>
<table border="1" class="small docutils">
<colgroup>
<col width="53%" />
<col width="47%" />
</colgroup>
<tbody valign="top">
<tr><td>CUDA cores</td>
<td><strong>5120</strong></td>
</tr>
<tr><td>Tensor cores</td>
<td>640</td>
</tr>
<tr><td>Transistors</td>
<td>21 Billion</td>
</tr>
<tr><td>VRAM</td>
<td>12 GB</td>
</tr>
<tr><td>Single Precision</td>
<td>13.8 TFLOPS</td>
</tr>
<tr><td>Double Precision</td>
<td>6.9 TFLOPS</td>
</tr>
<tr><td>Launch</td>
<td>2017/12/07</td>
</tr>
<tr><td>Price</td>
<td>2999 USD</td>
</tr>
<tr><td>GPU</td>
<td>GV100 (815mm2)</td>
</tr>
</tbody>
</table>
<p class="small">&quot;salvage part&quot; from <em>Tesla V100</em> server, same GV100</p>
<ul class="small simple">
<li>less VRAM, graphics enabled, 1/3 price</li>
</ul>
<p class="small last"><strong>Volta GPUs : Recommended for Opticks</strong></p>
</div>
</div>
<div class="slide" id="opticks-users-group">
<h1><span class="i">Opticks Users Group</span></h1>
<div class="sidebar">
<p class="first sidebar-title"><tt class="docutils literal"><span class="pre">https://groups.io/g/opticks</span></tt></p>
<ul class="small last simple">
<li>Post : <tt class="docutils literal">opticks&#64;groups.io</tt></li>
<li><tt class="docutils literal">opticks+subscribe&#64;groups.io</tt></li>
</ul>
</div>
</div>
<div class="slide" id="list-of-backup-slides">
<h1><span class="small">List of &quot;backup&quot; slides</span></h1>
<p class="tiny"><strong>CSG</strong></p>
<ul class="tiny simple">
<li>Constructive Solid Geometry (CSG) : Shapes defined &quot;by construction&quot;</li>
<li>CSG : Which primitive intersect to pick</li>
<li>Ray Tracing CSG Objects Using Single Hit Intersections (A. Kensler)</li>
<li>CSG Complete Binary Tree Serialization -&gt; simplifies GPU side</li>
<li>Evaluative CSG intersection Pseudocode : recursion emulated</li>
<li>Opticks CSG Primitives : Closed Solids, Consistent Normals</li>
<li>Opticks CSG Primitives : What is included</li>
<li>Opticks CSG : Balancing Deep Trees Drastically Improves Performance</li>
<li>Dayabay ESR reflector : Deep CSG tree : disc with 9 holes</li>
<li>Opticks CSG Serialized into OpticksCSG format (numpy buffers, json)</li>
</ul>
<p class="tiny"><strong>Validation</strong></p>
<ul class="tiny simple">
<li>tconcentric : spherical GdLS/LS/MineralOil</li>
<li>tconcentric : Opticks/Geant4 chi2 comparison</li>
<li>tconcentric : Opticks/Geant4 distrib chi2/df ~ 1.0</li>
<li>PMT Opticks/Geant4 step distribution comparison TO BT [SD]</li>
<li>PMT Opticks/Geant4 step distribution comparison : chi2/ndf</li>
<li>Opticks/Geant4 Rainbow Step Sequence Comparison</li>
<li>1M Rainbow S-Polarized, Comparison Opticks/Geant4</li>
<li>Compare Opticks/Geant4 Simulations with Simple Lights/Geometries</li>
</ul>
<p class="tiny"><strong>Misc</strong></p>
<ul class="tiny simple">
<li>OptiX Performance Scaling with GPU cores</li>
<li>Torus : much more difficult/expensive than other primitives</li>
<li>Geometry Modelling : Tesselated vs Analytic Photomultiplier Tubes</li>
<li>Hybrid Geant4/Opticks Event Workflow</li>
<li>Open Source Opticks</li>
</ul>
</div>
<div class="slide" id="idealized-geometry-tests-photon-generation-propagation-reemission">
<h1><span class="small">Idealized geometry tests : photon generation, propagation, reemission</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Match achieved after many fixes</p>
<ul class="small simple">
<li>scattering, was comparing different implementations</li>
<li>diffuse reflection, ported G4 approach</li>
<li>reemission &quot;rejoining&quot;</li>
<li>missing optical surfaces</li>
<li>truncation recording discrepancy</li>
<li>group velocity of wrong material after refraction (G4 issue 1275)</li>
<li>interpolation mismatches</li>
</ul>
<p class="small last"><span class="red">Work guided by the next largest chi2 contributor</span></p>
</div>
<p class="small"><strong>Idealized &quot;tconcentric&quot; scintillator detector avoids any geometry issues, tests optical physics in isolation</strong></p>
<p class="small">Single executable (cfg4 package):</p>
<ul class="small simple">
<li>performs both pure G4 and hybrid G4+Opticks simulations</li>
<li>writes two events recording up to 16 steps of each photon</li>
<li>photons indexed on GPU by history and material sequences</li>
<li>history category counts comparison, Opticks/G4 chi2/df ~ 1.0</li>
<li>position, time, polarization, wavelength recorded at each step</li>
</ul>
<p class="small">point-by-point chi2-distance comparisons of 8 photon properties for top 100 history categories</p>
<ul class="small simple">
<li>details in backup</li>
</ul>
<p class="small"><strong>NEXT STEPS</strong></p>
<ul class="small simple">
<li>JUNO integration + full JUNO geometry validation</li>
</ul>
<p class="tiny"><a class="reference external" href="https://bugzilla-geant4.kek.jp/show_bug.cgi?id=1275">https://bugzilla-geant4.kek.jp/show_bug.cgi?id=1275</a></p>
</div>
<div class="slide" id="photon-propagation-times-geant4-cf-opticks">
<h1><span class="small">Photon Propagation Times Geant4 cf Opticks</span></h1>
<img alt="/env/optix/cfg4/PmtInBox-cfg4-2.png" class="align-center" src="/env/optix/cfg4/PmtInBox-cfg4-2.png" style="width: 800px;" />
<table border="1" class="small docutils">
<colgroup>
<col width="28%" />
<col width="24%" />
<col width="24%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Test</th>
<th class="head">Geant4 10.2</th>
<th class="head">Opticks Interop</th>
<th class="head">Opticks Compute</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Rainbow 1M(S)</td>
<td>56 s</td>
<td>1.62 s</td>
<td>0.28 s</td>
</tr>
<tr><td>Rainbow 1M(P)</td>
<td>58 s</td>
<td>1.71 s</td>
<td>0.25 s</td>
</tr>
<tr><td><strong>PmtInBox 0.5M</strong></td>
<td><strong>41 s</strong></td>
<td>0.81 s</td>
<td><strong>0.15 s</strong></td>
</tr>
</tbody>
</table>
<ul class="small simple">
<li><strong>Opticks &gt; 200X Geant4</strong> with only 384 core mobile GPU[1] (multi-GPU workstation up to 20x more cores)</li>
</ul>
<ul class="small simple">
<li><strong>Interop</strong> uses OpenGL buffers allowing visualization, <strong>Compute</strong> uses OptiX buffers</li>
<li><strong>Interop/Compute</strong> : perfectly identical results, monitored by digest</li>
</ul>
<p class="tiny">[1] MacBook Pro (2013), NVIDIA GeForce GT 750M, 2048 MB, 384 cores</p>
</div>
<div class="slide" id="constructive-solid-geometry-csg-shapes-defined-by-construction">
<h1><span class="small">Constructive Solid Geometry (CSG) : Shapes defined &quot;by construction&quot;</span></h1>
<div class="sidebar">
<p class="first sidebar-title">CSG Binary Tree</p>
<img alt="/env/presentation/hanrahan_example_of_solid_object_formed_using_csg.png" class="align-right" src="/env/presentation/hanrahan_example_of_solid_object_formed_using_csg.png" style="width: 450px;" />
<p class="small last">Primitives combined via binary operators</p>
</div>
<p class="small">Simple <em>by construction</em> definition, implicit geometry.</p>
<ul class="small simple">
<li><strong>A, B</strong> implicit primitive <strong>solids</strong></li>
<li><strong>A + B</strong> : union (OR)</li>
<li><strong>A * B</strong> : intersection (AND)</li>
<li><strong>A - B</strong> : difference (AND NOT)</li>
<li><strong>!B</strong> : complement (NOT) (inside &lt;-&gt; outside)</li>
</ul>
<p class="small">CSG expressions</p>
<ul class="small simple">
<li>non-unique: <strong>A - B == A * !B</strong></li>
<li>represented by binary tree, primitives at leaves</li>
</ul>
<p class="small">3D Parametric Ray : <strong>ray(t) = r0 + t rDir</strong></p>
<p class="small"><strong>Ray Geometry Intersection</strong></p>
<ul class="small simple">
<li>primitive : find <em>t</em> roots of implicit eqn</li>
<li>composite : <span class="red">pick</span> primitive intersect, depending on CSG tree</li>
</ul>
<p class="large"><span class="red">How to pick exactly ?</span></p>
</div>
<div class="slide" id="csg-which-primitive-intersect-to-pick">
<h1><span class="small">CSG : Which primitive intersect to pick ?</span></h1>
<div class="sidebar">
<p class="first sidebar-title">In/On/Out transitions</p>
<img alt="/env/presentation/hanrahan_example_of_solid_object_formed_using_csg_roth_diagram.png" class="small last align-right" src="/env/presentation/hanrahan_example_of_solid_object_formed_using_csg_roth_diagram.png" style="width: 450px;" />
</div>
<p class="small">Classical Roth diagram approach</p>
<ul class="small simple">
<li>find all ray/primitive intersects</li>
<li>recursively combine inside intervals using CSG operator</li>
<li>works from leaves upwards</li>
</ul>
<p class="small">Computational requirements:</p>
<ul class="small simple">
<li>find all intersects, store them, order them</li>
<li>recursive traverse</li>
</ul>
<p class="small">BUT : <strong>High performance on GPU requires</strong>:</p>
<ul class="small simple">
<li>massive parallelism -&gt; more the merrier</li>
<li>low register usage -&gt; keep it simple</li>
<li>small stack size -&gt; <strong>avoid recursion</strong></li>
</ul>
<p class="large"><span class="red">Classical approach not appropriate on GPU</span></p>
</div>
<div class="slide" id="id1">
<h1><span class="small">CSG Complete Binary Tree Serialization -&gt; simplifies GPU side</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Bit Twiddling Navigation</p>
<ul class="small last simple">
<li>parent(i) = i/2 = i &gt;&gt; 1</li>
<li>leftchild(i) = 2*i = i &lt;&lt; 1</li>
<li>rightchild(i) = 2*i + 1 = (i &lt;&lt; 1) + 1</li>
<li>leftmost(height)  =  1 &lt;&lt; height</li>
</ul>
</div>
<p class="small">CSG Tree, leaf node primitives, internal node operators, 4x4 transforms on any node,
serialized as <span class="blue">complete binary tree</span>:</p>
<ul class="small simple">
<li>bit twiddling navigation <span class="red">avoids recursion</span></li>
<li>no need to deserialize</li>
<li>no child/parent pointers</li>
<li>BUT: very inefficient when unbalanced</li>
</ul>
<p class="small"><strong>Height 3 complete binary tree with level order indices:</strong></p>
<pre class="mypre">
                                                   depth     elevation

                     1                               0           3

          10                   11                    1           2

     100       101        110        111             2           1

 1000 1001  1010 1011  1100 1101  1110  1111         3           0
</pre>
<hr/><p class="small"><strong>postorder_next(i,elevation) = i &amp; 1 ? i &gt;&gt; 1 : (i &lt;&lt; elevation) + (1 &lt;&lt; elevation) ;</strong>   // from pattern of bits</p>
<p class="tiny">Postorder tree traverse visits all nodes, starting from leftmost, such that children
are visited prior to their parents.</p>
</div>
<div class="slide" id="evaluative-csg-intersection-pseudocode-recursion-emulated">
<h1><span class="small">Evaluative CSG intersection Pseudocode : recursion emulated</span></h1>
<pre class="mypretiny">
fullTree = PACK( 1 << height, 1 >> 1 )  // leftmost, parent_of_root(=0)
tranche.push(fullTree, ray.tmin)

while (!tranche.empty)        <b><span class="alarm"> // stack of begin/end indices </span></b>
{
    begin, end, tmin <- tranche.pop  ; node <- begin ;
    while( node != end )                  <b><span class="alarm"> // over tranche of postorder traversal </span></b>
    {
        elevation = height - TREE_DEPTH(node) ;
        if(is_primitive(node)){ isect <- intersect_primitive(node, tmin) ;  csg.push(isect) }
        else{
            i_left, i_right = csg.pop, csg.pop          <b><span class="alarm">  // csg stack of intersect normals, t </span></b>
            l_state = CLASSIFY(i_left, ray.direction, tmin)
            r_state = CLASSIFY(i_right, ray.direction, tmin)
            action = LUT(operator(node), leftIsCloser)(l_state, r_state)

            if(      action is ReturnLeft/Right)     csg.push(i_left or i_right)
            else if( action is LoopLeft/Right)
            {
                left = 2*node ; right = 2*node + 1 ;
                endTranche = PACK( node,  end );
                leftTranche = PACK(  left << (elevation-1), right << (elevation-1) )
                rightTranche = PACK(  right << (elevation-1),  node  )
                loopTranche = action ? leftTranche : rightTranche

                tranche.push(endTranche, tmin)
                tranche.push(loopTranche, tminAdvanced ) <b><span class="alarm"> // subtree re-traversal with changed tmin </span></b>
                break ; // to next tranche
            }
        }
        node <- postorder_next(node, elevation)        <b><span class="alarm"> // bit twiddling postorder </span></b>
    }
}
isect = csg.pop();       <b><span class="alarm">  // winning intersect  </span></b>
</pre><p class="tiny"><a class="reference external" href="https://bitbucket.org/simoncblyth/opticks/src/tip/optixrap/cu/csg_intersect_boolean.h">https://bitbucket.org/simoncblyth/opticks/src/tip/optixrap/cu/csg_intersect_boolean.h</a></p>
</div>
<div class="slide" id="opticks-csg-primitives-closed-solids-consistent-normals">
<h1><span class="small">Opticks CSG Primitives : Closed Solids, Consistent Normals</span></h1>
<p class="small"><strong>Closed Solid</strong> as: <span class="blue">implementation requires otherside intersect</span>, <strong>Rigidly attached normals</strong></p>
<table border="1" class="small docutils">
<colgroup>
<col width="39%" />
<col width="29%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Type code</th>
<th class="head">Python name</th>
<th class="head">C++ nnode sub-struct</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>CSG_BOX3,CSG_BOX</td>
<td>box3,box</td>
<td>nbox</td>
</tr>
<tr><td>CSG_SPHERE,CSG_ZSPHERE</td>
<td>sphere,zsphere</td>
<td>nsphere,nzsphere</td>
</tr>
<tr><td>CSG_CYLINDER,CSG_DISC</td>
<td>cylinder,disc</td>
<td>ncylinder,ndisc</td>
</tr>
<tr><td>CSG_CONE</td>
<td>cone</td>
<td>ncone</td>
</tr>
<tr><td>CSG_CONVEXPOLYHEDRON</td>
<td>convexpolyhedron</td>
<td>nconvexpolyhedron</td>
</tr>
<tr><td>CSG_TRAPEZOID,CSG_SEGMENT</td>
<td>trapezoid,segment</td>
<td>nconvexpolyhedron</td>
</tr>
<tr><td>CSG_TORUS</td>
<td>torus</td>
<td>ntorus</td>
</tr>
<tr><td>CSG_HYPERBOLOID</td>
<td>hyperboloid</td>
<td>nhyperboloid</td>
</tr>
</tbody>
</table>
<ul class="small simple">
<li><strong>zsphere, cone, cylinder, disc</strong> : truncated shapes <strong>closed</strong> by endcaps <span class="red">&lt;-- NOT OPTIONAL</span></li>
<li><strong>disc</strong> : avoids endcap degeneracy with very thin cylinders</li>
<li><strong>convexpolyhedron</strong> : defined by a set of planes, used for trapezoid and segment</li>
<li><strong>segment</strong> :   prism shape used for deltaphi intersection</li>
<li><strong>!complemented</strong> (inside&lt;-&gt;outside) solids handled by
special casing classification (cannot miss otherside).</li>
</ul>
<p class="small">Non-primitives, <span class="red">high level CSG definition avoids loadsa code</span></p>
<ul class="small simple">
<li><strong>ellipsoid</strong> : non-uniform scaling of sphere,  <strong>polycone</strong> : union of cylinders and cones</li>
<li><strong>inner-radii</strong> : via subtraction, <strong>deltaphi-segment</strong> : via intersect with <strong>segment</strong></li>
</ul>
</div>
<div class="slide" id="opticks-csg-primitives-what-is-included">
<h1><span class="small">Opticks CSG Primitives : What is included</span></h1>
<div class="sidebar">
<p class="first sidebar-title">OptiX Geometry</p>
<p class="small">OptiX provides acceleration of geometrical intersection, not the intersection itself.</p>
<ul class="small simple">
<li>parametric ray : <strong>p(t) = p0 + t rayDir</strong></li>
<li>implicit surface : <strong>f(p) = 0</strong></li>
</ul>
<p class="small">Intersect finding next closest root:</p>
<ul class="small last simple">
<li>smallest <strong>t</strong>, with <strong>t &gt; tmin</strong></li>
<li>surface normal at <strong>t</strong></li>
</ul>
</div>
<p class="small">OptiX/CUDA functions providing:</p>
<ul class="small simple">
<li>axis aligned bounding box (AABB)</li>
<li>intersect ray position (parametric t), surface normal</li>
</ul>
<p class="small">C++/nnode sub-struct methods</p>
<ul class="small simple">
<li>signed distance function (SDF)</li>
<li>parametric surface generation</li>
</ul>
<p class="small"><strong>4x4 Transforms on any node (translation/rotation/scaling)</strong></p>
<p class="small"><span class="blue">Intersect inverse-transformed ray with un-transformed primitive</span></p>
<ul class="small simple">
<li>parametric-t same in both frames</li>
<li>inverse transform transposed brings normal back to world frame</li>
</ul>
<p class="tiny">Supporting non-uniform scaling requires <strong>rayDir</strong> not be be normalized (or assumed to be normalized) by primitives.</p>
</div>
<div class="slide" id="opticks-csg-balancing-deep-trees-drastically-improves-performance">
<h1><span class="small">Opticks CSG : Balancing Deep Trees Drastically Improves Performance</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Positive form CSG Trees</p>
<p class="small">Apply deMorgan pushing negations down tree</p>
<ul class="small simple">
<li><strong>A - B -&gt; A * !B</strong></li>
<li><strong>!(A*B) -&gt; !A + !B</strong></li>
<li><strong>!(A+B) -&gt; !A * !B</strong></li>
<li><strong>!(A - B) -&gt; !(A*!B) -&gt; !A + B</strong></li>
</ul>
<p class="small">End with only UNION, INTERSECT operators,
and some complemented leaves.</p>
<p class="small last"><span class="red">COMMUTATIVE -&gt; easily rearranged</span></p>
</div>
<p class="small">Intended for solids, not scenes (tree height &lt;8, &lt;256 nodes[*])</p>
<ul class="small simple">
<li>unbalanced trees inefficiently handled as complete binary trees</li>
<li>CSG trees non-unique, many expressions of same shape</li>
</ul>
<pre class="mypretiny">
Dayabay TopESRCutHols lvidx:57  (height:9 totnodes:1023)
di(di(di(di(di(di(di(di(di(cy,cy),cy),cy),cy),cy),cy),cy),cy),cy)

                                                                    di
                                                             di          cy
                                                     di          cy
                                             di          cy
                                     di          cy
                             di          cy
                     di          cy
             di          cy
     di          cy
 cy      cy


Balanced Tree, height:4 totnodes:31
in(in(in(in(cy,!cy),in(!cy,!cy)),in(in(!cy,!cy),in(!cy,!cy))),!cy)

                                                             in
                             in                                 !cy
             in                              in
     in              in              in              in
 cy     !cy     !cy     !cy     !cy     !cy     !cy     !cy
</pre><p class="tiny">[*] Algorithm has no inherent height limit, but use of complete binary tree imposes practical performance limitation</p>
</div>
<div class="slide" id="dayabay-esr-reflector-deep-csg-tree-disc-with-9-holes">
<h1><span class="small">Dayabay ESR reflector : Deep CSG tree : disc with 9 holes</span></h1>
<img alt="/env/presentation/lvidx_57_esr_deep_tree_disc_with_holes.png" class="align-center" src="/env/presentation/lvidx_57_esr_deep_tree_disc_with_holes.png" style="width: 1000px;" />
</div>
<div class="slide" id="opticks-csg-serialized-into-optickscsg-format-numpy-buffers-json">
<h1><span class="small">Opticks CSG Serialized into OpticksCSG format (numpy buffers, json)</span></h1>
<pre class="mypretiny">

// tboolean-parade

from opticks.ana.base import opticks_main
from opticks.analytic.csg import CSG

args = opticks_main(csgpath="$TMP/$FUNCNAME")

container = CSG("box", param=[0,0,0,1200], boundary=args.container, poly="MC", nx="20" )

a = CSG("sphere", param=[0,0,0,100])
b = CSG("zsphere", param=[0,0,0,100], param1=[-50,60,0,0])
c = CSG("box3",param=[100,50,70,0])
d = CSG.MakeTrapezoid(z=100, x1=80, y1=100, x2=100, y2=80)
e = CSG("cylinder",param=[0,0,0,100], param1=[-100,100,0,0])
f = CSG("disc",param=[0,0,0,100], param1=[-1,1,0,0])
g = CSG("cone", param=[100,-100,50,100])
h = CSG.MakeTorus(R=70, r=30)
i = CSG.MakeHyperboloid(r0=80, zf=100, z1=-100, z2=100)
j = CSG.MakeIcosahedron(scale=100.)

prims = [a,b,c,d,e,f,g,h,i,j]

...  // setting translations

CSG.Serialize([container] + prims, args.csgpath )   <b><span class="alarm">  <-- write trees to file </span></b>
</pre><ul class="small simple">
<li>imported into C++ <strong>nnode</strong> tree by <strong>NCSG</strong></li>
</ul>
</div>
<div class="slide" id="tconcentric-spherical-gdls-ls-mineraloil">
<h1><span class="small">tconcentric : spherical GdLS/LS/MineralOil</span></h1>
<img alt="/env/presentation/tconcentric-8cccccccc9ccccd.png" class="align-center" src="/env/presentation/tconcentric-8cccccccc9ccccd.png" style="width: 900px;" />
</div>
<div class="slide" id="tconcentric-opticks-geant4-chi2-comparison">
<h1><span class="small">tconcentric : Opticks/Geant4 chi2 comparison</span></h1>
<pre class="mypre">
.      seqhis_ana  1:concentric   -1:concentric     c2
.                       1000000   1000000       373.13/356 =  1.05  (pval:0.256 prob:0.744)
0000           8ccccd    669843    670001             0.02  [6 ] TO BT BT BT BT SA
0001               4d     83950     84149             0.24  [2 ] TO AB
0002          8cccc6d     45490     44770             5.74  [7 ] TO SC BT BT BT BT SA
0003           4ccccd     28955     28718             0.97  [6 ] TO BT BT BT BT AB
0004             4ccd     23187     23170             0.01  [4 ] TO BT BT AB
0005          8cccc5d     20238     20140             0.24  [7 ] TO RE BT BT BT BT SA
0006          8cc6ccd     10214     10357             0.99  [7 ] TO BT BT SC BT BT SA
0007          86ccccd     10176     10318             0.98  [7 ] TO BT BT BT BT SC SA
0008          89ccccd      7540      7710             1.90  [7 ] TO BT BT BT BT DR SA
0009         8cccc55d      5976      5934             0.15  [8 ] TO RE RE BT BT BT BT SA
0010              45d      5779      5766             0.01  [3 ] TO RE AB
0011  8cccccccc9ccccd      5339      5269             0.46  [15] TO BT BT BT BT DR BT BT BT BT BT BT BT BT SA
0012          8cc5ccd      5111      4940             2.91  [7 ] TO BT BT RE BT BT SA
0013              46d      4797      4886             0.82  [3 ] TO SC AB
0014      8cccc9ccccd      4494      4469             0.07  [11] TO BT BT BT BT DR BT BT BT BT SA
0015      8cccccc6ccd      3317      3302             0.03  [11] TO BT BT SC BT BT BT BT BT BT SA
0016         8cccc66d      2670      2675             0.00  [8 ] TO SC SC BT BT BT BT SA
0017          49ccccd      2432      2383             0.50  [7 ] TO BT BT BT BT DR AB
0018          4cccc6d      2043      1991             0.67  [7 ] TO SC BT BT BT BT AB
0019            4cc6d      1755      1826             1.41  [5 ] TO SC BT BT AB
</pre><p class="small">Top 20 chart above, (category 100 down to ~100 photons for propagation of 1M photons)</p>
</div>
<div class="slide" id="tconcentric-opticks-geant4-distrib-chi2-df-1-0">
<h1><span class="small">tconcentric : Opticks/Geant4 distrib chi2/df ~ 1.0</span></h1>
<ul class="small simple">
<li>Top 100 history categories correspond to ~900 propagation points</li>
<li>8 quantities at each point : ~7200 histograms pairs to chi2 compare</li>
<li>selecting discrepant points : distchi2 &gt; 1.1 (yields 41 out of 900 points)</li>
</ul>
<p class="tiny">XYZT:position/time ABCW:polarization/wavelength</p>
<table border="1" class="tiny docutils">
<colgroup>
<col width="3%" />
<col width="2%" />
<col width="4%" />
<col width="4%" />
<col width="41%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="5%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">iv</th>
<th class="head">is</th>
<th class="head">na</th>
<th class="head">nb</th>
<th class="head">reclab</th>
<th class="head">X</th>
<th class="head">Y</th>
<th class="head">Z</th>
<th class="head">T</th>
<th class="head">A</th>
<th class="head">B</th>
<th class="head">C</th>
<th class="head">W</th>
<th class="head">seqc2</th>
<th class="head">distc2</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>26</td>
<td>5</td>
<td>20238</td>
<td>20140</td>
<td>TO [RE] BT BT BT BT SA</td>
<td>0.85</td>
<td>0.00</td>
<td>0.00</td>
<td>1.31</td>
<td>1.12</td>
<td>1.37</td>
<td>1.10</td>
<td>0.78</td>
<td>0.24</td>
<td>1.10</td>
</tr>
<tr><td>27</td>
<td>5</td>
<td>20238</td>
<td>20140</td>
<td>TO RE [BT] BT BT BT SA</td>
<td>2.14</td>
<td>2.26</td>
<td>0.80</td>
<td>1.08</td>
<td>1.15</td>
<td>0.82</td>
<td>0.76</td>
<td>0.78</td>
<td>0.24</td>
<td>1.18</td>
</tr>
<tr><td>28</td>
<td>5</td>
<td>20238</td>
<td>20140</td>
<td>TO RE BT [BT] BT BT SA</td>
<td>2.01</td>
<td>2.23</td>
<td>0.79</td>
<td>0.83</td>
<td>1.17</td>
<td>0.83</td>
<td>0.83</td>
<td>0.78</td>
<td>0.24</td>
<td>1.17</td>
</tr>
<tr><td>29</td>
<td>5</td>
<td>20238</td>
<td>20140</td>
<td>TO RE BT BT [BT] BT SA</td>
<td>2.66</td>
<td>4.37</td>
<td>1.13</td>
<td>0.49</td>
<td>1.20</td>
<td>0.81</td>
<td>0.79</td>
<td>0.78</td>
<td>0.24</td>
<td>1.68</td>
</tr>
<tr><td>30</td>
<td>5</td>
<td>20238</td>
<td>20140</td>
<td>TO RE BT BT BT [BT] SA</td>
<td>2.56</td>
<td>4.48</td>
<td>1.19</td>
<td>1.04</td>
<td>1.12</td>
<td>0.97</td>
<td>0.91</td>
<td>0.78</td>
<td>0.24</td>
<td>1.75</td>
</tr>
<tr><td>31</td>
<td>5</td>
<td>20238</td>
<td>20140</td>
<td>TO RE BT BT BT BT [SA]</td>
<td>3.18</td>
<td>5.17</td>
<td>1.23</td>
<td>0.48</td>
<td>1.12</td>
<td>0.97</td>
<td>0.91</td>
<td>0.78</td>
<td>0.24</td>
<td>2.06</td>
</tr>
<tr><td>38</td>
<td>6</td>
<td>10214</td>
<td>10357</td>
<td>TO BT BT SC BT BT [SA]</td>
<td>0.79</td>
<td>1.37</td>
<td>1.43</td>
<td>0.55</td>
<td>1.00</td>
<td>1.33</td>
<td>0.97</td>
<td>0.00</td>
<td>0.99</td>
<td>1.16</td>
</tr>
<tr><td>52</td>
<td>8</td>
<td>7540</td>
<td>7710</td>
<td>TO BT BT BT BT DR [SA]</td>
<td>1.70</td>
<td>1.32</td>
<td>1.48</td>
<td>1.49</td>
<td>1.12</td>
<td>1.03</td>
<td>1.37</td>
<td>0.00</td>
<td>1.90</td>
<td>1.28</td>
</tr>
<tr><td>56</td>
<td>9</td>
<td>5976</td>
<td>5934</td>
<td>TO RE RE [BT] BT BT BT SA</td>
<td>1.26</td>
<td>1.51</td>
<td>1.21</td>
<td>2.36</td>
<td>0.99</td>
<td>1.40</td>
<td>1.10</td>
<td>1.65</td>
<td>0.15</td>
<td>1.24</td>
</tr>
<tr><td>57</td>
<td>9</td>
<td>5976</td>
<td>5934</td>
<td>TO RE RE BT [BT] BT BT SA</td>
<td>1.23</td>
<td>1.39</td>
<td>1.25</td>
<td>2.31</td>
<td>0.98</td>
<td>1.45</td>
<td>0.98</td>
<td>1.65</td>
<td>0.15</td>
<td>1.21</td>
</tr>
<tr><td>58</td>
<td>9</td>
<td>5976</td>
<td>5934</td>
<td>TO RE RE BT BT [BT] BT SA</td>
<td>1.24</td>
<td>0.98</td>
<td>1.18</td>
<td>1.88</td>
<td>0.97</td>
<td>1.39</td>
<td>1.01</td>
<td>1.65</td>
<td>0.15</td>
<td>1.14</td>
</tr>
<tr><td>59</td>
<td>9</td>
<td>5976</td>
<td>5934</td>
<td>TO RE RE BT BT BT [BT] SA</td>
<td>1.24</td>
<td>0.90</td>
<td>1.04</td>
<td>1.83</td>
<td>0.93</td>
<td>1.55</td>
<td>0.92</td>
<td>1.65</td>
<td>0.15</td>
<td>1.11</td>
</tr>
<tr><td>60</td>
<td>9</td>
<td>5976</td>
<td>5934</td>
<td>TO RE RE BT BT BT BT [SA]</td>
<td>0.95</td>
<td>1.03</td>
<td>1.50</td>
<td>3.12</td>
<td>0.93</td>
<td>1.55</td>
<td>0.92</td>
<td>1.65</td>
<td>0.15</td>
<td>1.18</td>
</tr>
<tr><td>69</td>
<td>11</td>
<td>5339</td>
<td>5269</td>
<td>TO BT BT BT BT [DR] BT BT BT BT BT BT BT BT SA</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>1.29</td>
<td>1.69</td>
<td>2.42</td>
<td>0.00</td>
<td>0.46</td>
<td>1.31</td>
</tr>
<tr><td>74</td>
<td>11</td>
<td>5339</td>
<td>5269</td>
<td>TO BT BT BT BT DR BT BT BT BT [BT] BT BT BT SA</td>
<td>1.10</td>
<td>1.45</td>
<td>1.02</td>
<td>0.67</td>
<td>1.42</td>
<td>0.83</td>
<td>1.38</td>
<td>0.00</td>
<td>0.46</td>
<td>1.12</td>
</tr>
<tr><td>75</td>
<td>11</td>
<td>5339</td>
<td>5269</td>
<td>TO BT BT BT BT DR BT BT BT BT BT [BT] BT BT SA</td>
<td>0.98</td>
<td>1.42</td>
<td>1.16</td>
<td>0.52</td>
<td>1.58</td>
<td>0.82</td>
<td>1.46</td>
<td>0.00</td>
<td>0.46</td>
<td>1.15</td>
</tr>
<tr><td>76</td>
<td>11</td>
<td>5339</td>
<td>5269</td>
<td>TO BT BT BT BT DR BT BT BT BT BT BT [BT] BT SA</td>
<td>1.46</td>
<td>1.66</td>
<td>0.79</td>
<td>0.65</td>
<td>1.69</td>
<td>0.89</td>
<td>1.46</td>
<td>0.00</td>
<td>0.46</td>
<td>1.21</td>
</tr>
<tr><td>77</td>
<td>11</td>
<td>5339</td>
<td>5269</td>
<td>TO BT BT BT BT DR BT BT BT BT BT BT BT [BT] SA</td>
<td>1.04</td>
<td>1.64</td>
<td>0.81</td>
<td>0.51</td>
<td>2.20</td>
<td>0.91</td>
<td>1.35</td>
<td>0.00</td>
<td>0.46</td>
<td>1.19</td>
</tr>
<tr><td>78</td>
<td>11</td>
<td>5339</td>
<td>5269</td>
<td>TO BT BT BT BT DR BT BT BT BT BT BT BT BT [SA]</td>
<td>1.10</td>
<td>1.56</td>
<td>0.73</td>
<td>0.21</td>
<td>2.20</td>
<td>0.91</td>
<td>1.35</td>
<td>0.00</td>
<td>0.46</td>
<td>1.17</td>
</tr>
<tr><td>85</td>
<td>12</td>
<td>5111</td>
<td>4940</td>
<td>TO BT BT RE BT BT [SA]</td>
<td>1.26</td>
<td>2.13</td>
<td>0.79</td>
<td>2.07</td>
<td>1.03</td>
<td>0.93</td>
<td>0.72</td>
<td>0.68</td>
<td>2.91</td>
<td>1.11</td>
</tr>
<tr><td>94</td>
<td>14</td>
<td>4494</td>
<td>4469</td>
<td>TO BT BT BT BT [DR] BT BT BT BT SA</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>1.90</td>
<td>3.74</td>
<td>1.95</td>
<td>0.00</td>
<td>0.07</td>
<td>2.01</td>
</tr>
<tr><td>95</td>
<td>14</td>
<td>4494</td>
<td>4469</td>
<td>TO BT BT BT BT DR [BT] BT BT BT SA</td>
<td>3.85</td>
<td>1.83</td>
<td>0.90</td>
<td>0.82</td>
<td>2.20</td>
<td>1.45</td>
<td>1.11</td>
<td>0.00</td>
<td>0.07</td>
<td>1.41</td>
</tr>
<tr><td>96</td>
<td>14</td>
<td>4494</td>
<td>4469</td>
<td>TO BT BT BT BT DR BT [BT] BT BT SA</td>
<td>1.94</td>
<td>1.82</td>
<td>1.07</td>
<td>0.85</td>
<td>2.67</td>
<td>1.30</td>
<td>1.08</td>
<td>0.00</td>
<td>0.07</td>
<td>1.39</td>
</tr>
<tr><td>97</td>
<td>14</td>
<td>4494</td>
<td>4469</td>
<td>TO BT BT BT BT DR BT BT [BT] BT SA</td>
<td>1.61</td>
<td>1.35</td>
<td>1.48</td>
<td>0.31</td>
<td>2.00</td>
<td>1.22</td>
<td>1.28</td>
<td>0.00</td>
<td>0.07</td>
<td>1.35</td>
</tr>
<tr><td>98</td>
<td>14</td>
<td>4494</td>
<td>4469</td>
<td>TO BT BT BT BT DR BT BT BT [BT] SA</td>
<td>1.96</td>
<td>1.31</td>
<td>1.39</td>
<td>0.66</td>
<td>2.13</td>
<td>1.03</td>
<td>1.42</td>
<td>0.00</td>
<td>0.07</td>
<td>1.36</td>
</tr>
<tr><td>99</td>
<td>14</td>
<td>4494</td>
<td>4469</td>
<td>TO BT BT BT BT DR BT BT BT BT [SA]</td>
<td>2.29</td>
<td>0.91</td>
<td>1.05</td>
<td>4.14</td>
<td>2.13</td>
<td>1.03</td>
<td>1.42</td>
<td>0.00</td>
<td>0.07</td>
<td>1.23</td>
</tr>
<tr><td>104</td>
<td>15</td>
<td>3317</td>
<td>3302</td>
<td>TO BT BT SC [BT] BT BT BT BT BT SA</td>
<td>0.60</td>
<td>1.02</td>
<td>1.75</td>
<td>1.92</td>
<td>0.77</td>
<td>1.23</td>
<td>1.39</td>
<td>0.00</td>
<td>0.03</td>
<td>1.20</td>
</tr>
<tr><td>105</td>
<td>15</td>
<td>3317</td>
<td>3302</td>
<td>TO BT BT SC BT [BT] BT BT BT BT SA</td>
<td>0.77</td>
<td>1.35</td>
<td>1.34</td>
<td>1.98</td>
<td>0.73</td>
<td>1.13</td>
<td>1.41</td>
<td>0.00</td>
<td>0.03</td>
<td>1.17</td>
</tr>
<tr><td>108</td>
<td>15</td>
<td>3317</td>
<td>3302</td>
<td>TO BT BT SC BT BT BT BT [BT] BT SA</td>
<td>1.48</td>
<td>1.01</td>
<td>1.73</td>
<td>0.51</td>
<td>0.85</td>
<td>1.00</td>
<td>1.05</td>
<td>0.00</td>
<td>0.03</td>
<td>1.15</td>
</tr>
<tr><td>124</td>
<td>17</td>
<td>2432</td>
<td>2383</td>
<td>TO BT BT BT BT [DR] AB</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>1.64</td>
<td>0.92</td>
<td>0.71</td>
<td>0.00</td>
<td>0.50</td>
<td>1.20</td>
</tr>
<tr><td>140</td>
<td>20</td>
<td>1815</td>
<td>1805</td>
<td>TO RE [RE] RE BT BT BT BT SA</td>
<td>1.80</td>
<td>0.56</td>
<td>1.73</td>
<td>0.59</td>
<td>1.31</td>
<td>1.20</td>
<td>1.42</td>
<td>0.60</td>
<td>0.03</td>
<td>1.26</td>
</tr>
<tr><td>141</td>
<td>20</td>
<td>1815</td>
<td>1805</td>
<td>TO RE RE [RE] BT BT BT BT SA</td>
<td>1.30</td>
<td>1.02</td>
<td>2.24</td>
<td>1.02</td>
<td>1.09</td>
<td>1.06</td>
<td>1.17</td>
<td>1.07</td>
<td>0.03</td>
<td>1.15</td>
</tr>
<tr><td>144</td>
<td>20</td>
<td>1815</td>
<td>1805</td>
<td>TO RE RE RE BT BT [BT] BT SA</td>
<td>1.05</td>
<td>1.32</td>
<td>1.03</td>
<td>0.53</td>
<td>0.93</td>
<td>1.31</td>
<td>1.12</td>
<td>1.07</td>
<td>0.03</td>
<td>1.10</td>
</tr>
<tr><td>222</td>
<td>29</td>
<td>1105</td>
<td>1168</td>
<td>TO BT BT RE BT BT [BT] BT BT BT SA</td>
<td>2.42</td>
<td>2.53</td>
<td>2.26</td>
<td>2.49</td>
<td>1.29</td>
<td>1.25</td>
<td>0.65</td>
<td>1.08</td>
<td>1.75</td>
<td>1.65</td>
</tr>
<tr><td>223</td>
<td>29</td>
<td>1105</td>
<td>1168</td>
<td>TO BT BT RE BT BT BT [BT] BT BT SA</td>
<td>2.32</td>
<td>2.44</td>
<td>1.98</td>
<td>2.38</td>
<td>1.03</td>
<td>1.07</td>
<td>0.72</td>
<td>1.08</td>
<td>1.75</td>
<td>1.53</td>
</tr>
<tr><td>224</td>
<td>29</td>
<td>1105</td>
<td>1168</td>
<td>TO BT BT RE BT BT BT BT [BT] BT SA</td>
<td>3.13</td>
<td>2.49</td>
<td>1.32</td>
<td>1.34</td>
<td>1.11</td>
<td>1.23</td>
<td>0.69</td>
<td>1.08</td>
<td>1.75</td>
<td>1.56</td>
</tr>
<tr><td>225</td>
<td>29</td>
<td>1105</td>
<td>1168</td>
<td>TO BT BT RE BT BT BT BT BT [BT] SA</td>
<td>2.83</td>
<td>2.44</td>
<td>1.36</td>
<td>1.06</td>
<td>0.92</td>
<td>1.08</td>
<td>0.69</td>
<td>1.08</td>
<td>1.75</td>
<td>1.47</td>
</tr>
<tr><td>226</td>
<td>29</td>
<td>1105</td>
<td>1168</td>
<td>TO BT BT RE BT BT BT BT BT BT [SA]</td>
<td>3.24</td>
<td>3.21</td>
<td>1.03</td>
<td>2.18</td>
<td>0.92</td>
<td>1.08</td>
<td>0.69</td>
<td>1.08</td>
<td>1.75</td>
<td>1.59</td>
</tr>
<tr><td>241</td>
<td>31</td>
<td>1067</td>
<td>1013</td>
<td>TO BT BT BT BT DR [BT] BT AB</td>
<td>1.25</td>
<td>1.53</td>
<td>0.80</td>
<td>0.27</td>
<td>2.03</td>
<td>0.90</td>
<td>1.40</td>
<td>0.00</td>
<td>1.40</td>
<td>1.27</td>
</tr>
<tr><td>242</td>
<td>31</td>
<td>1067</td>
<td>1013</td>
<td>TO BT BT BT BT DR BT [BT] AB</td>
<td>1.30</td>
<td>1.88</td>
<td>0.76</td>
<td>0.37</td>
<td>1.44</td>
<td>0.95</td>
<td>1.38</td>
<td>0.00</td>
<td>1.40</td>
<td>1.18</td>
</tr>
<tr><td>248</td>
<td>32</td>
<td>1036</td>
<td>988</td>
<td>TO RE BT BT [AB]</td>
<td>1.00</td>
<td>1.78</td>
<td>1.69</td>
<td>1.55</td>
<td>0.62</td>
<td>0.87</td>
<td>0.86</td>
<td>1.33</td>
<td>1.14</td>
<td>1.13</td>
</tr>
</tbody>
</table>
</div>
<div class="slide" id="pmt-opticks-geant4-step-distribution-comparison-to-bt-sd">
<h1><span class="small">PMT Opticks/Geant4 step distribution comparison TO BT [SD]</span></h1>
<p class="small"><strong>Good agreement reached</strong>, after several fixes: geometry, total internal reflection, group velocity</p>
<div class="figure align-left">
<img alt="/env/numerics/npy/PmtInBox_TOBTSD_xyzt.png" src="/env/numerics/npy/PmtInBox_TOBTSD_xyzt.png" style="width: 500px;" />
<p class="caption">position(xyz), time(t)</p>
</div>
<div class="figure align-right">
<img alt="/env/numerics/npy/PmtInBox_TOBTSD_abcr.png" src="/env/numerics/npy/PmtInBox_TOBTSD_abcr.png" style="width: 500px;" />
<p class="caption">polarization(abc), radius(r)</p>
</div>
</div>
<div class="slide" id="pmt-opticks-geant4-step-distribution-comparison-chi2-ndf">
<h1><span class="small">PMT Opticks/Geant4 step distribution comparison : chi2/ndf</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Consistent : chi2/ndf ~ 1</p>
<p class="small">Very good Opticks/Geant4 agreement</p>
<ul class="small simple">
<li>identical geometries</li>
<li>identical optical physics</li>
</ul>
<p class="small last">XYTZ: position, time
ABCR: polarization, radius</p>
</div>
<table border="1" class="tiny docutils">
<colgroup>
<col width="43%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">4/PMT In Box/torch :</th>
<th class="head">X</th>
<th class="head">Y</th>
<th class="head">Z</th>
<th class="head">T</th>
<th class="head">A</th>
<th class="head">B</th>
<th class="head">C</th>
<th class="head">R</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>340271/340273  :  [TO] BT SA</td>
<td>1.15</td>
<td>1.00</td>
<td>0.00</td>
<td>0.00</td>
<td>1.06</td>
<td>1.03</td>
<td>0.00</td>
<td>1.21</td>
</tr>
<tr><td>340271/340273  :  TO [BT] SA</td>
<td>1.15</td>
<td>1.00</td>
<td>1.06</td>
<td>0.91</td>
<td>1.06</td>
<td>1.03</td>
<td>0.00</td>
<td>1.21</td>
</tr>
<tr><td>340271/340273  :  TO BT [SA]</td>
<td>0.97</td>
<td>1.02</td>
<td>1.05</td>
<td>0.99</td>
<td>1.06</td>
<td>1.03</td>
<td>0.00</td>
<td>1.29</td>
</tr>
<tr><td>107598/107251  :  [TO] BT SD</td>
<td>0.91</td>
<td>0.73</td>
<td>0.56</td>
<td>0.56</td>
<td>0.98</td>
<td>1.09</td>
<td>0.56</td>
<td>0.94</td>
</tr>
<tr><td>107598/107251  :  TO [BT] SD</td>
<td>0.91</td>
<td>0.73</td>
<td>0.81</td>
<td>0.93</td>
<td>0.98</td>
<td>1.09</td>
<td>0.56</td>
<td>0.94</td>
</tr>
<tr><td>107598/107251  :  TO BT [SD]</td>
<td>0.99</td>
<td>0.83</td>
<td>0.97</td>
<td>0.99</td>
<td>0.98</td>
<td>1.09</td>
<td>0.56</td>
<td>0.93</td>
</tr>
<tr><td>23217/23260  :  [TO] BT BT SA</td>
<td>0.94</td>
<td>0.82</td>
<td>0.04</td>
<td>0.04</td>
<td>0.97</td>
<td>0.89</td>
<td>0.04</td>
<td>0.57</td>
</tr>
<tr><td>23217/23260  :  TO [BT] BT SA</td>
<td>0.94</td>
<td>0.82</td>
<td>0.70</td>
<td>0.50</td>
<td>0.97</td>
<td>0.89</td>
<td>0.04</td>
<td>0.57</td>
</tr>
<tr><td>23217/23260  :  TO BT [BT] SA</td>
<td>0.91</td>
<td>0.94</td>
<td>0.43</td>
<td>0.60</td>
<td>0.97</td>
<td>0.89</td>
<td>0.04</td>
<td>0.05</td>
</tr>
<tr><td>23217/23260  :  TO BT BT [SA]</td>
<td>0.94</td>
<td>0.88</td>
<td>0.04</td>
<td>0.35</td>
<td>0.97</td>
<td>0.89</td>
<td>0.04</td>
<td>0.72</td>
</tr>
<tr><td>18866/19048  :  [TO] AB</td>
<td>0.99</td>
<td>1.10</td>
<td>0.87</td>
<td>0.87</td>
<td>0.85</td>
<td>0.84</td>
<td>0.87</td>
<td>1.00</td>
</tr>
<tr><td>18866/19048  :  TO [AB]</td>
<td>0.99</td>
<td>1.10</td>
<td>0.93</td>
<td>0.92</td>
<td>0.85</td>
<td>0.84</td>
<td>0.87</td>
<td>1.00</td>
</tr>
<tr><td>3179/3133  :  [TO] SC SA</td>
<td>1.07</td>
<td>0.83</td>
<td>0.34</td>
<td>0.34</td>
<td>0.86</td>
<td>0.96</td>
<td>0.34</td>
<td>0.73</td>
</tr>
<tr><td>3179/3133  :  TO [SC] SA</td>
<td>1.07</td>
<td>0.83</td>
<td>0.98</td>
<td>1.05</td>
<td>0.98</td>
<td>1.06</td>
<td>0.98</td>
<td>0.73</td>
</tr>
<tr><td>3179/3133  :  TO SC [SA]</td>
<td>0.96</td>
<td>1.04</td>
<td>0.93</td>
<td>0.97</td>
<td>0.98</td>
<td>1.06</td>
<td>0.98</td>
<td>1.10</td>
</tr>
<tr><td>2204/2249  :  [TO] BT AB</td>
<td>0.85</td>
<td>1.04</td>
<td>0.45</td>
<td>0.45</td>
<td>0.99</td>
<td>0.92</td>
<td>0.45</td>
<td>1.06</td>
</tr>
<tr><td>2204/2249  :  TO [BT] AB</td>
<td>0.85</td>
<td>1.04</td>
<td>0.95</td>
<td>0.88</td>
<td>0.99</td>
<td>0.92</td>
<td>0.45</td>
<td>1.06</td>
</tr>
<tr><td>2204/2249  :  TO BT [AB]</td>
<td>0.98</td>
<td>0.94</td>
<td>1.01</td>
<td>1.00</td>
<td>0.99</td>
<td>0.92</td>
<td>0.45</td>
<td>0.90</td>
</tr>
<tr><td>1696/1732  :  [TO] BT BT AB</td>
<td>1.05</td>
<td>0.85</td>
<td>0.38</td>
<td>0.38</td>
<td>0.86</td>
<td>1.09</td>
<td>0.38</td>
<td>0.26</td>
</tr>
<tr><td>1696/1732  :  TO [BT] BT AB</td>
<td>1.05</td>
<td>0.85</td>
<td>1.48</td>
<td>1.28</td>
<td>0.86</td>
<td>1.09</td>
<td>0.38</td>
<td>0.26</td>
</tr>
<tr><td>1696/1732  :  TO BT [BT] AB</td>
<td>0.99</td>
<td>0.86</td>
<td>1.17</td>
<td>1.40</td>
<td>0.86</td>
<td>1.09</td>
<td>0.38</td>
<td>0.86</td>
</tr>
<tr><td>1696/1732  :  TO BT BT [AB]</td>
<td>1.15</td>
<td>0.88</td>
<td>1.08</td>
<td>1.06</td>
<td>0.86</td>
<td>1.09</td>
<td>0.38</td>
<td>0.79</td>
</tr>
<tr><td>1446/1455  :  [TO] BR SA</td>
<td>1.21</td>
<td>0.94</td>
<td>0.03</td>
<td>0.03</td>
<td>0.90</td>
<td>0.87</td>
<td>0.03</td>
<td>1.09</td>
</tr>
<tr><td>1446/1455  :  TO [BR] SA</td>
<td>1.21</td>
<td>0.94</td>
<td>1.02</td>
<td>1.01</td>
<td>0.90</td>
<td>0.87</td>
<td>0.03</td>
<td>1.09</td>
</tr>
<tr><td>1446/1455  :  TO BR [SA]</td>
<td>1.00</td>
<td>0.93</td>
<td>0.97</td>
<td>0.99</td>
<td>0.90</td>
<td>0.87</td>
<td>0.03</td>
<td>1.04</td>
</tr>
</tbody>
</table>
</div>
<div class="slide" id="opticks-geant4-rainbow-step-sequence-comparison">
<h1><span class="small">Opticks/Geant4 Rainbow Step Sequence Comparison</span></h1>
<dl class="small docutils">
<dt><strong>Flags:</strong></dt>
<dd><ul class="first last simple">
<li>BT/BR: boundary transmit/reflect</li>
<li>TO/SC/SA: torch/scatter/surface absorb</li>
</ul>
</dd>
</dl>
<p class="small"><strong>Statistically consistent photon histories in the two simulations : Multiple orders of rainbow apparent</strong></p>
<pre class="mypre">
 64-bit uint  Opticks    Geant4    chi2                                      (tag:5,-5)

        8ccd   819160    819654    0.15  [4 ] TO BT BT SA                    (cross droplet)
         8bd   102087    101615    1.09  [3 ] TO BR SA                       (external reflect)
       8cbcd    61869     61890    0.00  [5 ] TO BT BR BT SA                 (bow 1)
      8cbbcd     9618      9577    0.09  [6 ] TO BT BR BR BT SA              (bow 2)
     8cbbbcd     2604      2687    1.30  [7 ] TO BT BR BR BR BT SA           (bow 3)
    8cbbbbcd     1056      1030    0.32  [8 ] TO BT BR BR BR BR BT SA        (bow 4)
       86ccd     1014      1000    0.10  [5 ] TO BT BT SC SA
   8cbbbbbcd      472       516    1.96  [9 ] TO BT BR BR BR BR BR BT SA     (bow 5)
         86d      498       473    0.64  [3 ] TO SC SA
  bbbbbbbbcd      304       294    0.17  [10] TO BT BR BR BR BR BR BR BR BR  (bow 8+ truncated)
  8cbbbbbbcd      272       247    1.20  [10] TO BT BR BR BR BR BR BR BT SA  (bow 6)
  cbbbbbbbcd      183       161    1.41  [10] TO BT BR BR BR BR BR BR BR BT  (bow 7 truncated)
</pre></div>
<div class="slide" id="m-rainbow-s-polarized-comparison-opticks-geant4">
<h1><span class="small">1M Rainbow S-Polarized, Comparison Opticks/Geant4</span></h1>
<p class="tiny">Deviation angle(degrees) of 1M parallel monochromatic photons in disc shaped beam incident on water sphere.
Numbered bands are visible range expectations of first 11 rainbows.
S-Polarized intersection (E field perpendicular to plane of incidence) arranged by directing polarization radially.</p>
<img alt="/env/optix/cfg4/rainbow-cfg4-spol.png" class="align-center" src="/env/optix/cfg4/rainbow-cfg4-spol.png" style="width: 800px;" />
</div>
<div class="slide" id="compare-opticks-geant4-simulations-with-simple-lights-geometries">
<h1><span class="small">Compare Opticks/Geant4 Simulations with Simple Lights/Geometries</span></h1>
<div class="figure align-left">
<img alt="/env/graphics/ggeoview/rainbow-spol-disc-incident-sphere.png" src="/env/graphics/ggeoview/rainbow-spol-disc-incident-sphere.png" style="width: 550px;" />
<p class="caption">1M Photons -&gt; Water Sphere (S-Polarized)</p>
</div>
<div class="figure align-right">
<img alt="/env/graphics/ggeoview/PmtInBox-approach.png" src="/env/graphics/ggeoview/PmtInBox-approach.png" style="width: 450px;" />
<p class="caption">0.5M Photons -&gt; Dayabay PMT</p>
</div>
<img alt="/env/presentation/1px.png" class="align-center" src="/env/presentation/1px.png" style="width: 1000px; height: 1px;" />
<dl class="small docutils">
<dt><strong>Photon step records</strong></dt>
<dd>128 bit per step : highly compressed position, time, wavelength, polarization vector, material/history codes</dd>
<dt><strong>Photon flag sequence</strong></dt>
<dd>16x 4-bit step flags recorded in uint64 sequence, indexed using Thrust GPU sort (1M indexed ~0.040s)</dd>
</dl>
<p class="small"><strong>Sequence index</strong> -&gt; interactive OpenGL selection of photons by flag sequence</p>
</div>
<div class="slide" id="optix-performance-scaling-with-gpu-cores">
<h1><span class="small">OptiX Performance Scaling with GPU cores</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Performance Linearity with CUDA cores</p>
<img alt="/env/g4dae/core_linearity.png" class="last align-right" src="/env/g4dae/core_linearity.png" style="width: 500px;" />
</div>
<p class="small">OptiX sample rendering with 2 GPU IHEP workstation,</p>
<ul class="small simple">
<li>2 Tesla K20m (4992 cores) 28.0 ms/f</li>
<li>1 Tesla K20m (2496 cores) 49.1 ms/f</li>
<li>1 GeForce GT 750m (384 cores) 345.1 ms/f</li>
</ul>
<p class="small"><span class="red">Performance linear with GPU cores</span>, compared to laptop:</p>
<ul class="small simple">
<li>13x cores, 12x performance</li>
<li>performance scales across GPUs</li>
</ul>
<p class="small">Benefit from multiple GPUs with no development effort.</p>
</div>
<div class="slide" id="torus-much-more-difficult-expensive-than-other-primitives">
<h1><span class="small">Torus : much more difficult/expensive than other primitives</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Torus artifacts</p>
<blockquote>
<img alt="/env/presentation/tboolean_torus_orthographic_artifact.png" class="align-right" src="/env/presentation/tboolean_torus_orthographic_artifact.png" style="width: 400px;" />
</blockquote>
<img alt="/env/presentation/torus_eqn_sqrt.png" class="align-right" src="/env/presentation/torus_eqn_sqrt.png" style="width: 400px;" />
<img alt="/env/presentation/torus_eqn_quartic.png" class="last align-right" src="/env/presentation/torus_eqn_quartic.png" style="width: 400px;" />
</div>
<p class="small">3D parametric ray : <strong>ray(x,y,z;t) = rayOrigin  +  t * rayDirection</strong></p>
<ul class="small simple">
<li>ray-torus intersection -&gt; solve quartic polynomial in <strong>t</strong></li>
<li>A t^4 + B t^3 + C t^2 + D t + E = 0</li>
</ul>
<p class="small">High order equation</p>
<ul class="small simple">
<li>very large difference between coefficients</li>
<li>varying ray -&gt; wide range of very coefficients</li>
<li>numerically problematic, requires double precision</li>
<li>several mathematical approaches used, work in progress</li>
</ul>
<p class="small"><strong>Best Solution : replace torus</strong></p>
<ul class="small simple">
<li>eg model PMT neck with hyperboloid, not cylinder-torus</li>
</ul>
</div>
<div class="slide" id="geometry-modelling-tesselated-vs-analytic-photomultiplier-tubes">
<h1><span class="small">Geometry Modelling : Tesselated vs Analytic Photomultiplier Tubes</span></h1>
<img alt="/env/graphics/ggeoview/dpib-triangulated-pmt.png" class="align-left" src="/env/graphics/ggeoview/dpib-triangulated-pmt.png" style="width: 550px;" />
<img alt="/env/nuwa/detdesc/pmt/hemi-pmt-analytic-near-clipped.png" class="align-right" src="/env/nuwa/detdesc/pmt/hemi-pmt-analytic-near-clipped.png" style="width: 550px;" />
<img alt="/env/presentation/1px.png" class="align-center" src="/env/presentation/1px.png" style="width: 1000px; height: 1px;" />
<p class="small">Analytic : more realistic, faster, less memory, <strong>much more effort</strong></p>
<p class="small">For Dayabay PMT:</p>
<ul class="small simple">
<li>partition CSG solids into 12 <strong>single primitive</strong> parts (instead of 2928 triangles)</li>
<li>splitting at geometrical intersections avoids implementing general CSG boolean handling</li>
<li>geometry provided to OptiX in form of ray intersection and bounding box code</li>
</ul>
<p class="small"><strong>Aim : analytic description of geometry on critical optical path, remainder tesselated</strong></p>
</div>
<div class="slide" id="opticksdocs">
<h1><span class="i">OpticksDocs</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Open Source Opticks</p>
<ul class="small simple">
<li><a class="reference external" href="http://simoncblyth.bitbucket.io/opticks/">http://simoncblyth.bitbucket.io/opticks/</a></li>
<li><a class="reference external" href="http://bitbucket.org/simoncblyth/opticks/">http://bitbucket.org/simoncblyth/opticks/</a></li>
</ul>
<p class="small">Documentation, install instructions. Repository.</p>
<ul class="small simple">
<li>Mac, Linux, Windows (*)</li>
<li>16 C++ projects, ordered by dependency</li>
<li>~200 &quot;Unit&quot; Tests (CMake/CTest)</li>
<li>12 integration tests: tpmt, trainbow, tprism, treflect, tlens, tnewton, tg4gun, ...</li>
<li>NumPy/Python analysis/debugging scripts</li>
</ul>
<p class="small">Geometry/event data use NumPy serialization:</p>
<pre class="small literal-block">
import numpy as np
a = np.load(&quot;photons.npy&quot;)
</pre>
<p class="tiny last">(*) Windows VS2015, non-CUDA only so far</p>
</div>
</div>
<div class="slide" id="nvidia-optix-1">
<h1><span class="i">NVIDIA OptiX 1</span></h1>
</div>
<div class="slide" id="nvidia-optix-2">
<h1><span class="i">NVIDIA OptiX 2</span></h1>
<div class="sidebar">
<p class="first sidebar-title">NVIDIA® OptiX™</p>
<p class="small"><a class="reference external" href="http://developer.nvidia.com/optix">http://developer.nvidia.com/optix</a></p>
<ul class="small last simple">
<li>no rendering assumptions</li>
<li><strong>just accelerates ray-geometry intersections</strong></li>
<li><span class="red">compiler optimized for GPU ray tracing</span></li>
<li>regular improvements, new GPU tuning</li>
<li>NVIDIA expertise on GPU/multi-GPU usage<ul>
<li>~linear scaling with cores across GPUs</li>
</ul>
</li>
<li>free to acquire, use, distribute non-commercially</li>
<li><span class="blue">simple : single-ray programming model</span></li>
</ul>
</div>
<img alt="/env/presentation/1px.png" class="align-center" src="/env/presentation/1px.png" style="width: 1px; height: 100px;" />
<p class="tiny"><tt class="docutils literal"><span class="pre">https://research.nvidia.com/publication/optix-general-purpose-ray-tracing-engine</span></tt></p>
</div>
<div class="slide" id="ray-intersection-with-general-csg-binary-tree-solids-within-optix">
<h1><span class="small">Ray intersection with general CSG binary tree solids within OptiX</span></h1>
<div class="sidebar">
<p class="first sidebar-title">Very close GPU/CPU match is possible</p>
<ul class="small last simple">
<li>same analytic geometry</li>
<li>same optical physics</li>
</ul>
</div>
<p class="small"><strong>Performance on GPU requires</strong></p>
<ul class="small simple">
<li>massive parallelism -&gt; more the merrier</li>
<li>low register usage -&gt; keep it simple</li>
<li>small stack size -&gt; <strong>avoid recursion</strong> : OptiX demands: <span class="red">no recursion in intersect</span></li>
</ul>
<p class="small"><strong>Approach (details in backup)</strong></p>
<ul class="small simple">
<li>Complete Binary Tree Serialization<ul>
<li>postorder tree traversal, just by bit twiddling (avoids recursion)</li>
</ul>
</li>
<li>Ray Tracing CSG Objects Using Single Hit Intersections (A. Kensler)[1]<ul>
<li>binary intersect classification, lookup table</li>
<li>avoids lots of state, BUT: sometimes advance <strong>t_min</strong> and re-intersect</li>
<li>converted recursive pseudocode into &quot;Evaluative&quot; implementation [2]</li>
</ul>
</li>
<li>Auto translation of GDML into GPU appropriate form<ul>
<li>entire geometry translated, serialized, uploaded to GPU</li>
</ul>
</li>
</ul>
<dl class="tiny docutils">
<dt>[1] Ray Tracing CSG Objects Using Single Hit Intersections, Andrew Kensler (2006)</dt>
<dd>with corrections by author of XRT Raytracer <a class="reference external" href="http://xrt.wikidot.com/doc:csg">http://xrt.wikidot.com/doc:csg</a></dd>
</dl>
<p class="tiny">[2] Similar to binary expression tree evaluation using postorder traverse.</p>
</div>
<div class="slide" id="opticks-analytic-juno-pmt-snap-gpu-raytrace-1">
<h1><span class="i">Opticks Analytic JUNO PMT Snap, GPU Raytrace (1)</span></h1>
</div>
<div class="slide" id="gpu-instance-culling-with-level-of-detail">
<h1><span class="i">GPU Instance Culling with Level Of Detail</span></h1>
</div>
<div class="slide" id="large-geometry-techniques-instancing-mandatory">
<h1><span class="small">Large Geometry Techniques : Instancing Mandatory</span></h1>
<p class="small"><strong>Geometry analysed to find repeats</strong></p>
<p class="small">JUNO: 18k 20&quot; PMTs, 36k 3&quot; PMTs</p>
<p class="small">Instances used by:</p>
<ul class="small simple">
<li>OptiX geometry</li>
<li>OptiX acceleration structures</li>
<li>OpenGL visualization</li>
</ul>
<p class="small"><strong>Advantages</strong></p>
<ul class="small simple">
<li>drastic reduction in GPU memory</li>
<li>one set of vertices for each PMT type</li>
<li>4x4 matrices position each PMT</li>
</ul>
<p class="small"><strong>Viz Optimizations (OpenGL 4+)</strong></p>
<p class="small">Use geometry shader transform feedback:</p>
<ul class="small simple">
<li>cull non-visible instances</li>
<li>level of detail (LOD) meshes<ul>
<li>full/simplified/bbox</li>
</ul>
</li>
<li>switch mesh based on distance to PMT</li>
</ul>
</div>
<div class="slide" id="opticks-whats-new">
<h1><span class="small">Opticks : Whats New ?</span></h1>
<p class="large"><strong>Geometry Handling</strong></p>
<ul class="large simple">
<li>General CSG boolean geometry intersection on GPU<ul>
<li><span class="red">Geant4 geometry auto-translated to GPU without approximation</span></li>
</ul>
</li>
<li>Geometry direct from Geant4, no export/import needed</li>
<li>Export Geant4 geometry to glTF 2.0 for visualization</li>
</ul>
<p class="large"><strong>Validation</strong></p>
<ul class="large simple">
<li>make any solid emit CPU generated &quot;input&quot; photons</li>
<li>random sequence aligned validations</li>
</ul>
<p class="large"><strong>Configuration</strong></p>
<ul class="large simple">
<li>Modern CMake 3.5 target export -&gt; easy integration with your code</li>
</ul>
<p class="large"><strong>Community</strong></p>
<ul class="large simple">
<li>Opticks mailing list : <a class="reference external" href="https://groups.io/g/opticks">https://groups.io/g/opticks</a></li>
</ul>
</div>
<div class="slide" id="opticks-analytic-daya-bay-near-site-gpu-raytrace-0">
<h1><span class="i">Opticks Analytic Daya Bay Near Site, GPU Raytrace (0)</span></h1>
</div>
<div class="slide" id="opticks-analytic-daya-bay-near-site-gpu-raytrace-1">
<h1><span class="i">Opticks Analytic Daya Bay Near Site, GPU Raytrace (1)</span></h1>
</div>
<div class="slide" id="opticks-analytic-daya-bay-near-site-gpu-raytrace-2">
<h1><span class="i">Opticks Analytic Daya Bay Near Site, GPU Raytrace (2)</span></h1>
<p><tt class="docutils literal">Cutaway view of Daya Bay <span class="pre">Antineutrino-detector</span></tt></p>
</div>
<div class="slide" id="photorealistic-detector-images-using-gltf-renderer-or-optix-raytrace">
<h1><span class="small">Photorealistic detector images : using glTF renderer or OptiX raytrace</span></h1>
<ul class="small simple">
<li>PBR (Physically Based Rendering) support in glTF</li>
</ul>
<table border="1" class="small docutils">
<colgroup>
<col width="41%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">rasterized : fast, approximate</th>
<th class="head">ray-traced : highest quality</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><ul class="first last simple">
<li>apply glTF Physically Based Rendering (PBR)</li>
</ul>
</td>
<td><ul class="first last simple">
<li>&quot;simulate&quot; taking photograph : improve current minimal Lambertian shading</li>
</ul>
</td>
</tr>
<tr><td><ul class="first last simple">
<li>material/surface properties <em>f([nm])</em> -&gt; PBR param</li>
</ul>
</td>
<td><ul class="first last simple">
<li>NVIDIA® OptiX™ AI-Accelerated Denoiser : exploits Volta tensor cores</li>
</ul>
</td>
</tr>
<tr><td><ul class="first last simple">
<li>incorporate into Opticks glTF export</li>
</ul>
</td>
<td><ul class="first last simple">
<li>NVIDIA® Material Definition Language (MDL), BSDF based, renderer independent</li>
</ul>
</td>
</tr>
<tr><td><ul class="first last simple">
<li>find/install/test open source glTF PBR renderers</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Event display : overlay via compositing</li>
</ul>
</td>
</tr>
<tr><td><ul class="first last simple">
<li>separate OpenGL shaders for event display</li>
</ul>
</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<!-- comment

* NVIDIA® Material Definition Language (MDL) : BSDF based, renderer independent :small:`https://developer.nvidia.com/mdl-sdk`
BSDF : Bidirectional Scattering Distribution Functions

:small:`https://developer.nvidia.com/optix-denoiser` -->
</div>
<div class="slide" id="opticks-analytic-daya-bay-near-site-gpu-raytrace-3">
<h1><span class="i">Opticks Analytic Daya Bay Near Site, GPU Raytrace (3)</span></h1>
<p><tt class="docutils literal">GPU raytrace : purely analytic geometry (Daya Bay Near Site)</tt></p>
</div>
</div>
</body>
</html>
